"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7679],{10795:function(a,l,o){o.r(l),o.d(l,{default:function(){return Xc}});var s,d,m,p,h=o(15059),v=o(36609),b=o(12849),x=o(67294),w=o(68188),E=o(7207),C=o(57632),k=o(39597),I=o(76076),A=o(42216),O=o(4511),M=o(86744),P=o(82968),L=o(29619),F=o(58369),z=o(94801),_=o(91036),H=o(93041),V=o(43338),N=o(79890),U=o(38886),q=o(69203),G=o(22512);let Y="clover",K=Object.fromEntries(Object.entries({en:{commonClose:"Close",commonNext:"Next",commonPrevious:"Previous",commonSearch:"Search",commonSearchPlaceholder:"Search...",commonShare:"Share",commonViewAll:"View All",copyFailure:"Failed",copySuccess:"Copied",contentSearchLoading:"Loading...",contentSearchPlaceholder:"Search",contentSearchResultsNone:"No Results",contentSearchResultsMore:"More Results",informationPanelTabs:"Select",informationPanelTabsClose:"Viewer",informationPanelTabsAbout:"About",informationPanelTabsAnnotations:"Annotations",informationPanelTabsSearch:"Search",informationPanelToggle:"More Information",shareCollectionJson:"View Collection",shareCollectionCopy:"Copy Collection URL",shareManifestJson:"View Manifest",shareManifestCopy:"Copy Manifest URL"},pt:{}}).map(([a,l])=>[a,{[`${Y}`]:l}]));v.ZP.use(h.Z).use(b.Db).init({defaultNS:Y,fallbackLng:"en",ns:[Y],resources:{...K}});var W=function(a){return function(){let l={type:a,getType:()=>a,toString:()=>a};return(a,o)=>({...l,...void 0!==a&&{payload:a},...void 0!==o&&{meta:o}})}},ee="@iiif/IMPORT_ENTITIES",et="@iiif/MODIFY_ENTITY_FIELD",ei="@iiif/REORDER_ENTITY_FIELD",en="@iiif/ADD_REFERENCE",er="@iiif/UPDATE_REFERENCE",el="@iiif/REMOVE_REFERENCE",eo="@iiif/ADD_METADATA",es="@iiif/REMOVE_METADATA",ed="@iiif/UPDATE_METADATA",eu="@iiif/REORDER_METADATA",em=W(ee)(),ep=W(et)(),eh=W(ei)(),ef=W(en)(),eg=W(el)(),ev=W(er)(),ey=W(eo)(),eb=W(ed)(),ex={importEntities:em,modifyEntityField:ep,reorderEntityField:eh,addReference:ef,removeReference:eg,updateReference:ev,addMetadata:ey,removeMetadata:W(es)(),updateMetadata:eb,reorderMetadata:W(eu)()},ew="@iiif/ADD_MAPPING",eE="@iiif/ADD_MAPPINGS",eS=W(ew)(),eC=W(eE)(),ek="RESOURCE_ERROR",eI="RESOURCE_LOADING",eA="RESOURCE_READY",eT="@iiif/REQUEST_RESOURCE",eR="@iiif/REQUEST_ERROR",e$="@iiif/REQUEST_MISMATCH",eO="@iiif/REQUEST_COMPLETE",eM=W(eT)(),eP=W(eR)(),eL=W(e$)(),eF=W(eO)(),ez="@iiif/BATCH",ej=W(ez)(),ea=(a,l)=>{let{entities:o,resource:s,mapping:d}=(0,w.z)(l);if(void 0===s.id)return[eP({id:a,message:"ID is not defined in resource."})];let m=[em({entities:o}),eC({mapping:d})];return s.id!==a&&(m.push(eS({id:a,type:s.type})),m.push(eL({requestId:a,actualId:s.id}))),m.push(eF({id:a})),m},e_=Number.isNaN||function(a){return"number"==typeof a&&a!=a};function Rt(a,l){if(!Array.isArray(a)||!Array.isArray(l))return a===l;if(a.length!==l.length)return!1;for(let d=0;d<a.length;d++){var o,s;if(!((o=a[d])===(s=l[d])||e_(o)&&e_(s)))return!1}return!0}function Qe(a,l,o){let s=a.iiif.requests[l],d=a.iiif.mapping[l];if(!d||!a.iiif.entities[d][s.resourceUri])return;let m=a.iiif.entities[d][s.resourceUri];if(m&&m[w.c]){let a=m[w.c].find(a=>a[w.d]===m.id);return(0,w.j)(m,a)}return m}function kt(a,l,{waitTimeout:o=30}={}){return(s,d)=>{let m=a.getStore(),p=m.getState(),h=p.iiif.requests[s];if(h){if(h.loadingState===eA){let a=Qe(p,s);if(a)return a}switch(h.loadingState){case ek:break;case eI:return(async()=>{let a,l=!1;try{let d=await Promise.race([new Promise((o,d)=>{l||(a=m.subscribe(()=>{let a=m.getState();if(a.iiif.requests[s].loadingState===ek){d();return}if(a.iiif.requests[s].loadingState===eA){let l=Qe(a,s);l?o(l):d()}}))}),new Promise((a,s)=>setTimeout(()=>{l=!0,s()},6e4*o))]);if(a&&a(),d)return d}catch{a&&a()}})()}}a.dispatch(eM({id:s}));let c=l=>{if(!l)return;l.id||l["@id"]||(l["@type"]&&(l["@id"]=s),l.id=s);let o=ea(s,l);return a.dispatch(ej({actions:o})),Qe(m.getState(),s)};try{let o=l(s,d);return o&&"function"==typeof o.then?(async()=>{try{return c(await o)}catch(l){throw a.dispatch(eP({id:s,message:l.toString()})),l}})():c(o)}catch(l){throw a.dispatch(eP({id:s,message:l.toString()})),l}}}function vr(){return{Collection:{},Manifest:{},Canvas:{},AnnotationPage:{},AnnotationCollection:{},Annotation:{},ContentResource:{},Range:{},Service:{},Selector:{},Agent:{}}}let eB={};var $t=a=>{let l;let o=new Set,n=(a,s)=>{let d="function"==typeof a?a(l):a;if(!Object.is(d,l)){let a=l;l=s??("object"!=typeof d||null===d)?d:Object.assign({},l,d),o.forEach(o=>o(l,a))}},i=()=>l,s={setState:n,getState:i,getInitialState:()=>d,subscribe:a=>(o.add(a),()=>o.delete(a)),destroy:()=>{(eB?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),o.clear()}},d=l=a(n,i,s);return s},ia=a=>a?$t(a):$t,eD="@iiif/SET_META_VALUE",eW="@iiif/SET_META_VALUE_DYNAMIC",eH="@iiif/UNSET_META_VALUE",eV={setMetaValue:W(eD)(),setMetaValueDynamic:W(eW)(),unsetMetaValue:W(eH)()};let eN={};var ca=(a,l)=>(o,s,d)=>(d.dispatch=l=>(o(o=>a(o,l),!1,l),l),d.dispatchFromDevtools=!0,{dispatch:(...a)=>d.dispatch(...a),...l}),eU=new Map,$e=a=>{let l=eU.get(a);return l?Object.fromEntries(Object.entries(l.stores).map(([a,l])=>[a,l.getState()])):{}},da=(a,l,o)=>{if(void 0===a)return{type:"untracked",connection:l.connect(o)};let s=eU.get(o.name);if(s)return{type:"tracked",store:a,...s};let d={connection:l.connect(o),stores:{}};return eU.set(o.name,d),{type:"tracked",store:a,...d}},ma=(a,l={})=>(o,s,d)=>{let m;let{enabled:p,anonymousActionType:h,store:v,...b}=l;try{m=(p??(eN?"production":void 0)!=="production")&&window.__REDUX_DEVTOOLS_EXTENSION__}catch{}if(!m)return(eN?"production":void 0)!=="production"&&p&&console.warn("[zustand devtools middleware] Please install/enable Redux devtools extension"),a(o,s,d);let{connection:x,...w}=da(v,m,b),E=!0;d.setState=(a,l,m)=>{let p=o(a,l);if(!E)return p;let w=void 0===m?{type:h||"anonymous"}:"string"==typeof m?{type:m}:m;return void 0===v?null==x||x.send(w,s()):null==x||x.send({...w,type:`${v}/${w.type}`},{...$e(b.name),[v]:d.getState()}),p};let g=(...a)=>{let l=E;E=!1,o(...a),E=l},C=a(d.setState,s,d);if("untracked"===w.type?null==x||x.init(C):(w.stores[w.store]=d,null==x||x.init(Object.fromEntries(Object.entries(w.stores).map(([a,l])=>[a,a===w.store?C:l.getState()])))),d.dispatchFromDevtools&&"function"==typeof d.dispatch){let a=!1,l=d.dispatch;d.dispatch=(...o)=>{(eN?"production":void 0)==="production"||"__setState"!==o[0].type||a||(console.warn('[zustand devtools middleware] "__setState" action type is reserved to set state from the devtools. Avoid using it.'),a=!0),l(...o)}}return x.subscribe(a=>{var l;switch(a.type){case"ACTION":if("string"!=typeof a.payload){console.error("[zustand devtools middleware] Unsupported action format");return}return Ye(a.payload,a=>{if("__setState"===a.type){if(void 0===v){g(a.state);return}1!==Object.keys(a.state).length&&console.error(`
                    [zustand devtools middleware] Unsupported __setState action format. 
                    When using 'store' option in devtools(), the 'state' should have only one key, which is a value of 'store' that was passed in devtools(),
                    and value of this only key should be a state object. Example: { "type": "__setState", "state": { "abc123Store": { "foo": "bar" } } }
                    `);let l=a.state[v];if(null==l)return;JSON.stringify(d.getState())!==JSON.stringify(l)&&g(l);return}d.dispatchFromDevtools&&"function"==typeof d.dispatch&&d.dispatch(a)});case"DISPATCH":switch(a.payload.type){case"RESET":return g(C),void 0===v?null==x?void 0:x.init(d.getState()):null==x?void 0:x.init($e(b.name));case"COMMIT":if(void 0===v){null==x||x.init(d.getState());break}return null==x?void 0:x.init($e(b.name));case"ROLLBACK":return Ye(a.state,a=>{if(void 0===v){g(a),null==x||x.init(d.getState());return}g(a[v]),null==x||x.init($e(b.name))});case"JUMP_TO_STATE":case"JUMP_TO_ACTION":return Ye(a.state,a=>{if(void 0===v){g(a);return}JSON.stringify(d.getState())!==JSON.stringify(a[v])&&g(a[v])});case"IMPORT_STATE":{let{nextLiftedState:o}=a.payload,s=null==(l=o.computedStates.slice(-1)[0])?void 0:l.state;if(!s)return;g(void 0===v?s:s[v]),null==x||x.send(null,o);break}case"PAUSE_RECORDING":return E=!E}return}}),C},Ye=(a,l)=>{let o;try{o=JSON.parse(a)}catch(a){console.error("[zustand devtools middleware] Could not parse the received json",a)}void 0!==o&&l(o)},ha=a=>(l,o,s)=>{let d=s.subscribe;return s.subscribe=(a,l,o)=>{let m=a;if(l){let d=(null==o?void 0:o.equalityFn)||Object.is,p=a(s.getState());m=o=>{let s=a(o);if(!d(p,s)){let a=p;l(p=s,a)}},null!=o&&o.fireImmediately&&l(p,p)}return d(m)},a(l,o,s)};function Xe(a,l,o,s){return!(!a[o]||!a[o][l]||!a[o][l][s]||!Array.isArray(a[o][l][s]))}function T(a){return a.payload}function Ze(a,l){return typeof a>"u"?l:a}function xr(a={}){let l=Object.keys(a);return function(o={},s){let d=!1,m={};for(let p=0;p<l.length;p++){let h=l[p];m[h]=a[h](o[h],s),d=d||m[h]!==o[h]}return d?m:o}}var eq=xr({mapping:(a={},l)=>{switch(l.type){case ew:return{...a,[l.payload.id]:l.payload.type};case eE:return{...a,...l.payload.mapping};default:return a}},entities:(a=vr(),l)=>{var o;let r=(o,s)=>({...a,[T(l).type]:{...a[T(l).type],[T(l).id]:{...o,...s}}});switch(l.type){case et:{if(!a[T(l).type]||!a[T(l).type][T(l).id])return a;let o=a[T(l).type][T(l).id];return"string"==typeof o?a:r(o,{[T(l).key]:T(l).value})}case ei:{if(!Xe(a,T(l).id,T(l).type,T(l).key))return a;let o=a[T(l).type][T(l).id];if("string"==typeof o)return a;let s=Array.from(o[T(l).key]),[d]=s.splice(T(l).startIndex,1);return s.splice(T(l).endIndex,0,d),r(o,{[T(l).key]:s})}case ee:{let o=Object.keys(T(l).entities),s={...a};for(let d of o){let o=T(l).entities[d],m={...a[d]||{}},p=!1,h=Object.keys(o||{})||[];if(o&&h){for(let l of h)p=!0,m[l]=a[d][l]?function(a,l){let o={},s=[];for(let[d,m]of Object.entries(a||{})){s.push(d);let a=(l||{})[d];if(!a||0===a.length){o[d]=m;continue}o[d]=a}for(let[a,d]of Object.entries(l||{}))-1===s.indexOf(a)&&(o[a]=d);return o}(a[d][l],o[l]):o[l];p&&(s[d]=m)}}return s}case en:{if(!Xe(a,T(l).id,T(l).type,T(l).key))return a;let o=a[T(l).type][T(l).id],s=Array.from(o[T(l).key]);return s.splice(Ze(T(l).index,s.length+1),0,T(l).reference),r(o,{[T(l).key]:s})}case er:case el:{if(!Xe(a,T(l).id,T(l).type,T(l).key))return a;let s=a[T(l).type][T(l).id],d=Array.from(s[T(l).key]),m=Ze(T(l).index,d.findIndex(a=>a&&a.id===T(l).reference.id));return -1===m||(null==(o=d[m])?void 0:o.id)!==T(l).reference.id?a:(l.type===er?d.splice(m,1,T(l).reference):d.splice(m,1),r(s,{[T(l).key]:d}))}case eo:{let o=a[T(l).type][T(l).id];if(!o)return a;let s=Array.from(o.metadata||[]),d=T(l);return s.splice(Ze(l.payload.beforeIndex,s.length+1),0,{label:d.label,value:d.label}),r(o,{metadata:s})}case eu:{let o=a[T(l).type][T(l).id];if("string"==typeof o||!o)return a;let s=Array.from(o.metadata||[]),[d]=s.splice(T(l).startIndex,1);return s.splice(T(l).endIndex,0,d),r(o,{metadata:s})}case ed:case es:{let o=a[T(l).type][T(l).id],s=Array.from(o.metadata||[]),d=T(l).atIndex;return typeof d>"u"||-1===d||!s[d]?a:(l.type===ed?s.splice(d,1,{label:T(l).label,value:T(l).value}):s.splice(d,1),r(o,{metadata:s}))}default:return a}},requests:(a={},l)=>{switch(l.type){case eT:case"@iiif/REQUEST_OFFLINE_RESOURCE":return{...a,[l.payload.id]:{requestUri:l.payload.id,loadingState:eI,uriMismatch:!1,resourceUri:l.payload.id}};case e$:return{...a,[l.payload.requestId]:{...a[l.payload.requestId]||{},uriMismatch:!0,resourceUri:l.payload.actualId},[l.payload.actualId]:{requestUri:l.payload.requestId,loadingState:a[l.payload.requestId].loadingState,uriMismatch:!0,resourceUri:l.payload.actualId}};case eR:return{...a,[l.payload.id]:{...a[l.payload.id]||{},loadingState:ek,error:l.payload.message}};case eO:return{...a,[l.payload.id]:{...a[l.payload.id]||{},loadingState:eA,error:void 0}}}return a},meta:(a={},l)=>{let{id:o,updateValue:s,value:d,meta:m,key:p}=l&&l.payload||{};switch(l.type){case eD:return{...a,[o]:{...a[o]||{},[m]:{...a[o]&&a[o][m]||{},[p]:d}}};case eW:return{...a,[o]:{...a[o]||{},[m]:{...a[o]&&a[o][m]||{},[p]:s(a[o]&&a[o][m]?a[o][m][p]:void 0)}}};case eH:return a[o]&&a[o][m]&&a[o][m][p]?{...a,[o]:{...a[o]||{},[m]:{...a[o]&&a[o][m]||{},[p]:void 0}}}:a;default:return a}}}),eQ=Object.defineProperty,Ia=(a,l,o)=>l in a?eQ(a,l,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[l]=o,de=(a,l,o)=>(Ia(a,"symbol"!=typeof l?l+"":l,o),o);function Q(a,l,o,s=!0){l[eJ]=l[eJ]||[],l[eJ].push(a);let d=new Map;Object.defineProperty(l,a,{enumerable:s,get(){if(typeof l[eZ][a]>"u")return;let s=l[eZ][a];if(!s)return s;let m=o.get(l[eZ][a],{parent:this.id?{id:this.id,type:this.type}:void 0});return d.has(m)||(d.clear(),d.set(m,ge(m,o))),d.get(m)},set(s){l[eZ][a]!==s&&(this[eG]?o.modifyEntityField({id:this.id,type:this.type},a,function Er(a){return Array.isArray(a)?a.map(a=>Er(a)):a&&a.type?{id:a.id,type:a.type}:a}(s)):this[eZ][a]=s)}})}var eZ=Symbol.for("_refs_"),eG=Symbol.for("_reactive_"),eJ=Symbol.for("_defined_"),eX=Symbol.for("_parent_");function ge(a,l,o=!1,s){if(Array.isArray(a))return a.map(a=>ge(a,l,o));if(!a||!a.type||!a.id)return a;let d=function(a,l=!1,o){let s={id:"",type:"unknown",[eJ]:[],[eZ]:{},[eX]:null,[eG]:null,is(a){return"string"==typeof a?this.id===a:!!a.id&&a.id===this.id},reactive(){if(!this[eG])return this[eG]=this.subscribe(()=>this.refresh(),!0),()=>{this.unreactive()}},refresh(){if(this.id){let a=this.unwrap();for(let l of Object.keys(a||{}))this[eJ].includes(l)?this[eZ][l]=a[l]:this[l]=a[l]}},unreactive(){this[eG]&&(this[eG](),this[eG]=null)},unwrap(){if(!this.id)throw Error("Invalid object");let l=this[eX];return a.get(this.id,{parent:l?{id:l,type:"unknown"}:void 0})},toPresentation3(){return a.toPresentation3(this.unwrap())},toPresentation2(){return a.toPresentation2(this.unwrap())},valueOf(){return this.unwrap()},toJSON(){return{...this,items:this.items,annotations:this.annotations,structures:this.structures,seeAlso:this.seeAlso,service:this.service,services:this.services,rendering:this.rendering,partOf:this.partOf,start:this.start,supplementary:this.supplementary,homepage:this.homepage,thumbnail:this.thumbnail,placeholderCanvas:this.placeholderCanvas,accompanyingCanvas:this.accompanyingCanvas,provider:this.provider}},subscribe(l,o=!0){return a.subscribe(()=>this.id?a.get(this.id):null,l,o)}};return Q("items",s,a),Q("annotations",s,a),Q("structures",s,a),Q("seeAlso",s,a),Q("rendering",s,a),Q("partOf",s,a),Q("start",s,a,!1),Q("supplementary",s,a),Q("homepage",s,a),Q("thumbnail",s,a),Q("placeholderCanvas",s,a,!1),Q("accompanyingCanvas",s,a,!1),Q("provider",s,a),Q("body",s,a),Q("logo",s,a),s}(l,o),m=Object.create(d),p=Object.assign(m,a);return o&&p.reactive(),p}function Pt(a){switch(a){case"Image":case"Video":case"Sound":case"Dataset":case"Text":case"Composite":case"List":case"Independents":case"Audience":return"ContentResource";case"ImageService1":case"ImageService2":case"ImageService3":return"Service"}return a}var eY=class{constructor(a,l){var o;de(this,"options"),de(this,"store"),de(this,"emitter"),de(this,"isBatching",!1),de(this,"batchQueue",[]),de(this,"remoteFetcher"),de(this,"staticFetcher"),de(this,"defaultFetcher",a=>fetch(a).then(a=>a.json())),this.options=Object.assign({reducers:{},customFetcher:this.defaultFetcher,enableDevtools:!0},a||{}),this.store=l||function(a={}){var l;let{enableDevtools:o=!1,iiifStoreName:s="iiif",defaultState:d={iiif:{entities:vr(),meta:{},mapping:{},requests:{}}},customReducers:m={}}=a,p=(l=xr({[s]:eq,...m}),(a,o)=>o&&o.type===ez?o.payload.actions.reduce(l,a):o&&"@iiif/BATCH_IMPORT"===o.type?{...a,iiif:{...a.iiif,...o.payload.state}}:l(a,o)),h="u">typeof window&&window.__REDUX_DEVTOOLS_EXTENSION__?ma:(a,l)=>a;return ia(ha(h(ca(p,d),{enabled:o})))}({customReducers:this.options.reducers,defaultState:this.options.defaultState,enableDevtools:this.options.enableDevtools}),this.emitter={all:o=o||new Map,on:function(a,l){var s=o.get(a);s?s.push(l):o.set(a,[l])},off:function(a,l){var s=o.get(a);s&&(l?s.splice(s.indexOf(l)>>>0,1):o.set(a,[]))},emit:function(a,l){var s=o.get(a);s&&s.slice().map(function(a){a(l)}),(s=o.get("*"))&&s.slice().map(function(o){o(a,l)})}},this.remoteFetcher=kt(this,this.options.customFetcher),this.staticFetcher=kt(this,(a,l)=>l)}batch(a){this.isBatching=!0;try{a(this),this.isBatching=!1,this.dispatch(ej({actions:this.batchQueue}))}catch(a){throw this.batchQueue=[],this.isBatching=!1,a}this.batchQueue=[]}async asyncBatch(a){this.isBatching=!0;try{await a(this),this.isBatching=!1,this.dispatch(ej({actions:this.batchQueue}))}catch(a){throw this.batchQueue=[],this.isBatching=!1,a}this.batchQueue=[]}modifyEntityField(a,l,o){this.dispatch(ex.modifyEntityField({id:a.id,type:a.type,key:l,value:o}))}dispatch(a){if(this.isBatching)this.batchQueue.push(a);else{if(a.type===ez){for(let l of a.payload.actions)this.emitter.emit(l.type,{action:l,state:this.store.getState()});this.store.dispatch(a);let l=this.getState();for(let o of a.payload.actions)this.emitter.emit(`after:${o.type}`,{action:o,state:l});return}this.emitter.emit(a.type,{action:a,state:this.store.getState()}),this.store.dispatch(a);let l=this.store.getState();this.emitter.emit(`after:${a.type}`,{action:a,state:l});return}}on(a,l){return this.emitter.on(a,l),()=>{this.emitter.off(a,l)}}serialize(a,l){return(0,w.B)(this.getState().iiif,a,l)}toPresentation2(a){return this.serialize(a,w.E)}toPresentation3(a){return this.serialize(a,w.F)}hydrate(a,l,o={}){return this.get(a,l,{...o,skipSelfReturn:!1})}get(a,l,o={}){"string"!=typeof l&&(o=l||{},l=void 0);let{skipSelfReturn:s=!0}=o||{},d=o.parent?"string"==typeof o.parent?o.parent:o.parent.id:void 0;if(Array.isArray(a))return a.map(a=>this.get(a,o));let m=this.getState();if((0,E.a)(a)&&!o.preserveSpecificResources&&(a=a.source),"string"==typeof a){let o=Pt(l||m.iiif.mapping[a]);if(!o)return s?null:{id:a,type:"unknown"};a={id:a,type:o}}if(a&&a.partOf&&!d&&!o.skipPartOfCheck){let l=Array.isArray(a.partOf)?a.partOf[0]:a.partOf;l&&("string"==typeof l&&(d=l),"string"==typeof l.id&&(d=l.id))}let p=Pt(l||(null==a?void 0:a.type)),h=null==a?void 0:a.id,v=m.iiif.entities[p];if(!v){let l=m.iiif.requests[h];return l&&l.resourceUri!==h?this.get(l.resourceUri,o):s?null:a}let b=v[a.id];if(b&&b[w.c]){let a=b[w.c].find(a=>d?a[w.d]===d:a[w.d]===b.id);return(0,w.j)(b,a)}return v[a.id]||(s?null:a)}select(a){return a(this.getState())}getStore(){return this.store}getState(){return this.store.getState()}deep(a,l){if(typeof a>"u")return this.get(l,{skipSelfReturn:!1});if("function"==typeof a)try{let o=a(this.get(l,{skipSelfReturn:!1})),i=a=>this.deep(a,o);return i.size=Array.isArray(o)?o.length:1,i}catch{let i=a=>this.deep(a,void 0);return i.size=0,i}let r=l=>this.deep(l,a);return r.size=Array.isArray(a)?a.length:1,r}loadManifest(a,l){let o="string"==typeof a?a:a.id;return this.load(o,l)}loadCollection(a,l){let o="string"==typeof a?a:a.id;return this.load(o,l)}load(a,l){let o="string"==typeof a?a:a.id;return l?Promise.resolve(this.staticFetcher(o,l)):Promise.resolve(this.remoteFetcher(o))}loadSync(a,l){let o="string"==typeof a?a:a.id;return this.staticFetcher(o,l)}loadManifestSync(a,l){let o="string"==typeof a?a:a.id;return this.loadSync(o,l)}loadCollectionSync(a,l){let o="string"==typeof a?a:a.id;return this.loadSync(o,l)}areInputsEqual(a,l){return Rt(a,l)}subscribe(a,l,o){return typeof o>"u"&&(typeof l>"u"||!1===l||!0===l)&&(o=l,l=a,a=a=>a),this.store.subscribe(a,a=>l(a,this),{equalityFn:Rt,fireImmediately:!o})}async ensureLoaded(a){let l="string"==typeof a?a:a.id;this.requestStatus(l)||await this.load(l)}requestStatus(a){return this.select(l=>l.iiif.requests[a])}getResourceMeta(a,l){let o=this.getState().iiif.meta[a];if(o)return l?o[l]:o}getObject(a,l,o={}){let{reactive:s,...d}=o;return ge(this.get(a,l,d),this,s)}async loadObject(a,l){return ge(await this.load(a,l),this)}async loadManifestObject(a,l){return ge(await this.loadManifest(a,l),this)}async loadCollectionObject(a,l){return ge(await this.loadCollection(a,l),this)}wrapObject(a){return ge(this.get(a,{skipSelfReturn:!1}),this)}isWrapped(a){return!!a[eJ]}setMetaValue([a,l,o],s){this.dispatch("function"==typeof s?eV.setMetaValueDynamic({id:a,meta:l,key:o,updateValue:s}):eV.setMetaValue({id:a,meta:l,key:o,value:s}))}};let ka=a=>{let l=a.toString().split(":"),o=Math.ceil(parseInt(l[0])),s=Math.ceil(parseInt(l[1])),d=$a(Math.ceil(parseInt(l[2])),2),m=`${0!==o&&s<10?(s+"").padStart(2,"0"):s}:${d}`;return 0!==o&&(m=`${o}:${m}`),m},Cr=a=>{let l=new Date(1e3*a).toISOString().substr(11,8);return ka(l)},Ir=(a,l)=>{if("object"!=typeof a||null===a)return l;for(let o in l)"object"!=typeof l[o]||null===l[o]||Array.isArray(l[o])?a[o]=l[o]:(a[o]||(a[o]={}),a[o]=Ir(a[o],l[o]));return a},Ar=a=>a.split("").reduce(function(a,l){return(a=(a<<5)-a+l.charCodeAt(0))&a},0),Tr=(a,l)=>Object.hasOwn(a,l)?a[l].toString():void 0,$a=(a,l)=>String(a).padStart(l,"0"),eK={annotationOverlays:{backgroundColor:"#6666ff",borderColor:"#000099",borderType:"solid",borderWidth:"1px",opacity:"0.5",renderOverlays:!0,zoomLevel:2},background:"transparent",canvasBackgroundColor:"#6662",canvasHeight:"500px",contentSearch:{searchResultsLimit:20,overlays:{backgroundColor:"#ff6666",borderColor:"#990000",borderType:"solid",borderWidth:"1px",opacity:"0.5",renderOverlays:!0,zoomLevel:4}},crossOrigin:void 0,ignoreCaptionLabels:[],informationPanel:{vtt:{autoScroll:{enabled:!0,settings:{behavior:"smooth",block:"center"}}},open:!0,renderAbout:!0,renderSupplementing:!0,renderToggle:!0,renderAnnotation:!0,renderContentSearch:!0},openSeadragon:{},requestHeaders:{"Content-Type":"application/json"},showDownload:!0,showIIIFBadge:!0,showTitle:!0,withCredentials:!1};function Rr(a){let l={...eK.informationPanel.vtt.autoScroll};return"object"==typeof a&&(l="enabled"in a?a:{enabled:!0,settings:a}),!1===a&&(l.enabled=!1),function({behavior:a,block:l}){let o=["auto","instant","smooth"],s=["center","end","nearest","start"];if(!o.includes(a))throw TypeError(`'${a}' not in ${o.join(" | ")}`);if(!s.includes(l))throw TypeError(`'${l}' not in ${s.join(" | ")}`)}(l.settings),l}let e0=Rr(null==(m=null==(d=null==eK?void 0:eK.informationPanel)?void 0:d.vtt)?void 0:m.autoScroll),e1={activeCanvas:"",activeManifest:"",activeSelector:void 0,OSDImageLoaded:!1,collection:{},configOptions:eK,customDisplays:[],plugins:[],isAutoScrollEnabled:e0.enabled,isAutoScrolling:!1,isInformationOpen:null==(p=null==eK?void 0:eK.informationPanel)?void 0:p.open,isLoaded:!1,isUserScrolling:void 0,sequence:[[],[]],vault:new eY,openSeadragonViewer:null,viewerId:(0,C.Z)(),visibleCanvases:[],visibleAnnotations:[]},e2=x.createContext(e1),e3=x.createContext(e1);function Fa(a,l){switch(l.type){case"updateActiveCanvas":return l.canvasId||(l.canvasId=""),{...a,activeCanvas:l.canvasId};case"updateActiveManifest":return{...a,activeManifest:l.manifestId};case"updateOSDImageLoaded":return{...a,OSDImageLoaded:l.OSDImageLoaded};case"updateAutoScrollAnnotationEnabled":return{...a,isAutoScrollEnabled:l.isAutoScrollEnabled};case"updateAutoScrolling":return{...a,isAutoScrolling:l.isAutoScrolling};case"updateCollection":return{...a,collection:l.collection};case"updateConfigOptions":return{...a,configOptions:Ir(a.configOptions,l.configOptions)};case"updateContentStateAnnotation":return{...a,contentStateAnnotation:l.contentStateAnnotation};case"updateInformationOpen":return{...a,isInformationOpen:l.isInformationOpen};case"updateInformationPanelResource":return{...a,informationPanelResource:l.informationPanelResource};case"updateIsLoaded":return{...a,isLoaded:l.isLoaded};case"updateManifestSequence":return{...a,sequence:l.sequence};case"updateUserScrolling":return{...a,isUserScrolling:l.isUserScrolling};case"updateOpenSeadragonViewer":return{...a,openSeadragonViewer:l.openSeadragonViewer};case"updateViewerId":return{...a,viewerId:l.viewerId};case"updateActiveSelector":return{...a,activeSelector:l.selector};case"updateVisibleCanvases":return{...a,visibleCanvases:l.visibleCanvases};default:throw Error(`Unhandled action type: ${l.type}`)}}let _a=({initialState:a=e1,children:l})=>{let[o,s]=(0,x.useReducer)(Fa,a),{openSeadragonViewer:d}=o;return(0,x.useEffect)(()=>{if(d)return d.addHandler("update-viewport",()=>{let a=d.viewport,l=a.getBounds(),o=a.viewportToImageRectangle(l),m=`xywh=${[Math.round(o.x),Math.round(o.y),Math.round(o.width),Math.round(o.height)].join(",")}`;s({type:"updateActiveSelector",selector:{type:"FragmentSelector",value:m}})}),()=>{d.removeAllHandlers("update-viewport")}},[d]),x.createElement(e2.Provider,{value:o},x.createElement(e3.Provider,{value:s},l))};function D(){let a=x.useContext(e2);if(void 0===a)throw Error("useViewerState must be used within a ViewerProvider");return a}function X(){let a=x.useContext(e3);if(void 0===a)throw Error("useViewerDispatch must be used within a ViewerProvider");return a}let La=async(a,l)=>{let o=a.get({id:l,type:"Canvas"});if(!(null!=o&&o.annotations)||!o.annotations[0])return[];let s=a.get(o.annotations).filter(a=>!!a.items&&a),d=[];for(let l of s)if(l.items.length>0){let a=l.label||{none:["Annotations"]};d.push({...l,label:a})}else{let o={};try{o=await a.load(l.id)}catch(a){console.log(a)}if(o.items&&o.items.length>0){let a=o.label||{none:["Annotations"]};d.push({...o,label:a})}}return d},Mr=async(a,l,o)=>{try{if(null==o||null==o.q)return{};let s=o.q.trim(),d=new URL(l);return d.searchParams.set("q",s),await a.load(d.toString())}catch(a){return console.warn("Error in getContentSearchResources:",a),{}}},Or=(a,l,o,s)=>{var d,m;let p={canvas:void 0,accompanyingCanvas:void 0,annotationPage:void 0,annotations:[]};if(p.canvas=a.get(l),p.canvas&&(p.annotationPage=a.get(p.canvas.items[0]),p.accompanyingCanvas=null!=(d=p.canvas)&&d.accompanyingCanvas?a.get(null==(m=p.canvas)?void 0:m.accompanyingCanvas):void 0),p.annotationPage){let d=a.get(p.annotationPage.items).map(l=>({body:a.get(l.body[0].id),motivation:l.motivation,type:"Annotation"})),m=[];d.forEach(l=>{"Choice"===l.body.type?l.body.items.forEach(o=>m.push({...l,id:o.id,body:a.get(o.id)})):m.push(l)}),p.annotations=m.filter(d=>{if(d){if(!d.body||!d.motivation){console.error("Invalid annotation after Hyperion parsing: missing either 'body' or 'motivation'",d);return}let m=d.body;Array.isArray(m)&&(m=m[0]);let p=a.get(m.id);if(p)switch(o){case"painting":return d.target===l.id&&d.motivation&&"painting"===d.motivation[0]&&s.includes(p.type)&&(d.body=p),!!d;case"supplementing":return;default:throw Error("Invalid annotation motivation.")}}})}return p},yt=(a,l="en")=>{if(!a)return"";if(!a[l]){let l=Object.getOwnPropertyNames(a);if(l.length>0)return a[l[0]]}return a[l]},me=(a,l)=>{let o=Or(a,{id:l,type:"Canvas"},"painting",["Image","Sound","Video"]);if(0!==o.annotations.length&&o.annotations&&o.annotations)return o.annotations.map(a=>null==a?void 0:a.body)},e4={xxs:"(max-width: 349px)",xs:"(max-width: 575px)",sm:"(max-width: 767px)",md:"(max-width: 991px)",lg:"(max-width: 90rem)",xl:"(min-width: calc(90rem + 1px))"},{styled:e5,css:e6,keyframes:e8,createTheme:e7}=(0,M.Th)({theme:{colors:{primary:"#1a1d1e",primaryMuted:"#26292b",primaryAlt:"#151718",accent:"hsl(209 100% 38.2%)",accentMuted:"hsl(209 80% 61.8%)",accentAlt:"hsl(209 80% 30%)",secondary:"#FFFFFF",secondaryMuted:"#e6e8eb",secondaryAlt:"#c1c8cd"},fontSizes:{1:"12px",2:"13px",3:"15px",4:"17px",5:"19px",6:"21px",7:"27px",8:"35px",9:"59px"},lineHeights:{1:"12px",2:"13px",3:"15px",4:"17px",5:"19px",6:"21px",7:"27px",8:"35px",9:"59px"},sizes:{1:"5px",2:"10px",3:"15px",4:"20px",5:"25px",6:"35px",7:"45px",8:"65px",9:"80px"},space:{1:"5px",2:"10px",3:"15px",4:"20px",5:"25px",6:"35px",7:"45px",8:"65px",9:"80px"},radii:{1:"4px",2:"6px",3:"8px",4:"12px",round:"50%",pill:"9999px"},transitions:{all:"all 200ms cubic-bezier(0.16, 1, 0.3, 1)"},zIndices:{1:"100",2:"200",3:"300",4:"400",max:"999"}},media:e4}),e9=e5("div",{display:"flex",flexDirection:"column",alignItems:"center"}),te=e5("p",{fontWeight:"bold",fontSize:"x-large"}),ti=e5("span",{fontSize:"medium"}),bt=({error:a})=>{let{message:l}=a;return x.createElement(e9,{role:"alert"},x.createElement(te,{"data-testid":"headline"},"Something went wrong"),l&&x.createElement(ti,null,`Error message: ${l}`," "))},tn=e5("div",{position:"relative",zIndex:"0"}),ta=e5("div",{display:"flex",flexDirection:"row",flexGrow:"1",overflow:"hidden"}),tr=e5("div",{display:"flex",flexDirection:"column",flexGrow:"1",flexShrink:"1",width:"100%",height:"100%","&[data-aside-active='true']":{width:"61.8%","@sm":{width:"0",opacity:"0"}},"&[data-aside-toggle='false']":{"@sm":{width:"100% !important",opacity:"1 !important"}}}),tl=e5("aside",{display:"flex",flexGrow:"1",flexShrink:"0",width:"0",maxHeight:"100%","&[data-aside-active='true']":{width:"38.2%","@sm":{width:"100%"}},"&[data-aside-toggle='false']":{"@sm":{width:"0 !important"}}}),ts=e5("div",{display:"flex",flexDirection:"column",fontSmooth:"auto",webkitFontSmoothing:"antialiased",'&[data-absolute-position="true"]':{position:"absolute",width:"100%",height:"100%",zIndex:"0"},"> div":{display:"flex",flexDirection:"column",flexGrow:"1",justifyContent:"flex-start",height:"100%",maxHeight:"100%","@sm":{[`& ${ta}`]:{flexGrow:"1"},[`& ${tr}`]:{flexGrow:"0"}}},"@sm":{padding:"0"},"&[data-information-panel-open='true']":{"@sm":{}}}),tc=e5(P.fC,{display:"flex",flexDirection:"column",width:"100%",height:"100%",flexGrow:"1",flexShrink:"0",position:"relative",zIndex:"1",maskImage:"linear-gradient(180deg, rgba(0, 0, 0, 1) calc(100% -  2rem), transparent 100%)","@sm":{marginTop:"0.5rem",boxShadow:"none"}}),td=e5(P.aV,{display:"flex",flexGrow:"0",margin:"0 1.618rem",borderBottom:"5px solid #6663","@sm":{margin:"0 1rem"}}),tu=e5(P.xz,{display:"flex",position:"relative",padding:"0.5rem 1.618rem",background:"none",backgroundColor:"transparent",fontFamily:"inherit",border:"none",opacity:"0.7",fontSize:"1rem",lineHeight:"1rem",whiteSpace:"nowrap",cursor:"pointer",fontWeight:400,transition:"$all","&[data-value='manifest-back']":{display:"none;","@sm":{display:"block"}},"&::after":{width:"0",height:"4px",content:"",position:"absolute",bottom:"-4px",left:"0",transition:"$all"},"&[data-state='active']":{opacity:"1",fontWeight:700,"&::after":{width:"100%",backgroundColor:"$accent"}}}),tm=e5(P.VY,{display:"flex",flexDirection:"column",flexGrow:"1",flexShrink:"0",position:"absolute",top:"0",left:"0","&[data-state='active']":{width:"100%",height:"calc(100% - 2rem)",padding:"1.618rem 0"}}),tp=e5(({handleScroll:a,children:l,className:o})=>x.createElement("div",{className:o,onScroll:a},l),{position:"relative",height:"100%",width:"100%",overflowY:"scroll"}),th={position:"relative",display:"flex",margin:"0 1.618rem",padding:"0.5rem 0",fontFamily:"inherit",fontSize:"0.8333rem",lineHeight:"1.47rem",color:"inherit",background:"none",borderRadius:"3px",border:"none"},tf=e5("button",{textAlign:"left","&:hover":{color:"$accent"}}),tg=e5("div",{display:"flex",flexDirection:"column",width:"100%",header:{margin:"0 1.618rem 0.5rem ",fontWeight:700,fontSize:"0.8333rem",em:{fontStyle:"normal",fontWeight:400,opacity:.7}},paddingBottom:"1rem",marginBottom:"1rem",borderBottom:"1px solid #0001"}),tv=e5("div",{gap:"1rem",fontSize:"1rem",lineHeight:"1.47em",margin:"0","&[data-content-search=true]":{em:{fontWeight:700,display:"inline"}}}),ty=e5("div",{...th,display:"flex",flexDirection:"row",gap:"1rem","&[data-format='text/vtt']":{marginTop:"-1rem","> span":{display:"none"}},"> span":{display:"flex",width:"2rem",height:"2rem",backgroundColor:"#0001",flexShrink:"0",borderRadius:"3px",marginTop:"0.25rem"},"&[data-content='None']":{button:{div:{opacity:"0.7"},"&:hover, &:focus":{div:{opacity:"1"}}}},[`&[dir=rtl] ${tv}`]:{textAlign:"right !important"}}),Ja=({value:a,handleClick:l})=>x.createElement(tf,{onClick:l},x.createElement(tv,{dangerouslySetInnerHTML:{__html:a}})),Ya=({caption:a,handleClick:l,imageUri:o})=>x.createElement(tf,{onClick:l},x.createElement("img",{src:o,alt:`A visual annotation for ${a}`}),x.createElement("span",null,a)),Xa=({value:a,handleClick:l})=>{let o=(0,L.Z)(a);return x.createElement(tf,{onClick:l},x.createElement(tv,{dangerouslySetInnerHTML:{__html:o.html}}))},Ft=({value:a,handleClick:l,isContentSearch:o})=>x.createElement(tf,{onClick:l},x.createElement(tv,{dangerouslySetInnerHTML:{__html:a},"data-content-search":o})),Za=()=>{function e(a){return a.map(a=>{let l=a.identifier||(0,C.Z)();return{...a,identifier:l}})}return{addIdentifiersToParsedCues:e,createNestedCues:function(a){var l;let o=[],s=[],d=e(a);for(let a of d){for(;s.length>0&&s[s.length-1].end<=a.start;)s.pop();s.length>0?(s[s.length-1].children||(s[s.length-1].children=[]),null==(l=s[s.length-1].children)||l.push(a)):o.push(a),s.push(a)}return o},isChild:function(a,l=[]){return l.some(l=>a.start>=l.start&&a.end<=l.end)},orderCuesByTime:function(a=[]){return a.sort((a,l)=>a.start-l.start)},parseVttData:function(a){return new Promise((l,o)=>{let s=[],d=new F.WebVTT.Parser(window,F.WebVTT.StringDecoder());d.oncue=a=>{let l=F.WebVTT.convertCueToDOMTree(window,a.text),o=l.innerHTML||"&nbsp;",d=l.textContent||"";s.push({identifier:(0,C.Z)(),start:a.startTime,end:a.endTime,align:a.align,html:o,text:d})},d.onflush=()=>l(s),d.onparsingerror=a=>o(a),d.parse(a),d.flush()})}}},tb=e5(z.fC,{display:"flex",flexDirection:"column",width:"100%"}),tx=e5(z.ck,{...th,justifyContent:"space-between",textAlign:"left",flexGrow:1,margin:0,marginLeft:"-1rem",padding:"0.618rem 1rem",width:"calc(100% + 2rem)",fontSize:"1rem",strong:{marginLeft:"1rem"},"&:hover":{color:"$accent"},"&[aria-checked='true']":{background:"#6662"}}),to=a=>{for(;a&&a!==document.body;){let l=window.getComputedStyle(a).overflowY;if("visible"!==l&&"hidden"!==l&&a.scrollHeight>a.clientHeight)return a;a=a.parentNode}return null},ro=({html:a,text:l,start:o,end:s})=>{var d,m;let p=X(),{configOptions:h,isAutoScrollEnabled:v,isUserScrolling:b}=D(),w=null==(m=null==(d=null==h?void 0:h.informationPanel)?void 0:d.vtt)?void 0:m.autoScroll,[E,C]=(0,x.useState)(!1),k=(0,x.useRef)(null),I=document.getElementById("clover-iiif-video");return(0,x.useEffect)(()=>(null==I||I.addEventListener("timeupdate",()=>{let{currentTime:a}=I;C(o<=a&&a<s)}),()=>document.removeEventListener("timeupdate",()=>{})),[s,o,I]),(0,x.useEffect)(()=>{var a,l;if(v&&E&&k.current&&!b){let o=k.current;if(o&&o instanceof HTMLElement){let s=to(o);if(s&&s instanceof HTMLElement){let d;switch(null==(a=null==w?void 0:w.settings)?void 0:a.block){case"center":let m=s.getBoundingClientRect();d=o.offsetTop+o.offsetHeight-Math.floor((m.bottom-m.top)/2);break;case"end":d=o.offsetTop+o.offsetHeight-(s.clientHeight-o.clientHeight)+2;break;default:d=o.offsetTop-2}p({type:"updateAutoScrolling",isAutoScrolling:!0}),s.scrollTo({top:d,left:0,behavior:null==(l=null==w?void 0:w.settings)?void 0:l.behavior}),setTimeout(()=>p({type:"updateAutoScrolling",isAutoScrolling:!1}),750)}}}},[w,E,b,v,p]),x.createElement(tx,{ref:k,"aria-checked":E,"data-testid":"information-panel-cue",onClick:()=>{I&&(I.pause(),I.currentTime=o,I.play())},value:l},x.createElement("div",{className:"webvtt-cue",dangerouslySetInnerHTML:{__html:a}}),x.createElement("strong",null,Cr(o)))},tw=e5("ul",{listStyle:"none",paddingLeft:"1rem",position:"relative","&&:first-child":{paddingLeft:"0"},"& li ul":{[`& ${tx}`]:{backgroundColor:"unset","&::before":{content:"none"},"&::after":{content:"none"}}},"&:first-child":{margin:"0 0 1.618rem"}}),Br=({items:a})=>x.createElement(tw,null,a.map(a=>{let{html:l,text:o,start:s,end:d,children:m,identifier:p}=a;return x.createElement("li",{key:p},x.createElement(ro,{html:l,text:o,start:s,end:d}),m&&x.createElement(Br,{items:m}))})),io=({inlineCues:a,label:l,vttUri:o})=>{let[s,d]=x.useState(a||[]),{createNestedCues:m,orderCuesByTime:p,parseVttData:h}=Za(),[v,b]=x.useState();return(0,x.useEffect)(()=>{o&&fetch(o,{headers:{"Content-Type":"text/plain",Accept:"application/json"}}).then(a=>a.text()).then(a=>{h(a).then(a=>{let l=p(a),o=m(l);d(o)})}).catch(a=>{console.error(o,a.toString()),b(a)})},[o]),x.createElement(tb,{"data-testid":"annotation-item-vtt","aria-label":`${yt(l)}`},v&&x.createElement("div",{"data-testid":"error-message"},"Network Error: ",v.toString()),x.createElement(Br,{items:s}))},ao=a=>{var l;if(!a)return"LTR";let o=Array.isArray(a)?null==(l=a[0])?void 0:l.split("-")[0]:null==a?void 0:a.split("-")[0];return["ar","fa","ur","ps","dv","sd","ug","ku","he","yi","jrb","jpr","nqo"].includes(o)?"RTL":"LTR"},oo=a=>{var l,o,s,d,m;let p={id:"string"==typeof a?a:a.source};if("string"==typeof a){if(a.includes("#xywh=")){let l=a.split("#xywh=");if(l&&l[1]){let[a,o,s,d]=l[1].split(",").map(a=>Number(a));p={id:l[0],rect:{x:a,y:o,w:s,h:d}}}}else if(a.includes("#t=")){let l=a.split("#t=");l&&l[1]&&(p={id:l[0],t:l[1]})}}else if("object"==typeof a){if((null==(l=a.selector)?void 0:l.type)==="PointSelector")p={id:a.source,point:{x:a.selector.x,y:a.selector.y}};else if((null==(o=a.selector)?void 0:o.type)==="SvgSelector")p={id:a.source,svg:a.selector.value};else if((null==(s=a.selector)?void 0:s.type)==="FragmentSelector"&&null!=(d=a.selector)&&d.value.includes("xywh=")&&"Canvas"==a.source.type&&a.source.id){let l=null==(m=a.selector)?void 0:m.value.split("xywh=");if(l&&l[1]){let[o,s,d,m]=l[1].split(",").map(a=>Number(a));p={id:a.source.id,rect:{x:o,y:s,w:d,h:m}}}}}return p},xt=({annotation:a,targetResource:l,isContentSearch:o,isContentState:s})=>{var d,m,p,h,v,b,w;let{target:E}=a,C=null==(d=null==E?void 0:E.selector)?void 0:d.type,k=(null==(p=null==(m=null==E?void 0:E.selector)?void 0:m.value)?void 0:p.split("=")[1])||"full",[I,A]="full"!==k?null==k?void 0:k.split(",").slice(2):[100,100],O="PointSelector"===C&&null!=(h=null==E?void 0:E.selector)&&h.t?[{start:null==(v=null==E?void 0:E.selector)?void 0:v.t,end:0,html:" ",text:" ",styles:"",children:[]}]:void 0,M=`${l}/${k}/!${((a,l)=>{let o=Math.max(a,l);return[Math.round(a/o*100),Math.round(l/o*100)].join(",")})(I,A)}/0/default.jpg`,P=D(),L=X(),{openSeadragonViewer:F,vault:z,visibleCanvases:_}=P,H=null!=a&&a.body?null==(b=null==a?void 0:a.body)?void 0:b.map(a=>z.get(a.id)):[],{format:V="PointSelector"===C?"text/vtt":"text/plain",language:N="none",value:U="",chars:q=""}=H[0]?H[0]:{},G=(null==(w=H[0])?void 0:w.label)||{none:["t"]},Y=U||q||"None",K=N?ao(N).toLocaleLowerCase():"LTR";function $(){var l;let o=null==F?void 0:F.getOverlayById(a.id);if(o&&null!=F&&F.viewport){null!=o&&o.element&&(null==(l=o.element)||l.focus());let a=null==o?void 0:o.getBounds(F.viewport);a.x-=.2,a.y-=.2,a.width+=.5,a.height+=.5,F.viewport.fitBounds(a,!1)}}function R(l){var o;l.preventDefault(),l.stopPropagation();let s=(null==(o=null==a?void 0:a.target)?void 0:o.source)||(null==a?void 0:a.target),d=null==s?void 0:s.id;_.map(a=>a.id).includes(d)?$():L({type:"updateActiveCanvas",canvasId:d})}return(0,x.useEffect)(()=>{if(!F||!s)return;let l=setInterval(()=>{(null==F?void 0:F.getOverlayById(a.id))&&($(),F.container.className="clover-iiif-content-state",clearInterval(l))},1e3);return()=>clearInterval(l)},[F,s]),x.createElement(ty,{dir:K,"data-format":V,"data-content":Y,className:"clover-iiif-annotation-item"},x.createElement("span",{style:{backgroundImage:`url(${M})`,backgroundSize:"cover",backgroundPosition:"center"}}),function(){var a,l,s;switch(V){case"text/plain":return x.createElement(Ft,{value:Y,handleClick:R,isContentSearch:o});case"text/html":return x.createElement(Ja,{value:Y,handleClick:R});case"text/markdown":return x.createElement(Xa,{value:Y,handleClick:R});case"text/vtt":return x.createElement(io,{inlineCues:O,label:G,vttUri:(null==(a=H[0])?void 0:a.id)||void 0});case null==(l=null==V?void 0:V.match(/^image\//))?void 0:l.input:let d=(null==(s=H.find(a=>{var l;return!(null!=(l=a.id)&&l.includes("vault://"))}))?void 0:s.id)||"";return x.createElement(Ya,{caption:U,handleClick:R,imageUri:d});default:return x.createElement(Ft,{value:Y,handleClick:R})}}())},Hr=(a,l="none")=>{if(!a)return null;if("string"==typeof a)return[a];if(!a[l]){let l=Object.getOwnPropertyNames(a);if(l.length>0)return a[l[0]]}return a[l]&&Array.isArray(a[l])?a[l]:null},Z=(a,l="none",o=", ")=>{let s=Hr(a,l);return Array.isArray(s)?s.join(`${o}`):s};function ae(a,l){let o=Object.keys(a).filter(a=>l.includes(a)?null:a),s={};return o.forEach(l=>{s[l]=a[l]}),s}let tE=e5("span",{}),ce=a=>{let{as:l,label:o}=a,s=ae(a,["as","label"]);return x.createElement(tE,{as:l,...s},Z(o,s.lang))},uo=(a,l="200,",o="full")=>{let s;Array.isArray(a)&&(a=a[0]);let{id:d,service:m}=a;if(!m)return d;if(Array.isArray(a.service)&&a.service.length>0&&(s=m[0]),s){if(s["@id"])return`${s["@id"]}/${o}/${l}/0/default.jpg`;if(s.id)return`${s.id}/${o}/${l}/0/default.jpg`}},tS=e5("img",{objectFit:"cover"}),mo=a=>{let l;let o=(0,x.useRef)(null),{contentResource:s,altAsLabel:d,region:m="full"}=a;d&&(l=Z(d));let p=ae(a,["contentResource","altAsLabel"]),{type:h,id:v,width:b=200,height:w=200,duration:E}=s;(0,x.useEffect)(()=>{if(!v&&!o.current||["Image"].includes(h)||!v.includes("m3u8"))return;let a=new H.ZP;return o.current&&(a.attachMedia(o.current),a.on(H.ZP.Events.MEDIA_ATTACHED,function(){a.loadSource(v)})),a.on(H.ZP.Events.ERROR,function(l,o){if(o.fatal)switch(o.type){case H.ZP.ErrorTypes.NETWORK_ERROR:console.error(`fatal ${l} network error encountered, try to recover`),a.startLoad();break;case H.ZP.ErrorTypes.MEDIA_ERROR:console.error(`fatal ${l} media error encountered, try to recover`),a.recoverMediaError();break;default:a.destroy()}}),()=>{a&&(a.detachMedia(),a.destroy())}},[v,h]);let C=(0,x.useCallback)(()=>{if(!o.current)return;let a=0,l=30;if(E&&(l=E),!v.split("#t=")&&E&&(a=.1*E),v.split("#t=").pop()){let l=v.split("#t=").pop();l&&(a=parseInt(l.split(",")[0]))}let s=o.current;s.autoplay=!0,s.currentTime=a,setTimeout(()=>C(),1e3*l)},[E,v]);(0,x.useEffect)(()=>C(),[C]);let k=uo(s,`${b},${w}`,m);switch(h){case"Image":return x.createElement(tS,{as:"img",alt:l,css:{width:b,height:w},key:v,src:k,...p});case"Video":return x.createElement(tS,{as:"video",css:{width:b,height:w},disablePictureInPicture:!0,key:v,loop:!0,muted:!0,onPause:C,ref:o,src:v});default:return console.warn(`Resource type: ${h} is not valid or not yet supported in Primitives.`),x.createElement(x.Fragment,null)}},tC=e5("a",{}),ho=a=>{let{children:l,homepage:o}=a,s=ae(a,["children","homepage"]);return x.createElement(x.Fragment,null,o&&o.map(a=>{let o=Z(a.label,s.lang);return x.createElement(tC,{"aria-label":l?o:void 0,href:a.id,key:a.id,...s},l||o)}))},tk={delimiter:", "},tI=(0,x.createContext)(void 0),Vr=()=>{let a=(0,x.useContext)(tI);if(void 0===a)throw Error("usePrimitivesContext must be used with a PrimitivesProvider");return a},St=({children:a,initialState:l=tk})=>{let o=go(l,"delimiter");return x.createElement(tI.Provider,{value:{delimiter:o}},a)},go=(a,l)=>Object.hasOwn(a,l)?a[l].toString():void 0,tA=e5("span",{}),Lt=a=>{let{as:l,markup:o}=a,{delimiter:s}=Vr();if(!o)return x.createElement(x.Fragment,null);let d=ae(a,["as","markup"]),m={__html:_(Z(o,d.lang,s),{allowedAttributes:{a:["href"],img:["alt","src","height","width"]},allowedSchemes:["http","https","mailto"],allowedTags:["a","b","br","i","img","p","small","span","sub","sup"]})};return x.createElement(tA,{as:l,...d,dangerouslySetInnerHTML:m})},Nr=a=>x.useContext(tI)?x.createElement(Lt,{...a}):x.createElement(St,null,x.createElement(Lt,{...a})),yo=({as:a="dd",lang:l,value:o})=>x.createElement(Nr,{markup:o,as:a,lang:l}),tT=e5("span",{}),wo=({as:a="dd",customValueContent:l,lang:o,value:s})=>{var d;let{delimiter:m}=Vr(),p=null==(d=Hr(s,o))?void 0:d.map(a=>(0,x.cloneElement)(l,{value:a}));return x.createElement(tT,{as:a,lang:o},null==p?void 0:p.map((a,l)=>[l>0&&`${m}`,x.createElement(x.Fragment,{key:l},a)]))},Wr=a=>{var l;let{item:o,lang:s,customValueContent:d}=a,{label:m,value:p}=o,h=null==(l=Z(m))?void 0:l.replace(" ","-").toLowerCase();return x.createElement("div",{role:"group","data-label":h},x.createElement(ce,{as:"dt",label:m,lang:s}),d?x.createElement(wo,{as:"dd",customValueContent:d,value:p,lang:s}):x.createElement(yo,{as:"dd",value:p,lang:s}))},tR=e5("dl",{}),So=a=>{let{as:l,customValueContent:o,metadata:s}=a;if(!Array.isArray(s))return x.createElement(x.Fragment,null);let d=Tr(a,"customValueDelimiter"),m=ae(a,["as","customValueContent","customValueDelimiter","metadata"]);return x.createElement(St,{..."string"==typeof d?{initialState:{delimiter:d}}:void 0},s.length>0&&x.createElement(tR,{as:l,...m},s.map((a,l)=>{let s=o?function(a,l){let o=l.filter(l=>{let{matchingLabel:o}=l,s=Object.keys(l.matchingLabel)[0],d=Z(o,s);if(Z(a,s)===d)return!0}).map(a=>a.Content);if(Array.isArray(o))return o[0]}(a.label,o):void 0;return x.createElement(Wr,{customValueContent:s,item:a,key:l,lang:null==m?void 0:m.lang})})))};e5("li",{}),e5("ul",{});let t$=e5("li",{}),tO=e5("ul",{}),Ao=a=>{let{as:l,rendering:o}=a,s=ae(a,["as","rendering"]);return x.createElement(tO,{as:l},o&&o.map(a=>{let l=Z(a.label,s.lang);return x.createElement(t$,{key:a.id},x.createElement("a",{href:a.id,...s,target:"_blank"},l||a.id))}))},tM=e5("dl",{}),Ro=a=>{let{as:l,requiredStatement:o}=a;if(!o)return x.createElement(x.Fragment,null);let s=Tr(a,"customValueDelimiter"),d=ae(a,["as","customValueDelimiter","requiredStatement"]);return x.createElement(St,{..."string"==typeof s?{initialState:{delimiter:s}}:void 0},x.createElement(tM,{as:l,...d},x.createElement(Wr,{item:o,lang:d.lang})))},tP=e5("li",{}),tL=e5("ul",{}),Mo=a=>{let{as:l,seeAlso:o}=a,s=ae(a,["as","seeAlso"]);return x.createElement(tL,{as:l},o&&o.map(a=>{let l=Z(a.label,s.lang);return x.createElement(tP,{key:a.id},x.createElement("a",{href:a.id,...s},l||a.id))}))},Oo=a=>{let{as:l,summary:o}=a,s=ae(a,["as","customValueDelimiter","summary"]);return x.createElement(Nr,{as:l,markup:o,...s})},Ur=a=>{let{thumbnail:l,region:o}=a,s=ae(a,["thumbnail"]);return x.createElement(x.Fragment,null,l&&l.map(a=>x.createElement(mo,{contentResource:a,key:a.id,region:o,...s})))},Po=({annotationPage:a})=>{var l,o,s,d,m,p;let h=D(),{vault:v}=h;if(!a||!a.items||(null==(l=a.items)?void 0:l.length)===0)return x.createElement(x.Fragment,null);let b=a.items.map(a=>v.get(a.id));if(!b)return x.createElement(x.Fragment,null);let w=b.reduce((a,l)=>(a.canvas=l.target.source.id,a.annotations=[],a.annotations.push(null==l?void 0:l.id),a),{}),E=v.get(w.canvas),C=me(v,E.id),k=null!=(o=null==C?void 0:C[0])&&o.service?(null==(d=null==(s=null==C?void 0:C[0])?void 0:s.service[0])?void 0:d.id)||(null==(p=null==(m=null==C?void 0:C[0])?void 0:m.service[0])?void 0:p["@id"]):void 0;return x.createElement(tg,{"data-testid":"annotation-page"},E&&x.createElement("header",null,x.createElement(ce,{label:E.label})),x.createElement("div",{"data-testid":"annotation-page-items"},null==b?void 0:b.map(a=>x.createElement(xt,{annotation:a,targetResource:k,key:a.id}))))},tF=e5("div",{form:{display:"flex",alignItems:"center",width:"100%",height:"100%",gap:"1rem",padding:"0 1.618rem 1.618rem",".content-search-input":{flexGrow:"1",input:{width:"100%",border:"none",backgroundColor:"$secondaryMuted",color:"$primary",marginRight:"1rem",height:"2rem",padding:"0 1rem",borderRadius:"1rem",fontFamily:"inherit",fontSize:"1rem",lineHeight:"1rem",boxShadow:"inset 1px 1px 2px #0001","&::placeholder":{color:"#0006"}}}}}),tz=e5("button",{display:"flex",background:"none",border:"none",width:"2rem",height:"2rem",padding:"0",margin:"0",fontWeight:"700",borderRadius:"2rem",backgroundColor:"$accent",color:"$secondary",cursor:"pointer",boxSizing:"content-box",transition:"$all",svg:{height:"60%",width:"60%",padding:"20%",fill:"$secondary",stroke:"$secondary",opacity:"1",filter:"drop-shadow(5px 5px 5px #000D)",boxSizing:"inherit",transition:"$all"},"&:disabled":{backgroundColor:"transparent",boxShadow:"none",svg:{opacity:"0.25"}}}),Lo=({searchServiceUrl:a,setContentSearchResource:l,setLoading:o})=>{let{t:s}=(0,b.$G)(),[d,m]=(0,x.useState)(),p=D(),{openSeadragonViewer:h,vault:v}=p;async function u(s){if(s.preventDefault(),h&&a){if(!d||""===d.trim()){l({});return}o(!0),Mr(v,a,{q:d}).then(a=>{l(a),o(!1)})}}let w=s("contentSearchPlaceholder");return x.createElement(tF,null,x.createElement(V.fC,{onSubmit:u,className:"content-search-form"},x.createElement(V.gN,{className:"content-search-input",name:"searchTerms",onChange:a=>{a.preventDefault(),m(a.target.value)}},x.createElement(V.oT,{placeholder:w})),x.createElement(V.k4,{asChild:!0},x.createElement(tz,{type:"submit"},x.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},x.createElement("title",null,s("informationPanelTabsSearch")),x.createElement("path",{d:"M456.69 421.39L362.6 327.3a173.81 173.81 0 0034.84-104.58C397.44 126.38 319.06 48 222.72 48S48 126.38 48 222.72s78.38 174.72 174.72 174.72A173.81 173.81 0 00327.3 362.6l94.09 94.09a25 25 0 0035.3-35.3zM97.92 222.72a124.8 124.8 0 11124.8 124.8 124.95 124.95 0 01-124.8-124.8z"}))))))},zo=({searchServiceUrl:a,setContentSearchResource:l,activeCanvas:o,annotationPage:s})=>{let d;let m=D(),{vault:p}=m,{t:h}=(0,b.$G)(),[v,w]=(0,x.useState)(!1),[E,C]=(0,x.useState)({});return(0,x.useEffect)(()=>{var a;if(!(null!=s&&s.items))return;let l=(null==(a=null==s?void 0:s.items)?void 0:a.map(a=>p.get(a.id))).reduce((a,l)=>{let o=l.target.source.id;return a[o]||(a[o]=[]),a[o].push(l.id),a},{});C(l)},[s]),x.createElement(x.Fragment,null,x.createElement(Lo,{searchServiceUrl:a,setContentSearchResource:l,activeCanvas:o,setLoading:w}),v?x.createElement("span",null,h("contentSearchLoading")):E&&Object.keys(E).length>0&&Object.keys(E).map(a=>(d=p.get(a),x.createElement(tg,{key:a,"data-testid":"annotation-page"},d&&x.createElement("header",null,x.createElement(ce,{label:d.label})),E[a].map(a=>{var l,o,s,m,h;let v=p.get(a),b=me(p,d.id),w=null!=(l=null==b?void 0:b[0])&&l.service?(null==(s=null==(o=null==b?void 0:b[0])?void 0:o.service[0])?void 0:s.id)||(null==(h=null==(m=null==b?void 0:b[0])?void 0:m.service[0])?void 0:h["@id"]):void 0;return x.createElement(xt,{annotation:v,targetResource:w,key:v.id,isContentSearch:!0})})))))},tj=e5("div",{width:"100%",padding:" 0 1.618rem 2rem",display:"flex",flexDirection:"column",overflow:"auto",position:"absolute",fontWeight:"400",fontSize:"1rem",zIndex:"0",img:{maxWidth:"100px",maxHeight:"100px",objectFit:"contain",color:"transparent",margin:"0 0 1rem",borderRadius:"3px",backgroundColor:"$secondaryMuted"},video:{display:"none"},"a, a:visited":{color:"$accent"},p:{fontSize:"1rem",lineHeight:"1.47em",margin:"0"},dl:{margin:"0",dt:{fontWeight:"700",margin:"1rem 0 0.25rem"},dd:{margin:"0"}},".manifest-property-title":{fontWeight:"700",margin:"1rem 0 0.25rem"},"ul, ol":{padding:"0",margin:"0",li:{fontSize:"1rem",lineHeight:"1.45em",listStyle:"none",margin:"0.25rem 0 0.25rem"}}}),t_=e5("div",{position:"relative",width:"100%",height:"100%",zIndex:"0"}),Ho=({homepage:a})=>(null==a?void 0:a.length)===0?x.createElement(x.Fragment,null):x.createElement(x.Fragment,null,x.createElement("span",{className:"manifest-property-title"},"Homepage"),x.createElement(ho,{homepage:a})),Vo=({id:a,htmlLabel:l,parent:o="manifest"})=>x.createElement(x.Fragment,null,x.createElement("span",{className:"manifest-property-title"},l),x.createElement("a",{href:a,target:"_blank",id:`iiif-${o}-id`},a)),No=({metadata:a,parent:l="manifest"})=>a?x.createElement(x.Fragment,null,x.createElement(So,{metadata:a,id:`iiif-${l}-metadata`})):x.createElement(x.Fragment,null),Wo=({rendering:a})=>(null==a?void 0:a.length)===0?x.createElement(x.Fragment,null):x.createElement(x.Fragment,null,x.createElement("span",{className:"manifest-property-title"},"Alternate formats"),x.createElement(Ao,{rendering:a})),Uo=({requiredStatement:a,parent:l="manifest"})=>a?x.createElement(x.Fragment,null,x.createElement(Ro,{requiredStatement:a,id:`iiif-${l}-required-statement`})):x.createElement(x.Fragment,null),qo=({rights:a})=>a?x.createElement(x.Fragment,null,x.createElement("span",{className:"manifest-property-title"},"Rights"),x.createElement("a",{href:a,target:"_blank"},a)):x.createElement(x.Fragment,null),jo=({seeAlso:a})=>(null==a?void 0:a.length)===0?x.createElement(x.Fragment,null):x.createElement(x.Fragment,null,x.createElement("span",{className:"manifest-property-title"},"See Also"),x.createElement(Mo,{seeAlso:a})),Go=({summary:a,parent:l="manifest"})=>a?x.createElement(x.Fragment,null,x.createElement(Oo,{summary:a,as:"p",id:`iiif-${l}-summary`})):x.createElement(x.Fragment,null),Qo=({label:a,thumbnail:l})=>(null==l?void 0:l.length)===0?x.createElement(x.Fragment,null):x.createElement(x.Fragment,null,x.createElement(Ur,{altAsLabel:a||{none:["resource"]},thumbnail:l,style:{backgroundColor:"#6663",objectFit:"cover"}})),Jo=()=>{let a=D(),{activeManifest:l,vault:o}=a,[s,d]=(0,x.useState)(),[m,p]=(0,x.useState)([]),[h,v]=(0,x.useState)([]),[b,w]=(0,x.useState)([]),[E,C]=(0,x.useState)([]);return(0,x.useEffect)(()=>{var a,s,m,h;let b=o.get(l);b&&(d(b),(null==(a=b.homepage)?void 0:a.length)>0&&p(o.get(b.homepage)),(null==(s=b.seeAlso)?void 0:s.length)>0&&v(o.get(b.seeAlso)),(null==(m=b.rendering)?void 0:m.length)>0&&w(o.get(b.rendering)),(null==(h=b.thumbnail)?void 0:h.length)>0&&C(o.get(b.thumbnail)))},[l,o]),s?x.createElement(t_,null,x.createElement(tj,null,x.createElement(Qo,{thumbnail:E,label:s.label}),x.createElement(Go,{summary:s.summary}),x.createElement(No,{metadata:s.metadata}),x.createElement(Uo,{requiredStatement:s.requiredStatement}),x.createElement(qo,{rights:s.rights}),x.createElement(Ho,{homepage:m}),x.createElement(jo,{seeAlso:h}),x.createElement(Wo,{rendering:b}),x.createElement(Vo,{id:s.id,htmlLabel:"IIIF Manifest"}))):x.createElement(x.Fragment,null)},Xo=({contentStateAnnotation:a})=>{var l,o,s,d,m,p;let h=D(),{vault:v}=h;if(!a)return x.createElement(x.Fragment,null);let b=(null==(l=null==a?void 0:a.target)?void 0:l.source)||(null==a?void 0:a.target),w=v.get(null==b?void 0:b.id),E=me(v,w.id),C=null!=(o=null==E?void 0:E[0])&&o.service?(null==(d=null==(s=null==E?void 0:E[0])?void 0:s.service[0])?void 0:d.id)||(null==(p=null==(m=null==E?void 0:E[0])?void 0:m.service[0])?void 0:p["@id"]):void 0;return x.createElement(tg,{"data-testid":"annotation-page"},w&&x.createElement("header",null,x.createElement(ce,{label:w.label})," ",x.createElement("em",null,"(Shared)")),x.createElement("div",{"data-testid":"annotation-page-items"},x.createElement(xt,{annotation:a,targetResource:C,key:a.id,isContentState:!0})))},Ko=({activeCanvas:a,annotationResources:l,searchServiceUrl:o,setContentSearchResource:s,contentSearchResource:d})=>{var m;let{t:p}=(0,b.$G)(),h=X(),v=D(),{contentStateAnnotation:w,informationPanelResource:E,isAutoScrolling:C,isUserScrolling:k,vault:I,configOptions:A,plugins:M}=v,{informationPanel:P}=A,L=null==P?void 0:P.renderAbout,F=null==P?void 0:P.renderAnnotation,z=I.get({id:a,type:"Canvas"}),_=null==P?void 0:P.renderContentSearch,H=null==P?void 0:P.renderToggle,V=(null==(m=null==w?void 0:w.target)?void 0:m.source)||(null==w?void 0:w.target),N=!!w&&V.id===a,U=!!(null!=l&&l.length)||N,{pluginsWithInfoPanel:q}=function(a){let l=[];return a.forEach(a=>{var o;null!=(o=a.informationPanel)&&o.component&&l.push(a)}),{pluginsWithInfoPanel:l}}(M);return(0,x.useEffect)(()=>{["manifest-about","manifest-annotations","manifest-content-search"].includes(String(null==P?void 0:P.defaultTab))?h({type:"updateInformationPanelResource",informationPanelResource:null==P?void 0:P.defaultTab}):h(N?{type:"updateInformationPanelResource",informationPanelResource:"manifest-annotations"}:{type:"updateInformationPanelResource",informationPanelResource:"manifest-about"})},[]),(0,x.useEffect)(()=>{U||h({type:"updateInformationPanelResource",informationPanelResource:"manifest-about"})},[U]),x.createElement(tc,{"data-testid":"information-panel",defaultValue:E,onValueChange:a=>{h({type:"updateInformationPanelResource",informationPanelResource:a})},orientation:"horizontal",value:E,className:"clover-viewer-information-panel"},x.createElement(td,{"aria-label":p("informationPanelTabs"),"data-testid":"information-panel-list"},H&&x.createElement(tu,{value:"manifest-back","data-value":"manifest-back",onClick:()=>{h({type:"updateInformationOpen",isInformationOpen:!1})},as:"button"},p("informationPanelTabsClose")),L&&x.createElement(tu,{value:"manifest-about"},p("informationPanelTabsAbout")),_&&d&&x.createElement(tu,{value:"manifest-content-search"},p("informationPanelTabsSearch")),F&&U&&x.createElement(tu,{value:"manifest-annotations"},p("informationPanelTabsAnnotations")),q&&q.map((a,l)=>{var o;return x.createElement(tu,{key:l,value:a.id},x.createElement(ce,{label:null==(o=a.informationPanel)?void 0:o.label}))})),x.createElement(tp,{handleScroll:function(){if(!C){clearTimeout(k);let a=setTimeout(()=>{h({type:"updateUserScrolling",isUserScrolling:void 0})},1500);h({type:"updateUserScrolling",isUserScrolling:a})}}},L&&x.createElement(tm,{value:"manifest-about"},x.createElement(Jo,null)),_&&d&&x.createElement(tm,{value:"manifest-content-search"},x.createElement(zo,{searchServiceUrl:o,setContentSearchResource:s,activeCanvas:a,annotationPage:d})),F&&l&&x.createElement(tm,{value:"manifest-annotations"},w&&N&&x.createElement(Xo,{contentStateAnnotation:w}),l.map(a=>x.createElement(Po,{key:a.id,annotationPage:a}))),q&&q.map((a,l)=>(function(a,l){var o,s;let d=null==(o=null==a?void 0:a.informationPanel)?void 0:o.component;return void 0===d?x.createElement(x.Fragment,null):x.createElement(tm,{key:l,value:a.id},x.createElement(O.ErrorBoundary,{FallbackComponent:bt},x.createElement(d,{...null==(s=null==a?void 0:a.informationPanel)?void 0:s.componentProps,canvas:z,useViewerDispatch:X,useViewerState:D})))})(a,l))))},tB=e5("svg",{display:"inline-flex",variants:{isLarge:{true:{height:"4rem",width:"4rem"}},isMedium:{true:{height:"2rem",width:"2rem"}},isSmall:{true:{height:"1rem",width:"1rem"}}}}),j=a=>x.createElement(tB,{...a,"data-testid":"icon-svg",role:"img",viewBox:"0 0 512 512",xmlns:"http://www.w3.org/2000/svg"},a.children);j.Title=({children:a})=>x.createElement("title",null,a),j.Add=()=>x.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32",d:"M256 112v288M400 256H112"}),j.Audio=()=>x.createElement(x.Fragment,null,x.createElement("path",{d:"M232 416a23.88 23.88 0 01-14.2-4.68 8.27 8.27 0 01-.66-.51L125.76 336H56a24 24 0 01-24-24V200a24 24 0 0124-24h69.75l91.37-74.81a8.27 8.27 0 01.66-.51A24 24 0 01256 120v272a24 24 0 01-24 24zm-106.18-80zm-.27-159.86zM320 336a16 16 0 01-14.29-23.19c9.49-18.87 14.3-38 14.3-56.81 0-19.38-4.66-37.94-14.25-56.73a16 16 0 0128.5-14.54C346.19 208.12 352 231.44 352 256c0 23.86-6 47.81-17.7 71.19A16 16 0 01320 336z"}),x.createElement("path",{d:"M368 384a16 16 0 01-13.86-24C373.05 327.09 384 299.51 384 256c0-44.17-10.93-71.56-29.82-103.94a16 16 0 0127.64-16.12C402.92 172.11 416 204.81 416 256c0 50.43-13.06 83.29-34.13 120a16 16 0 01-13.87 8z"}),x.createElement("path",{d:"M416 432a16 16 0 01-13.39-24.74C429.85 365.47 448 323.76 448 256c0-66.5-18.18-108.62-45.49-151.39a16 16 0 1127-17.22C459.81 134.89 480 181.74 480 256c0 64.75-14.66 113.63-50.6 168.74A16 16 0 01416 432z"})),j.Close=()=>x.createElement("path",{d:"M289.94 256l95-95A24 24 0 00351 127l-95 95-95-95a24 24 0 00-34 34l95 95-95 95a24 24 0 1034 34l95-95 95 95a24 24 0 0034-34z"}),j.Download=()=>x.createElement(x.Fragment,null,x.createElement("path",{d:"M336 176h40a40 40 0 0140 40v208a40 40 0 01-40 40H136a40 40 0 01-40-40V216a40 40 0 0140-40h40",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32"}),x.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32",d:"M176 272l80 80 80-80M256 48v288"})),j.Image=()=>x.createElement("path",{d:"M416 64H96a64.07 64.07 0 00-64 64v256a64.07 64.07 0 0064 64h320a64.07 64.07 0 0064-64V128a64.07 64.07 0 00-64-64zm-80 64a48 48 0 11-48 48 48.05 48.05 0 0148-48zM96 416a32 32 0 01-32-32v-67.63l94.84-84.3a48.06 48.06 0 0165.8 1.9l64.95 64.81L172.37 416zm352-32a32 32 0 01-32 32H217.63l121.42-121.42a47.72 47.72 0 0161.64-.16L448 333.84z"}),j.Video=()=>x.createElement("path",{d:"M464 384.39a32 32 0 01-13-2.77 15.77 15.77 0 01-2.71-1.54l-82.71-58.22A32 32 0 01352 295.7v-79.4a32 32 0 0113.58-26.16l82.71-58.22a15.77 15.77 0 012.71-1.54 32 32 0 0145 29.24v192.76a32 32 0 01-32 32zM268 400H84a68.07 68.07 0 01-68-68V180a68.07 68.07 0 0168-68h184.48A67.6 67.6 0 01336 179.52V332a68.07 68.07 0 01-68 68z"});let tD=e8({"0%":{opacity:0,transform:"translateY(1rem)"},"100%":{opacity:1,transform:"translateY(0)"}}),tW=e8({"0%":{opacity:0,transform:"translateY(1rem)"},"100%":{opacity:1,transform:"translateY(0)"}}),tH=e5(N.Eh,{fill:"$secondaryAlt"}),tV=e5(N.x8,{position:"absolute",right:"0",top:"0",padding:"0.5rem",margin:"0",cursor:"pointer",border:"none",background:"none",fill:"inherit","&:hover":{opacity:"0.75"}}),tN=e5(N.VY,{border:"none",backgroundColor:"white",fill:"inhrerit",padding:"1rem 2rem 1rem 1rem",width:"auto",minWidth:"200px",maxWidth:"350px",borderRadius:"3px",boxShadow:"5px 5px 13px #0002",animationDuration:"0.3s",animationTimingFunction:"cubic-bezier(0.16, 1, 0.3, 1)",'&[data-side="top"]':{animationName:tW},'&[data-side="bottom"]':{animationName:tD},'&[data-align="end"]':{[`& ${tH}`]:{margin:"0 0.7rem"}}}),tU=e5(N.xz,{display:"inline-flex",padding:"0.5rem 0",margin:"0 0.5rem 0 0",cursor:"pointer",border:"none",background:"none","> button, > span":{margin:"0"}}),tq=e5(N.fC,{boxSizing:"content-box"}),be=({children:a})=>x.createElement(tq,null,a);be.Trigger=a=>x.createElement(tU,{...a},a.children),be.Content=a=>x.createElement(tN,{...a,sideOffset:5,collisionPadding:21},x.createElement(tH,null),x.createElement(tV,null,x.createElement(j,{isSmall:!0},x.createElement(j.Close,null))),a.children);let tQ=e5("div",{boxSizing:"border-box",display:"inline-flex",alignItems:"center",borderRadius:"2px",padding:"$1",marginBottom:"$2",marginRight:"$2",backgroundColor:"$lightGrey",color:"$richBlack50",textTransform:"uppercase",fontSize:"$2",objectFit:"contain",lineHeight:"1em !important","&:last-child":{marginRight:"0"},[`${tB}`]:{position:"absolute",left:"$1",height:"$3",width:"$3"},variants:{isIcon:{true:{position:"relative",paddingLeft:"$5"}}}}),tZ=e5("span",{background:"transparent",opacity:"0",border:"3px solid transparent",position:"absolute",width:"100%",height:"100%",zIndex:"0",left:"0",top:"0",transition:"$all"}),tG=e5("span",{display:"flex"}),tJ=e5("span",{display:"flex",width:"1.2111rem",height:"0.7222rem"}),tX=e5("span",{display:"inline-flex",marginLeft:"5px",marginBottom:"-1px"}),tY=e5("div",{position:"relative",display:"flex",backgroundColor:"$secondaryAlt",width:"inherit",height:"100px",overflow:"hidden",borderRadius:"3px",".media-thumbnail-lazyload":{width:"100%",height:"100%",borderRadius:"3px"},img:{width:"100%",height:"100%",objectFit:"cover",objectPosition:"top center",filter:"blur(0)",transform:"scale3d(1, 1, 1)",borderRadius:"3px",transition:"$all",color:"transparent"},[`& ${tG}`]:{position:"absolute",right:"0",bottom:"0",[`& ${tQ}`]:{display:"none",margin:"0",paddingLeft:"0",fontSize:"0.7222rem",backgroundColor:"#000d",color:"$secondary",fill:"$secondary",borderBottomLeftRadius:"0",borderTopRightRadius:"0"}}}),tK=e5(z.ck,{display:"flex",flexShrink:"0",padding:"0",cursor:"pointer",background:"none",border:"none",fontFamily:"inherit",lineHeight:"1.25em",fontSize:"1rem",textAlign:"left",figure:{margin:"0",width:"161.8px",figcaption:{marginTop:"0.5rem",fontWeight:"400",fontSize:"0.8333rem",display:"-webkit-box",overflow:"hidden",MozBoxOrient:"vertical",WebkitBoxOrient:"vertical",WebkitLineClamp:"5","@sm":{fontSize:"0.8333rem"}}}}),t0=e5(z.fC,{display:"flex",flexDirection:"row",flexGrow:"1",overflowX:"scroll",position:"relative",zIndex:"0",gap:"1rem",padding:"1.618rem 0"}),t1=e5("div",{display:"flex",flexDirection:"row","&[data-active='true']":{[`& ${tK}`]:{figcaption:{fontWeight:"700"},[`& ${tQ}`]:{backgroundColor:"$accent"},[`& ${tZ}`]:{background:"#0003",opacity:"1",borderBottom:"3px solid $accent"},"&:first-of-type":{[`& ${tZ}`]:{borderRight:"unset"}},"&:last-of-type":{[`& ${tZ}`]:{borderLeft:"unset"}}}},[`& ${tK}`]:{[`& ${tY}`]:{borderRadius:"unset"},"&:first-of-type":{[`& ${tY}`]:{borderTopLeftRadius:"3px",borderBottomLeftRadius:"3px"}},"&:last-of-type":{[`& ${tY}`]:{borderTopRightRadius:"3px",borderBottomRightRadius:"3px"},[`& ${tQ}`]:{display:"flex"}}}}),t2=e5("div",{position:"absolute",right:"1rem",top:"1rem",display:"flex",justifyContent:"flex-end",zIndex:"1"}),t3=e5("input",{flexGrow:"1",border:"none",backgroundColor:"$secondaryMuted",color:"$primary",marginRight:"1rem",height:"2rem",padding:"0 1rem",borderRadius:"2rem",fontFamily:"inherit",fontSize:"1rem",lineHeight:"1rem",boxShadow:"inset 1px 1px 2px #0001","&::placeholder":{color:"$primaryMuted"}}),t4=e5("button",{display:"flex",background:"none",border:"none",width:"2rem !important",height:"2rem !important",padding:"0",margin:"0",fontWeight:"700",borderRadius:"2rem",backgroundColor:"$accent",color:"$secondary",cursor:"pointer",boxSizing:"content-box !important",transition:"$all",svg:{height:"60%",width:"60%",padding:"20%",fill:"$secondary",stroke:"$secondary",opacity:"1",filter:"drop-shadow(5px 5px 5px #000D)",boxSizing:"inherit",transition:"$all"},"&:disabled":{backgroundColor:"transparent",boxShadow:"none",svg:{opacity:"0.25"}}}),t5=e5("div",{display:"flex",marginRight:"0.618rem",backgroundColor:"$accentAlt",borderRadius:"2rem",boxShadow:"5px 5px 5px #0003",color:"$secondary",alignItems:"center","> span":{display:"flex",margin:"0 0.5rem",fontSize:"0.7222rem",fontWeight:"bold",gap:"0.25rem",em:{opacity:"0.25"}}}),t6=e5("div",{display:"flex",position:"relative",zIndex:"1",width:"100%",padding:"0",transition:"$all",variants:{isToggle:{true:{paddingTop:"2.618rem",[`& ${t2}`]:{width:"calc(100% - 2rem)","@sm":{width:"calc(100% - 2rem)"}}}}}}),Es=(a,l)=>{(0,x.useEffect)(()=>{function r(o){o.key===a&&l()}return window.addEventListener("keyup",r),()=>window.removeEventListener("keyup",r)},[])},Ss=({title:a})=>x.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},x.createElement("title",null,a),x.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M244 400L100 256l144-144M120 256h292"})),Cs=({title:a})=>x.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},x.createElement("title",null,a),x.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M268 112l144 144-144 144M392 256H100"})),Is=({title:a})=>x.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},x.createElement("title",null,a),x.createElement("path",{d:"M289.94 256l95-95A24 24 0 00351 127l-95 95-95-95a24 24 0 00-34 34l95 95-95 95a24 24 0 1034 34l95-95 95 95a24 24 0 0034-34z"})),As=({title:a})=>x.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},x.createElement("title",null,a),x.createElement("path",{d:"M456.69 421.39L362.6 327.3a173.81 173.81 0 0034.84-104.58C397.44 126.38 319.06 48 222.72 48S48 126.38 48 222.72s78.38 174.72 174.72 174.72A173.81 173.81 0 00327.3 362.6l94.09 94.09a25 25 0 0035.3-35.3zM97.92 222.72a124.8 124.8 0 11124.8 124.8 124.95 124.95 0 01-124.8-124.8z"})),Ts=({handleCanvasToggle:a,handleFilter:l,activeIndex:o,canvasLength:s})=>{let[d,m]=(0,x.useState)(!1),[p,h]=(0,x.useState)(!1),[v,w]=(0,x.useState)(!1),{t:E}=(0,b.$G)();return(0,x.useEffect)(()=>{w(0===o),o===s-1?h(!0):h(!1)},[o,s]),Es("Escape",()=>{m(!1),l("")}),x.createElement(t6,{isToggle:d},x.createElement(t2,null,d&&x.createElement(t3,{autoFocus:!0,onChange:a=>l(a.target.value),placeholder:E("commonSearchPlaceholder")}),!d&&x.createElement(t5,null,x.createElement(t4,{onClick:()=>a(-1),disabled:v,type:"button"},x.createElement(Ss,{title:E("commonPrevious")})),x.createElement("span",null,o+1," ",x.createElement("em",null,"/")," ",s),x.createElement(t4,{onClick:()=>a(1),disabled:p,type:"button"},x.createElement(Cs,{title:E("commonNext")}))),x.createElement(t4,{onClick:()=>{m(a=>!a),l("")},type:"button",className:"clover-viewer-media-search"},d?x.createElement(Is,{title:E("commonClose")}):x.createElement(As,{title:E("commonSearch")}))))},Rs=({children:a,rootMargin:l="100px",attributes:o={},isVisibleCallback:s=()=>{}})=>{let d=(0,x.useRef)(null),[m,p]=(0,x.useState)(!1);return(0,x.useEffect)(()=>{let a=d.current;if(!a)return;let o=new IntersectionObserver(([a])=>{a.isIntersecting&&(s(!0),p(!0),o.disconnect())},{rootMargin:l});return o.observe(a),()=>o.disconnect()},[d]),x.createElement("div",{ref:d,...o},m?a:null)};var t8={},t7={get:a=>a,setMetaValue([a,l,o],s){let d=t7.getResourceMeta(a,l),m=d?d[o]:void 0,p="function"==typeof s?s(m):s;t8[a]={...t8[a]||{},[l]:{...(t8[a]||{})[l]||{},[o]:p}}},getResourceMeta:(a,l)=>{let o=t8[a];if(o)return l?o[l]:o},async load(a){let l="string"==typeof a?a:a.id;return fetch(l).then(a=>a.json())},requestStatus(a){}},t9=Object.defineProperty,$s=(a,l,o)=>l in a?t9(a,l,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[l]=o,Pe=(a,l,o)=>($s(a,"symbol"!=typeof l?l+"":l,o),o);function ve(a){return a.endsWith("info.json")?a:a.endsWith("/")?`${a}info.json`:`${a}/info.json`}var ie="http://library.stanford.edu/iiif/image-api/compliance.html#level1",it="http://library.stanford.edu/iiif/image-api/compliance.html#level2",ii="http://library.stanford.edu/iiif/image-api/conformance.html#level1",ir="http://library.stanford.edu/iiif/image-api/conformance.html#level2",il="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1",is="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2",id="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level1",iu="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level2",im="http://iiif.io/api/image/1/level1.json",ip="http://iiif.io/api/image/1/profiles/level1.json",ih="http://iiif.io/api/image/1/level2.json",ig="http://iiif.io/api/image/1/profiles/level2.json",iv="http://iiif.io/api/image/2/level1.json",iy="http://iiif.io/api/image/2/profiles/level1.json",ib="http://iiif.io/api/image/2/level2.json",ix="http://iiif.io/api/image/2/profiles/level2.json",iw="level1",iE="level2",iS="http://iiif.io/api/image/2/level1",iC="http://iiif.io/api/image/2/level2",ik="https://iiif.io/api/image/1.1/compliance/#level1",iI="https://iiif.io/api/image/1.1/compliance/#level2",iA=[iC,it,ir,is,iu,ih,ig,ib,ix,iE,iI],iT=[...iA,iS,ie,ii,il,id,im,ip,iv,iy,iw,ik],iR=["http://iiif.io/api/image/2/level0",iS,iC,"http://library.stanford.edu/iiif/image-api/compliance.html#level0",ie,it,"http://library.stanford.edu/iiif/image-api/conformance.html#level0",ii,ir,"http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0",il,is,"http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level0",id,iu,"http://iiif.io/api/image/1/level0.json","http://iiif.io/api/image/1/profiles/level0.json",im,ip,ih,ig,"http://iiif.io/api/image/2/level0.json","http://iiif.io/api/image/2/profiles/level0.json",iv,iy,ib,ix,"level0",iw,iE,"https://iiif.io/api/image/1.1/compliance/#level0",ik,iI],i$={extraFormats:["jpg"],extraQualities:["default"],extraFeatures:["sizeByWhListed"]},iO={extraFormats:["jpg"],extraQualities:["default"],extraFeatures:["baseUriRedirect","cors","jsonldMediaType","regionByPx","regionSquare","sizeByWhListed","sizeByH","sizeByW","sizeByWh"]},iM={extraFormats:["jpg","png"],extraQualities:["default"],extraFeatures:["baseUriRedirect","cors","jsonldMediaType","regionByPct","regionByPx","regionSquare","rotationBy90s","sizeByWhListed","sizeByConfinedWh","sizeByH","sizeByPct","sizeByW","sizeByWh"]};function B(a){return a["@id"]?a["@id"]:a.id?a.id:void 0}function je(a){if(!a||!a.profile||!B(a))return!1;for(let l of Array.isArray(a.profile)?a.profile:[a.profile])if("string"==typeof l&&-1!==iR.indexOf(l))return!0;return!1}function Le(a,l){if(l&&l.profile){let o=l.profile;if(o){let l=Array.isArray(o)?o:[o];return l.includes(`level${a}`)||l.includes(`http://iiif.io/api/image/2/level${a}.json`)||l.includes(`http://iiif.io/api/image/1/level${a}.json`)||l.includes(`http://iiif.io/api/image/1/profiles/level${a}.json`)}}return!1}function ft(a){return je(a)?Le(0,a)?0:Le(1,a)?1:Le(2,a)?2:null:null}function wn(a){return -1!==(a["@context"]?Array.isArray(a["@context"])?a["@context"]:[a["@context"]]:[]).indexOf("http://iiif.io/api/image/3/context.json")}function zt(a){let l=a.match(/^.*\/(full)\/(((\d+),(\d+)?)|max)\/(\d+)\/default\.(jpg|png|jpeg)$/);if(l&&l[4]&&l[5]){let o=l[1],s=parseInt(l[4],10),d=parseInt(l[5],10),m=l[7];if(("max"===o||"full"===o)&&s&&d&&m)return{type:"fixed",id:a,height:d,width:s}}return{type:"unknown",id:a}}function ht(a){if("string"==typeof a)return zt(a);let l=a["@type"]?a["@type"]:a.type?a.type:void 0;if("Image"!==l&&"sc:Image"!==l)return null;let o=B(a);return o?o&&a.width&&a.height?{id:o,type:"fixed",width:a.width,height:a.height,unsafe:!0}:zt(o):null}function Dt(a){let l=[],o=a.length;for(let s=0;s<o;s++){let o=a[s];if(!o)continue;let d=function(a){return je(a)?(a&&a.sizes?a.sizes:[]).map(l=>({id:B(a),type:"fixed-service",height:l.height,width:l.width,level:ft(a),version:wn(a)?3:2})):[]}(o);d.length&&l.push(...d);let m=function(a){if(!function(a){if(!je(a))return!1;for(let l of Array.isArray(a.profile)?a.profile:[a.profile])if("string"==typeof l){if(-1!==iT.indexOf(l))return!0}else{let a=[...l.supports||[],...l.extraFeatures||[]];if(-1!==a.indexOf("regionByPx")&&(-1!==a.indexOf("sizeByW")||-1!==a.indexOf("sizeByWh")))return!0}return!1}(a))return[];let l=[],o=Array.isArray(a.profile)?a.profile:[a.profile],s=o.length;for(let l=0;l<s;l++){let s=o[l];if(s&&"string"!=typeof s&&(s.maxHeight||s.maxWidth))return[{id:B(a),type:"variable",minWidth:0,minHeight:0,maxHeight:s.maxHeight||s.maxWidth,maxWidth:s.maxWidth||s.maxHeight,level:ft(a),version:"http://iiif.io/api/image/3/context.json"===a["@context"]?3:2}]}if(a.tiles){let o=a.tiles.length;for(let s=0;s<o;s++){let o=a.tiles[s];o&&(o.height||o.width)&&l.push({id:B(a),type:"variable",minHeight:0,minWidth:0,maxHeight:o.height||o.width,maxWidth:o.width,level:ft(a),version:wn(a)?3:2})}}return l}(o);m.length&&l.push(...m)}return l}function xn(a){let l=a.service?Array.isArray(a.service)?a.service:[a.service]:[],o=l.length,s=[];for(let a=0;a<o;a++)je(l[a])&&s.push(l[a]);return s}function tt(a,l,o){let s=function(a){let l=function(a,l=""){let{path:o,scheme:s,server:d,prefix:m}=function(a,l=""){let o=a.match(/^(([a-zA-Z]+):\/\/([^/]+))?((.*)+)/);if(!o)throw Error(`Invalid or unknown input ${a}`);let s=o[2],d=o[3],m=o[4];if("/"===m[0]&&(m=m.substring(1)),l.length>0){if("/"===l[0]&&(l=l.substring(1)),l!==m.substring(0,l.length))throw Error(`Path does not start with prefix (path: ${m}, prefix: ${l})`);m=m.substring(l.length)}return{scheme:s,server:d,path:m,prefix:l}}(a,l),p=(o||"").split("/").reverse(),[h,v,b,x,...w]=p,E=w.reverse().filter(Boolean).join("/");if(1===p.length||""===h)return{type:"base",scheme:s,server:d,prefix:m,identifier:E};if("info.json"===h){let[,...a]=p;return{type:"info",scheme:s,server:d,prefix:m,identifier:a.reverse().filter(Boolean).join("/")}}let C=(h||"").split(".");if(typeof C[1]>"u"||typeof C[0]>"u"||typeof x>"u"||typeof b>"u"||typeof v>"u")throw Error("Invalid image request");return{type:"image",scheme:s,server:d,prefix:m,identifier:E,originalPath:o,region:function(a){try{if("full"===a)return{full:!0};if("square"===a)return{square:!0};let l=a.startsWith("pct:"),o=a.substr(l?4:0).split(",").map(a=>parseFloat(a));return{x:o[0],y:o[1],w:o[2],h:o[3],percent:l}}catch{throw Error("Expected 'full', 'square' or 'x,y,w,h'. Found "+a)}}(x),size:function(a){let l={upscaled:!1,max:!1,confined:!1};if("^"===a[0]&&(l.upscaled=!0,a=a.slice(1)),"max"===a||"full"===a)return l.max=!0,l.serialiseAsFull="full"===a,l;if("!"===a[0]&&(l.confined=!0,a=a.slice(1)),"p"===a[0])return l.percentScale=parseFloat(a.slice(4)),l;let o=a.split(",").map(a=>a.trim());return o.length&&"u">typeof o[0]&&(""!==o[0]&&(l.width=parseInt(o[0],10)),"u">typeof o[1]&&""!==o[1]?(l.height=parseInt(o[1],10),l.version=2):l.version=3),l}(b),rotation:function(a){let l={angle:0};if("!"===a[0]&&(l.mirror=!0,a=a.substr(1)),l.angle=parseFloat(a)%360,Number.isNaN(l.angle))throw Error(`Invalid rotation ${a}`);return l}(v),quality:C[0],format:C[1]}}(ve(a.id));if("info"!==l.type)throw Error("Invalid service URL");let o=function(a){let l=a?Array.isArray(a.profile)?a.profile:[a.profile]:[],o={extraQualities:[],extraFormats:[],extraFeatures:[]};for(let a of l){var s;if("string"==typeof a&&(s=a,a=-1!==iA.indexOf(s)?iM:-1!==iT.indexOf(s)?iO:i$),a){if(a.formats)for(let l of a.formats)-1===o.extraFormats.indexOf(l)&&o.extraFormats.push(l);if(a.qualities)for(let l of a.qualities)-1===o.extraQualities.indexOf(l)&&o.extraQualities.push(l);if(a.supports)for(let l of a.supports)-1===o.extraFeatures.indexOf(l)&&o.extraFeatures.push(l);if(a.maxHeight&&(o.maxHeight=a.maxHeight),a.maxWidth&&(o.maxWidth=a.maxWidth),a.maxArea&&(o.maxArea=a.maxArea),a.extraFormats)for(let l of a.extraFormats)-1===o.extraFormats.indexOf(l)&&o.extraFormats.push(l);if(a.extraQualities)for(let l of a.extraQualities)-1===o.extraQualities.indexOf(l)&&o.extraQualities.push(l);if(a.extraFeatures)for(let l of a.extraFeatures)-1===o.extraFeatures.indexOf(l)&&o.extraFeatures.push(l);a.maxHeight&&(o.maxHeight=a.maxHeight),a.maxWidth&&(o.maxWidth=a.maxWidth),a.maxArea&&(o.maxArea=a.maxArea)}}if(a.extraFormats)for(let l of a.extraFormats)-1===o.extraFormats.indexOf(l)&&o.extraFormats.push(l);if(a.extraFeatures)for(let l of a.extraFeatures)-1===o.extraFeatures.indexOf(l)&&o.extraFeatures.push(l);if(a.extraQualities)for(let l of a.extraQualities)-1===o.extraQualities.indexOf(l)&&o.extraQualities.push(l);return o}(a);return{identifier:l.identifier,originalPath:"",server:l.server,prefix:l.prefix,scheme:l.scheme,type:"image",quality:-1===o.extraQualities.indexOf("default")?o.extraQualities[0]:"default",region:{full:!0},size:{max:!0,upscaled:!1,confined:!1},format:"jpg",rotation:{angle:0}}}({"@context":3===a.version?"http://iiif.io/api/image/3/context.json":"http://iiif.io/api/image/2/context.json",id:ve(B(a)),profile:null===a.level||typeof a.level>"u"?"level0":`level${a.level}`,type:3===a.version?"ImageService3":"ImageService2"});if("image"!==s.type)throw Error("Invalid service");return s.size.max=!1,s.size.width=l,s.size.height=o,{id:function(a,l){let o=a.prefix.startsWith("/")?a.prefix.substr(1):a.prefix,s=`${a.scheme}://${a.server}/${o?`${o}/`:""}${a.identifier}`;if("base"===a.type)return s;if("info"===a.type)return`${s}/info.json`;let{size:d}=a,{region:m,rotation:p,format:h,quality:v}=a;return[s,function({x:a=0,y:l=0,w:o,h:s,full:d,square:m,percent:p}){if(d)return"full";if(m)return"square";if(typeof o>"u"||typeof s>"u")throw Error("RegionParameter: invalid region");let h=`${a},${l},${o},${s}`;return p?`pct:${h}`:h}(m),function({max:a,percentScale:l,upscaled:o,confined:s,width:d,height:m,serialiseAsFull:p,version:h}){let v=[];return o&&v.push("^"),a?v.push(p?"full":"max"):(s&&v.push("!"),l&&v.push(`pct:${l}`),d&&v.push(`${d}`),v.push(","),m&&3===h&&v.push(`${m}`)),v.join("")}(d),`${p.mirror?"!":""}${(p.angle||0)%360}`,`${v}.${h}`].filter(Boolean).join("/")}(s),type:"fixed",width:l,height:o||a.height/(a.width||1)*l,unsafe:a.width>l}}function xe(a){let l=a.replace(/(https?:\/\/)?(www.)?/i,"");return -1!==l.indexOf("/")?l.split("/")[0]:l}var iP=class{constructor(a={}){Pe(this,"config",{verificationsRequired:1,approximateServices:!1,enableFetching:!0,disableThrottling:!1}),Pe(this,"fetchingCount",0),Pe(this,"imageServices",{}),Pe(this,"knownImageServers",{}),this.config=Object.assign(this.config,a)}setConfig(a){Object.assign(this.config,a)}sample(a,l,o=!0){let s=xe(B(a)),d=ve(B(a)),m=this.knownImageServers[s];return this.imageServices[d]=Object.assign(a,{real:!0}),m||!a.tiles||Le(0,a)?this.verify(a):(this.knownImageServers[s]={verifications:0,malformed:!1,root:s,preLoaded:o,sampledId:B(a),verified:!1,server:null,result:{context:a["@context"]||[],sampledProfile:a.profile,resourceServiceRatio:l&&a.height?l.height/a.height:1,sampledSizes:a.sizes||[],sizeRatios:function(a,l,o){let s=o.length,d=[];for(let l=0;l<s;l++){let s=o[l];if(s){let l=s.width;d.push(a/l)}}return d}(a.width,a.height,a.sizes||[]),sampledTiles:a.tiles||[]}},!0)}preLoad(a,l=!0){this.knownImageServers[a.root]=a,l&&(this.knownImageServers[a.root].malformed=!1,this.knownImageServers[a.root].verifications=this.config.verificationsRequired)}predict(a,l=!1,o=!1){let s=null==a?void 0:a.source,d=xe(B(a)),m=this.knownImageServers[d],p=ve(B(a));return this.imageServices[p]?this.imageServices[p]||null:!(!this.config.approximateServices||!m||!m.result||!(null!=s&&s.height||a.height)||!(null!=s&&s.width||a.width)||!o&&(m.malformed||m.verifications<this.config.verificationsRequired)||Le(0,a.source))?(this.imageServices[p]||(this.imageServices[p]={"@context":m.result.context,"@id":B(a),id:B(a),protocol:"http://iiif.io/api/image",tiles:(null==s?void 0:s.tiles)||function(a,l,o){let s=a>l?a:l,d=o.length,m=[];for(let a=0;a<d;a++){let l=o[a];if(!l||0===l.scaleFactors.length)continue;let d=l.scaleFactors[0];if(!d)continue;let p=s/d,h=[d];for(;p>=l.width;)h.push(d*=2),p/=2;m.push({...l,scaleFactors:h})}return m}(a.width,a.height,m.result.sampledTiles),sizes:(null==s?void 0:s.sizes)||function(a,l,o){let s=o.length,d=[];for(let m=0;m<s;m++){let s=o[m];s&&d.push({width:Math.floor(a/s),height:Math.floor(l/s)})}return d}(Math.round(a.width/m.result.resourceServiceRatio),Math.round(a.height/m.result.resourceServiceRatio),m.result.sizeRatios),profile:(null==s?void 0:s.profile)||m.result.sampledProfile,height:(null==s?void 0:s.height)||a.height,width:(null==s?void 0:s.width)||a.width,real:!1}),this.imageServices[p]||null):null}async getThumbnailFromResource(a,l,o=!0,s=[]){let d=a?await this.getImageCandidates(a,o):[];return function(a,l){let o=[],s=Object.assign({unsafeImageService:!1,atAnyCost:!0,fallback:!0,minHeight:64,minWidth:64,maxHeight:1/0,maxWidth:1/0,returnAllOptions:!1,preferFixedSize:!1,allowUnsafe:!1,explain:!1,height:0,width:0},a),i=(a,l=0)=>s.explain?o.push(Array(l).fill(0).map(a=>"    ").join("")+a().trim()):void 0,d=[],m=[],p=null;i(()=>`Using configuration: ${JSON.stringify(s,null,2)}`);let c=(a,l)=>{let o;if(i(()=>"Swapping choice",3),o=s.width?s.width:s.maxWidth,a.height<=s.maxHeight&&a.width<=s.maxWidth&&a.height>=s.minHeight&&a.width>=s.minWidth&&(!l||Math.abs(a.width-o)<Math.abs(l.width-o))){if(s.preferFixedSize&&a.unsafe){i(()=>`We found an image that was marked as unsafe, but it was the best size. (${a.id})`,4),m.push(a);return}s.returnAllOptions&&l&&m.push(l),i(()=>`We found a new image that was the best size. (${a.id})`,4),p=a}else s.returnAllOptions&&m.push(a)};i(()=>`The input shows we have ${l.length} list(s) of candidates to choose from.`);let h=l.length;for(let a=0;a<h;a++){let o=l[a]();i(()=>`Candidate group ${a}: ${JSON.stringify(o,null,2)}`,1);let m=o.length;i(()=>`Checking candidate list number ${a} and found ${m} potential ways of creating image(s)`,1);for(let a=0;a<m;a++){let l=o[a];i(()=>`-> Checking candidate ${a}`,1),"unknown"===l.type&&s.atAnyCost&&(i(()=>'We\'ve found an unknown image type, adding this to the "last resort" list',2),d.push(l)),"fixed"===l.type&&(l.unsafe?(i(()=>'We\'ve found an unsafe fixed image type, adding this to the "last resort" list',2),d.push(l)):(i(()=>"We've found a fixed size image, checking if it matches the request",2),c(l,p))),"fixed-service"===l.type&&(s.unsafeImageService?(i(()=>"Checking for an image from the tile source, without calculating the right height and width (unsafeImageService)",2),c(tt(l,s.width,s.height),p)):(i(()=>"Checking for an image from the tile source 3",2),c(tt(l,l.width,l.height),p))),"variable"===l.type&&l.maxWidth&&c(tt({id:l.id,type:"fixed-service",width:l.maxWidth,height:l.maxWidth,level:l.level,version:l.version},l.maxWidth),p)}if(p&&!s.returnAllOptions){if(p.unsafe||s.allowUnsafe)continue;i(()=>`We found a match in choice list number ${a}, no searching any more`);break}}return s.atAnyCost&&0===m.length?(i(()=>p?`We found an image! ${p.id} of type ${p.type}`:'We found no images, but "atAnyCost" is set, so returning that'),{best:p||d[0]||null,fallback:d.slice(1),log:o}):s.returnAllOptions?(i(()=>"Returning all options that we have found"),{best:(s.atAnyCost?p||m[0]||d[0]:p||m[0])||null,fallback:[...m,...d],log:o}):(i(()=>"Returning the best image that we found, and a fallback"),{best:p||m[0]||null,fallback:p?m:m.slice(1),log:o})}(l,[()=>s,()=>d])}async getImageCandidates(a,l=!0){if(l&&a&&a.height&&a.width)for(let l of xn(a)){let o={id:B(l),width:l.width?l.width:a.width,height:l.height?l.height:a.height,source:l};await this.loadService(o)}return function(a,l=!0,o){let s=[],d=ht(a);if(null===d)return s;if(s.push(d),l&&a&&a.width&&a.height){let l=[];for(let s of xn(a)){let d={id:B(s),width:a.width,height:a.height};if(o.canLoadSync(d)){let s=o.loadServiceSync(d);s&&(s.height||(s.height=a.height),s.width||(s.width=a.width),l.push(...Dt([s])))}}if(l.length)return s.push(...l),s}return a.service&&s.push(...Dt(a.service)),s}(a,l,this)}async verify(a){let l=this.predict(a,!1,!0),o=await this.fetchService(B(a));if(!l)return!1;let s=l.height===o.height&&l.width===o.width&&l["@context"]===o["@context"]&&function(a,l){if(a.length!==l.length)return!1;if(0===a.length&&0===l.length)return!0;let o=a.length,s=!0;for(let d=0;d<o;d++){let o=a[d],m=l[d];if(o.width!==m.width||o.height!==m.height){s=!1;break}}if(s)return!0;let d=0;for(let s=0;s<o;s++)for(let m=0;m<o;m++)if(a[s].width===l[m].width&&a[s].height===l[m].height){d++;break}return d===o}(l.sizes||[],o.sizes||[]);if(s){let l=xe(B(a)),o=this.knownImageServers[l];o&&(o.verifications+=1,o.verifications>=this.config.verificationsRequired&&(o.verified=!0))}return s}canLoadSync(a){let l="string"==typeof a?a:B(a),o=ve(l);if(this.imageServices[o])return!0;let s=this.knownImageServers[xe(l)];return!!(s&&!s.malformed&&s.verifications>=this.config.verificationsRequired)}async markAsMalformed(a){return this.knownImageServers[xe(B(a))].malformed=!0,this.loadService(a,!0)}async fetchService(a,l=!1){let o=ve(a),s=this.imageServices[o];if(s&&(!l||s.real))return s;if(!this.config.enableFetching)throw Error("Fetching is not enabled");let d=await this.fetch(o).then(a=>a.json());return!d.id&&d["@id"]&&(d.id=d["@id"]),d.id!==a&&(d.id=a,d["@id"]&&(d["@id"]=a)),this.imageServices[o]=Object.assign(d,{real:!0}),this.imageServices[o]}async fetch(a,l){return fetch(a,l)}async loadService(a,l=!1){if(!this.config.disableThrottling){let a=!0;for(;a;)if(this.fetchingCount>=this.config.verificationsRequired)await new Promise(a=>setTimeout(a,500));else{a=!1;break}}let o=this.knownImageServers[xe(B(a))];if(o&&!o.malformed&&!l){await o.result;let l=this.loadServiceSync(a);if(l)return l}this.fetchingCount++;let s=await this.fetchService(B(a),l);return this.fetchingCount--,s.real&&this.sample(s,a),s}loadServiceSync(a){let l=ve(B(a));return this.imageServices[l]?this.imageServices[l]:this.config.approximateServices?this.predict(a):null}};new iP;var iL=new iP,iF=new Map;let yl=({type:a})=>{switch(a){case"Sound":return x.createElement(j.Audio,null);case"Image":default:return x.createElement(j.Image,null);case"Video":return x.createElement(j.Video,null)}},bl=({canvas:a,canvasIndex:l,isActive:o,type:s,handleChange:d})=>{let[m,p]=(0,x.useState)(!1),[h,v]=(0,x.useState)(),b=D(),{vault:w}=b,E=null!=a&&a.label?Z(null==a?void 0:a.label):String(l+1);return(0,x.useEffect)(()=>{m&&(async()=>{var l,o;try{if((null==(l=null==a?void 0:a.thumbnail)?void 0:l.length)!==0)v(null==(o=null==a?void 0:a.thumbnail[0])?void 0:o.id);else{let{best:l}=await function(a,{vault:l=t7,dereference:o=!1,...s}={}){let d=iF.get(l);return d||(d=function(a=t7,l={}){let o=l.imageServiceLoader||iL;async function n(l,s,d=!1,m=[],p){let u=()=>o.getThumbnailFromResource(void 0,s,d,m);if(!l)return await o.getThumbnailFromResource(void 0,s,d,m);if("string"==typeof l){let a=ht(l);return a&&m.push(a),await o.getThumbnailFromResource(void 0,s,d,m)}let h=a.get(l,{skipSelfReturn:!1});if("string"==typeof h)return{best:ht(h),fallback:[],log:[]};if(!h)return await u();switch(await (async l=>{if(l&&l.thumbnail&&l.thumbnail.length){let s=a.get(l.thumbnail[0]),p=await o.getImageCandidates(s,d);p&&p.length&&m.push(...p)}})(h),h.type){case"Annotation":{let l=Array.isArray(h.body)?h.body:[h.body],v=a.get(l[0]);return p&&!v.width&&(v.width=p.width,v.height=p.height),await o.getThumbnailFromResource(v,s,d,m)}case"Canvas":return n(h.items[0],s,d,m,{width:h.width,height:h.height});case"AnnotationPage":return n(h.items[0],s,d,m,p);case"Choice":return!h.items||h.items[0]?await u():n(h.items[0],s,d,m,p);case"Collection":{let a=h.items[0];return a?n(a,s,d,m,p):await u()}case"Manifest":{let a=h.items[0];return a?n(a,s,d,m,p):await u()}case"SpecificResource":case"Image":case"Dataset":case"Sound":case"Text":case"TextualBody":case"Video":return p&&!h.width&&(h.width=p.width,h.height=p.height),o.getThumbnailFromResource(h,s,d,m)}return await u()}return{getBestThumbnailAtSize:n}}(l),iF.set(l,d)),d.getBestThumbnailAtSize(a,s,o)}(a,{vault:w,dereference:!0,width:200,height:200});v(null==l?void 0:l.id)}}catch(a){console.error("Error fetching thumbnail",a)}})()},[a,m]),x.createElement(tK,{"aria-checked":o,"data-testid":"media-thumbnail","data-canvas":l,onClick:()=>d(a.id),value:a.id},x.createElement("figure",null,x.createElement(tY,null,x.createElement(Rs,{isVisibleCallback:a=>{p(a)},attributes:{className:"media-thumbnail-lazyload","data-lazyload":String(m),"data-testid":"media-thumbnail-lazyload"}},h&&x.createElement("img",{alt:E,"data-testid":"media-thumbnail-image",src:h})),x.createElement(tZ,null),x.createElement(tG,null,x.createElement(tQ,{isIcon:!0,"data-testid":"thumbnail-tag"},x.createElement(tJ,null),x.createElement(j,{"aria-label":s},x.createElement(yl,{type:s})),["Video","Sound"].includes(s)&&x.createElement(tX,null,Cr(a.duration))))),x.createElement("figcaption",{"data-testid":"fig-caption"},a.label?x.createElement(ce,{label:a.label}):(l+1).toString())))},wl=a=>a.body?a.body.type:"Image",xl=({items:a})=>{let{t:l}=(0,b.$G)(),o=X(),s=D(),{activeCanvas:d,vault:m,sequence:p}=s,[h,v]=(0,x.useState)(""),[w,E]=(0,x.useState)([]),[C,k]=(0,x.useState)(0),I=x.useRef(null),f=a=>{d!==a&&o({type:"updateActiveCanvas",canvasId:a})};return(0,x.useEffect)(()=>{if(!w.length){let l=["Image","Sound","Video"],o=a.map(a=>Or(m,a,"painting",l)).filter(a=>a.annotations.length>0);E(o)}},[a,w.length,m]),(0,x.useEffect)(()=>{w.forEach((a,l)=>{null!=a&&a.canvas&&a.canvas.id===d&&k(l)})},[d,w]),(0,x.useEffect)(()=>{let a=document.querySelector(`[data-canvas="${C}"]`);if(a instanceof HTMLElement&&I.current){let l=a.offsetLeft-I.current.offsetWidth/2+a.offsetWidth/2;I.current.scrollTo({left:l,behavior:"smooth"})}},[C]),x.createElement(x.Fragment,null,x.createElement(Ts,{handleFilter:a=>v(a),handleCanvasToggle:a=>{let l=p[1].findIndex(a=>a.includes(C)),o=l+a>=0?l+a:p[1].length-1;if(!p[1][o])return;let s=p[1][o][0],d=p[0][s].id;d&&f(d)},activeIndex:C,canvasLength:a.length}),x.createElement(t0,{"aria-label":l("media.selectItem"),"data-testid":"media","data-active-canvas":a[C].id,"data-canvas-length":a.length,"data-filter":h,ref:I},p[1].filter(a=>a.some(a=>{var l;let o=p[0][a].id,s=w.find(a=>{var l;return(null==(l=null==a?void 0:a.canvas)?void 0:l.id)===o});if(!s)return!1;let d=Z(null==(l=null==s?void 0:s.canvas)?void 0:l.label)||"";return!(h&&!d.toLowerCase().includes(h.toLowerCase()))})).map((a,l)=>{let o=a.map(a=>p[0][a].id).includes(d);return x.createElement(t1,{"data-active":o,key:l},a.map(a=>{var l,o;let s=p[0][a].id,m=w.find(a=>{var l;return(null==(l=null==a?void 0:a.canvas)?void 0:l.id)===s});return m?x.createElement(bl,{canvas:m.canvas,canvasIndex:w.findIndex(a=>a===m),handleChange:f,isActive:d===(null==(l=null==m?void 0:m.canvas)?void 0:l.id),key:null==(o=null==m?void 0:m.canvas)?void 0:o.id,type:wl(m.annotations[0])}):null}))})))},iz=e5("button",{position:"absolute",background:"none",border:"none",cursor:"zoom-in",margin:"0",padding:"0",width:"100%",height:"100%",transition:"$all",opacity:1,display:"flex",alignItems:"center",justifyContent:"center",img:{width:"100%",height:"100%",objectFit:"contain",color:"transparent",aspectRatio:"auto"},"&[data-paged=true]":{"img:first-child ":{objectPosition:"100% 50%"},"img:last-child":{objectPosition:"0 50%"}},"&[data-active=false]":{opacity:0,objectPosition:"50% 50%"},variants:{isMedia:{true:{cursor:"pointer"}}}}),ij=e5("button",{display:"flex",height:"2rem",width:"2rem",borderRadius:"2rem",padding:"0",margin:"0",fontFamily:"inherit",background:"none",backgroundColor:"$primary",border:"none",color:"white",cursor:"pointer",marginLeft:"0.618rem",filter:"drop-shadow(2px 2px 5px #0003)",transition:"$all",boxSizing:"content-box !important","&:first-child":{marginLeft:"0"},"@xs":{marginBottom:"0.618rem",marginLeft:"0","&:last-child":{marginBottom:"0"}},svg:{height:"60%",width:"60%",padding:"20%",fill:"$secondary",stroke:"$secondary",filter:"drop-shadow(2px 2px 5px #0003)",transition:"$all",boxSizing:"inherit"},"&:hover, &:focus":{backgroundColor:"$accent"},"&[data-button=rotate-right]":{"&:hover, &:focus":{svg:{rotate:"45deg"}}},"&[data-button=rotate-left]":{transform:"scaleX(-1)","&:hover, &:focus":{svg:{rotate:"45deg"}}},"&[data-button=reset]":{"&:hover, &:focus":{svg:{rotate:"-15deg"}}}}),i_=e5(ij,{position:"absolute",width:"2rem",top:"1rem",right:"1rem",zIndex:100,display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",transition:"$all",borderRadius:"50%",backgroundColor:"$accent",cursor:"pointer","&:hover, &:focus":{backgroundColor:"$accent !important"},variants:{isInteractive:{true:{"&:hover":{opacity:"1"}},false:{}},isMedia:{true:{cursor:"pointer !important"}}},compoundVariants:[{isInteractive:!1,isMedia:!0,css:{top:"50%",right:"50%",width:"4rem",height:"4rem",transform:"translate(50%,-50%)"}}]}),iB=e5("div",{position:"relative",display:"flex",flexDirection:"column",flexGrow:"1",flexShrink:"1",gap:"1rem",zIndex:"0",overflow:"hidden","&:hover":{[`${i_}`]:{backgroundColor:"$accent"},[`${iz}`]:{backgroundColor:"#6662"}}}),iD=e5("div",{width:"100%",height:"100%"}),iW=e5("svg",{height:"19px",color:"$accent",fill:"$accent",stroke:"$accent",display:"flex",margin:"0.25rem 0.85rem"}),iH=e5(U.xz,{fontSize:"1.25rem",fontWeight:"400",fontFamily:"inherit",alignSelf:"flex-start",flexGrow:"1",cursor:"pointer",transition:"$all",border:"1px solid #6663",boxShadow:"2px 2px 5px #0001",borderRadius:"3px",display:"flex",alignItems:"center",paddingLeft:"0.5rem",width:"100%","@sm":{fontSize:"1rem"}}),iV=e5(U.VY,{borderRadius:"3px",boxShadow:"3px 3px 8px #0003",backgroundColor:"$secondary",marginTop:"2.25rem",marginLeft:"6px",paddingBottom:"0.25rem",maxHeight:"calc(61.8vh - 2.5rem) !important",borderTopLeftRadius:"0",border:"1px solid $secondaryMuted",maxWidth:"90vw"}),iN=e5(U.ck,{display:"flex",alignItems:"center",fontFamily:"inherit",padding:"0.25rem 0.5rem",color:"$primary",fontWeight:"400",fontSize:"0.8333rem",cursor:"pointer",backgroundColor:"$secondary",width:"calc(100% - 1rem)","> span":{whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"},'&[data-state="checked"]':{fontWeight:"700",color:"$primary !important"},"&:hover":{color:"$accent"},img:{width:"31px",height:"31px",marginRight:"0.5rem",borderRadius:"3px"}}),iU=e5(U.__,{color:"$primaryMuted",fontFamily:"inherit",fontSize:"0.85rem",padding:"0.5rem 1rem 0.5rem 0.5rem",display:"flex",alignItems:"center",marginBottom:"0.25rem",borderRadius:"3px",borderTopLeftRadius:"0",borderBottomLeftRadius:"0",borderBottomRightRadius:"0",backgroundColor:"$secondaryMuted"}),iq=e5(U.fC,{position:"relative",zIndex:"5",width:"100%"}),rt=({direction:a,title:l})=>x.createElement(iW,{xmlns:"http://www.w3.org/2000/svg",focusable:"false",viewBox:"0 0 512 512",role:"img"},x.createElement("title",null,l),"up"===a&&x.createElement(()=>x.createElement("path",{d:"M414 321.94L274.22 158.82a24 24 0 00-36.44 0L98 321.94c-13.34 15.57-2.28 39.62 18.22 39.62h279.6c20.5 0 31.56-24.05 18.18-39.62z"}),null),"down"===a&&x.createElement(()=>x.createElement("path",{d:"M98 190.06l139.78 163.12a24 24 0 0036.44 0L414 190.06c13.34-15.57 2.28-39.62-18.22-39.62h-279.6c-20.5 0-31.56 24.05-18.18 39.62z"}),null)),Tn=({children:a,label:l,maxHeight:o,onValueChange:s,value:d})=>x.createElement(iq,{onValueChange:s,value:d},x.createElement(iH,{"data-testid":"select-button"},x.createElement(U.ki,{"data-testid":"select-button-value"}),x.createElement(U.GV,null,x.createElement(rt,{direction:"down",title:"select"}))),x.createElement(U.ue,null,x.createElement(iV,{css:{maxHeight:`${o} !important`},"data-testid":"select-content"},x.createElement(U.Pn,null,x.createElement(rt,{direction:"up",title:"scroll up for more"})),x.createElement(U.Q_,null,x.createElement(U.DI,null,l&&x.createElement(iU,null,x.createElement(ce,{"data-testid":"select-label",label:l})),a)),x.createElement(U.Jk,null,x.createElement(rt,{direction:"down",title:"scroll down for more"}))))),Rn=a=>x.createElement(iN,{...a},a.thumbnail&&x.createElement(Ur,{thumbnail:a.thumbnail}),x.createElement(U.S_,null,x.createElement(ce,{label:a.label})),x.createElement(U.o6,null)),iQ=window.OpenSeadragon;if(!iQ&&!(iQ=q))throw Error("OpenSeadragon is missing.");let iZ="http://www.w3.org/2000/svg";iQ.Viewer&&(iQ.Viewer.prototype.svgOverlay=function(){return this._svgOverlayInfo||(this._svgOverlayInfo=new kn(this)),this._svgOverlayInfo});let kn=function(a){let l=this;this._viewer=a,this._containerWidth=0,this._containerHeight=0,this._svg=document.createElementNS(iZ,"svg"),this._svg.style.position="absolute",this._svg.style.left=0,this._svg.style.top=0,this._svg.style.width="100%",this._svg.style.height="100%",this._viewer.canvas.appendChild(this._svg),this._node=document.createElementNS(iZ,"g"),this._svg.appendChild(this._node),this._viewer.addHandler("animation",function(){l.resize()}),this._viewer.addHandler("open",function(){l.resize()}),this._viewer.addHandler("rotate",function(){l.resize()}),this._viewer.addHandler("flip",function(){l.resize()}),this._viewer.addHandler("resize",function(){l.resize()}),this.resize()};kn.prototype={node:function(){return this._node},resize:function(){this._containerWidth!==this._viewer.container.clientWidth&&(this._containerWidth=this._viewer.container.clientWidth,this._svg.setAttribute("width",this._containerWidth)),this._containerHeight!==this._viewer.container.clientHeight&&(this._containerHeight=this._viewer.container.clientHeight,this._svg.setAttribute("height",this._containerHeight));let a=this._viewer.viewport.pixelFromPoint(new iQ.Point(0,0),!0),l=this._viewer.viewport.getZoom(!0),o=this._viewer.viewport.getRotation(),s=this._viewer.viewport.getFlip(),d=this._viewer.viewport._containerInnerSize.x,m=d*l,p=m;s&&(m=-m,a.x=-a.x+d),this._node.setAttribute("transform","translate("+a.x+","+a.y+") scale("+m+","+p+") rotate("+o+")")},onClick:function(a,l){new iQ.MouseTracker({element:a,clickHandler:l}).setTracking(!0)}};let kl=a=>fetch(`${a.replace(/\/$/,"")}/info.json`).then(a=>a.json()).then(a=>a).catch(l=>{console.error(`The IIIF tilesource ${a.replace(/\/$/,"")}/info.json failed to load: ${l}`)}),$l=a=>{let l,o;return Array.isArray(a)&&(l=a[0])&&(o="@id"in l?l["@id"]:l.id),o},$n=a=>{var l,o,s,d,m,p,h,v,b,x,w,E,C,k,I;let A,O={};switch(null==a?void 0:a.type){case"SpecificResource":O={manifest:A=null==(s=null==(o=null==(l=null==a?void 0:a.target)?void 0:l.partOf)?void 0:o[0])?void 0:s.id,canvas:null==(d=null==a?void 0:a.target)?void 0:d.id},null!=a&&a.selector&&(O.selector=a.selector);break;case"Range":case"Annotation":let M=(null==(m=null==a?void 0:a.target)?void 0:m.source)||(null==a?void 0:a.target),P=null==(p=null==a?void 0:a.target)?void 0:p.selector;O={manifest:null==(v=null==(h=null==M?void 0:M.partOf)?void 0:h[0])?void 0:v.id,canvas:null==M?void 0:M.id},((null==(b=null==a?void 0:a.target)?void 0:b.type)==="SpecificResource"||null!=(x=null==a?void 0:a.target)&&x.selector)&&(O.selector=P);break;case"Canvas":if(O={manifest:A=null==(E=null==(w=null==a?void 0:a.partOf)?void 0:w[0])?void 0:E.id,canvas:null==a?void 0:a.id},null!=(C=null==a?void 0:a.id)&&C.includes("#xywh=")){let[l,o]=a.id.split("#xywh=");O.canvas=l,O.selector={type:"FragmentSelector",value:`xywh=${o}`}}break;case"Manifest":A=null==a?void 0:a.id,O={collection:null==(I=null==(k=null==a?void 0:a.partOf)?void 0:k[0])?void 0:I.id,manifest:null==a?void 0:a.id};break;case"Collection":O={collection:A=null==a?void 0:a.id}}return{resourceId:A,active:O}},Ml=a=>{if(_l(a))return{resourceId:a};{let l=JSON.parse((0,k.o0)(a)),{active:o}=$n(l);return{active:o,resourceId:null==l?void 0:l.resourceId,resourceObject:l}}},Ol=a=>{let{resourceId:l,resourceObject:o}=Ml(a);return o||l},Pl=a=>a.items.map(a=>a.id)[0],Fl=a=>{let l=a.items.filter(a=>"Manifest"===a.type).map(a=>a.id);return 0==l.length?null:l[0]},_l=a=>{try{new URL(a)}catch{return!1}return!0};var iG=((s=iG||{}).TiledImage="tiledImage",s.SimpleImage="simpleImage",s);let Ll=a=>{let l=Array.isArray(null==a?void 0:a.service)&&(null==a?void 0:a.service.length)>0,o=l?$l(null==a?void 0:a.service):null==a?void 0:a.id,s=l?iG.TiledImage:iG.SimpleImage;return{uri:o,imageType:s}},zl=(a,l)=>{let o=l?iG.TiledImage:iG.SimpleImage;return{uri:a,imageType:o}},iJ=e5("div",{position:"absolute !important",zIndex:"1",top:"1rem",left:"1rem",width:"161.8px",height:"100px",backgroundColor:"#000D",boxShadow:"5px 5px 5px #0002",borderRadius:"3px",".displayregion":{border:" 3px solid $accent !important",boxShadow:"0 0 3px #0006"},"@sm":{width:"123px",height:"76px"},"@xs":{width:"100px",height:"61.8px"}}),iX=e5("div",{position:"relative",width:"100%",height:"100%",zIndex:"0",".clover-iiif-image-openseadragon-annotation":{position:"relative",backgroundColor:"transparent",border:"2px solid #0003",boxSizing:"content-box",borderRadius:"3px",boxShadow:"0 0 38vw 38vw transparent",transition:"box-shadow 100ms ease-in-out",zIndex:"0",label:{opacity:0,position:"absolute",lineHeight:"1.47rem",pointerEvents:"none",textAlign:"center",minWidth:"300px",maxWidth:"20vw",padding:"0.5rem",borderRadius:"3px",top:"calc(100% + 0.5rem)",left:"50%",transform:"translate(-50%, 0)",backgroundColor:"$primary",color:"$secondary",transition:"opacity 100ms ease-in-out"},"&[data-active=true]":{border:"2px solid $accent !important",boxShadow:"0 0 38vw 38vw #0003",zIndex:"99999999",label:{opacity:1}}}}),iY=e5("div",{width:"100%",height:"100%",maxHeight:"100vh",background:"transparent",backgroundSize:"contain",color:"white",position:"relative",zIndex:"0",overflow:"hidden",variants:{hasNavigator:{true:{[`${iJ}`]:{display:"block"}},false:{[`${iJ}`]:{display:"none"}}}}}),Ee=({className:a,id:l,label:o,children:s})=>{let d=o.toLowerCase().replace(/\s/g,"-");return x.createElement(ij,{id:l,className:a,"data-testid":"openseadragon-button","data-button":d},x.createElement("svg",{xmlns:"http://www.w3.org/2000/svg","aria-labelledby":`${l}-svg-title`,"data-testid":"openseadragon-button-svg",focusable:"false",viewBox:"0 0 512 512",role:"img"},x.createElement("title",{id:`${l}-svg-title`},o),s))},iK=e5("div",{position:"absolute",zIndex:"1",top:"1rem",right:"1rem",display:"flex","@xs":{flexDirection:"column",zIndex:"2"},variants:{hasPlaceholder:{true:{right:"3.618rem","@xs":{top:"3.618rem",right:"1rem"}},false:{right:"1rem","@xs":{top:"1rem",right:"1rem"}}}}}),Vl=()=>x.createElement("path",{strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M256 112v288M400 256H112"}),Nl=()=>x.createElement("path",{strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M400 256H112"}),Wl=()=>x.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32",d:"M432 320v112H320M421.8 421.77L304 304M80 192V80h112M90.2 90.23L208 208M320 80h112v112M421.77 90.2L304 208M192 432H80V320M90.23 421.8L208 304"}),Ul=()=>x.createElement("path",{d:"M448 440a16 16 0 01-12.61-6.15c-22.86-29.27-44.07-51.86-73.32-67C335 352.88 301 345.59 256 344.23V424a16 16 0 01-27 11.57l-176-168a16 16 0 010-23.14l176-168A16 16 0 01256 88v80.36c74.14 3.41 129.38 30.91 164.35 81.87C449.32 292.44 464 350.9 464 424a16 16 0 01-16 16z"}),Nt=()=>x.createElement(x.Fragment,null,x.createElement("path",{fill:"none",strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M400 148l-21.12-24.57A191.43 191.43 0 00240 64C134 64 48 150 48 256s86 192 192 192a192.09 192.09 0 00181.07-128"}),x.createElement("path",{d:"M464 97.42V208a16 16 0 01-16 16H337.42c-14.26 0-21.4-17.23-11.32-27.31L436.69 86.1C446.77 76 464 83.16 464 97.42z"})),ql=({_cloverViewerHasPlaceholder:a,config:l})=>{let o=D(),{activeCanvas:s,plugins:d,vault:m,openSeadragonViewer:p}=o,h=m.get({id:s,type:"Canvas"});return(0,x.useEffect)(()=>{if(!p)return;let a=p.viewport.getRotation();p.addHandler("home",()=>{p.viewport.setRotation(a)})},[p]),x.createElement(iK,{"data-testid":"clover-iiif-image-openseadragon-controls",hasPlaceholder:a},l.showZoomControl&&x.createElement(x.Fragment,null,x.createElement(Ee,{id:l.zoomInButton,label:"zoom in"},x.createElement(Vl,null)),x.createElement(Ee,{id:l.zoomOutButton,label:"zoom out"},x.createElement(Nl,null))),l.showFullPageControl&&x.createElement(Ee,{id:l.fullPageButton,label:"full page"},x.createElement(Wl,null)),l.showRotationControl&&x.createElement(x.Fragment,null,x.createElement(Ee,{id:l.rotateRightButton,label:"rotate right"},x.createElement(Nt,null)),x.createElement(Ee,{id:l.rotateLeftButton,label:"rotate left"},x.createElement(Nt,null))),l.showHomeControl&&x.createElement(Ee,{id:l.homeButton,label:"reset"},x.createElement(Ul,null)),d.filter(a=>{var l;return null==(l=a.imageViewer)?void 0:l.controls}).map((a,l)=>{var o,s,d,m;let p=null==(s=null==(o=a.imageViewer)?void 0:o.controls)?void 0:s.component;return x.createElement(p,{key:l,...null==(m=null==(d=null==a?void 0:a.imageViewer)?void 0:d.controls)?void 0:m.componentProps,canvas:h,useViewerDispatch:X,useViewerState:D})}))};async function Mn(a,l=3,o=500){try{return await a()}catch(s){if(l<=0)throw s;return await new Promise(a=>setTimeout(a,o)),Mn(a,l-1,o)}}let jl=a=>new Promise(l=>setTimeout(l,a)),Wt=async(a,l,o=3,s=300)=>{for(let d=0;d<o;d++){let o=l?l-1:0,d=a.getItemAt(o);if(d)return d;await jl(s)}throw Error("No base item found at index 0 after retries")},Gl=({annotations:a,ariaLabel:l,config:o,uri:s,_cloverViewerHasPlaceholder:d,imageType:m,openSeadragonCallback:p})=>{let[h,v]=(0,x.useState)([]),[b,w]=(0,x.useState)([]),[E,C]=(0,x.useState)(),[k,I]=(0,x.useState)([]),A=X(),O=(0,x.useRef)(!1);function y(){E&&(null==p||p(E))}return(0,x.useEffect)(()=>(O.current||(O.current=!0,E||C(q(o))),()=>null==E?void 0:E.destroy()),[]),(0,x.useEffect)(()=>{y()},[E,p]),(0,x.useEffect)(()=>{E&&JSON.stringify(s)!==JSON.stringify(b)&&(E.forceRedraw(),w(s))},[E,b,s]),(0,x.useEffect)(()=>{b.length&&E&&(E.close(),(async()=>{switch(m){case"simpleImage":let l=1,o=0;for(let s=0;s<b.length;s++){let d=b[s];if(a){let a=new Image;a.src=d,await a.decode(),I(l=>[...l,{width:null==a?void 0:a.width,height:null==a?void 0:a.height}])}try{if(0!==s){let a=(await Wt(E.world,s)).getBounds();o=a.x+a.width,l=a.height}E.addSimpleImage({url:d,x:o,y:0,height:l,success:()=>{v(a=>[...a,d]),"function"==typeof A&&A({type:"updateOSDImageLoaded",OSDImageLoaded:!0})}})}catch(a){console.error(`Failed to load image at ${d}:`,a)}}break;case"tiledImage":{let a=1,l=0;for(let o=0;o<b.length;o++){let s=b[o];try{let d=await Mn(()=>kl(s),3,1e3);if(!d)throw Error(`No tile source for ${s}`);if(0!==o){let s=(await Wt(E.world,o)).getBounds();l=s.x+s.width,a=s.height}E.addTiledImage({tileSource:d,x:l,y:0,height:a,success:()=>{v(a=>[...a,s]),"function"==typeof A&&A({type:"updateOSDImageLoaded",OSDImageLoaded:!0})}})}catch(a){console.error(`Failed to load tile at ${s}:`,a)}}break}default:console.warn(`Unsupported imageType: "${m}"`)}})().catch(a=>console.error("Error drawing tiles",a)))},[b,m,E]),(0,x.useEffect)(()=>{if(h){let a=0,S=()=>{if(a<3){let l=null==E?void 0:E.world.getHomeBounds();l&&(null==E||E.viewport.fitBounds(l,!0)),a++,setTimeout(S,50)}};S(),null==E||E.addHandler("canvas-click",a=>{let l=null==E?void 0:E.getOverlayById(a.originalTarget.id);if(l){let o=null==l?void 0:l.getBounds(E.viewport);return o.x-=.1,o.y-=.1,o.width+=.2,o.height+=.2,null==E||E.viewport.fitBounds(o,!1),a.preventDefaultAction=!0}})}},[h]),(0,x.useEffect)(()=>{a&&(null==E||E.clearOverlays(),a.forEach(a=>{var l,o,s,d;let{annotation:m,targetIndex:p}=a,h=(null==(o=null==(l=null==E?void 0:E.viewport)?void 0:l.getBounds())?void 0:o.width)||1,v=null==E?void 0:E.world.getItemAt(p),b=v?(null==v?void 0:v.getBounds().width)/(null==v?void 0:v.getContentSize().x):(null==(s=k[p])?void 0:s.width)/h,x=oo(null==m?void 0:m.target),w=null!=m&&m.body?null==(d=null==m?void 0:m.body[0])?void 0:d.value:void 0;if(null!=x&&x.rect){let{x:a,y:l,w:o,h:s}=null==x?void 0:x.rect,d=function(a,l,o){let s=a*o;if(0===l)return s;for(;l>0;){let a=null==E?void 0:E.world.getItemAt(l-1);if(a){let o=a.getBounds().width;s+=o,l--}else break}return s}(a,p,b),h=new q.Rect(d,l*b,o*b,s*b),v=document.createElement("button");if(v.classList.add("clover-iiif-image-openseadragon-annotation"),v.id=m.id,v.setAttribute("tabindex","0"),v.setAttribute("role","button"),v.setAttribute("data-active","true"),v.setAttribute("tabindex","0"),v.setAttribute("role","button"),v.setAttribute("data-active","false"),w){v.setAttribute("aria-label",w);let a=document.createElement("label");a.innerHTML=w,v.appendChild(a)}v.addEventListener("mousedown",a=>{a.stopPropagation(),a.preventDefault()}),v.addEventListener("touchstart",a=>{a.stopPropagation(),a.preventDefault()}),v.addEventListener("click",a=>{a.stopPropagation(),a.preventDefault()}),v.addEventListener("keydown",a=>{if("Enter"===a.key){a.stopPropagation(),a.preventDefault();let l=new q.Rect(h.x-.1,h.y-.1,h.width+.2,h.height+.2);null==E||E.viewport.fitBounds(l,!1)}}),v.addEventListener("focus",()=>{v.setAttribute("data-active","true")}),v.addEventListener("mouseover",()=>{v.setAttribute("data-active","true")}),v.addEventListener("mouseout",()=>{v.removeAttribute("data-active")}),v.addEventListener("blur",()=>{v.removeAttribute("data-active")}),null==E||E.addOverlay(v,h,q.Placement.CENTER)}}),y())},[h,a]),x.createElement(iY,{className:"clover-iiif-image-openseadragon","data-testid":"clover-iiif-image-openseadragon","data-openseadragon-instance":o.id,hasNavigator:o.showNavigator},x.createElement(ql,{_cloverViewerHasPlaceholder:d,config:o}),o.showNavigator&&x.createElement(iJ,{id:o.navigatorId,"data-testid":"clover-iiif-image-openseadragon-navigator"}),x.createElement(iX,{id:o.id,"data-testid":"clover-iiif-image-openseadragon-viewport",role:"img",...l&&{"aria-label":l}}))},Jl=({_cloverViewerHasPlaceholder:a=!1,annotations:l,body:o,instanceId:s,isTiledImage:d=!1,label:m,src:p="",openSeadragonCallback:h,openSeadragonConfig:v={}})=>{let b=s??(0,C.Z)(),w="string"==typeof m?m:Z(m),E={id:`openseadragon-${b}`,navigatorId:`openseadragon-navigator-${b}`,loadTilesWithAjax:!0,fullPageButton:`fullPage-${b}`,homeButton:`reset-${b}`,rotateLeftButton:`rotateLeft-${b}`,rotateRightButton:`rotateRight-${b}`,zoomInButton:`zoomIn-${b}`,zoomOutButton:`zoomOut-${b}`,showNavigator:!0,showFullPageControl:!0,showHomeControl:!0,showRotationControl:!0,showZoomControl:!0,navigatorBorderColor:"transparent",gestureSettingsMouse:{clickToZoom:!0,dblClickToZoom:!0,pinchToZoom:!0,scrollToZoom:!1},...v},k=Array.isArray(o)?o:o?[o]:[],I=Array.isArray(p)?p:p?[p]:[],A=[],M=iG.SimpleImage;if(k.length){let a=k.map(Ll);A=a.map(a=>a.uri).filter(Boolean),M=a.some(a=>a.imageType===iG.TiledImage)?iG.TiledImage:iG.SimpleImage}else if(I.length){let a=I.map(a=>zl(a,d));A=a.map(a=>a.uri).filter(Boolean),M=a.some(a=>a.imageType===iG.TiledImage)?iG.TiledImage:iG.SimpleImage}return A.length?x.createElement(O.ErrorBoundary,{FallbackComponent:bt},x.createElement(Gl,{_cloverViewerHasPlaceholder:a,annotations:l,ariaLabel:w,config:E,imageType:M,key:b,uri:A,openSeadragonCallback:a=>{null==h||h(a)}})):null},Yl=({isActive:a,isMedia:l,items:o,setIsInteractive:s})=>{let{vault:d}=D(),[m,p]=(0,x.useState)([]),h=m.length>1;if((0,x.useEffect)(()=>{p([]);let a=o.map(a=>{let l=me(d,a.id);if(!l)return null;let{id:o,width:s,height:m}=l[0];return o?{src:o,width:s||640,height:m||640,alt:a.label?yt(a.label):"placeholder image"}:null}).filter(a=>null!==a);a.length&&p(a)},[o,h]),!a||!m.length)return null;let v=m.map(a=>a.width/a.height*1),b=v.reduce((a,l)=>a+l,0);return x.createElement(iz,{onClick:()=>s(!0),isMedia:l,className:"clover-viewer-placeholder","data-active":a,"data-paged":h},m.map((a,l)=>{let o=v[l]/b*100;return x.createElement("img",{...a,key:l,alt:a.alt,style:{width:`${o}%`}})}))},i0=e5("canvas",{position:"absolute",width:"100%",height:"100%",zIndex:"0"}),i1=x.forwardRef((a,l)=>{let o=x.useRef(null),s=(0,x.useCallback)(()=>{var a,s;if(null!=(a=l.current)&&a.currentTime&&(null==(s=l.current)?void 0:s.currentTime)>0)return;let d=l.current;if(!d)return;let m=new AudioContext,p=m.createMediaElementSource(d),h=m.createAnalyser(),v=o.current;if(!v)return;v.width=d.offsetWidth,v.height=d.offsetHeight;let b=v.getContext("2d");p.connect(h),h.connect(m.destination),h.fftSize=256;let x=h.frequencyBinCount,w=new Uint8Array(x);setInterval(function(){!function(a,l,o,s,d,m){let p=d/o*2.6,h,v=0;a.getByteFrequencyData(s),l.fillStyle="#000000",l.fillRect(0,0,d,m);for(let a=0;a<o;a++)h=2*s[a],l.fillStyle="rgba(78, 42, 132, 1)",l.fillRect(v,m-h,p,h),v+=p+6}(h,b,x,w,v.width,v.height)},20)},[l]);return x.useEffect(()=>{l&&l.current&&(l.current.onplay=s)},[s,l]),x.createElement(i0,{ref:o,role:"presentation"})}),i2=e5("div",{position:"relative",backgroundColor:"$primaryAlt",display:"flex",flexGrow:"0",flexShrink:"1",height:"100%",zIndex:"1",video:{backgroundColor:"transparent",objectFit:"contain",width:"100%",height:"100%",position:"relative",zIndex:"1"}}),ec=({resource:a,ignoreCaptionLabels:l})=>{let o=yt(a.label,"en");return Array.isArray(o)&&o.some(a=>l.includes(a))?null:x.createElement("track",{key:a.id,src:a.id,label:Array.isArray(o)?o[0]:o,srcLang:"en","data-testid":"player-track"})},i3=["application/vnd.apple.mpegurl","vnd.apple.mpegurl","audio/mpegurl","audio/x-mpegurl","application/x-mpegurl","video/x-mpegurl","video/mpegurl","application/mpegurl"],rc=({allSources:a,annotationResources:l,painting:o})=>{let[s,d]=x.useState(0),[m,p]=x.useState(),h=x.useRef(null),v=(null==o?void 0:o.type)==="Sound",b=X(),w=D(),{activeCanvas:E,configOptions:C,contentStateAnnotation:k,vault:I}=w;return(0,x.useEffect)(()=>{if(!o.id||!h.current)return;if(null!=h&&h.current){let a=h.current;a.src=o.id,a.load()}if("m3u8"!==o.id.split(".").pop()&&o.format&&!i3.includes(o.format))return;let a=new H.ZP({xhrSetup:function(a,l){a.withCredentials=!!C.withCredentials}});return a.attachMedia(h.current),a.on(H.ZP.Events.MEDIA_ATTACHED,function(){a.loadSource(o.id)}),a.on(H.ZP.Events.ERROR,function(l,o){if(o.fatal)switch(o.type){case H.ZP.ErrorTypes.NETWORK_ERROR:console.error(`fatal ${l} network error encountered, try to recover`),a.startLoad();break;case H.ZP.ErrorTypes.MEDIA_ERROR:console.error(`fatal ${l} media error encountered, try to recover`),a.recoverMediaError();break;default:a.destroy()}}),()=>{if(a&&h.current){let l=h.current;a.detachMedia(),a.destroy(),l.currentTime=0}}},[C.withCredentials,o.id]),(0,x.useEffect)(()=>{var a,l,o,d;let m=I.get(E),h=null!=(a=m.accompanyingCanvas)&&a.id?me(I,null==(l=m.accompanyingCanvas)?void 0:l.id):null,v=null!=(o=m.placeholderCanvas)&&o.id?me(I,null==(d=m.placeholderCanvas)?void 0:d.id):null;h&&v?p(0===s?v[0].id:h[0].id):(h&&p(h[0].id),v&&p(v[0].id))},[E,s,I]),(0,x.useEffect)(()=>{let a=null==h?void 0:h.current;if(!a)return;let l=null,o=!1,y=()=>{o||(o=!0,l=setInterval(()=>{!a||a.paused||a.ended||(d(a.currentTime),b({type:"updateActiveSelector",selector:{type:"PointSelector",t:Math.round(a.currentTime)}}))},500)),a&&a.paused&&(d(a.currentTime),b({type:"updateActiveSelector",selector:{type:"PointSelector",t:Math.round(a.currentTime)}}))};return a.addEventListener("timeupdate",y),()=>{null==a||a.removeEventListener("timeupdate",y),l&&clearInterval(l)}},[o.id,E]),(0,x.useEffect)(()=>{var a,l;if(k){let o=null==h?void 0:h.current;if(!o)return;let s=null==(a=null==k?void 0:k.target)?void 0:a.selector,{type:m,t:p,value:v}=s||{};if(((null==(l=null==k?void 0:k.target)?void 0:l.source)||(null==k?void 0:k.target)).id!==E)return;if(p&&"PointSelector"===m&&(d(p),o.currentTime=p),"FragmentSelector"===m&&v){let a=v.split("=")[1];if(!a)return;let l=a.split(",")[0];d(l),o.currentTime=l}}},[h,k]),x.createElement(i2,{css:{backgroundColor:C.canvasBackgroundColor,maxHeight:C.canvasHeight,position:"relative"},"data-testid":"player-wrapper",className:"clover-viewer-player-wrapper"},x.createElement("video",{id:"clover-iiif-video",key:o.id,ref:h,"data-src":o.id,controls:!0,height:o.height,width:o.width,crossOrigin:C.crossOrigin,poster:m,style:{maxHeight:C.canvasHeight,position:"relative",zIndex:"1"}},a.map(a=>x.createElement("source",{src:a.id,type:a.format,key:a.id})),(null==l?void 0:l.length)>0&&l.map(a=>{let l=[];return a.items.forEach(a=>{I.get(a.id).body.forEach(a=>{let o=I.get(a.id);l.push(o)})}),l.map(a=>x.createElement(ec,{resource:a,ignoreCaptionLabels:C.ignoreCaptionLabels||[],key:a.id}))}),"Sorry, your browser doesn't support embedded videos."),v&&x.createElement(i1,{ref:h}))},nc=()=>x.createElement("svg",{xmlns:"http://www.w3.org/2000/svg","aria-labelledby":"close-svg-title",focusable:"false",viewBox:"0 0 512 512",role:"img"},x.createElement("title",{id:"close-svg-title"},"close"),x.createElement("path",{d:"M289.94 256l95-95A24 24 0 00351 127l-95 95-95-95a24 24 0 00-34 34l95 95-95 95a24 24 0 1034 34l95-95 95 95a24 24 0 0034-34z"})),ic=({isMedia:a})=>x.createElement("svg",{xmlns:"http://www.w3.org/2000/svg","aria-labelledby":"open-svg-title",focusable:"false",viewBox:"0 0 512 512",role:"img"},x.createElement("title",{id:"open-svg-title"},"open"),a?x.createElement("path",{d:"M133 440a35.37 35.37 0 01-17.5-4.67c-12-6.8-19.46-20-19.46-34.33V111c0-14.37 7.46-27.53 19.46-34.33a35.13 35.13 0 0135.77.45l247.85 148.36a36 36 0 010 61l-247.89 148.4A35.5 35.5 0 01133 440z"}):x.createElement(x.Fragment,null,x.createElement("path",{d:"m456.69,421.39l-94.09-94.09c22.65-30.16,34.88-66.86,34.84-104.58,0-96.34-78.38-174.72-174.72-174.72S48,126.38,48,222.72s78.38,174.72,174.72,174.72c37.72.04,74.42-12.19,104.58-34.84l94.09,94.09c10.29,9.2,26.1,8.32,35.3-1.98,8.48-9.49,8.48-23.83,0-33.32Zm-233.97-73.87c-68.89-.08-124.72-55.91-124.8-124.8h0c0-68.93,55.87-124.8,124.8-124.8s124.8,55.87,124.8,124.8-55.87,124.8-124.8,124.8Z"}),x.createElement("path",{d:"m279.5,197.76h-3.35s-28.47,0-28.47,0v-31.82c-.77-13.79-12.57-24.33-26.36-23.56-12.71.71-22.85,10.86-23.56,23.56v3.35h0v28.47h-31.82c-13.79.77-24.33,12.57-23.56,26.36.71,12.71,10.86,22.85,23.56,23.56h3.35s28.47,0,28.47,0v31.82c.77,13.79,12.57,24.33,26.36,23.56,12.71-.71,22.85-10.86,23.56-23.56v-3.35h0v-28.47h31.82c13.79-.77,24.33-12.57,23.56-26.36-.71-12.71-10.86-22.85-23.56-23.56Z"}))),ac=({handleToggle:a,isInteractive:l,isMedia:o})=>x.createElement(i_,{onClick:a,isInteractive:l,isMedia:o,"data-testid":"placeholder-toggle"},l?x.createElement(nc,null):x.createElement(ic,{isMedia:o})),oc=({activeCanvas:a,annotationResources:l,contentSearchResource:o,isMedia:s,painting:d})=>{var m,p,h,v;let[b,w]=x.useState(0),[E,C]=x.useState(!1),[k,I]=x.useState([]),[A,O]=x.useState([]),[M,P]=x.useState(0),{configOptions:L,customDisplays:F,contentStateAnnotation:z,informationPanelResource:_,openSeadragonViewer:H,vault:V,viewerId:N,visibleCanvases:U}=D(),[q,G]=x.useState([]),Y=!!z&&a===(null==(p=null==(m=null==z?void 0:z.target)?void 0:m.source)?void 0:p.id),K=X(),ee=V.get(a),et=A.length&&!E&&!s,ei=(null==d?void 0:d.length)>1,en=`${N}-${Ar(a+b+JSON.stringify(U)+M)}`,J=()=>{C(!E),P(a=>a+1)},er=F.find(l=>{var o;let s=!1,{canvasId:m,paintingFormat:p}=l.target;if(Array.isArray(m)&&m.length>0&&(s=m.includes(a)),Array.isArray(p)&&p.length>0){let a=(null==(o=d[b])?void 0:o.format)||"";s=!!(a&&p.includes(a))}return s});(0,x.useEffect)(()=>{Y&&et&&0===M&&J()},[Y,et]),(0,x.useEffect)(()=>{et&&(K({type:"updateOpenSeadragonViewer",openSeadragonViewer:void 0}),K({type:"updateActiveSelector",selector:void 0}))},[et]),(0,x.useEffect)(()=>{var a,s,d;let m=[];if("manifest-annotations"===_&&(null==l||l.forEach((a,l)=>{var o;null==(o=null==a?void 0:a.items)||o.forEach(a=>{let o=V.get(a.id);o&&m.push({annotation:{...o,body:o.body.map(a=>{let l=V.get(a.id);return l||a})},targetIndex:l})})}),z)){let l=(null==(a=null==z?void 0:z.target)?void 0:a.source)||(null==z?void 0:z.target);m.push({annotation:{...z,body:null==(s=null==z?void 0:z.body)?void 0:s.map(a=>{let l=V.get(a.id);return l||a})},targetIndex:U.findIndex(a=>a.id===l.id)})}"manifest-content-search"===_&&(null==(d=null==o?void 0:o.items)||d.forEach(a=>{let l=V.get(a.id);if(l){let a=U.findIndex(a=>a.id===l.target.source.id);"number"==typeof a&&m.push({annotation:{...l,body:l.body.map(a=>{let l=V.get(a.id);return l||a})},targetIndex:a})}})),G(m)},[l,o,z,_,U]),(0,x.useEffect)(()=>{if(!s){let a=U.map(a=>{let l=a.id,o=me(V,l);return o?o[b]:void 0}).filter(Boolean),l=U.map(a=>{var l;let o=a.id,s=V.get(o),d=null==(l=null==s?void 0:s.placeholderCanvas)?void 0:l.id;return d&&d?{id:d,label:null==s?void 0:s.label}:null}).filter(a=>null!==a);I(a),O(l)}},[b,a,U,s,ee]),(0,x.useEffect)(()=>{w(0)},[U]);let el=null==(h=null==er?void 0:er.display)?void 0:h.component;return x.createElement(iB,{className:"clover-viewer-painting"},x.createElement(iD,{style:{backgroundColor:L.canvasBackgroundColor,height:"auto"===L.canvasHeight?"100%":L.canvasHeight}},!!A.length&&!s&&x.createElement(ac,{handleToggle:J,isInteractive:E,isMedia:s}),!!(null!=A&&A.length)&&!s&&x.createElement(Yl,{isActive:!!et,isMedia:s,items:A,setIsInteractive:C}),!et&&!er&&(s?x.createElement(rc,{allSources:d,painting:d[b],annotationResources:l}):d&&x.createElement(Jl,{_cloverViewerHasPlaceholder:!!(null!=A&&A.length),annotations:q,body:k,instanceId:en,key:en,openSeadragonCallback:a=>{a&&!et&&(null==H?void 0:H.id)!==`openseadragon-${en}`&&K({type:"updateOpenSeadragonViewer",openSeadragonViewer:a})},openSeadragonConfig:L.openSeadragon})),!et&&el&&x.createElement(el,{id:a,annotationBody:d[b],...null==er?void 0:er.display.componentProps})),ei&&x.createElement(Tn,{value:null==(v=d[b])?void 0:v.id,onValueChange:a=>{let l=d.findIndex(l=>l.id===a);w(l)},maxHeight:"200px"},null==d?void 0:d.map(a=>x.createElement(Rn,{value:null==a?void 0:a.id,key:null==a?void 0:a.id,label:null==a?void 0:a.label}))))},sc=({activeCanvas:a,annotationResources:l,searchServiceUrl:o,setContentSearchResource:s,contentSearchResource:d,isAudioVideo:m,items:p,painting:h})=>{var v,b;let{contentStateAnnotation:w,isInformationOpen:E,configOptions:C,sequence:k,visibleCanvases:I}=D(),{informationPanel:A}=C,O=I.map(a=>a.id),M=(l.length>0||O.includes(null==(b=null==(v=null==w?void 0:w.target)?void 0:v.source)?void 0:b.id))&&(null==A?void 0:A.renderAnnotation)&&!A.open,P=(null==A?void 0:A.renderAbout)&&E||M,L=null==A?void 0:A.renderToggle;return x.createElement(ta,{className:"clover-viewer-content","data-testid":"clover-viewer-content"},x.createElement(tr,{"data-aside-active":P,"data-aside-toggle":L},x.createElement(oc,{activeCanvas:a,annotationResources:l,contentSearchResource:d,isMedia:m,painting:h}),k[1].length>1&&x.createElement(tn,{className:"clover-viewer-media-wrapper"},x.createElement(xl,{items:p,activeItem:0}))),P&&x.createElement(tl,{"data-aside-active":P,"data-aside-toggle":L},x.createElement(Ko,{activeCanvas:a,annotationResources:l,searchServiceUrl:o,setContentSearchResource:s,contentSearchResource:d})))},i4=e5(be.Trigger,{width:"30px",padding:"5px"}),i5=e5(be.Content,{display:"flex",flexDirection:"column",fontSize:"0.8333rem",border:"none",boxShadow:"2px 2px 5px #0003",zIndex:"2",button:{display:"flex",textDecoration:"none",marginBottom:"0.5em",color:"$accentAlt",cursor:"pointer",background:"$secondary",border:"none","&:last-child":{marginBottom:"0"}}}),i6=e5("span",{fontSize:"1.33rem",alignSelf:"flex-start",flexGrow:"0",flexShrink:"1",padding:"1rem","@sm":{fontSize:"1rem"},"&.visually-hidden":{position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",border:"0"}}),i8=e5("header",{display:"flex",backgroundColor:"transparent !important",justifyContent:"space-between",alignItems:"flex-start",width:"100%",[`> ${iq}`]:{flexGrow:"1",flexShrink:"0"},form:{flexGrow:"0",flexShrink:"1"}}),i7=e5("div",{display:"flex",alignItems:"flex-end",justifyContent:"flex-end",padding:"1rem",flexShrink:"0",flexGrow:"1"}),mc=()=>{var a;let l=X(),o=D(),{activeManifest:s,collection:d,configOptions:m,vault:p}=o,h=null==m?void 0:m.canvasHeight;return x.createElement("div",{style:{margin:"0.75rem"}},x.createElement(Tn,{label:d.label,maxHeight:h,value:s,onValueChange:a=>{l({type:"updateActiveCanvas",canvasId:void 0}),l({type:"updateActiveManifest",manifestId:a}),l({type:"updateViewerId",viewerId:(0,C.Z)()})}},null==(a=null==d?void 0:d.items)?void 0:a.map(a=>x.createElement(Rn,{value:a.id,key:a.id,thumbnail:null!=a&&a.thumbnail?p.get(null==a?void 0:a.thumbnail):void 0,label:a.label}))))},fc=(a,l=2500)=>{let{t:o}=(0,b.$G)(),[s,d]=(0,x.useState)(""),m=(0,x.useCallback)(()=>{navigator.clipboard.writeText(a).then(()=>d(o("copySuccess")),()=>d(o("copyFailure")))},[a]);return(0,x.useEffect)(()=>{if(!s)return;let a=setTimeout(()=>d(""),l);return()=>clearTimeout(a)},[s]),[s,m]},i9=e5("span",{display:"flex",alignContent:"center",alignItems:"center",padding:"0.125rem 0.25rem 0",marginTop:"-0.125rem",marginLeft:"0.5rem",backgroundColor:"$accent",color:"$secondary",borderRadius:"3px",lineHeight:"1em"}),pc=({status:a})=>a?x.createElement(i9,{"data-copy-status":a},a):null,Ut=({textPrompt:a,textToCopy:l})=>{let[o,s]=fc(l);return x.createElement("button",{onClick:s},a," ",x.createElement(pc,{status:o}))},gc=({title:a})=>{let l="#ed1d33",o="#2873ab";return x.createElement("svg",{viewBox:"0 0 493.35999 441.33334",id:"iiif-logo",version:"1.1"},x.createElement("title",null,a),x.createElement("g",{transform:"matrix(1.3333333,0,0,-1.3333333,0,441.33333)"},x.createElement("g",{transform:"scale(0.1)"},x.createElement("path",{style:{fill:o},d:"M 65.2422,2178.75 775.242,1915 773.992,15 65.2422,276.25 v 1902.5"}),x.createElement("path",{style:{fill:o},d:"m 804.145,2640.09 c 81.441,-240.91 -26.473,-436.2 -241.04,-436.2 -214.558,0 -454.511,195.29 -535.9527,436.2 -81.4335,240.89 26.4805,436.18 241.0387,436.18 214.567,0 454.512,-195.29 535.954,-436.18"}),x.createElement("path",{style:{fill:l},d:"M 1678.58,2178.75 968.578,1915 969.828,15 1678.58,276.25 v 1902.5"}),x.createElement("path",{style:{fill:l},d:"m 935.082,2640.09 c -81.437,-240.91 26.477,-436.2 241.038,-436.2 214.56,0 454.51,195.29 535.96,436.2 81.43,240.89 -26.48,436.18 -241.04,436.18 -214.57,0 -454.52,-195.29 -535.958,-436.18"}),x.createElement("path",{style:{fill:o},d:"m 1860.24,2178.75 710,-263.75 -1.25,-1900 -708.75,261.25 v 1902.5"}),x.createElement("path",{style:{fill:o},d:"m 2603.74,2640.09 c 81.45,-240.91 -26.47,-436.2 -241.03,-436.2 -214.58,0 -454.52,195.29 -535.96,436.2 -81.44,240.89 26.48,436.18 241.03,436.18 214.57,0 454.51,-195.29 535.96,-436.18"}),x.createElement("path",{style:{fill:l},d:"m 3700.24,3310 v -652.5 c 0,0 -230,90 -257.5,-142.5 -2.5,-247.5 0,-336.25 0,-336.25 l 257.5,83.75 V 1690 l -258.61,-92.5 V 262.5 L 2735.24,0 v 2360 c 0,0 -15,850 965,950"}))))},ne=e5(G.fC,{all:"unset",height:"2rem",width:"3.236rem",backgroundColor:"#6663",borderRadius:"9999px",position:"relative",WebkitTapHighlightColor:"transparent",cursor:"pointer","&:focus":{boxShadow:"0 0 0 2px $secondaryAlt"},'&[data-state="checked"]':{backgroundColor:"$accent",boxShadow:"inset 2px 2px 5px #0003"}}),nt=e5(G.bU,{display:"block",height:"calc(2rem - 12px)",width:"calc(2rem - 12px)",backgroundColor:"$secondary",borderRadius:"100%",boxShadow:"2px 2px 5px #0001",transition:"$all",transform:"translateX(6px)",willChange:"transform",span:{fontFamily:"monospace",fontSize:"0.8333rem",fontWeight:"700",display:"flex",height:"100%",width:"100%",alignItems:"center",justifyContent:"center",color:"$primary",opacity:"0.382",userSelect:"none",pointerEvents:"none"},'&[data-state="checked"]':{transform:"translateX(calc(1.236rem + 6px))",span:{opacity:"1",color:"$accent"}}});e5("label",{fontSize:"0.8333rem",fontWeight:"400",lineHeight:"1em",userSelect:"none",cursor:"pointer",paddingRight:"0.618rem"});let ni=e5("form",{display:"flex",flexShrink:"0",flexGrow:"1",alignItems:"center",marginLeft:"1.618rem"}),nn=x.memo(()=>{let{isInformationOpen:a}=D(),l=X(),{t:o}=(0,b.$G)();return x.createElement(ni,null,x.createElement(ne,{checked:a,onCheckedChange:a=>{l({type:"updateInformationOpen",isInformationOpen:a})},id:"information-toggle","aria-label":o("informationPanelToggle"),name:"toggled?"},x.createElement(nt,null,x.createElement("span",null,"i"))))}),na=e5(be.Trigger,{width:"30px",padding:"5px",marginBottom:"auto"}),nr=e5(i5,{h3:{color:"$primaryAlt",fontSize:"$2",fontWeight:"700",margin:"$2 0"},button:{},"& ul li":{marginBottom:"$1"}});function qt(a,l){let o=[];if(!a)return o;for(let s of a)if(s.id){let a=l.get(s.id);a&&o.push(a)}return o}function jt(a,l){return a.map(({format:a,id:o,label:s})=>{let d=function(a){let{vault:l}=D();try{let o=a&&l.get(a);if(!o)throw Error(`Vault entity ${a} not found.`);return(null==o?void 0:o["@id"])||(null==o?void 0:o.id)}catch(l){return console.error(l),a}}(o);return{format:a,id:d,label:Z(s)||l}})}let Tc=()=>{let{allPages:a,individualPages:l}=function(){let a=function(){let{activeCanvas:a,activeManifest:l,vault:o}=D(),[s,d]=(0,x.useState)({root:[],canvas:[]});return(0,x.useEffect)(()=>{let s=o.get(l),m=o.get(a),p=null==s?void 0:s.rendering,h=null==m?void 0:m.rendering,v=qt(p,o),b=qt(h,o);d({root:v,canvas:b})},[a,l,o]),{...s}}(),l=jt((null==a?void 0:a.root)||[],"Root Rendering Label"),o=jt((null==a?void 0:a.canvas)||[],"Canvas Rendering Label");return{allPages:l,individualPages:o}}(),o=a.length>0||l.length>0,n=a=>{window.open(a,"_blank")};return o?x.createElement(be,null,x.createElement(na,{"data-testid":"download-button"},x.createElement(j,null,x.createElement(j.Download,null))),x.createElement(nr,{"data-testid":"download-content"},l.length>0&&x.createElement(x.Fragment,null,x.createElement("h3",null,"Individual Pages"),x.createElement("ul",null,l.map(({format:a,id:l,label:o})=>x.createElement("li",{key:o},x.createElement("button",{onClick:()=>n(l)},o," (",a,")"))))),a.length>0&&x.createElement(x.Fragment,null,x.createElement("h3",null,"All Pages"),x.createElement("ul",null,a.map(({format:a,id:l,label:o})=>x.createElement("li",{key:o},x.createElement("button",{onClick:()=>n(l)},o," (",a,")"))))))):null},Rc=({manifestId:a,manifestLabel:l})=>{let o=D(),{collection:s,configOptions:d}=o,{informationPanel:m,showDownload:p,showIIIFBadge:h,showTitle:v}=d,w=p||h||(null==m?void 0:m.renderToggle),{t:E}=(0,b.$G)();return x.createElement(i8,{className:"clover-viewer-header"},null!=s&&s.items?x.createElement(mc,null):x.createElement(i6,{className:v?"":"visually-hidden"},v&&x.createElement(ce,{label:l,className:"label"})),w&&x.createElement(i7,null,p&&x.createElement(Tc,null),h&&x.createElement(be,null,x.createElement(i4,null,x.createElement(gc,{title:E("commonShare")})),x.createElement(i5,null,(null==s?void 0:s.items)&&x.createElement("button",{onClick:a=>{a.preventDefault(),window.open(s.id,"_blank")}},E("shareCollectionJson")),x.createElement("button",{onClick:l=>{l.preventDefault(),window.open(a,"_blank")}},E("shareManifestJson"))," ",(null==s?void 0:s.items)&&x.createElement(Ut,{textPrompt:E("shareCollectionCopy"),textToCopy:s.id}),x.createElement(Ut,{textPrompt:E("shareManifestCopy"),textToCopy:a}))),(null==m?void 0:m.renderToggle)&&x.createElement(nn,null)))},kc=a=>{let t=()=>!!window.matchMedia&&window.matchMedia(a).matches,[l,o]=(0,x.useState)(t);return(0,x.useEffect)(()=>{let i=()=>o(t);return window.addEventListener("resize",i),()=>window.removeEventListener("resize",i)}),l},$c=({manifest:a,theme:l,iiifContentSearchQuery:o})=>{var s;let d=D(),m=X(),{activeCanvas:p,isInformationOpen:h,vault:v,configOptions:b,visibleCanvases:w}=d,E=(null==b?void 0:b.canvasHeight)&&["100%","auto"].includes(null==b?void 0:b.canvasHeight),[C,k]=(0,x.useState)(!1),[M,P]=(0,x.useState)([]),[L,F]=(0,x.useState)([]),[z,_]=(0,x.useState)(),H=kc(e4.sm),[V,N]=(0,x.useState)(),U=(0,x.useCallback)(a=>{m({type:"updateInformationOpen",isInformationOpen:a})},[m]);(0,x.useEffect)(()=>{var a;null!=(a=null==b?void 0:b.informationPanel)&&a.open&&U(!H)},[H,null==(s=null==b?void 0:b.informationPanel)?void 0:s.open]),(0,x.useEffect)(()=>{},[H]),(0,x.useEffect)(()=>{let l=me(v,p);l&&(k(["Sound","Video"].indexOf(l[0].type)>-1),P(l));let o=(0,I.sA)(v,a,p);m({type:"updateVisibleCanvases",visibleCanvases:o})},[p,H,a,v,m]),(0,x.useEffect)(()=>{(async()=>{let a=await Promise.all(w.map(a=>La(v,a.id)));F(a.flat())})()},[w]);let q=a.service.some(a=>["SearchService1","SearchService2"].includes(a.type||a["@type"]));return(0,x.useEffect)(()=>{if(q){let l=a.service.find(a=>["SearchService1","SearchService2"].includes(a.type||a["@type"]));l&&N(l.id||l["@id"])}},[a,q]),(0,x.useEffect)(()=>{var a;V&&(null==(a=b.informationPanel)?void 0:a.renderContentSearch)!==!1&&Mr(v,V,o).then(a=>_(a))},[V]),x.createElement(O.ErrorBoundary,{FallbackComponent:bt},x.createElement(ts,{className:`${l} clover-viewer`,css:{background:null==b?void 0:b.background},"data-absolute-position":E,"data-information-panel-open":h},x.createElement(A.fC,{open:h,onOpenChange:U},x.createElement(Rc,{manifestLabel:a.label,manifestId:a.id}),x.createElement(sc,{activeCanvas:p,painting:M,annotationResources:L,searchServiceUrl:V,setContentSearchResource:_,contentSearchResource:z,items:a.items,isAudioVideo:C}))))},nl={ignoreCache:!1,headers:{Accept:"application/json, text/javascript, text/plain"},timeout:5e3,withCredentials:!1};function Qt(a,l=null){return{ok:!1,status:a.status,statusText:a.statusText,headers:a.getAllResponseHeaders(),data:l||a.statusText,json:()=>JSON.parse(l||a.statusText)}}let no={"@context":"http://iiif.io/api/presentation/3/context.json",id:"https://example.org/iiif/content-state/specific-resource",type:"Annotation",motivation:["contentState"],target:{type:"SpecificResource",source:{id:"https://example.org/iiif/manifest/canvas/0",type:"Canvas",partOf:[{id:"https://example.org/iiif/manifest",type:"Manifest"}]}},body:[]},Xc=({canvasIdCallback:a,contentStateCallback:l,customDisplays:o=[],plugins:s=[],customTheme:d,iiifContent:m,id:p,manifestId:h,options:v,iiifContentSearchQuery:b})=>{var w,E,C;let k=m;p&&(k=p),h&&(k=h);let I=Rr(null==(E=null==(w=null==v?void 0:v.informationPanel)?void 0:w.vtt)?void 0:E.autoScroll);return x.createElement(_a,{initialState:{...e1,customDisplays:o,plugins:s,isAutoScrollEnabled:I.enabled,isInformationOpen:!!(null!=(C=null==v?void 0:v.informationPanel)&&C.open),vault:new eY({customFetcher:a=>(function(a,l=nl){let o=l.headers||nl.headers;return new Promise((s,d)=>{let m=new XMLHttpRequest;m.open("get",a),m.withCredentials=l.withCredentials,o&&Object.keys(o).forEach(a=>m.setRequestHeader(a,o[a])),m.onload=()=>{s({ok:m.status>=200&&m.status<300,status:m.status,statusText:m.statusText,headers:m.getAllResponseHeaders(),data:m.responseText,json:()=>JSON.parse(m.responseText)})},m.onerror=()=>{d(Qt(m,"Failed to make request."))},m.ontimeout=()=>{d(Qt(m,"Request took longer than expected."))},m.send()})})(a,{withCredentials:null==v?void 0:v.withCredentials,headers:null==v?void 0:v.requestHeaders}).then(a=>JSON.parse(a.data))})}},x.createElement(Pc,{iiifContent:k,canvasIdCallback:a,contentStateCallback:l,customTheme:d,options:v,iiifContentSearchQuery:b}))},Pc=({canvasIdCallback:a,contentStateCallback:l,customTheme:o,iiifContent:s,options:d,iiifContentSearchQuery:m})=>{let p=X(),h=D(),{activeCanvas:v,activeManifest:b,activeSelector:w,isLoaded:E,vault:C,visibleCanvases:A}=h,[O,P]=(0,x.useState)(),[L,F]=(0,x.useState)(),z={};if(o&&(z=(0,M.jG)("custom",o)),(0,x.useEffect)(()=>{p({type:"updateActiveSelector",selector:void 0})},[v,b]),(0,x.useEffect)(()=>{var o;if(a&&a(v),l&&b&&v){let a=(null==(o=A[0])?void 0:o.id)||v,s=`${b}/state/${Ar(a+JSON.stringify(w))}`,d={...no,id:s,target:{type:"SpecificResource",source:{id:a,type:"Canvas",partOf:[{id:b,type:"Manifest"}]},selector:w}};l({json:d,encoded:(0,k.ML)(JSON.stringify(d))})}},[v,b,w,a,l,A]),(0,x.useEffect)(()=>{b&&C.load(b).then(a=>{if(!a)return;F(a);let l=(0,I.rw)(C,a),o=v||Pl(a);p({type:"updateActiveCanvas",canvasId:o}),p({type:"updateManifestSequence",sequence:l})}).catch(a=>{console.error(`Manifest failed to load: ${a}`)}).finally(()=>{p({type:"updateIsLoaded",isLoaded:!0})})},[s,b,p,C]),(0,x.useEffect)(()=>{p({type:"updateConfigOptions",configOptions:d}),(async()=>{var a;if(!s)return;let l=Ol(s);try{let a=await C.load(l);P(a)}catch(o){if(l&&l.id||console.error(`Failed to load resource: ${o}`),null!=l&&l.id&&(null==l?void 0:l.type)==="Annotation"&&null!=(a=null==l?void 0:l.motivation)&&a.includes("contentState")){let a=await C.loadSync(l.id,l);a&&P(a)}else null!=l&&l.id&&["Canvas","Manifest"].includes(null==l?void 0:l.type)&&await C.loadSync(l.id,l)&&P({...no,target:l})}})()},[p,s,d,C]),(0,x.useEffect)(()=>{if(O)switch(O.type){case"Annotation":if(null!=O&&O.motivation&&(Array.isArray(null==O?void 0:O.motivation)?null!=O&&O.motivation.includes("contentState"):(null==O?void 0:O.motivation)==="content-state")){let{active:a}=$n(O);p({type:"updateActiveManifest",manifestId:a.manifest}),p({type:"updateActiveCanvas",canvasId:a.canvas}),p({type:"updateContentStateAnnotation",contentStateAnnotation:O})}break;case"Collection":let a=Fl(O);p({type:"updateCollection",collection:O}),a&&p({type:"updateActiveManifest",manifestId:a});break;case"Manifest":p({type:"updateActiveManifest",manifestId:O.id})}},[p,s,O]),!E){if(null==d||!d.customLoadingComponent)return x.createElement(x.Fragment,null,"Loading");{let a=d.customLoadingComponent;return x.createElement(a,null)}}return L&&L.items?0===L.items.length?(console.log(`The IIIF manifest ${s} does not contain canvases.`),x.createElement(x.Fragment,null)):x.createElement($c,{manifest:L,theme:z,key:L.id,iiifContentSearchQuery:m}):(console.log(`The IIIF manifest ${s} failed to load.`),x.createElement(x.Fragment,null))}}}]);