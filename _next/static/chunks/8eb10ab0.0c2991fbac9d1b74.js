(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[318],{9203:function(module,exports){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;function OpenSeadragon(n){return new OpenSeadragon.Viewer(n)}!function(n){n.version={versionStr:"2.4.2",major:parseInt("2",10),minor:parseInt("4",10),revision:parseInt("2",10)};var o={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"},r=Object.prototype.toString,l=Object.prototype.hasOwnProperty;n.isFunction=function(o){return"function"===n.type(o)},n.isArray=Array.isArray||function(o){return"array"===n.type(o)},n.isWindow=function(n){return n&&"object"==typeof n&&"setInterval"in n},n.type=function(n){return null==n?String(n):o[r.call(n)]||"object"},n.isPlainObject=function(o){var r;if(!o||"object"!==OpenSeadragon.type(o)||o.nodeType||n.isWindow(o)||o.constructor&&!l.call(o,"constructor")&&!l.call(o.constructor.prototype,"isPrototypeOf"))return!1;for(var h in o)r=h;return void 0===r||l.call(o,r)},n.isEmptyObject=function(n){for(var o in n)return!1;return!0},n.freezeObject=function(o){return Object.freeze?n.freezeObject=Object.freeze:n.freezeObject=function(n){return n},n.freezeObject(o)},n.supportsCanvas=function(){var o=document.createElement("canvas");return!!(n.isFunction(o.getContext)&&o.getContext("2d"))}(),n.isCanvasTainted=function(n){var o=!1;try{n.getContext("2d").getImageData(0,0,1,1)}catch(n){o=!0}return o},n.pixelDensityRatio=function(){if(!n.supportsCanvas)return 1;var o=document.createElement("canvas").getContext("2d");return Math.max(window.devicePixelRatio||1,1)/(o.webkitBackingStorePixelRatio||o.mozBackingStorePixelRatio||o.msBackingStorePixelRatio||o.oBackingStorePixelRatio||o.backingStorePixelRatio||1)}()}(OpenSeadragon),function($){$.extend=function(){var n,o,r,l,h,u,p=arguments[0]||{},g=arguments.length,m=!1,v=1;for("boolean"==typeof p&&(m=p,p=arguments[1]||{},v=2),"object"==typeof p||OpenSeadragon.isFunction(p)||(p={}),g===v&&(p=this,--v);v<g;v++)if(n=arguments[v],null!==n||void 0!==n)for(o in n)r=p[o],p!==(l=n[o])&&(m&&l&&(OpenSeadragon.isPlainObject(l)||(h=OpenSeadragon.isArray(l)))?(h?(h=!1,u=r&&OpenSeadragon.isArray(r)?r:[]):u=r&&OpenSeadragon.isPlainObject(r)?r:{},p[o]=OpenSeadragon.extend(m,u,l)):void 0!==l&&(p[o]=l));return p};var isIOSDevice=function(){if("object"!=typeof navigator)return!1;var n=navigator.userAgent;return"string"==typeof n&&(-1!==n.indexOf("iPhone")||-1!==n.indexOf("iPad")||-1!==n.indexOf("iPod"))};$.extend($,{DEFAULT_SETTINGS:{xmlPath:null,tileSources:null,tileHost:null,initialPage:0,crossOriginPolicy:!1,ajaxWithCredentials:!1,loadTilesWithAjax:!1,ajaxHeaders:{},panHorizontal:!0,panVertical:!0,constrainDuringPan:!1,wrapHorizontal:!1,wrapVertical:!1,visibilityRatio:.5,minPixelRatio:.5,defaultZoomLevel:0,minZoomLevel:null,maxZoomLevel:null,homeFillsViewer:!1,clickTimeThreshold:300,clickDistThreshold:5,dblClickTimeThreshold:300,dblClickDistThreshold:20,springStiffness:6.5,animationTime:1.2,gestureSettingsMouse:{scrollToZoom:!0,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsTouch:{scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsPen:{scrollToZoom:!1,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsUnknown:{scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},zoomPerClick:2,zoomPerScroll:1.2,zoomPerSecond:1,blendTime:0,alwaysBlend:!1,autoHideControls:!0,immediateRender:!1,minZoomImageRatio:.9,maxZoomPixelRatio:1.1,smoothTileEdgesMinZoom:1.1,iOSDevice:isIOSDevice(),pixelsPerWheelLine:40,pixelsPerArrowPress:40,autoResize:!0,preserveImageSizeOnResize:!1,minScrollDeltaTime:50,rotationIncrement:90,showSequenceControl:!0,sequenceControlAnchor:null,preserveViewport:!1,preserveOverlays:!1,navPrevNextWrap:!1,showNavigationControl:!0,navigationControlAnchor:null,showZoomControl:!0,showHomeControl:!0,showFullPageControl:!0,showRotationControl:!1,showFlipControl:!1,controlsFadeDelay:2e3,controlsFadeLength:1500,mouseNavEnabled:!0,showNavigator:!1,navigatorId:null,navigatorPosition:null,navigatorSizeRatio:.2,navigatorMaintainSizeRatio:!1,navigatorTop:null,navigatorLeft:null,navigatorHeight:null,navigatorWidth:null,navigatorAutoResize:!0,navigatorAutoFade:!0,navigatorRotate:!0,navigatorBackground:"#000",navigatorOpacity:.8,navigatorBorderColor:"#555",navigatorDisplayRegionColor:"#900",degrees:0,flipped:!1,opacity:1,preload:!1,compositeOperation:null,imageSmoothingEnabled:!0,placeholderFillStyle:null,showReferenceStrip:!1,referenceStripScroll:"horizontal",referenceStripElement:null,referenceStripHeight:null,referenceStripWidth:null,referenceStripPosition:"BOTTOM_LEFT",referenceStripSizeRatio:.2,collectionRows:3,collectionColumns:0,collectionLayout:"horizontal",collectionMode:!1,collectionTileSize:800,collectionTileMargin:80,imageLoaderLimit:0,maxImageCacheCount:200,timeout:3e4,useCanvas:!0,prefixUrl:"/images/",navImages:{zoomIn:{REST:"zoomin_rest.png",GROUP:"zoomin_grouphover.png",HOVER:"zoomin_hover.png",DOWN:"zoomin_pressed.png"},zoomOut:{REST:"zoomout_rest.png",GROUP:"zoomout_grouphover.png",HOVER:"zoomout_hover.png",DOWN:"zoomout_pressed.png"},home:{REST:"home_rest.png",GROUP:"home_grouphover.png",HOVER:"home_hover.png",DOWN:"home_pressed.png"},fullpage:{REST:"fullpage_rest.png",GROUP:"fullpage_grouphover.png",HOVER:"fullpage_hover.png",DOWN:"fullpage_pressed.png"},rotateleft:{REST:"rotateleft_rest.png",GROUP:"rotateleft_grouphover.png",HOVER:"rotateleft_hover.png",DOWN:"rotateleft_pressed.png"},rotateright:{REST:"rotateright_rest.png",GROUP:"rotateright_grouphover.png",HOVER:"rotateright_hover.png",DOWN:"rotateright_pressed.png"},flip:{REST:"flip_rest.png",GROUP:"flip_grouphover.png",HOVER:"flip_hover.png",DOWN:"flip_pressed.png"},previous:{REST:"previous_rest.png",GROUP:"previous_grouphover.png",HOVER:"previous_hover.png",DOWN:"previous_pressed.png"},next:{REST:"next_rest.png",GROUP:"next_grouphover.png",HOVER:"next_hover.png",DOWN:"next_pressed.png"}},debugMode:!1,debugGridColor:["#437AB2","#1B9E77","#D95F02","#7570B3","#E7298A","#66A61E","#E6AB02","#A6761D","#666666"]},SIGNAL:"----seadragon----",delegate:function(n,o){return function(){var r=arguments;return void 0===r&&(r=[]),o.apply(n,r)}},BROWSERS:{UNKNOWN:0,IE:1,FIREFOX:2,SAFARI:3,CHROME:4,OPERA:5},getElement:function(n){return"string"==typeof n&&(n=document.getElementById(n)),n},getElementPosition:function(n){var o,r,l=new $.Point;for(n=$.getElement(n),o="fixed"==$.getElementStyle(n).position,r=getOffsetParent(n,o);r;)l.x+=n.offsetLeft,l.y+=n.offsetTop,o&&(l=l.plus($.getPageScroll())),n=r,o="fixed"==$.getElementStyle(n).position,r=getOffsetParent(n,o);return l},getElementOffset:function(n){var o,r,l=(n=$.getElement(n))&&n.ownerDocument,h={top:0,left:0};return l?(o=l.documentElement,void 0!==n.getBoundingClientRect&&(h=n.getBoundingClientRect()),r=l==l.window?l:9===l.nodeType&&(l.defaultView||l.parentWindow),new $.Point(h.left+(r.pageXOffset||o.scrollLeft)-(o.clientLeft||0),h.top+(r.pageYOffset||o.scrollTop)-(o.clientTop||0))):new $.Point},getElementSize:function(n){return n=$.getElement(n),new $.Point(n.clientWidth,n.clientHeight)},getElementStyle:document.documentElement.currentStyle?function(n){return(n=$.getElement(n)).currentStyle}:function(n){return n=$.getElement(n),window.getComputedStyle(n,"")},getCssPropertyWithVendorPrefix:function(n){var o={};return $.getCssPropertyWithVendorPrefix=function(n){if(void 0!==o[n])return o[n];var r=document.createElement("div").style,l=null;if(void 0!==r[n])l=n;else for(var h=["Webkit","Moz","MS","O","webkit","moz","ms","o"],u=$.capitalizeFirstLetter(n),p=0;p<h.length;p++){var g=h[p]+u;if(void 0!==r[g]){l=g;break}}return o[n]=l,l},$.getCssPropertyWithVendorPrefix(n)},capitalizeFirstLetter:function(n){return n.charAt(0).toUpperCase()+n.slice(1)},positiveModulo:function(n,o){var r=n%o;return r<0&&(r+=o),r},pointInElement:function(n,o){n=$.getElement(n);var r=$.getElementOffset(n),l=$.getElementSize(n);return o.x>=r.x&&o.x<r.x+l.x&&o.y<r.y+l.y&&o.y>=r.y},getEvent:function(n){return n?$.getEvent=function(n){return n}:$.getEvent=function(){return window.event},$.getEvent(n)},getMousePosition:function(n){if("number"==typeof n.pageX)$.getMousePosition=function(n){var o=new $.Point;return n=$.getEvent(n),o.x=n.pageX,o.y=n.pageY,o};else if("number"==typeof n.clientX)$.getMousePosition=function(n){var o=new $.Point;return n=$.getEvent(n),o.x=n.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,o.y=n.clientY+document.body.scrollTop+document.documentElement.scrollTop,o};else throw Error("Unknown event mouse position, no known technique.");return $.getMousePosition(n)},getPageScroll:function(){var n=document.documentElement||{},o=document.body||{};if("number"==typeof window.pageXOffset)$.getPageScroll=function(){return new $.Point(window.pageXOffset,window.pageYOffset)};else if(o.scrollLeft||o.scrollTop)$.getPageScroll=function(){return new $.Point(document.body.scrollLeft,document.body.scrollTop)};else{if(!n.scrollLeft&&!n.scrollTop)return new $.Point(0,0);$.getPageScroll=function(){return new $.Point(document.documentElement.scrollLeft,document.documentElement.scrollTop)}}return $.getPageScroll()},setPageScroll:function(n){if(void 0!==window.scrollTo)$.setPageScroll=function(n){window.scrollTo(n.x,n.y)};else{var o=$.getPageScroll();if(o.x===n.x&&o.y===n.y)return;document.body.scrollLeft=n.x,document.body.scrollTop=n.y;var r=$.getPageScroll();if(r.x!==o.x&&r.y!==o.y){$.setPageScroll=function(n){document.body.scrollLeft=n.x,document.body.scrollTop=n.y};return}if(document.documentElement.scrollLeft=n.x,document.documentElement.scrollTop=n.y,(r=$.getPageScroll()).x!==o.x&&r.y!==o.y){$.setPageScroll=function(n){document.documentElement.scrollLeft=n.x,document.documentElement.scrollTop=n.y};return}$.setPageScroll=function(n){}}return $.setPageScroll(n)},getWindowSize:function(){var n=document.documentElement||{},o=document.body||{};if("number"==typeof window.innerWidth)$.getWindowSize=function(){return new $.Point(window.innerWidth,window.innerHeight)};else if(n.clientWidth||n.clientHeight)$.getWindowSize=function(){return new $.Point(document.documentElement.clientWidth,document.documentElement.clientHeight)};else if(o.clientWidth||o.clientHeight)$.getWindowSize=function(){return new $.Point(document.body.clientWidth,document.body.clientHeight)};else throw Error("Unknown window size, no known technique.");return $.getWindowSize()},makeCenteredNode:function(n){n=$.getElement(n);var o=[$.makeNeutralElement("div"),$.makeNeutralElement("div"),$.makeNeutralElement("div")];return $.extend(o[0].style,{display:"table",height:"100%",width:"100%"}),$.extend(o[1].style,{display:"table-row"}),$.extend(o[2].style,{display:"table-cell",verticalAlign:"middle",textAlign:"center"}),o[0].appendChild(o[1]),o[1].appendChild(o[2]),o[2].appendChild(n),o[0]},makeNeutralElement:function(n){var o=document.createElement(n),r=o.style;return r.background="transparent none",r.border="none",r.margin="0px",r.padding="0px",r.position="static",o},now:function(){return Date.now?$.now=Date.now:$.now=function(){return new Date().getTime()},$.now()},makeTransparentImage:function(n){return $.makeTransparentImage=function(n){var o=$.makeNeutralElement("img");return o.src=n,o},$.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<7&&($.makeTransparentImage=function(n){var o=$.makeNeutralElement("img"),r=null;return(r=$.makeNeutralElement("span")).style.display="inline-block",o.onload=function(){r.style.width=r.style.width||o.width+"px",r.style.height=r.style.height||o.height+"px",o.onload=null,o=null},o.src=n,r.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+n+"', sizingMethod='scale')",r}),$.makeTransparentImage(n)},setElementOpacity:function(n,o,r){var l;n=$.getElement(n),r&&!$.Browser.alpha&&(o=Math.round(o)),$.Browser.opacity?n.style.opacity=o<1?o:"":o<1?(l="alpha(opacity="+Math.round(100*o)+")",n.style.filter=l):n.style.filter=""},setElementTouchActionNone:function(n){void 0!==(n=$.getElement(n)).style.touchAction?n.style.touchAction="none":void 0!==n.style.msTouchAction&&(n.style.msTouchAction="none")},addClass:function(n,o){(n=$.getElement(n)).className?-1===(" "+n.className+" ").indexOf(" "+o+" ")&&(n.className+=" "+o):n.className=o},indexOf:function(n,o,r){return Array.prototype.indexOf?this.indexOf=function(n,o,r){return n.indexOf(o,r)}:this.indexOf=function(n,o,r){var l,h,u=r||0;if(!n)throw TypeError();if(0===(h=n.length)||u>=h)return -1;for(u<0&&(u=h-Math.abs(u)),l=u;l<h;l++)if(n[l]===o)return l;return -1},this.indexOf(n,o,r)},removeClass:function(n,o){var r,l,h=[];for(l=0,r=(n=$.getElement(n)).className.split(/\s+/);l<r.length;l++)r[l]&&r[l]!==o&&h.push(r[l]);n.className=h.join(" ")},addEvent:function(){if(window.addEventListener)return function(n,o,r,l){(n=$.getElement(n)).addEventListener(o,r,l)};if(window.attachEvent)return function(n,o,r,l){(n=$.getElement(n)).attachEvent("on"+o,r)};throw Error("No known event model.")}(),removeEvent:function(){if(window.removeEventListener)return function(n,o,r,l){(n=$.getElement(n)).removeEventListener(o,r,l)};if(window.detachEvent)return function(n,o,r,l){(n=$.getElement(n)).detachEvent("on"+o,r)};throw Error("No known event model.")}(),cancelEvent:function(n){(n=$.getEvent(n)).preventDefault?$.cancelEvent=function(n){n.preventDefault()}:$.cancelEvent=function(n){(n=$.getEvent(n)).cancel=!0,n.returnValue=!1},$.cancelEvent(n)},stopEvent:function(n){(n=$.getEvent(n)).stopPropagation?$.stopEvent=function(n){n.stopPropagation()}:$.stopEvent=function(n){(n=$.getEvent(n)).cancelBubble=!0},$.stopEvent(n)},createCallback:function(n,o){var r,l=[];for(r=2;r<arguments.length;r++)l.push(arguments[r]);return function(){var r,h=l.concat([]);for(r=0;r<arguments.length;r++)h.push(arguments[r]);return o.apply(n,h)}},getUrlParameter:function(n){return URLPARAMS[n]||null},getUrlProtocol:function(n){var o=n.match(/^([a-z]+:)\/\//i);return null===o?window.location.protocol:o[1].toLowerCase()},createAjaxRequest:function(n){var o;try{new ActiveXObject("Microsoft.XMLHTTP"),o=!0}catch(n){o=!1}if(o)window.XMLHttpRequest?$.createAjaxRequest=function(n){return n?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest}:$.createAjaxRequest=function(){return new ActiveXObject("Microsoft.XMLHTTP")};else if(window.XMLHttpRequest)$.createAjaxRequest=function(){return new XMLHttpRequest};else throw Error("Browser doesn't support XMLHttpRequest.");return $.createAjaxRequest(n)},makeAjaxRequest:function(n,o,r){$.isPlainObject(n)&&(o=n.success,r=n.error,l=n.withCredentials,h=n.headers,u=n.responseType||null,n=n.url);var l,h,u,p=$.getUrlProtocol(n),g=$.createAjaxRequest("file:"===p);if(!$.isFunction(o))throw Error("makeAjaxRequest requires a success callback");g.onreadystatechange=function(){4==g.readyState&&(g.onreadystatechange=function(){},g.status>=200&&g.status<300||0===g.status&&"http:"!==p&&"https:"!==p?o(g):($.console.log("AJAX request returned %d: %s",g.status,n),$.isFunction(r)&&r(g)))};try{if(g.open("GET",n,!0),u&&(g.responseType=u),h)for(var m in h)Object.prototype.hasOwnProperty.call(h,m)&&h[m]&&g.setRequestHeader(m,h[m]);l&&(g.withCredentials=!0),g.send(null)}catch(l){var v=l.message;if($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<10&&void 0!==l.number&&-2147024891==l.number&&(v+="\nSee http://msdn.microsoft.com/en-us/library/ms537505(v=vs.85).aspx#xdomain"),$.console.log("%s while making AJAX request: %s",l.name,v),g.onreadystatechange=function(){},window.XDomainRequest){var T=new window.XDomainRequest;if(T){T.onload=function(n){$.isFunction(o)&&o({responseText:T.responseText,status:200,statusText:"OK"})},T.onerror=function(n){$.isFunction(r)&&r({responseText:T.responseText,status:444,statusText:"An error happened. Due to an XDomainRequest deficiency we can not extract any information about this error. Upgrade your browser."})};try{T.open("GET",n),T.send()}catch(n){$.isFunction(r)&&r(g,l)}}}else $.isFunction(r)&&r(g,l)}return g},jsonp:function(n){var o,r=n.url,l=document.head||document.getElementsByTagName("head")[0]||document.documentElement,h=n.callbackName||"openseadragon"+$.now(),u=window[h],p="$1"+h+"$2",g=n.param||"callback",m=n.callback;r=r.replace(/(\=)\?(&|$)|\?\?/i,p),r+=(/\?/.test(r)?"&":"?")+g+"="+h,window[h]=function(n){if(u)window[h]=u;else try{delete window[h]}catch(n){}m&&$.isFunction(m)&&m(n)},o=document.createElement("script"),(void 0!==n.async||!1!==n.async)&&(o.async="async"),n.scriptCharset&&(o.charset=n.scriptCharset),o.src=r,o.onload=o.onreadystatechange=function(n,r){(r||!o.readyState||/loaded|complete/.test(o.readyState))&&(o.onload=o.onreadystatechange=null,l&&o.parentNode&&l.removeChild(o),o=void 0)},l.insertBefore(o,l.firstChild)},createFromDZI:function(){throw"OpenSeadragon.createFromDZI is deprecated, use Viewer.open."},parseXml:function(n){if(window.DOMParser)$.parseXml=function(n){return new DOMParser().parseFromString(n,"text/xml")};else if(window.ActiveXObject)$.parseXml=function(n){var o=null;return(o=new ActiveXObject("Microsoft.XMLDOM")).async=!1,o.loadXML(n),o};else throw Error("Browser doesn't support XML DOM.");return $.parseXml(n)},parseJSON:function(string){return window.JSON&&window.JSON.parse?$.parseJSON=window.JSON.parse:$.parseJSON=function(string){return eval("("+string+")")},$.parseJSON(string)},imageFormatSupported:function(n){return!!FILEFORMATS[(n=n||"").toLowerCase()]}});var nullfunction=function(n){};$.console=window.console||{log:nullfunction,debug:nullfunction,info:nullfunction,warn:nullfunction,error:nullfunction,assert:nullfunction},$.Browser={vendor:$.BROWSERS.UNKNOWN,version:0,alpha:!0};var FILEFORMATS={bmp:!1,jpeg:!0,jpg:!0,png:!0,tif:!1,wdp:!1},URLPARAMS={};function getOffsetParent(n,o){return o&&n!=document.body?document.body:n.offsetParent}(function(){var n=navigator.appVersion,o=navigator.userAgent;switch(navigator.appName){case"Microsoft Internet Explorer":window.attachEvent&&window.ActiveXObject&&($.Browser.vendor=$.BROWSERS.IE,$.Browser.version=parseFloat(o.substring(o.indexOf("MSIE")+5,o.indexOf(";",o.indexOf("MSIE")))));break;case"Netscape":window.addEventListener&&(o.indexOf("Firefox")>=0?($.Browser.vendor=$.BROWSERS.FIREFOX,$.Browser.version=parseFloat(o.substring(o.indexOf("Firefox")+8))):o.indexOf("Safari")>=0?($.Browser.vendor=o.indexOf("Chrome")>=0?$.BROWSERS.CHROME:$.BROWSERS.SAFARI,$.Browser.version=parseFloat(o.substring(o.substring(0,o.indexOf("Safari")).lastIndexOf("/")+1,o.indexOf("Safari")))):null!==RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})").exec(o)&&($.Browser.vendor=$.BROWSERS.IE,$.Browser.version=parseFloat(RegExp.$1)));break;case"Opera":$.Browser.vendor=$.BROWSERS.OPERA,$.Browser.version=parseFloat(n)}var r,l,h,u=window.location.search.substring(1).split("&");for(h=0;h<u.length;h++)if((l=(r=u[h]).indexOf("="))>0){var p=r.substring(0,l),g=r.substring(l+1);try{URLPARAMS[p]=decodeURIComponent(g)}catch(n){$.console.error("Ignoring malformed URL parameter: %s=%s",p,g)}}$.Browser.alpha=!($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<9||$.Browser.vendor==$.BROWSERS.CHROME&&$.Browser.version<2),$.Browser.opacity=!($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<9)})(),function(n){var o=n.requestAnimationFrame||n.mozRequestAnimationFrame||n.webkitRequestAnimationFrame||n.msRequestAnimationFrame,r=n.cancelAnimationFrame||n.mozCancelAnimationFrame||n.webkitCancelAnimationFrame||n.msCancelAnimationFrame;if(o&&r)$.requestAnimationFrame=function(){return o.apply(n,arguments)},$.cancelAnimationFrame=function(){return r.apply(n,arguments)};else{var l,h=[],u=[],p=0;$.requestAnimationFrame=function(n){return h.push([++p,n]),l||(l=setInterval(function(){if(h.length){var n=$.now(),o=u;for(u=h,h=o;u.length;)u.shift()[1](n)}else clearInterval(l),l=void 0},20)),p},$.cancelAnimationFrame=function(n){var o,r;for(o=0,r=h.length;o<r;o+=1)if(h[o][0]===n){h.splice(o,1);return}for(o=0,r=u.length;o<r;o+=1)if(u[o][0]===n){u.splice(o,1);return}}}}(window)}(OpenSeadragon),function(n,o){__WEBPACK_AMD_DEFINE_ARRAY__=[],void 0!==(__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof(__WEBPACK_AMD_DEFINE_FACTORY__=o)?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__)&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)}(0,function(){return OpenSeadragon}),function(n){var o={supportsFullScreen:!1,isFullScreen:function(){return!1},getFullScreenElement:function(){return null},requestFullScreen:function(){},exitFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",fullScreenErrorEventName:""};document.exitFullscreen?(o.supportsFullScreen=!0,o.getFullScreenElement=function(){return document.fullscreenElement},o.requestFullScreen=function(n){return n.requestFullscreen()},o.exitFullScreen=function(){document.exitFullscreen()},o.fullScreenEventName="fullscreenchange",o.fullScreenErrorEventName="fullscreenerror"):document.msExitFullscreen?(o.supportsFullScreen=!0,o.getFullScreenElement=function(){return document.msFullscreenElement},o.requestFullScreen=function(n){return n.msRequestFullscreen()},o.exitFullScreen=function(){document.msExitFullscreen()},o.fullScreenEventName="MSFullscreenChange",o.fullScreenErrorEventName="MSFullscreenError"):document.webkitExitFullscreen?(o.supportsFullScreen=!0,o.getFullScreenElement=function(){return document.webkitFullscreenElement},o.requestFullScreen=function(n){return n.webkitRequestFullscreen()},o.exitFullScreen=function(){document.webkitExitFullscreen()},o.fullScreenEventName="webkitfullscreenchange",o.fullScreenErrorEventName="webkitfullscreenerror"):document.webkitCancelFullScreen?(o.supportsFullScreen=!0,o.getFullScreenElement=function(){return document.webkitCurrentFullScreenElement},o.requestFullScreen=function(n){return n.webkitRequestFullScreen()},o.exitFullScreen=function(){document.webkitCancelFullScreen()},o.fullScreenEventName="webkitfullscreenchange",o.fullScreenErrorEventName="webkitfullscreenerror"):document.mozCancelFullScreen&&(o.supportsFullScreen=!0,o.getFullScreenElement=function(){return document.mozFullScreenElement},o.requestFullScreen=function(n){return n.mozRequestFullScreen()},o.exitFullScreen=function(){document.mozCancelFullScreen()},o.fullScreenEventName="mozfullscreenchange",o.fullScreenErrorEventName="mozfullscreenerror"),o.isFullScreen=function(){return null!==o.getFullScreenElement()},o.cancelFullScreen=function(){n.console.error("cancelFullScreen is deprecated. Use exitFullScreen instead."),o.exitFullScreen()},n.extend(n,o)}(OpenSeadragon),function(n){n.EventSource=function(){this.events={}},n.EventSource.prototype={addOnceHandler:function(n,o,r,l){var h=this;l=l||1;var u=0,onceHandler=function(r){++u===l&&h.removeHandler(n,onceHandler),o(r)};this.addHandler(n,onceHandler,r)},addHandler:function(o,r,l){var h=this.events[o];h||(this.events[o]=h=[]),r&&n.isFunction(r)&&(h[h.length]={handler:r,userData:l||null})},removeHandler:function(o,r){var l,h=this.events[o],u=[];if(h&&n.isArray(h)){for(l=0;l<h.length;l++)h[l].handler!==r&&u.push(h[l]);this.events[o]=u}},removeAllHandlers:function(n){if(n)this.events[n]=[];else for(var o in this.events)this.events[o]=[]},getHandler:function(n){var o=this.events[n];return o&&o.length?(o=1===o.length?[o[0]]:Array.apply(null,o),function(n,r){var l,h=o.length;for(l=0;l<h;l++)o[l]&&(r.eventSource=n,r.userData=o[l].userData,o[l].handler(r))}):null},raiseEvent:function(n,o){var r=this.getHandler(n);r&&(o||(o={}),r(this,o))}}}(OpenSeadragon),function(n){var o=[],r={};function clearTrackedPointers(o){var l,h=r[o.hash],u=h.activePointersLists.length;for(l=0;l<u;l++)h.activePointersLists[l].captureCount>0&&(n.removeEvent(n.MouseTracker.captureElement,"mousemove",h.mousemovecaptured,!0),n.removeEvent(n.MouseTracker.captureElement,"mouseup",h.mouseupcaptured,!0),n.removeEvent(n.MouseTracker.captureElement,n.MouseTracker.unprefixedPointerEvents?"pointermove":"MSPointerMove",h.pointermovecaptured,!0),n.removeEvent(n.MouseTracker.captureElement,n.MouseTracker.unprefixedPointerEvents?"pointerup":"MSPointerUp",h.pointerupcaptured,!0),n.removeEvent(n.MouseTracker.captureElement,"touchmove",h.touchmovecaptured,!0),n.removeEvent(n.MouseTracker.captureElement,"touchend",h.touchendcaptured,!0),h.activePointersLists[l].captureCount=0);for(l=0;l<u;l++)h.activePointersLists.pop()}function startTracking(o){var l,h,u=r[o.hash];if(!u.tracking){for(h=0;h<n.MouseTracker.subscribeEvents.length;h++)l=n.MouseTracker.subscribeEvents[h],n.addEvent(o.element,l,u[l],!1);clearTrackedPointers(o),u.tracking=!0}}function stopTracking(o){var l,h,u=r[o.hash];if(u.tracking){for(h=0;h<n.MouseTracker.subscribeEvents.length;h++)l=n.MouseTracker.subscribeEvents[h],n.removeEvent(o.element,l,u[l],!1);clearTrackedPointers(o),u.tracking=!1}}function getCaptureEventParams(o,l){var h=r[o.hash];if("pointerevent"===l)return{upName:n.MouseTracker.unprefixedPointerEvents?"pointerup":"MSPointerUp",upHandler:h.pointerupcaptured,moveName:n.MouseTracker.unprefixedPointerEvents?"pointermove":"MSPointerMove",moveHandler:h.pointermovecaptured};if("mouse"===l)return{upName:"mouseup",upHandler:h.mouseupcaptured,moveName:"mousemove",moveHandler:h.mousemovecaptured};if("touch"===l)return{upName:"touchend",upHandler:h.touchendcaptured,moveName:"touchmove",moveHandler:h.touchmovecaptured};throw Error("MouseTracker.getCaptureEventParams: Unknown pointer type.")}function capturePointer(o,r,h){var u,p=o.getActivePointersListByType(r);p.captureCount+=h||1,1===p.captureCount&&(n.Browser.vendor===n.BROWSERS.IE&&n.Browser.version<9?o.element.setCapture(!0):(u=getCaptureEventParams(o,n.MouseTracker.havePointerEvents?"pointerevent":r),l&&canAccessEvents(window.top)&&n.addEvent(window.top,u.upName,u.upHandler,!0),n.addEvent(n.MouseTracker.captureElement,u.upName,u.upHandler,!0),n.addEvent(n.MouseTracker.captureElement,u.moveName,u.moveHandler,!0)))}function releasePointer(o,r,h){var u,p=o.getActivePointersListByType(r);p.captureCount-=h||1,0===p.captureCount&&(n.Browser.vendor===n.BROWSERS.IE&&n.Browser.version<9?o.element.releaseCapture():(u=getCaptureEventParams(o,n.MouseTracker.havePointerEvents?"pointerevent":r),l&&canAccessEvents(window.top)&&n.removeEvent(window.top,u.upName,u.upHandler,!0),n.removeEvent(n.MouseTracker.captureElement,u.moveName,u.moveHandler,!0),n.removeEvent(n.MouseTracker.captureElement,u.upName,u.upHandler,!0)))}function getPointerType(o){var r;if(n.MouseTracker.unprefixedPointerEvents)r=o.pointerType;else switch(o.pointerType){case 2:r="touch";break;case 3:r="pen";break;case 4:r="mouse";break;default:r=""}return r}function getMouseAbsolute(o){return n.getMousePosition(o)}function getMouseRelative(n,o){return getPointRelativeToAbsolute(getMouseAbsolute(n),o)}function getPointRelativeToAbsolute(o,r){var l=n.getElementOffset(r);return o.minus(l)}function getCenterPoint(o,r){return new n.Point((o.x+r.x)/2,(o.y+r.y)/2)}function onClick(o,r){o.clickHandler&&n.cancelEvent(r)}function onDblClick(o,r){o.dblClickHandler&&n.cancelEvent(r)}function onKeyDown(o,r){o.keyDownHandler&&(r=n.getEvent(r),o.keyDownHandler({eventSource:o,keyCode:r.keyCode?r.keyCode:r.charCode,ctrl:r.ctrlKey,shift:r.shiftKey,alt:r.altKey,meta:r.metaKey,originalEvent:r,preventDefaultAction:!1,userData:o.userData})||n.cancelEvent(r))}function onKeyUp(o,r){o.keyUpHandler&&(r=n.getEvent(r),o.keyUpHandler({eventSource:o,keyCode:r.keyCode?r.keyCode:r.charCode,ctrl:r.ctrlKey,shift:r.shiftKey,alt:r.altKey,meta:r.metaKey,originalEvent:r,preventDefaultAction:!1,userData:o.userData})||n.cancelEvent(r))}function onKeyPress(o,r){o.keyHandler&&(r=n.getEvent(r),o.keyHandler({eventSource:o,keyCode:r.keyCode?r.keyCode:r.charCode,ctrl:r.ctrlKey,shift:r.shiftKey,alt:r.altKey,meta:r.metaKey,originalEvent:r,preventDefaultAction:!1,userData:o.userData})||n.cancelEvent(r))}function onFocus(o,r){o.focusHandler&&(r=n.getEvent(r),!1===o.focusHandler({eventSource:o,originalEvent:r,preventDefaultAction:!1,userData:o.userData})&&n.cancelEvent(r))}function onBlur(o,r){o.blurHandler&&(r=n.getEvent(r),!1===o.blurHandler({eventSource:o,originalEvent:r,preventDefaultAction:!1,userData:o.userData})&&n.cancelEvent(r))}function onWheel(n,o){handleWheelEvent(n,o,o)}function onMouseWheel(o,r){var l={target:(r=n.getEvent(r)).target||r.srcElement,type:"wheel",shiftKey:r.shiftKey||!1,clientX:r.clientX,clientY:r.clientY,pageX:r.pageX?r.pageX:r.clientX,pageY:r.pageY?r.pageY:r.clientY,deltaMode:"MozMousePixelScroll"==r.type?0:1,deltaX:0,deltaZ:0};"mousewheel"==n.MouseTracker.wheelEventName?l.deltaY=-r.wheelDelta/n.DEFAULT_SETTINGS.pixelsPerWheelLine:l.deltaY=r.detail,handleWheelEvent(o,l,r)}function handleWheelEvent(o,r,l){var h=0;h=r.deltaY<0?1:-1,o.scrollHandler&&!1===o.scrollHandler({eventSource:o,pointerType:"mouse",position:getMouseRelative(r,o.element),scroll:h,shift:r.shiftKey,isTouchEvent:!1,originalEvent:l,preventDefaultAction:!1,userData:o.userData})&&n.cancelEvent(l)}function isParentChild(n,o){if(n===o)return!1;for(;o&&o!==n;)o=o.parentNode;return o===n}function onMouseEnter(o,r){handleMouseEnter(o,r=n.getEvent(r))}function onMouseOver(o,r){(r=n.getEvent(r)).currentTarget===r.relatedTarget||isParentChild(r.currentTarget,r.relatedTarget)||handleMouseEnter(o,r)}function handleMouseEnter(o,r){var l={id:n.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:getMouseAbsolute(r),currentTime:n.now()};updatePointersEnter(o,r,[l])}function onMouseLeave(o,r){handleMouseExit(o,r=n.getEvent(r))}function onMouseOut(o,r){(r=n.getEvent(r)).currentTarget===r.relatedTarget||isParentChild(r.currentTarget,r.relatedTarget)||handleMouseExit(o,r)}function handleMouseExit(o,r){var l={id:n.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:getMouseAbsolute(r),currentTime:n.now()};updatePointersExit(o,r,[l])}function getStandardizedButton(o){return n.Browser.vendor===n.BROWSERS.IE&&n.Browser.version<9?1===o?0:2===o?2:4===o?1:-1:o}function onMouseDown(o,r){var l;r=n.getEvent(r),l={id:n.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:getMouseAbsolute(r),currentTime:n.now()},updatePointersDown(o,r,[l],getStandardizedButton(r.button))&&(n.stopEvent(r),capturePointer(o,"mouse")),(o.clickHandler||o.dblClickHandler||o.pressHandler||o.dragHandler||o.dragEndHandler)&&n.cancelEvent(r)}function onMouseUp(n,o){handleMouseUp(n,o)}function onMouseUpCaptured(o,r){handleMouseUp(o,r),n.stopEvent(r)}function handleMouseUp(o,r){var l;r=n.getEvent(r),l={id:n.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:getMouseAbsolute(r),currentTime:n.now()},updatePointersUp(o,r,[l],getStandardizedButton(r.button))&&releasePointer(o,"mouse")}function onMouseMove(n,o){handleMouseMove(n,o)}function onMouseMoveCaptured(o,r){handleMouseMove(o,r),n.stopEvent(r)}function handleMouseMove(o,r){var l;r=n.getEvent(r),l={id:n.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:getMouseAbsolute(r),currentTime:n.now()},updatePointersMove(o,r,[l])}function abortContacts(n,o,r){var l,h=r.getLength(),u=[];if("touch"===r.type||r.contacts>0){for(l=0;l<h;l++)u.push(r.getByIndex(l));u.length>0&&(updatePointersUp(n,o,u,0),r.captureCount=1,releasePointer(n,r.type),updatePointersExit(n,o,u))}}function onTouchStart(r,l){var h,u,p,g,m=l.changedTouches.length,v=[],T=r.getActivePointersListByType("touch");for(h=n.now(),T.getLength()>l.touches.length-m&&(n.console.warn("Tracked touch contact count doesn't match event.touches.length. Removing all tracked touch pointers."),abortContacts(r,l,T)),u=0;u<m;u++)v.push({id:l.changedTouches[u].identifier,type:"touch",currentPos:getMouseAbsolute(l.changedTouches[u]),currentTime:h});for(updatePointersEnter(r,l,v),u=0;u<o.length;u++)if(o[u]!==r&&o[u].isTracking()&&isParentChild(o[u].element,r.element)){for(p=0,g=[];p<m;p++)g.push({id:l.changedTouches[p].identifier,type:"touch",currentPos:getMouseAbsolute(l.changedTouches[p]),currentTime:h});updatePointersEnter(o[u],l,g)}updatePointersDown(r,l,v,0)&&(n.stopEvent(l),capturePointer(r,"touch",m)),n.cancelEvent(l)}function onTouchEnd(n,o){handleTouchEnd(n,o)}function onTouchEndCaptured(o,r){handleTouchEnd(o,r),n.stopEvent(r)}function handleTouchEnd(r,l){var h,u,p,g,m=l.changedTouches.length,v=[];for(u=0,h=n.now();u<m;u++)v.push({id:l.changedTouches[u].identifier,type:"touch",currentPos:getMouseAbsolute(l.changedTouches[u]),currentTime:h});for(updatePointersUp(r,l,v,0)&&releasePointer(r,"touch",m),updatePointersExit(r,l,v),u=0;u<o.length;u++)if(o[u]!==r&&o[u].isTracking()&&isParentChild(o[u].element,r.element)){for(p=0,g=[];p<m;p++)g.push({id:l.changedTouches[p].identifier,type:"touch",currentPos:getMouseAbsolute(l.changedTouches[p]),currentTime:h});updatePointersExit(o[u],l,g)}n.cancelEvent(l)}function onTouchMove(n,o){handleTouchMove(n,o)}function onTouchMoveCaptured(o,r){handleTouchMove(o,r),n.stopEvent(r)}function handleTouchMove(o,r){var l,h=r.changedTouches.length,u=[];for(l=0;l<h;l++)u.push({id:r.changedTouches[l].identifier,type:"touch",currentPos:getMouseAbsolute(r.changedTouches[l]),currentTime:n.now()});updatePointersMove(o,r,u),n.cancelEvent(r)}function onTouchCancel(n,o){var r=n.getActivePointersListByType("touch");abortContacts(n,o,r)}function onGestureStart(n,o){return o.stopPropagation(),o.preventDefault(),!1}function onGestureChange(n,o){return o.stopPropagation(),o.preventDefault(),!1}function onPointerOver(o,r){var l;r.currentTarget===r.relatedTarget||isParentChild(r.currentTarget,r.relatedTarget)||(l={id:r.pointerId,type:getPointerType(r),isPrimary:r.isPrimary,currentPos:getMouseAbsolute(r),currentTime:n.now()},updatePointersEnter(o,r,[l]))}function onPointerOut(o,r){var l;r.currentTarget===r.relatedTarget||isParentChild(r.currentTarget,r.relatedTarget)||(l={id:r.pointerId,type:getPointerType(r),isPrimary:r.isPrimary,currentPos:getMouseAbsolute(r),currentTime:n.now()},updatePointersExit(o,r,[l]))}function onPointerDown(o,r){var l;l={id:r.pointerId,type:getPointerType(r),isPrimary:r.isPrimary,currentPos:getMouseAbsolute(r),currentTime:n.now()},updatePointersDown(o,r,[l],r.button)&&(n.stopEvent(r),capturePointer(o,l.type)),(o.clickHandler||o.dblClickHandler||o.pressHandler||o.dragHandler||o.dragEndHandler||o.pinchHandler)&&n.cancelEvent(r)}function onPointerUp(n,o){handlePointerUp(n,o)}function onPointerUpCaptured(o,r){o.getActivePointersListByType(getPointerType(r)).getById(r.pointerId)&&handlePointerUp(o,r),n.stopEvent(r)}function handlePointerUp(o,r){var l;l={id:r.pointerId,type:getPointerType(r),isPrimary:r.isPrimary,currentPos:getMouseAbsolute(r),currentTime:n.now()},updatePointersUp(o,r,[l],r.button)&&releasePointer(o,l.type)}function onPointerMove(n,o){handlePointerMove(n,o)}function onPointerMoveCaptured(o,r){o.getActivePointersListByType(getPointerType(r)).getById(r.pointerId)&&handlePointerMove(o,r),n.stopEvent(r)}function handlePointerMove(o,r){var l;l={id:r.pointerId,type:getPointerType(r),isPrimary:r.isPrimary,currentPos:getMouseAbsolute(r),currentTime:n.now()},updatePointersMove(o,r,[l])}function onPointerCancel(n,o){var r;r={id:o.pointerId,type:getPointerType(o)},updatePointersCancel(n,o,[r])}function startTrackingPointer(n,o){return Object.prototype.hasOwnProperty.call(o,"isPrimary")||(0===n.getLength()?o.isPrimary=!0:o.isPrimary=!1),o.speed=0,o.direction=0,o.contactPos=o.currentPos,o.contactTime=o.currentTime,o.lastPos=o.currentPos,o.lastTime=o.currentTime,n.add(o)}function stopTrackingPointer(n,o){var r,l;return n.getById(o.id)?(r=n.removeById(o.id),!(!Object.prototype.hasOwnProperty.call(o,"isPrimary")&&!(l=n.getPrimary())&&(l=n.getByIndex(0)))||(l.isPrimary=!0)):r=n.getLength(),r}function updatePointersEnter(o,r,l){var h,u,p,g=o.getActivePointersListByType(l[0].type),m=l.length;for(h=0;h<m;h++)u=l[h],(p=g.getById(u.id))?(p.insideElement=!0,p.lastPos=p.currentPos,p.lastTime=p.currentTime,p.currentPos=u.currentPos,p.currentTime=u.currentTime,u=p):(u.captured=!1,u.insideElementPressed=!1,u.insideElement=!0,startTrackingPointer(g,u)),o.enterHandler&&!1===o.enterHandler({eventSource:o,pointerType:u.type,position:getPointRelativeToAbsolute(u.currentPos,o.element),buttons:g.buttons,pointers:o.getActivePointerCount(),insideElementPressed:u.insideElementPressed,buttonDownAny:0!==g.buttons,isTouchEvent:"touch"===u.type,originalEvent:r,preventDefaultAction:!1,userData:o.userData})&&n.cancelEvent(r)}function updatePointersExit(o,r,l){var h,u,p,g=o.getActivePointersListByType(l[0].type),m=l.length;for(h=0;h<m;h++)u=l[h],(p=g.getById(u.id))&&(p.captured?(p.insideElement=!1,p.lastPos=p.currentPos,p.lastTime=p.currentTime,p.currentPos=u.currentPos,p.currentTime=u.currentTime):stopTrackingPointer(g,p),u=p),o.exitHandler&&!1===o.exitHandler({eventSource:o,pointerType:u.type,position:u.currentPos&&getPointRelativeToAbsolute(u.currentPos,o.element),buttons:g.buttons,pointers:o.getActivePointerCount(),insideElementPressed:!!p&&p.insideElementPressed,buttonDownAny:0!==g.buttons,isTouchEvent:"touch"===u.type,originalEvent:r,preventDefaultAction:!1,userData:o.userData})&&n.cancelEvent(r)}function updatePointersDown(o,l,h,u){var p,g,m,v,T=r[o.hash],S=o.getActivePointersListByType(h[0].type),P=h.length;void 0!==l.buttons?S.buttons=l.buttons:n.Browser.vendor===n.BROWSERS.IE&&n.Browser.version<9?0===u?S.buttons+=1:1===u?S.buttons+=4:2===u?S.buttons+=2:3===u?S.buttons+=8:4===u?S.buttons+=16:5===u&&(S.buttons+=32):0===u?S.buttons|=1:1===u?S.buttons|=4:2===u?S.buttons|=2:3===u?S.buttons|=8:4===u?S.buttons|=16:5===u&&(S.buttons|=32);var E=o.getActivePointersListsExceptType(h[0].type);for(g=0;g<E.length;g++)abortContacts(o,l,E[g]);if(0!==u)return o.nonPrimaryPressHandler&&!1===(p=o.nonPrimaryPressHandler({eventSource:o,pointerType:h[0].type,position:getPointRelativeToAbsolute(h[0].currentPos,o.element),button:u,buttons:S.buttons,isTouchEvent:"touch"===h[0].type,originalEvent:l,preventDefaultAction:!1,userData:o.userData}))&&n.cancelEvent(l),!1;for(g=0;g<P;g++)m=h[g],(v=S.getById(m.id))?(v.captured=!0,v.insideElementPressed=!0,v.insideElement=!0,v.contactPos=m.currentPos,v.contactTime=m.currentTime,v.lastPos=v.currentPos,v.lastTime=v.currentTime,v.currentPos=m.currentPos,v.currentTime=m.currentTime,m=v):(m.captured=!0,m.insideElementPressed=!0,m.insideElement=!0,startTrackingPointer(S,m)),S.addContact(),(o.dragHandler||o.dragEndHandler||o.pinchHandler)&&n.MouseTracker.gesturePointVelocityTracker.addPoint(o,m),1===S.contacts?o.pressHandler&&!1===(p=o.pressHandler({eventSource:o,pointerType:m.type,position:getPointRelativeToAbsolute(m.contactPos,o.element),buttons:S.buttons,isTouchEvent:"touch"===m.type,originalEvent:l,preventDefaultAction:!1,userData:o.userData}))&&n.cancelEvent(l):2===S.contacts&&o.pinchHandler&&"touch"===m.type&&(T.pinchGPoints=S.asArray(),T.lastPinchDist=T.currentPinchDist=T.pinchGPoints[0].currentPos.distanceTo(T.pinchGPoints[1].currentPos),T.lastPinchCenter=T.currentPinchCenter=getCenterPoint(T.pinchGPoints[0].currentPos,T.pinchGPoints[1].currentPos));return!0}function updatePointersUp(o,l,h,u){var p,g,m,v,T,S,P,E=r[o.hash],C=o.getActivePointersListByType(h[0].type),R=h.length,O=!1,I=!1;if(void 0!==l.buttons?C.buttons=l.buttons:n.Browser.vendor===n.BROWSERS.IE&&n.Browser.version<9?0===u?C.buttons-=1:1===u?C.buttons-=4:2===u?C.buttons-=2:3===u?C.buttons-=8:4===u?C.buttons-=16:5===u&&(C.buttons-=32):0===u?C.buttons^=-2:1===u?C.buttons^=-5:2===u?C.buttons^=-3:3===u?C.buttons^=-9:4===u?C.buttons^=-17:5===u&&(C.buttons^=-33),0!==u){o.nonPrimaryReleaseHandler&&!1===(p=o.nonPrimaryReleaseHandler({eventSource:o,pointerType:h[0].type,position:getPointRelativeToAbsolute(h[0].currentPos,o.element),button:u,buttons:C.buttons,isTouchEvent:"touch"===h[0].type,originalEvent:l,preventDefaultAction:!1,userData:o.userData}))&&n.cancelEvent(l);var M=o.getActivePointersListByType("mouse");return abortContacts(o,l,M),!1}if(void 0===h[0].currentPos)return abortContacts(o,l,C),!1;for(v=0;v<R;v++)T=h[v],(S=C.getById(T.id))&&(S.captured&&(S.captured=!1,O=!0,I=!0),S.lastPos=S.currentPos,S.lastTime=S.currentTime,S.currentPos=T.currentPos,S.currentTime=T.currentTime,S.insideElement||stopTrackingPointer(C,S),g=S.currentPos,m=S.currentTime,I?(C.removeContact(),(o.dragHandler||o.dragEndHandler||o.pinchHandler)&&n.MouseTracker.gesturePointVelocityTracker.removePoint(o,S),0===C.contacts?(o.releaseHandler&&!1===(p=o.releaseHandler({eventSource:o,pointerType:S.type,position:getPointRelativeToAbsolute(g,o.element),buttons:C.buttons,insideElementPressed:S.insideElementPressed,insideElementReleased:S.insideElement,isTouchEvent:"touch"===S.type,originalEvent:l,preventDefaultAction:!1,userData:o.userData}))&&n.cancelEvent(l),o.dragEndHandler&&!S.currentPos.equals(S.contactPos)&&!1===(p=o.dragEndHandler({eventSource:o,pointerType:S.type,position:getPointRelativeToAbsolute(S.currentPos,o.element),speed:S.speed,direction:S.direction,shift:l.shiftKey,isTouchEvent:"touch"===S.type,originalEvent:l,preventDefaultAction:!1,userData:o.userData}))&&n.cancelEvent(l),(o.clickHandler||o.dblClickHandler)&&S.insideElement&&(P=m-S.contactTime<=o.clickTimeThreshold&&S.contactPos.distanceTo(g)<=o.clickDistThreshold,o.clickHandler&&!1===(p=o.clickHandler({eventSource:o,pointerType:S.type,position:getPointRelativeToAbsolute(S.currentPos,o.element),quick:P,shift:l.shiftKey,isTouchEvent:"touch"===S.type,originalEvent:l,preventDefaultAction:!1,userData:o.userData}))&&n.cancelEvent(l),o.dblClickHandler&&P&&(C.clicks++,1===C.clicks?(E.lastClickPos=g,E.dblClickTimeOut=setTimeout(function(){C.clicks=0},o.dblClickTimeThreshold)):2===C.clicks&&(clearTimeout(E.dblClickTimeOut),C.clicks=0,E.lastClickPos.distanceTo(g)<=o.dblClickDistThreshold&&!1===(p=o.dblClickHandler({eventSource:o,pointerType:S.type,position:getPointRelativeToAbsolute(S.currentPos,o.element),shift:l.shiftKey,isTouchEvent:"touch"===S.type,originalEvent:l,preventDefaultAction:!1,userData:o.userData}))&&n.cancelEvent(l),E.lastClickPos=null)))):2===C.contacts&&o.pinchHandler&&"touch"===S.type&&(E.pinchGPoints=C.asArray(),E.lastPinchDist=E.currentPinchDist=E.pinchGPoints[0].currentPos.distanceTo(E.pinchGPoints[1].currentPos),E.lastPinchCenter=E.currentPinchCenter=getCenterPoint(E.pinchGPoints[0].currentPos,E.pinchGPoints[1].currentPos))):o.releaseHandler&&!1===(p=o.releaseHandler({eventSource:o,pointerType:S.type,position:getPointRelativeToAbsolute(g,o.element),buttons:C.buttons,insideElementPressed:S.insideElementPressed,insideElementReleased:S.insideElement,isTouchEvent:"touch"===S.type,originalEvent:l,preventDefaultAction:!1,userData:o.userData}))&&n.cancelEvent(l));return O}function updatePointersMove(o,l,h){var u,p,g,m,v,T,S=r[o.hash],P=o.getActivePointersListByType(h[0].type),E=h.length;for(void 0!==l.buttons&&(P.buttons=l.buttons),u=0;u<E;u++)p=h[u],(g=P.getById(p.id))?(Object.prototype.hasOwnProperty.call(p,"isPrimary")&&(g.isPrimary=p.isPrimary),g.lastPos=g.currentPos,g.lastTime=g.currentTime,g.currentPos=p.currentPos,g.currentTime=p.currentTime):(p.captured=!1,p.insideElementPressed=!1,p.insideElement=!0,startTrackingPointer(P,p));o.stopHandler&&"mouse"===h[0].type&&(clearTimeout(o.stopTimeOut),o.stopTimeOut=setTimeout(function(){handlePointerStop(o,l,h[0].type)},o.stopDelay)),0===P.contacts?o.moveHandler&&!1===(T=o.moveHandler({eventSource:o,pointerType:h[0].type,position:getPointRelativeToAbsolute(h[0].currentPos,o.element),buttons:P.buttons,isTouchEvent:"touch"===h[0].type,originalEvent:l,preventDefaultAction:!1,userData:o.userData}))&&n.cancelEvent(l):1===P.contacts?(o.moveHandler&&(g=P.asArray()[0],!1===(T=o.moveHandler({eventSource:o,pointerType:g.type,position:getPointRelativeToAbsolute(g.currentPos,o.element),buttons:P.buttons,isTouchEvent:"touch"===g.type,originalEvent:l,preventDefaultAction:!1,userData:o.userData}))&&n.cancelEvent(l)),o.dragHandler&&(v=(g=P.asArray()[0]).currentPos.minus(g.lastPos),!1===(T=o.dragHandler({eventSource:o,pointerType:g.type,position:getPointRelativeToAbsolute(g.currentPos,o.element),buttons:P.buttons,delta:v,speed:g.speed,direction:g.direction,shift:l.shiftKey,isTouchEvent:"touch"===g.type,originalEvent:l,preventDefaultAction:!1,userData:o.userData}))&&n.cancelEvent(l))):2===P.contacts&&(o.moveHandler&&(m=P.asArray(),!1===(T=o.moveHandler({eventSource:o,pointerType:m[0].type,position:getPointRelativeToAbsolute(getCenterPoint(m[0].currentPos,m[1].currentPos),o.element),buttons:P.buttons,isTouchEvent:"touch"===m[0].type,originalEvent:l,preventDefaultAction:!1,userData:o.userData}))&&n.cancelEvent(l)),o.pinchHandler&&"touch"===h[0].type&&(v=S.pinchGPoints[0].currentPos.distanceTo(S.pinchGPoints[1].currentPos))!=S.currentPinchDist&&(S.lastPinchDist=S.currentPinchDist,S.currentPinchDist=v,S.lastPinchCenter=S.currentPinchCenter,S.currentPinchCenter=getCenterPoint(S.pinchGPoints[0].currentPos,S.pinchGPoints[1].currentPos),!1===(T=o.pinchHandler({eventSource:o,pointerType:"touch",gesturePoints:S.pinchGPoints,lastCenter:getPointRelativeToAbsolute(S.lastPinchCenter,o.element),center:getPointRelativeToAbsolute(S.currentPinchCenter,o.element),lastDistance:S.lastPinchDist,distance:S.currentPinchDist,shift:l.shiftKey,originalEvent:l,preventDefaultAction:!1,userData:o.userData}))&&n.cancelEvent(l)))}function updatePointersCancel(n,o,r){updatePointersUp(n,o,r,0),updatePointersExit(n,o,r)}function handlePointerStop(n,o,r){n.stopHandler&&n.stopHandler({eventSource:n,pointerType:r,position:getMouseRelative(o,n.element),buttons:n.getActivePointersListByType(r).buttons,isTouchEvent:"touch"===r,originalEvent:o,preventDefaultAction:!1,userData:n.userData})}n.MouseTracker=function(l){o.push(this);var h=arguments;n.isPlainObject(l)||(l={element:h[0],clickTimeThreshold:h[1],clickDistThreshold:h[2]}),this.hash=Math.random(),this.element=n.getElement(l.element),this.clickTimeThreshold=l.clickTimeThreshold||n.DEFAULT_SETTINGS.clickTimeThreshold,this.clickDistThreshold=l.clickDistThreshold||n.DEFAULT_SETTINGS.clickDistThreshold,this.dblClickTimeThreshold=l.dblClickTimeThreshold||n.DEFAULT_SETTINGS.dblClickTimeThreshold,this.dblClickDistThreshold=l.dblClickDistThreshold||n.DEFAULT_SETTINGS.dblClickDistThreshold,this.userData=l.userData||null,this.stopDelay=l.stopDelay||50,this.enterHandler=l.enterHandler||null,this.exitHandler=l.exitHandler||null,this.pressHandler=l.pressHandler||null,this.nonPrimaryPressHandler=l.nonPrimaryPressHandler||null,this.releaseHandler=l.releaseHandler||null,this.nonPrimaryReleaseHandler=l.nonPrimaryReleaseHandler||null,this.moveHandler=l.moveHandler||null,this.scrollHandler=l.scrollHandler||null,this.clickHandler=l.clickHandler||null,this.dblClickHandler=l.dblClickHandler||null,this.dragHandler=l.dragHandler||null,this.dragEndHandler=l.dragEndHandler||null,this.pinchHandler=l.pinchHandler||null,this.stopHandler=l.stopHandler||null,this.keyDownHandler=l.keyDownHandler||null,this.keyUpHandler=l.keyUpHandler||null,this.keyHandler=l.keyHandler||null,this.focusHandler=l.focusHandler||null,this.blurHandler=l.blurHandler||null;var u=this;r[this.hash]={click:function(n){onClick(u,n)},dblclick:function(n){onDblClick(u,n)},keydown:function(n){onKeyDown(u,n)},keyup:function(n){onKeyUp(u,n)},keypress:function(n){onKeyPress(u,n)},focus:function(n){onFocus(u,n)},blur:function(n){onBlur(u,n)},wheel:function(n){onWheel(u,n)},mousewheel:function(n){onMouseWheel(u,n)},DOMMouseScroll:function(n){onMouseWheel(u,n)},MozMousePixelScroll:function(n){onMouseWheel(u,n)},mouseenter:function(n){onMouseEnter(u,n)},mouseleave:function(n){onMouseLeave(u,n)},mouseover:function(n){onMouseOver(u,n)},mouseout:function(n){onMouseOut(u,n)},mousedown:function(n){onMouseDown(u,n)},mouseup:function(n){onMouseUp(u,n)},mouseupcaptured:function(n){onMouseUpCaptured(u,n)},mousemove:function(n){onMouseMove(u,n)},mousemovecaptured:function(n){onMouseMoveCaptured(u,n)},touchstart:function(n){onTouchStart(u,n)},touchend:function(n){onTouchEnd(u,n)},touchendcaptured:function(n){onTouchEndCaptured(u,n)},touchmove:function(n){onTouchMove(u,n)},touchmovecaptured:function(n){onTouchMoveCaptured(u,n)},touchcancel:function(n){onTouchCancel(u,n)},gesturestart:function(n){onGestureStart(u,n)},gesturechange:function(n){onGestureChange(u,n)},pointerover:function(n){onPointerOver(u,n)},MSPointerOver:function(n){onPointerOver(u,n)},pointerout:function(n){onPointerOut(u,n)},MSPointerOut:function(n){onPointerOut(u,n)},pointerdown:function(n){onPointerDown(u,n)},MSPointerDown:function(n){onPointerDown(u,n)},pointerup:function(n){onPointerUp(u,n)},MSPointerUp:function(n){onPointerUp(u,n)},pointermove:function(n){onPointerMove(u,n)},MSPointerMove:function(n){onPointerMove(u,n)},pointercancel:function(n){onPointerCancel(u,n)},MSPointerCancel:function(n){onPointerCancel(u,n)},pointerupcaptured:function(n){onPointerUpCaptured(u,n)},pointermovecaptured:function(n){onPointerMoveCaptured(u,n)},tracking:!1,activePointersLists:[],lastClickPos:null,dblClickTimeOut:null,pinchGPoints:[],lastPinchDist:0,currentPinchDist:0,lastPinchCenter:null,currentPinchCenter:null},l.startDisabled||this.setTracking(!0)},n.MouseTracker.prototype={destroy:function(){var n;for(stopTracking(this),this.element=null,n=0;n<o.length;n++)if(o[n]===this){o.splice(n,1);break}r[this.hash]=null,delete r[this.hash]},isTracking:function(){return r[this.hash].tracking},setTracking:function(n){return n?startTracking(this):stopTracking(this),this},getActivePointersListsExceptType:function(n){for(var o=r[this.hash],l=[],h=0;h<o.activePointersLists.length;++h)o.activePointersLists[h].type!==n&&l.push(o.activePointersLists[h]);return l},getActivePointersListByType:function(o){var l,h,u=r[this.hash],p=u.activePointersLists.length;for(l=0;l<p;l++)if(u.activePointersLists[l].type===o)return u.activePointersLists[l];return h=new n.MouseTracker.GesturePointList(o),u.activePointersLists.push(h),h},getActivePointerCount:function(){var n,o=r[this.hash],l=o.activePointersLists.length,h=0;for(n=0;n<l;n++)h+=o.activePointersLists[n].getLength();return h},enterHandler:function(){},exitHandler:function(){},pressHandler:function(){},nonPrimaryPressHandler:function(){},releaseHandler:function(){},nonPrimaryReleaseHandler:function(){},moveHandler:function(){},scrollHandler:function(){},clickHandler:function(){},dblClickHandler:function(){},dragHandler:function(){},dragEndHandler:function(){},pinchHandler:function(){},stopHandler:function(){},keyDownHandler:function(){},keyUpHandler:function(){},keyHandler:function(){},focusHandler:function(){},blurHandler:function(){}},n.MouseTracker.resetAllMouseTrackers=function(){for(var n=0;n<o.length;n++)o[n].isTracking()&&(o[n].setTracking(!1),o[n].setTracking(!0))},n.MouseTracker.gesturePointVelocityTracker=function(){var o=[],r=0,l=0,_generateGuid=function(n,o){return n.hash.toString()+o.type+o.id.toString()},_doTracking=function(){var r,h,u,p,g,m,v=o.length,T=n.now();for(r=0,p=T-l,l=T;r<v;r++)(u=(h=o[r]).gPoint).direction=Math.atan2(u.currentPos.y-h.lastPos.y,u.currentPos.x-h.lastPos.x),g=h.lastPos.distanceTo(u.currentPos),h.lastPos=u.currentPos,m=1e3*g/(p+1),u.speed=.75*m+.25*u.speed};return{addPoint:function(h,u){var p=_generateGuid(h,u);o.push({guid:p,gPoint:u,lastPos:u.currentPos}),1===o.length&&(l=n.now(),r=window.setInterval(_doTracking,50))},removePoint:function(n,l){var h,u=_generateGuid(n,l),p=o.length;for(h=0;h<p;h++)if(o[h].guid===u){o.splice(h,1),0==--p&&window.clearInterval(r);break}}}}(),n.MouseTracker.captureElement=document,n.MouseTracker.wheelEventName=n.Browser.vendor==n.BROWSERS.IE&&n.Browser.version>8||"onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",n.MouseTracker.supportsMouseCapture=function(){var o=document.createElement("div");return n.isFunction(o.setCapture)&&n.isFunction(o.releaseCapture)}(),n.MouseTracker.subscribeEvents=["click","dblclick","keydown","keyup","keypress","focus","blur",n.MouseTracker.wheelEventName],"DOMMouseScroll"==n.MouseTracker.wheelEventName&&n.MouseTracker.subscribeEvents.push("MozMousePixelScroll"),window.PointerEvent&&(window.navigator.pointerEnabled||n.Browser.vendor!==n.BROWSERS.IE)?(n.MouseTracker.havePointerEvents=!0,n.MouseTracker.subscribeEvents.push("pointerover","pointerout","pointerdown","pointerup","pointermove","pointercancel"),n.MouseTracker.unprefixedPointerEvents=!0,navigator.maxTouchPoints?n.MouseTracker.maxTouchPoints=navigator.maxTouchPoints:n.MouseTracker.maxTouchPoints=0,n.MouseTracker.haveMouseEnter=!1):window.MSPointerEvent&&window.navigator.msPointerEnabled?(n.MouseTracker.havePointerEvents=!0,n.MouseTracker.subscribeEvents.push("MSPointerOver","MSPointerOut","MSPointerDown","MSPointerUp","MSPointerMove","MSPointerCancel"),n.MouseTracker.unprefixedPointerEvents=!1,navigator.msMaxTouchPoints?n.MouseTracker.maxTouchPoints=navigator.msMaxTouchPoints:n.MouseTracker.maxTouchPoints=0,n.MouseTracker.haveMouseEnter=!1):(n.MouseTracker.havePointerEvents=!1,n.Browser.vendor===n.BROWSERS.IE&&n.Browser.version<9?(n.MouseTracker.subscribeEvents.push("mouseenter","mouseleave"),n.MouseTracker.haveMouseEnter=!0):(n.MouseTracker.subscribeEvents.push("mouseover","mouseout"),n.MouseTracker.haveMouseEnter=!1),n.MouseTracker.subscribeEvents.push("mousedown","mouseup","mousemove"),"ontouchstart"in window&&n.MouseTracker.subscribeEvents.push("touchstart","touchend","touchmove","touchcancel"),"ongesturestart"in window&&n.MouseTracker.subscribeEvents.push("gesturestart","gesturechange"),n.MouseTracker.mousePointerId="legacy-mouse",n.MouseTracker.maxTouchPoints=10),n.MouseTracker.GesturePointList=function(n){this._gPoints=[],this.type=n,this.buttons=0,this.contacts=0,this.clicks=0,this.captureCount=0},n.MouseTracker.GesturePointList.prototype={getLength:function(){return this._gPoints.length},asArray:function(){return this._gPoints},add:function(n){return this._gPoints.push(n)},removeById:function(n){var o,r=this._gPoints.length;for(o=0;o<r;o++)if(this._gPoints[o].id===n){this._gPoints.splice(o,1);break}return this._gPoints.length},getByIndex:function(n){return n<this._gPoints.length?this._gPoints[n]:null},getById:function(n){var o,r=this._gPoints.length;for(o=0;o<r;o++)if(this._gPoints[o].id===n)return this._gPoints[o];return null},getPrimary:function(n){var o,r=this._gPoints.length;for(o=0;o<r;o++)if(this._gPoints[o].isPrimary)return this._gPoints[o];return null},addContact:function(){++this.contacts,this.contacts>1&&("mouse"===this.type||"pen"===this.type)&&(this.contacts=1)},removeContact:function(){--this.contacts,this.contacts<0&&(this.contacts=0)}};var l=function(){try{return window.self!==window.top}catch(n){return!0}}();function canAccessEvents(n){try{return n.addEventListener&&n.removeEventListener}catch(n){return!1}}}(OpenSeadragon),function(n){n.ControlAnchor={NONE:0,TOP_LEFT:1,TOP_RIGHT:2,BOTTOM_RIGHT:3,BOTTOM_LEFT:4,ABSOLUTE:5},n.Control=function(o,r,l){var h=o.parentNode;"number"==typeof r&&(n.console.error("Passing an anchor directly into the OpenSeadragon.Control constructor is deprecated; please use an options object instead.  Support for this deprecated variant is scheduled for removal in December 2013"),r={anchor:r}),r.attachToViewer=void 0===r.attachToViewer||r.attachToViewer,this.autoFade=void 0===r.autoFade||r.autoFade,this.element=o,this.anchor=r.anchor,this.container=l,this.anchor==n.ControlAnchor.ABSOLUTE?(this.wrapper=n.makeNeutralElement("div"),this.wrapper.style.position="absolute",this.wrapper.style.top="number"==typeof r.top?r.top+"px":r.top,this.wrapper.style.left="number"==typeof r.left?r.left+"px":r.left,this.wrapper.style.height="number"==typeof r.height?r.height+"px":r.height,this.wrapper.style.width="number"==typeof r.width?r.width+"px":r.width,this.wrapper.style.margin="0px",this.wrapper.style.padding="0px",this.element.style.position="relative",this.element.style.top="0px",this.element.style.left="0px",this.element.style.height="100%",this.element.style.width="100%"):(this.wrapper=n.makeNeutralElement("div"),this.wrapper.style.display="inline-block",this.anchor==n.ControlAnchor.NONE&&(this.wrapper.style.width=this.wrapper.style.height="100%")),this.wrapper.appendChild(this.element),r.attachToViewer?this.anchor==n.ControlAnchor.TOP_RIGHT||this.anchor==n.ControlAnchor.BOTTOM_RIGHT?this.container.insertBefore(this.wrapper,this.container.firstChild):this.container.appendChild(this.wrapper):h.appendChild(this.wrapper)},n.Control.prototype={destroy:function(){this.wrapper.removeChild(this.element),this.container.removeChild(this.wrapper)},isVisible:function(){return"none"!=this.wrapper.style.display},setVisible:function(o){this.wrapper.style.display=o?this.anchor==n.ControlAnchor.ABSOLUTE?"block":"inline-block":"none"},setOpacity:function(o){this.element[n.SIGNAL]&&n.Browser.vendor==n.BROWSERS.IE?n.setElementOpacity(this.element,o,!0):n.setElementOpacity(this.wrapper,o,!0)}}}(OpenSeadragon),function(n){function getControlIndex(n,o){var r,l=n.controls;for(r=l.length-1;r>=0;r--)if(l[r].element==o)return r;return -1}n.ControlDock=function(o){var r,l,h=["topleft","topright","bottomright","bottomleft"];for(n.extend(!0,this,{id:"controldock-"+n.now()+"-"+Math.floor(1e6*Math.random()),container:n.makeNeutralElement("div"),controls:[]},o),this.container.onsubmit=function(){return!1},this.element&&(this.element=n.getElement(this.element),this.element.appendChild(this.container),this.element.style.position="relative",this.container.style.width="100%",this.container.style.height="100%"),l=0;l<h.length;l++)r=h[l],this.controls[r]=n.makeNeutralElement("div"),this.controls[r].style.position="absolute",r.match("left")&&(this.controls[r].style.left="0px"),r.match("right")&&(this.controls[r].style.right="0px"),r.match("top")&&(this.controls[r].style.top="0px"),r.match("bottom")&&(this.controls[r].style.bottom="0px");this.container.appendChild(this.controls.topleft),this.container.appendChild(this.controls.topright),this.container.appendChild(this.controls.bottomright),this.container.appendChild(this.controls.bottomleft)},n.ControlDock.prototype={addControl:function(o,r){o=n.getElement(o);var l=null;if(!(getControlIndex(this,o)>=0)){switch(r.anchor){case n.ControlAnchor.TOP_RIGHT:l=this.controls.topright,o.style.position="relative",o.style.paddingRight="0px",o.style.paddingTop="0px";break;case n.ControlAnchor.BOTTOM_RIGHT:l=this.controls.bottomright,o.style.position="relative",o.style.paddingRight="0px",o.style.paddingBottom="0px";break;case n.ControlAnchor.BOTTOM_LEFT:l=this.controls.bottomleft,o.style.position="relative",o.style.paddingLeft="0px",o.style.paddingBottom="0px";break;case n.ControlAnchor.TOP_LEFT:l=this.controls.topleft,o.style.position="relative",o.style.paddingLeft="0px",o.style.paddingTop="0px";break;case n.ControlAnchor.ABSOLUTE:default:case n.ControlAnchor.NONE:l=this.container,o.style.margin="0px",o.style.padding="0px"}this.controls.push(new n.Control(o,r,l)),o.style.display="inline-block"}},removeControl:function(o){var r=getControlIndex(this,o=n.getElement(o));return r>=0&&(this.controls[r].destroy(),this.controls.splice(r,1)),this},clearControls:function(){for(;this.controls.length>0;)this.controls.pop().destroy();return this},areControlsEnabled:function(){var n;for(n=this.controls.length-1;n>=0;n--)if(this.controls[n].isVisible())return!0;return!1},setControlsEnabled:function(n){var o;for(o=this.controls.length-1;o>=0;o--)this.controls[o].setVisible(n);return this}}}(OpenSeadragon),function(n){n.Placement=n.freezeObject({CENTER:0,TOP_LEFT:1,TOP:2,TOP_RIGHT:3,RIGHT:4,BOTTOM_RIGHT:5,BOTTOM:6,BOTTOM_LEFT:7,LEFT:8,properties:{0:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1},1:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},2:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},3:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!0,isVerticallyCentered:!1,isBottom:!1},4:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!0,isBottom:!1},5:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!1,isBottom:!0},6:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},7:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},8:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1}}})}(OpenSeadragon),function(n){var o={},r=1;function _getSafeElemSize(o){return o=n.getElement(o),new n.Point(0===o.clientWidth?1:o.clientWidth,0===o.clientHeight?1:o.clientHeight)}function getTileSourceImplementation(o,r,l,h,u){var p=o;if("string"==n.type(r)){if(r.match(/^\s*<.*>\s*$/))r=n.parseXml(r);else if(r.match(/^\s*[\{\[].*[\}\]]\s*$/))try{r=n.parseJSON(r)}catch(n){}}function waitUntilReady(n,o){n.ready?h(n):(n.addHandler("ready",function(){h(n)}),n.addHandler("open-failed",function(n){u({message:n.message,source:o})}))}setTimeout(function(){if("string"==n.type(r))(r=new n.TileSource({url:r,crossOriginPolicy:void 0!==l.crossOriginPolicy?l.crossOriginPolicy:o.crossOriginPolicy,ajaxWithCredentials:o.ajaxWithCredentials,ajaxHeaders:o.ajaxHeaders,useCanvas:o.useCanvas,success:function(n){h(n.tileSource)}})).addHandler("open-failed",function(n){u(n)});else if(n.isPlainObject(r)||r.nodeType){if(void 0===r.crossOriginPolicy&&(void 0!==l.crossOriginPolicy||void 0!==o.crossOriginPolicy)&&(r.crossOriginPolicy=void 0!==l.crossOriginPolicy?l.crossOriginPolicy:o.crossOriginPolicy),void 0===r.ajaxWithCredentials&&(r.ajaxWithCredentials=o.ajaxWithCredentials),void 0===r.useCanvas&&(r.useCanvas=o.useCanvas),n.isFunction(r.getTileUrl)){var g=new n.TileSource(r);g.getTileUrl=r.getTileUrl,h(g)}else{var m=n.TileSource.determineType(p,r);if(!m){u({message:"Unable to load TileSource",source:r});return}var v=m.prototype.configure.apply(p,[r]);waitUntilReady(new m(v),r)}}else waitUntilReady(r,r)})}function getOverlayObject(o,r){if(r instanceof n.Overlay)return r;var l=null;if(r.element)l=n.getElement(r.element);else{var h=r.id?r.id:"openseadragon-overlay-"+Math.floor(1e7*Math.random());(l=n.getElement(r.id))||((l=document.createElement("a")).href="#/overlay/"+h),l.id=h,n.addClass(l,r.className?r.className:"openseadragon-overlay")}var u=r.location,p=r.width,g=r.height;if(!u){var m=r.x,v=r.y;if(void 0!==r.px){var T=o.viewport.imageToViewportRectangle(new n.Rect(r.px,r.py,p||0,g||0));m=T.x,v=T.y,p=void 0!==p?T.width:void 0,g=void 0!==g?T.height:void 0}u=new n.Point(m,v)}var S=r.placement;return S&&"string"===n.type(S)&&(S=n.Placement[r.placement.toUpperCase()]),new n.Overlay({element:l,location:u,placement:S,onDraw:r.onDraw,checkResize:r.checkResize,width:p,height:g,rotationMode:r.rotationMode})}function getOverlayIndex(n,o){var r;for(r=n.length-1;r>=0;r--)if(n[r].element===o)return r;return -1}function scheduleUpdate(o,r){return n.requestAnimationFrame(function(){r(o)})}function scheduleControlsFade(o){n.requestAnimationFrame(function(){updateControlsFade(o)})}function beginControlsAutoHide(o){o.autoHideControls&&(o.controlsShouldFade=!0,o.controlsFadeBeginTime=n.now()+o.controlsFadeDelay,window.setTimeout(function(){scheduleControlsFade(o)},o.controlsFadeDelay))}function updateControlsFade(o){var r,l;if(o.controlsShouldFade){for(r=Math.max(0,r=Math.min(1,r=1-(n.now()-o.controlsFadeBeginTime)/o.controlsFadeLength)),l=o.controls.length-1;l>=0;l--)o.controls[l].autoFade&&o.controls[l].setOpacity(r);r>0&&scheduleControlsFade(o)}}function abortControlsAutoHide(n){var o;for(n.controlsShouldFade=!1,o=n.controls.length-1;o>=0;o--)n.controls[o].setOpacity(1)}function onFocus(){abortControlsAutoHide(this)}function onBlur(){beginControlsAutoHide(this)}function onCanvasKeyDown(o){var r={originalEvent:o.originalEvent,preventDefaultAction:o.preventDefaultAction,preventVerticalPan:o.preventVerticalPan,preventHorizontalPan:o.preventHorizontalPan};if(this.raiseEvent("canvas-key",r),r.preventDefaultAction||o.ctrl||o.alt||o.meta)return!0;switch(o.keyCode){case 38:return r.preventVerticalPan||(o.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new n.Point(0,-this.pixelsPerArrowPress))),this.viewport.applyConstraints()),!1;case 40:return r.preventVerticalPan||(o.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new n.Point(0,this.pixelsPerArrowPress))),this.viewport.applyConstraints()),!1;case 37:return r.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new n.Point(-this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),!1;case 39:return r.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new n.Point(this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),!1;default:return!0}}function onCanvasKeyPress(o){var r={originalEvent:o.originalEvent,preventDefaultAction:o.preventDefaultAction,preventVerticalPan:o.preventVerticalPan,preventHorizontalPan:o.preventHorizontalPan};if(this.raiseEvent("canvas-key",r),r.preventDefaultAction||o.ctrl||o.alt||o.meta)return!0;switch(o.keyCode){case 43:case 61:return this.viewport.zoomBy(1.1),this.viewport.applyConstraints(),!1;case 45:return this.viewport.zoomBy(.9),this.viewport.applyConstraints(),!1;case 48:return this.viewport.goHome(),this.viewport.applyConstraints(),!1;case 119:case 87:return r.preventVerticalPan||(o.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new n.Point(0,-40))),this.viewport.applyConstraints()),!1;case 115:case 83:return r.preventVerticalPan||(o.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new n.Point(0,40))),this.viewport.applyConstraints()),!1;case 97:return r.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new n.Point(-40,0))),this.viewport.applyConstraints()),!1;case 100:return r.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new n.Point(40,0))),this.viewport.applyConstraints()),!1;case 114:return this.viewport.flipped?this.viewport.setRotation(n.positiveModulo(this.viewport.degrees-this.rotationIncrement,360)):this.viewport.setRotation(n.positiveModulo(this.viewport.degrees+this.rotationIncrement,360)),this.viewport.applyConstraints(),!1;case 82:return this.viewport.flipped?this.viewport.setRotation(n.positiveModulo(this.viewport.degrees+this.rotationIncrement,360)):this.viewport.setRotation(n.positiveModulo(this.viewport.degrees-this.rotationIncrement,360)),this.viewport.applyConstraints(),!1;case 102:return this.viewport.toggleFlip(),!1;default:return!0}}function onCanvasClick(n){document.activeElement!=this.canvas&&this.canvas.focus(),this.viewport.flipped&&(n.position.x=this.viewport.getContainerSize().x-n.position.x);var o,r={tracker:n.eventSource,position:n.position,quick:n.quick,shift:n.shift,originalEvent:n.originalEvent,preventDefaultAction:n.preventDefaultAction};this.raiseEvent("canvas-click",r),!r.preventDefaultAction&&this.viewport&&n.quick&&(o=this.gestureSettingsByDeviceType(n.pointerType)).clickToZoom&&(this.viewport.zoomBy(n.shift?1/this.zoomPerClick:this.zoomPerClick,o.zoomToRefPoint?this.viewport.pointFromPixel(n.position,!0):null),this.viewport.applyConstraints())}function onCanvasDblClick(n){var o,r={tracker:n.eventSource,position:n.position,shift:n.shift,originalEvent:n.originalEvent,preventDefaultAction:n.preventDefaultAction};this.raiseEvent("canvas-double-click",r),!r.preventDefaultAction&&this.viewport&&(o=this.gestureSettingsByDeviceType(n.pointerType)).dblClickToZoom&&(this.viewport.zoomBy(n.shift?1/this.zoomPerClick:this.zoomPerClick,o.zoomToRefPoint?this.viewport.pointFromPixel(n.position,!0):null),this.viewport.applyConstraints())}function onCanvasDrag(n){var o,r={tracker:n.eventSource,position:n.position,delta:n.delta,speed:n.speed,direction:n.direction,shift:n.shift,originalEvent:n.originalEvent,preventDefaultAction:n.preventDefaultAction};if(this.raiseEvent("canvas-drag",r),!r.preventDefaultAction&&this.viewport){if(o=this.gestureSettingsByDeviceType(n.pointerType),this.panHorizontal||(n.delta.x=0),this.panVertical||(n.delta.y=0),this.viewport.flipped&&(n.delta.x=-n.delta.x),this.constrainDuringPan){var l=this.viewport.deltaPointsFromPixels(n.delta.negate());this.viewport.centerSpringX.target.value+=l.x,this.viewport.centerSpringY.target.value+=l.y;var h=this.viewport.getBounds(),u=this.viewport.getConstrainedBounds();this.viewport.centerSpringX.target.value-=l.x,this.viewport.centerSpringY.target.value-=l.y,h.x!=u.x&&(n.delta.x=0),h.y!=u.y&&(n.delta.y=0)}this.viewport.panBy(this.viewport.deltaPointsFromPixels(n.delta.negate()),o.flickEnabled&&!this.constrainDuringPan)}}function onCanvasDragEnd(o){if(!o.preventDefaultAction&&this.viewport){var r=this.gestureSettingsByDeviceType(o.pointerType);if(r.flickEnabled&&o.speed>=r.flickMinSpeed){var l=0;this.panHorizontal&&(l=r.flickMomentum*o.speed*Math.cos(o.direction));var h=0;this.panVertical&&(h=r.flickMomentum*o.speed*Math.sin(o.direction));var u=this.viewport.pixelFromPoint(this.viewport.getCenter(!0)),p=this.viewport.pointFromPixel(new n.Point(u.x-l,u.y-h));this.viewport.panTo(p,!1)}this.viewport.applyConstraints()}this.raiseEvent("canvas-drag-end",{tracker:o.eventSource,position:o.position,speed:o.speed,direction:o.direction,shift:o.shift,originalEvent:o.originalEvent})}function onCanvasEnter(n){this.raiseEvent("canvas-enter",{tracker:n.eventSource,pointerType:n.pointerType,position:n.position,buttons:n.buttons,pointers:n.pointers,insideElementPressed:n.insideElementPressed,buttonDownAny:n.buttonDownAny,originalEvent:n.originalEvent})}function onCanvasExit(o){window.location!=window.parent.location&&n.MouseTracker.resetAllMouseTrackers(),this.raiseEvent("canvas-exit",{tracker:o.eventSource,pointerType:o.pointerType,position:o.position,buttons:o.buttons,pointers:o.pointers,insideElementPressed:o.insideElementPressed,buttonDownAny:o.buttonDownAny,originalEvent:o.originalEvent})}function onCanvasPress(n){this.raiseEvent("canvas-press",{tracker:n.eventSource,pointerType:n.pointerType,position:n.position,insideElementPressed:n.insideElementPressed,insideElementReleased:n.insideElementReleased,originalEvent:n.originalEvent})}function onCanvasRelease(n){this.raiseEvent("canvas-release",{tracker:n.eventSource,pointerType:n.pointerType,position:n.position,insideElementPressed:n.insideElementPressed,insideElementReleased:n.insideElementReleased,originalEvent:n.originalEvent})}function onCanvasNonPrimaryPress(n){this.raiseEvent("canvas-nonprimary-press",{tracker:n.eventSource,position:n.position,pointerType:n.pointerType,button:n.button,buttons:n.buttons,originalEvent:n.originalEvent})}function onCanvasNonPrimaryRelease(n){this.raiseEvent("canvas-nonprimary-release",{tracker:n.eventSource,position:n.position,pointerType:n.pointerType,button:n.button,buttons:n.buttons,originalEvent:n.originalEvent})}function onCanvasPinch(n){var o,r,l;if(!n.preventDefaultAction&&this.viewport&&((o=this.gestureSettingsByDeviceType(n.pointerType)).pinchToZoom&&(r=this.viewport.pointFromPixel(n.center,!0),l=this.viewport.pointFromPixel(n.lastCenter,!0).minus(r),this.panHorizontal||(l.x=0),this.panVertical||(l.y=0),this.viewport.zoomBy(n.distance/n.lastDistance,r,!0),o.zoomToRefPoint&&this.viewport.panBy(l,!0),this.viewport.applyConstraints()),o.pinchRotate)){var h=Math.atan2(n.gesturePoints[0].currentPos.y-n.gesturePoints[1].currentPos.y,n.gesturePoints[0].currentPos.x-n.gesturePoints[1].currentPos.x),u=Math.atan2(n.gesturePoints[0].lastPos.y-n.gesturePoints[1].lastPos.y,n.gesturePoints[0].lastPos.x-n.gesturePoints[1].lastPos.x);this.viewport.setRotation(this.viewport.getRotation()+(h-u)*(180/Math.PI))}return this.raiseEvent("canvas-pinch",{tracker:n.eventSource,gesturePoints:n.gesturePoints,lastCenter:n.lastCenter,center:n.center,lastDistance:n.lastDistance,distance:n.distance,shift:n.shift,originalEvent:n.originalEvent}),!1}function onCanvasScroll(o){var r,l,h;if((h=n.now())-this._lastScrollTime>this.minScrollDeltaTime){if(this._lastScrollTime=h,this.viewport.flipped&&(o.position.x=this.viewport.getContainerSize().x-o.position.x),!o.preventDefaultAction&&this.viewport&&(r=this.gestureSettingsByDeviceType(o.pointerType)).scrollToZoom&&(l=Math.pow(this.zoomPerScroll,o.scroll),this.viewport.zoomBy(l,r.zoomToRefPoint?this.viewport.pointFromPixel(o.position,!0):null),this.viewport.applyConstraints()),this.raiseEvent("canvas-scroll",{tracker:o.eventSource,position:o.position,scroll:o.scroll,shift:o.shift,originalEvent:o.originalEvent}),r&&r.scrollToZoom)return!1}else if((r=this.gestureSettingsByDeviceType(o.pointerType))&&r.scrollToZoom)return!1}function onContainerEnter(n){o[this.hash].mouseInside=!0,abortControlsAutoHide(this),this.raiseEvent("container-enter",{tracker:n.eventSource,position:n.position,buttons:n.buttons,pointers:n.pointers,insideElementPressed:n.insideElementPressed,buttonDownAny:n.buttonDownAny,originalEvent:n.originalEvent})}function onContainerExit(n){n.pointers<1&&(o[this.hash].mouseInside=!1,o[this.hash].animating||beginControlsAutoHide(this)),this.raiseEvent("container-exit",{tracker:n.eventSource,position:n.position,buttons:n.buttons,pointers:n.pointers,insideElementPressed:n.insideElementPressed,buttonDownAny:n.buttonDownAny,originalEvent:n.originalEvent})}function updateMulti(n){updateOnce(n),n.isOpen()?n._updateRequestId=scheduleUpdate(n,updateMulti):n._updateRequestId=!1}function updateOnce(n){if(!n._opening){if(n.autoResize){var r=_getSafeElemSize(n.container),l=o[n.hash].prevContainerSize;if(!r.equals(l)){var h=n.viewport;if(n.preserveImageSizeOnResize){var u=l.x/r.x,p=h.getZoom()*u,g=h.getCenter();h.resize(r,!1),h.zoomTo(p,null,!0),h.panTo(g,!0)}else{var m=h.getBounds();h.resize(r,!0),h.fitBoundsWithConstraints(m,!0)}o[n.hash].prevContainerSize=r,o[n.hash].forceRedraw=!0}}var v=n.viewport.update(),T=n.world.update()||v;v&&n.raiseEvent("viewport-change"),n.referenceStrip&&(T=n.referenceStrip.update(n.viewport)||T),!o[n.hash].animating&&T&&(n.raiseEvent("animation-start"),abortControlsAutoHide(n)),(T||o[n.hash].forceRedraw||n.world.needsDraw())&&(drawWorld(n),n._drawOverlays(),n.navigator&&n.navigator.update(n.viewport),o[n.hash].forceRedraw=!1,T&&n.raiseEvent("animation")),!o[n.hash].animating||T||(n.raiseEvent("animation-finish"),o[n.hash].mouseInside||beginControlsAutoHide(n)),o[n.hash].animating=T}}function drawWorld(n){n.imageLoader.clear(),n.drawer.clear(),n.world.draw(),n.raiseEvent("update-viewport",{})}function resolveUrl(n,o){return n?n+o:o}function beginZoomingIn(){o[this.hash].lastZoomTime=n.now(),o[this.hash].zoomFactor=this.zoomPerSecond,o[this.hash].zooming=!0,scheduleZoom(this)}function beginZoomingOut(){o[this.hash].lastZoomTime=n.now(),o[this.hash].zoomFactor=1/this.zoomPerSecond,o[this.hash].zooming=!0,scheduleZoom(this)}function endZooming(){o[this.hash].zooming=!1}function scheduleZoom(o){n.requestAnimationFrame(n.delegate(o,doZoom))}function doZoom(){var r,l,h;o[this.hash].zooming&&this.viewport&&(l=(r=n.now())-o[this.hash].lastZoomTime,h=Math.pow(o[this.hash].zoomFactor,l/1e3),this.viewport.zoomBy(h),this.viewport.applyConstraints(),o[this.hash].lastZoomTime=r,scheduleZoom(this))}function doSingleZoomIn(){this.viewport&&(o[this.hash].zooming=!1,this.viewport.zoomBy(this.zoomPerClick/1),this.viewport.applyConstraints())}function doSingleZoomOut(){this.viewport&&(o[this.hash].zooming=!1,this.viewport.zoomBy(1/this.zoomPerClick),this.viewport.applyConstraints())}function lightUp(){this.buttons.emulateEnter(),this.buttons.emulateExit()}function onHome(){this.viewport&&this.viewport.goHome()}function onFullScreen(){this.isFullPage()&&!n.isFullScreen()?this.setFullPage(!1):this.setFullScreen(!this.isFullPage()),this.buttons&&this.buttons.emulateExit(),this.fullPageButton.element.focus(),this.viewport&&this.viewport.applyConstraints()}function onRotateLeft(){if(this.viewport){var o=this.viewport.getRotation();o=this.viewport.flipped?n.positiveModulo(o+this.rotationIncrement,360):n.positiveModulo(o-this.rotationIncrement,360),this.viewport.setRotation(o)}}function onRotateRight(){if(this.viewport){var o=this.viewport.getRotation();o=this.viewport.flipped?n.positiveModulo(o-this.rotationIncrement,360):n.positiveModulo(o+this.rotationIncrement,360),this.viewport.setRotation(o)}}function onFlip(){this.viewport.toggleFlip()}function onPrevious(){var n=this._sequenceIndex-1;this.navPrevNextWrap&&n<0&&(n+=this.tileSources.length),this.goToPage(n)}function onNext(){var n=this._sequenceIndex+1;this.navPrevNextWrap&&n>=this.tileSources.length&&(n=0),this.goToPage(n)}n.Viewer=function(l){var h,u=arguments,p=this;if(n.isPlainObject(l)||(l={id:u[0],xmlPath:u.length>1?u[1]:void 0,prefixUrl:u.length>2?u[2]:void 0,controls:u.length>3?u[3]:void 0,overlays:u.length>4?u[4]:void 0}),l.config&&(n.extend(!0,l,l.config),delete l.config),n.extend(!0,this,{id:l.id,hash:l.hash||r++,initialPage:0,element:null,container:null,canvas:null,overlays:[],overlaysContainer:null,previousBody:[],customControls:[],source:null,drawer:null,world:null,viewport:null,navigator:null,collectionViewport:null,collectionDrawer:null,navImages:null,buttons:null,profiler:null},n.DEFAULT_SETTINGS,l),void 0===this.hash)throw Error("A hash must be defined, either by specifying options.id or options.hash.");for(void 0!==o[this.hash]&&n.console.warn("Hash "+this.hash+" has already been used."),o[this.hash]={fsBoundsDelta:new n.Point(1,1),prevContainerSize:null,animating:!1,forceRedraw:!1,mouseInside:!1,group:null,zooming:!1,zoomFactor:null,lastZoomTime:null,fullPage:!1,onfullscreenchange:null},this._sequenceIndex=0,this._firstOpen=!0,this._updateRequestId=null,this._loadQueue=[],this.currentOverlays=[],this._lastScrollTime=n.now(),n.EventSource.call(this),this.addHandler("open-failed",function(o){var r=n.getString("Errors.OpenFailed",o.eventSource,o.message);p._showMessage(r)}),n.ControlDock.call(this,l),this.xmlPath&&(this.tileSources=[this.xmlPath]),this.element=this.element||document.getElementById(this.id),this.canvas=n.makeNeutralElement("div"),this.canvas.className="openseadragon-canvas",function(n){n.width="100%",n.height="100%",n.overflow="hidden",n.position="absolute",n.top="0px",n.left="0px"}(this.canvas.style),n.setElementTouchActionNone(this.canvas),""!==l.tabIndex&&(this.canvas.tabIndex=void 0===l.tabIndex?0:l.tabIndex),this.container.className="openseadragon-container",function(n){n.width="100%",n.height="100%",n.position="relative",n.overflow="hidden",n.left="0px",n.top="0px",n.textAlign="left"}(this.container.style),this.container.insertBefore(this.canvas,this.container.firstChild),this.element.appendChild(this.container),this.bodyWidth=document.body.style.width,this.bodyHeight=document.body.style.height,this.bodyOverflow=document.body.style.overflow,this.docOverflow=document.documentElement.style.overflow,this.innerTracker=new n.MouseTracker({element:this.canvas,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,keyDownHandler:n.delegate(this,onCanvasKeyDown),keyHandler:n.delegate(this,onCanvasKeyPress),clickHandler:n.delegate(this,onCanvasClick),dblClickHandler:n.delegate(this,onCanvasDblClick),dragHandler:n.delegate(this,onCanvasDrag),dragEndHandler:n.delegate(this,onCanvasDragEnd),enterHandler:n.delegate(this,onCanvasEnter),exitHandler:n.delegate(this,onCanvasExit),pressHandler:n.delegate(this,onCanvasPress),releaseHandler:n.delegate(this,onCanvasRelease),nonPrimaryPressHandler:n.delegate(this,onCanvasNonPrimaryPress),nonPrimaryReleaseHandler:n.delegate(this,onCanvasNonPrimaryRelease),scrollHandler:n.delegate(this,onCanvasScroll),pinchHandler:n.delegate(this,onCanvasPinch)}),this.outerTracker=new n.MouseTracker({element:this.container,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,enterHandler:n.delegate(this,onContainerEnter),exitHandler:n.delegate(this,onContainerExit)}),this.toolbar&&(this.toolbar=new n.ControlDock({element:this.toolbar})),this.bindStandardControls(),o[this.hash].prevContainerSize=_getSafeElemSize(this.container),this.world=new n.World({viewer:this}),this.world.addHandler("add-item",function(n){p.source=p.world.getItemAt(0).source,o[p.hash].forceRedraw=!0,p._updateRequestId||(p._updateRequestId=scheduleUpdate(p,updateMulti))}),this.world.addHandler("remove-item",function(n){p.world.getItemCount()?p.source=p.world.getItemAt(0).source:p.source=null,o[p.hash].forceRedraw=!0}),this.world.addHandler("metrics-change",function(n){p.viewport&&p.viewport._setContentBounds(p.world.getHomeBounds(),p.world.getContentFactor())}),this.world.addHandler("item-index-change",function(n){p.source=p.world.getItemAt(0).source}),this.viewport=new n.Viewport({containerSize:o[this.hash].prevContainerSize,springStiffness:this.springStiffness,animationTime:this.animationTime,minZoomImageRatio:this.minZoomImageRatio,maxZoomPixelRatio:this.maxZoomPixelRatio,visibilityRatio:this.visibilityRatio,wrapHorizontal:this.wrapHorizontal,wrapVertical:this.wrapVertical,defaultZoomLevel:this.defaultZoomLevel,minZoomLevel:this.minZoomLevel,maxZoomLevel:this.maxZoomLevel,viewer:this,degrees:this.degrees,flipped:this.flipped,navigatorRotate:this.navigatorRotate,homeFillsViewer:this.homeFillsViewer,margins:this.viewportMargins}),this.viewport._setContentBounds(this.world.getHomeBounds(),this.world.getContentFactor()),this.imageLoader=new n.ImageLoader({jobLimit:this.imageLoaderLimit,timeout:l.timeout}),this.tileCache=new n.TileCache({maxImageCacheCount:this.maxImageCacheCount}),this.drawer=new n.Drawer({viewer:this,viewport:this.viewport,element:this.canvas,debugGridColor:this.debugGridColor}),this.overlaysContainer=n.makeNeutralElement("div"),this.canvas.appendChild(this.overlaysContainer),!this.drawer.canRotate()&&(this.rotateLeft&&(h=this.buttons.buttons.indexOf(this.rotateLeft),this.buttons.buttons.splice(h,1),this.buttons.element.removeChild(this.rotateLeft.element)),this.rotateRight&&(h=this.buttons.buttons.indexOf(this.rotateRight),this.buttons.buttons.splice(h,1),this.buttons.element.removeChild(this.rotateRight.element))),this.showNavigator&&(this.navigator=new n.Navigator({id:this.navigatorId,position:this.navigatorPosition,sizeRatio:this.navigatorSizeRatio,maintainSizeRatio:this.navigatorMaintainSizeRatio,top:this.navigatorTop,left:this.navigatorLeft,width:this.navigatorWidth,height:this.navigatorHeight,autoResize:this.navigatorAutoResize,autoFade:this.navigatorAutoFade,prefixUrl:this.prefixUrl,viewer:this,navigatorRotate:this.navigatorRotate,background:this.navigatorBackground,opacity:this.navigatorOpacity,borderColor:this.navigatorBorderColor,displayRegionColor:this.navigatorDisplayRegionColor,crossOriginPolicy:this.crossOriginPolicy})),this.sequenceMode&&this.bindSequenceControls(),this.tileSources&&this.open(this.tileSources),h=0;h<this.customControls.length;h++)this.addControl(this.customControls[h].id,{anchor:this.customControls[h].anchor});n.requestAnimationFrame(function(){beginControlsAutoHide(p)}),void 0===this.imageSmoothingEnabled||this.imageSmoothingEnabled||this.drawer.setImageSmoothingEnabled(this.imageSmoothingEnabled)},n.extend(n.Viewer.prototype,n.EventSource.prototype,n.ControlDock.prototype,{isOpen:function(){return!!this.world.getItemCount()},openDzi:function(o){return n.console.error("[Viewer.openDzi] this function is deprecated; use Viewer.open() instead."),this.open(o)},openTileSource:function(o){return n.console.error("[Viewer.openTileSource] this function is deprecated; use Viewer.open() instead."),this.open(o)},open:function(o,r){var l,h=this;if(this.close(),o){if(this.sequenceMode&&n.isArray(o)){this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),void 0===r||isNaN(r)||(this.initialPage=r),this.tileSources=o,this._sequenceIndex=Math.max(0,Math.min(this.tileSources.length-1,this.initialPage)),this.tileSources.length&&(this.open(this.tileSources[this._sequenceIndex]),this.showReferenceStrip&&this.addReferenceStrip()),this._updateSequenceButtons(this._sequenceIndex);return}if(n.isArray(o)||(o=[o]),o.length){this._opening=!0;for(var u=o.length,p=0,g=0,checkCompletion=function(){if(p+g===u){if(p){(h._firstOpen||!h.preserveViewport)&&(h.viewport.goHome(!0),h.viewport.update()),h._firstOpen=!1;var n=o[0];if(n.tileSource&&(n=n.tileSource),h.overlays&&!h.preserveOverlays)for(var r=0;r<h.overlays.length;r++)h.currentOverlays[r]=getOverlayObject(h,h.overlays[r]);h._drawOverlays(),h._opening=!1,h.raiseEvent("open",{source:n})}else h._opening=!1,h.raiseEvent("open-failed",l)}},doOne=function(o){n.isPlainObject(o)&&o.tileSource||(o={tileSource:o}),void 0!==o.index&&(n.console.error("[Viewer.open] setting indexes here is not supported; use addTiledImage instead"),delete o.index),void 0===o.collectionImmediately&&(o.collectionImmediately=!0);var r=o.success;o.success=function(n){if(p++,o.tileSource.overlays)for(var l=0;l<o.tileSource.overlays.length;l++)h.addOverlay(o.tileSource.overlays[l]);r&&r(n),checkCompletion()};var u=o.error;o.error=function(n){g++,l||(l=n),u&&u(n),checkCompletion()},h.addTiledImage(o)},m=0;m<o.length;m++)doOne(o[m]);return this}}},close:function(){return o[this.hash]&&(this._opening=!1,this.navigator&&this.navigator.close(),this.preserveOverlays||(this.clearOverlays(),this.overlaysContainer.innerHTML=""),o[this.hash].animating=!1,this.world.removeAll(),this.imageLoader.clear(),this.raiseEvent("close")),this},destroy:function(){if(o[this.hash]){if(this.close(),this.clearOverlays(),this.overlaysContainer.innerHTML="",this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),null!==this._updateRequestId&&(n.cancelAnimationFrame(this._updateRequestId),this._updateRequestId=null),this.drawer&&this.drawer.destroy(),this.removeAllHandlers(),this.element)for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.innerTracker&&this.innerTracker.destroy(),this.outerTracker&&this.outerTracker.destroy(),o[this.hash]=null,delete o[this.hash],this.canvas=null,this.container=null,this.element=null}},isMouseNavEnabled:function(){return this.innerTracker.isTracking()},setMouseNavEnabled:function(n){return this.innerTracker.setTracking(n),this.outerTracker.setTracking(n),this.raiseEvent("mouse-enabled",{enabled:n}),this},areControlsEnabled:function(){var n,o=this.controls.length;for(n=0;n<this.controls.length;n++)o=o&&this.controls[n].isVisible();return o},setControlsEnabled:function(n){return n?abortControlsAutoHide(this):beginControlsAutoHide(this),this.raiseEvent("controls-enabled",{enabled:n}),this},setDebugMode:function(n){for(var o=0;o<this.world.getItemCount();o++)this.world.getItemAt(o).debugMode=n;this.debugMode=n,this.forceRedraw()},isFullPage:function(){return o[this.hash].fullPage},setFullPage:function(r){var l,h,u=document.body,p=u.style,g=document.documentElement.style,m=this;if(r==this.isFullPage())return this;var v={fullPage:r,preventDefaultAction:!1};if(this.raiseEvent("pre-full-page",v),v.preventDefaultAction)return this;if(r){for(h=0,this.elementSize=n.getElementSize(this.element),this.pageScroll=n.getPageScroll(),this.elementMargin=this.element.style.margin,this.element.style.margin="0",this.elementPadding=this.element.style.padding,this.element.style.padding="0",this.bodyMargin=p.margin,this.docMargin=g.margin,p.margin="0",g.margin="0",this.bodyPadding=p.padding,this.docPadding=g.padding,p.padding="0",g.padding="0",this.bodyWidth=p.width,this.docWidth=g.width,p.width="100%",g.width="100%",this.bodyHeight=p.height,this.docHeight=g.height,p.height="100%",g.height="100%",this.previousBody=[],o[this.hash].prevElementParent=this.element.parentNode,o[this.hash].prevNextSibling=this.element.nextSibling,o[this.hash].prevElementWidth=this.element.style.width,o[this.hash].prevElementHeight=this.element.style.height,l=u.childNodes.length;h<l;h++)this.previousBody.push(u.childNodes[0]),u.removeChild(u.childNodes[0]);this.toolbar&&this.toolbar.element&&(this.toolbar.parentNode=this.toolbar.element.parentNode,this.toolbar.nextSibling=this.toolbar.element.nextSibling,u.appendChild(this.toolbar.element),n.addClass(this.toolbar.element,"fullpage")),n.addClass(this.element,"fullpage"),u.appendChild(this.element),this.element.style.height=n.getWindowSize().y+"px",this.element.style.width=n.getWindowSize().x+"px",this.toolbar&&this.toolbar.element&&(this.element.style.height=n.getElementSize(this.element).y-n.getElementSize(this.toolbar.element).y+"px"),o[this.hash].fullPage=!0,n.delegate(this,onContainerEnter)({})}else{for(this.element.style.margin=this.elementMargin,this.element.style.padding=this.elementPadding,p.margin=this.bodyMargin,g.margin=this.docMargin,p.padding=this.bodyPadding,g.padding=this.docPadding,p.width=this.bodyWidth,g.width=this.docWidth,p.height=this.bodyHeight,g.height=this.docHeight,u.removeChild(this.element),l=this.previousBody.length,h=0;h<l;h++)u.appendChild(this.previousBody.shift());n.removeClass(this.element,"fullpage"),o[this.hash].prevElementParent.insertBefore(this.element,o[this.hash].prevNextSibling),this.toolbar&&this.toolbar.element&&(u.removeChild(this.toolbar.element),n.removeClass(this.toolbar.element,"fullpage"),this.toolbar.parentNode.insertBefore(this.toolbar.element,this.toolbar.nextSibling),delete this.toolbar.parentNode,delete this.toolbar.nextSibling),this.element.style.width=o[this.hash].prevElementWidth,this.element.style.height=o[this.hash].prevElementHeight;var T=0,restoreScroll=function(){n.setPageScroll(m.pageScroll);var o=n.getPageScroll();++T<10&&(o.x!==m.pageScroll.x||o.y!==m.pageScroll.y)&&n.requestAnimationFrame(restoreScroll)};n.requestAnimationFrame(restoreScroll),o[this.hash].fullPage=!1,n.delegate(this,onContainerExit)({})}return this.navigator&&this.viewport&&this.navigator.update(this.viewport),this.raiseEvent("full-page",{fullPage:r}),this},setFullScreen:function(o){var r=this;if(!n.supportsFullScreen)return this.setFullPage(o);if(n.isFullScreen()===o)return this;var l={fullScreen:o,preventDefaultAction:!1};if(this.raiseEvent("pre-full-screen",l),l.preventDefaultAction)return this;if(o){if(this.setFullPage(!0),!this.isFullPage())return this;this.fullPageStyleWidth=this.element.style.width,this.fullPageStyleHeight=this.element.style.height,this.element.style.width="100%",this.element.style.height="100%";var onFullScreenChange=function(){var o=n.isFullScreen();!o&&(n.removeEvent(document,n.fullScreenEventName,onFullScreenChange),n.removeEvent(document,n.fullScreenErrorEventName,onFullScreenChange),r.setFullPage(!1),r.isFullPage()&&(r.element.style.width=r.fullPageStyleWidth,r.element.style.height=r.fullPageStyleHeight)),r.navigator&&r.viewport&&setTimeout(function(){r.navigator.update(r.viewport)}),r.raiseEvent("full-screen",{fullScreen:o})};n.addEvent(document,n.fullScreenEventName,onFullScreenChange),n.addEvent(document,n.fullScreenErrorEventName,onFullScreenChange),n.requestFullScreen(document.body)}else n.exitFullScreen();return this},isVisible:function(){return"hidden"!=this.container.style.visibility},setVisible:function(n){return this.container.style.visibility=n?"":"hidden",this.raiseEvent("visible",{visible:n}),this},addTiledImage:function(o){n.console.assert(o,"[Viewer.addTiledImage] options is required"),n.console.assert(o.tileSource,"[Viewer.addTiledImage] options.tileSource is required"),n.console.assert(!o.replace||o.index>-1&&o.index<this.world.getItemCount(),"[Viewer.addTiledImage] if options.replace is used, options.index must be a valid index in Viewer.world");var r=this;o.replace&&(o.replaceItem=r.world.getItemAt(o.index)),this._hideMessage(),void 0===o.placeholderFillStyle&&(o.placeholderFillStyle=this.placeholderFillStyle),void 0===o.opacity&&(o.opacity=this.opacity),void 0===o.preload&&(o.preload=this.preload),void 0===o.compositeOperation&&(o.compositeOperation=this.compositeOperation),void 0===o.crossOriginPolicy&&(o.crossOriginPolicy=void 0!==o.tileSource.crossOriginPolicy?o.tileSource.crossOriginPolicy:this.crossOriginPolicy),void 0===o.ajaxWithCredentials&&(o.ajaxWithCredentials=this.ajaxWithCredentials),void 0===o.loadTilesWithAjax&&(o.loadTilesWithAjax=this.loadTilesWithAjax),void 0===o.ajaxHeaders||null===o.ajaxHeaders?o.ajaxHeaders=this.ajaxHeaders:n.isPlainObject(o.ajaxHeaders)&&n.isPlainObject(this.ajaxHeaders)&&(o.ajaxHeaders=n.extend({},this.ajaxHeaders,o.ajaxHeaders));var l={options:o};function raiseAddItemFailed(n){for(var h=0;h<r._loadQueue.length;h++)if(r._loadQueue[h]===l){r._loadQueue.splice(h,1);break}0===r._loadQueue.length&&refreshWorld(l),r.raiseEvent("add-item-failed",n),o.error&&o.error(n)}function refreshWorld(n){r.collectionMode&&(r.world.arrange({immediately:n.options.collectionImmediately,rows:r.collectionRows,columns:r.collectionColumns,layout:r.collectionLayout,tileSize:r.collectionTileSize,tileMargin:r.collectionTileMargin}),r.world.setAutoRefigureSizes(!0))}if(n.isArray(o.tileSource)){setTimeout(function(){raiseAddItemFailed({message:"[Viewer.addTiledImage] Sequences can not be added; add them one at a time instead.",source:o.tileSource,options:o})});return}function processReadyItems(){for(var o,l,h;r._loadQueue.length&&(o=r._loadQueue[0]).tileSource;){if(r._loadQueue.splice(0,1),o.options.replace){var u=r.world.getIndexOfItem(o.options.replaceItem);-1!=u&&(o.options.index=u),r.world.removeItem(o.options.replaceItem)}l=new n.TiledImage({viewer:r,source:o.tileSource,viewport:r.viewport,drawer:r.drawer,tileCache:r.tileCache,imageLoader:r.imageLoader,x:o.options.x,y:o.options.y,width:o.options.width,height:o.options.height,fitBounds:o.options.fitBounds,fitBoundsPlacement:o.options.fitBoundsPlacement,clip:o.options.clip,placeholderFillStyle:o.options.placeholderFillStyle,opacity:o.options.opacity,preload:o.options.preload,degrees:o.options.degrees,compositeOperation:o.options.compositeOperation,springStiffness:r.springStiffness,animationTime:r.animationTime,minZoomImageRatio:r.minZoomImageRatio,wrapHorizontal:r.wrapHorizontal,wrapVertical:r.wrapVertical,immediateRender:r.immediateRender,blendTime:r.blendTime,alwaysBlend:r.alwaysBlend,minPixelRatio:r.minPixelRatio,smoothTileEdgesMinZoom:r.smoothTileEdgesMinZoom,iOSDevice:r.iOSDevice,crossOriginPolicy:o.options.crossOriginPolicy,ajaxWithCredentials:o.options.ajaxWithCredentials,loadTilesWithAjax:o.options.loadTilesWithAjax,ajaxHeaders:o.options.ajaxHeaders,debugMode:r.debugMode}),r.collectionMode&&r.world.setAutoRefigureSizes(!1),r.world.addItem(l,{index:o.options.index}),0===r._loadQueue.length&&refreshWorld(o),1!==r.world.getItemCount()||r.preserveViewport||r.viewport.goHome(!0),r.navigator&&(h=n.extend({},o.options,{replace:!1,originalTiledImage:l,tileSource:o.tileSource}),r.navigator.addTiledImage(h)),o.options.success&&o.options.success({item:l})}}this._loadQueue.push(l),getTileSourceImplementation(this,o.tileSource,o,function(n){l.tileSource=n,processReadyItems()},function(n){n.options=o,raiseAddItemFailed(n),processReadyItems()})},addSimpleImage:function(o){n.console.assert(o,"[Viewer.addSimpleImage] options is required"),n.console.assert(o.url,"[Viewer.addSimpleImage] options.url is required");var r=n.extend({},o,{tileSource:{type:"image",url:o.url}});delete r.url,this.addTiledImage(r)},addLayer:function(o){var r=this;n.console.error("[Viewer.addLayer] this function is deprecated; use Viewer.addTiledImage() instead.");var l=n.extend({},o,{success:function(n){r.raiseEvent("add-layer",{options:o,drawer:n.item})},error:function(n){r.raiseEvent("add-layer-failed",n)}});return this.addTiledImage(l),this},getLayerAtLevel:function(o){return n.console.error("[Viewer.getLayerAtLevel] this function is deprecated; use World.getItemAt() instead."),this.world.getItemAt(o)},getLevelOfLayer:function(o){return n.console.error("[Viewer.getLevelOfLayer] this function is deprecated; use World.getIndexOfItem() instead."),this.world.getIndexOfItem(o)},getLayersCount:function(){return n.console.error("[Viewer.getLayersCount] this function is deprecated; use World.getItemCount() instead."),this.world.getItemCount()},setLayerLevel:function(o,r){return n.console.error("[Viewer.setLayerLevel] this function is deprecated; use World.setItemIndex() instead."),this.world.setItemIndex(o,r)},removeLayer:function(o){return n.console.error("[Viewer.removeLayer] this function is deprecated; use World.removeItem() instead."),this.world.removeItem(o)},forceRedraw:function(){return o[this.hash].forceRedraw=!0,this},bindSequenceControls:function(){var o=n.delegate(this,onFocus),r=n.delegate(this,onBlur),l=n.delegate(this,onNext),h=n.delegate(this,onPrevious),u=this.navImages,p=!0;return this.showSequenceControl&&((this.previousButton||this.nextButton)&&(p=!1),this.previousButton=new n.Button({element:this.previousButton?n.getElement(this.previousButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:n.getString("Tooltips.PreviousPage"),srcRest:resolveUrl(this.prefixUrl,u.previous.REST),srcGroup:resolveUrl(this.prefixUrl,u.previous.GROUP),srcHover:resolveUrl(this.prefixUrl,u.previous.HOVER),srcDown:resolveUrl(this.prefixUrl,u.previous.DOWN),onRelease:h,onFocus:o,onBlur:r}),this.nextButton=new n.Button({element:this.nextButton?n.getElement(this.nextButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:n.getString("Tooltips.NextPage"),srcRest:resolveUrl(this.prefixUrl,u.next.REST),srcGroup:resolveUrl(this.prefixUrl,u.next.GROUP),srcHover:resolveUrl(this.prefixUrl,u.next.HOVER),srcDown:resolveUrl(this.prefixUrl,u.next.DOWN),onRelease:l,onFocus:o,onBlur:r}),this.navPrevNextWrap||this.previousButton.disable(),this.tileSources&&this.tileSources.length||this.nextButton.disable(),p&&(this.paging=new n.ButtonGroup({buttons:[this.previousButton,this.nextButton],clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.pagingControl=this.paging.element,this.toolbar?this.toolbar.addControl(this.pagingControl,{anchor:n.ControlAnchor.BOTTOM_RIGHT}):this.addControl(this.pagingControl,{anchor:this.sequenceControlAnchor||n.ControlAnchor.TOP_LEFT}))),this},bindStandardControls:function(){var o=n.delegate(this,beginZoomingIn),r=n.delegate(this,endZooming),l=n.delegate(this,doSingleZoomIn),h=n.delegate(this,beginZoomingOut),u=n.delegate(this,doSingleZoomOut),p=n.delegate(this,onHome),g=n.delegate(this,onFullScreen),m=n.delegate(this,onRotateLeft),v=n.delegate(this,onRotateRight),T=n.delegate(this,onFlip),S=n.delegate(this,onFocus),P=n.delegate(this,onBlur),E=this.navImages,C=[],R=!0;return this.showNavigationControl&&((this.zoomInButton||this.zoomOutButton||this.homeButton||this.fullPageButton||this.rotateLeftButton||this.rotateRightButton||this.flipButton)&&(R=!1),this.showZoomControl&&(C.push(this.zoomInButton=new n.Button({element:this.zoomInButton?n.getElement(this.zoomInButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:n.getString("Tooltips.ZoomIn"),srcRest:resolveUrl(this.prefixUrl,E.zoomIn.REST),srcGroup:resolveUrl(this.prefixUrl,E.zoomIn.GROUP),srcHover:resolveUrl(this.prefixUrl,E.zoomIn.HOVER),srcDown:resolveUrl(this.prefixUrl,E.zoomIn.DOWN),onPress:o,onRelease:r,onClick:l,onEnter:o,onExit:r,onFocus:S,onBlur:P})),C.push(this.zoomOutButton=new n.Button({element:this.zoomOutButton?n.getElement(this.zoomOutButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:n.getString("Tooltips.ZoomOut"),srcRest:resolveUrl(this.prefixUrl,E.zoomOut.REST),srcGroup:resolveUrl(this.prefixUrl,E.zoomOut.GROUP),srcHover:resolveUrl(this.prefixUrl,E.zoomOut.HOVER),srcDown:resolveUrl(this.prefixUrl,E.zoomOut.DOWN),onPress:h,onRelease:r,onClick:u,onEnter:h,onExit:r,onFocus:S,onBlur:P}))),this.showHomeControl&&C.push(this.homeButton=new n.Button({element:this.homeButton?n.getElement(this.homeButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:n.getString("Tooltips.Home"),srcRest:resolveUrl(this.prefixUrl,E.home.REST),srcGroup:resolveUrl(this.prefixUrl,E.home.GROUP),srcHover:resolveUrl(this.prefixUrl,E.home.HOVER),srcDown:resolveUrl(this.prefixUrl,E.home.DOWN),onRelease:p,onFocus:S,onBlur:P})),this.showFullPageControl&&C.push(this.fullPageButton=new n.Button({element:this.fullPageButton?n.getElement(this.fullPageButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:n.getString("Tooltips.FullPage"),srcRest:resolveUrl(this.prefixUrl,E.fullpage.REST),srcGroup:resolveUrl(this.prefixUrl,E.fullpage.GROUP),srcHover:resolveUrl(this.prefixUrl,E.fullpage.HOVER),srcDown:resolveUrl(this.prefixUrl,E.fullpage.DOWN),onRelease:g,onFocus:S,onBlur:P})),this.showRotationControl&&(C.push(this.rotateLeftButton=new n.Button({element:this.rotateLeftButton?n.getElement(this.rotateLeftButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:n.getString("Tooltips.RotateLeft"),srcRest:resolveUrl(this.prefixUrl,E.rotateleft.REST),srcGroup:resolveUrl(this.prefixUrl,E.rotateleft.GROUP),srcHover:resolveUrl(this.prefixUrl,E.rotateleft.HOVER),srcDown:resolveUrl(this.prefixUrl,E.rotateleft.DOWN),onRelease:m,onFocus:S,onBlur:P})),C.push(this.rotateRightButton=new n.Button({element:this.rotateRightButton?n.getElement(this.rotateRightButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:n.getString("Tooltips.RotateRight"),srcRest:resolveUrl(this.prefixUrl,E.rotateright.REST),srcGroup:resolveUrl(this.prefixUrl,E.rotateright.GROUP),srcHover:resolveUrl(this.prefixUrl,E.rotateright.HOVER),srcDown:resolveUrl(this.prefixUrl,E.rotateright.DOWN),onRelease:v,onFocus:S,onBlur:P}))),this.showFlipControl&&C.push(this.flipButton=new n.Button({element:this.flipButton?n.getElement(this.flipButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:n.getString("Tooltips.Flip"),srcRest:resolveUrl(this.prefixUrl,E.flip.REST),srcGroup:resolveUrl(this.prefixUrl,E.flip.GROUP),srcHover:resolveUrl(this.prefixUrl,E.flip.HOVER),srcDown:resolveUrl(this.prefixUrl,E.flip.DOWN),onRelease:T,onFocus:S,onBlur:P})),R&&(this.buttons=new n.ButtonGroup({buttons:C,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.navControl=this.buttons.element,this.addHandler("open",n.delegate(this,lightUp)),this.toolbar?this.toolbar.addControl(this.navControl,{anchor:this.navigationControlAnchor||n.ControlAnchor.TOP_LEFT}):this.addControl(this.navControl,{anchor:this.navigationControlAnchor||n.ControlAnchor.TOP_LEFT}))),this},currentPage:function(){return this._sequenceIndex},goToPage:function(n){return this.tileSources&&n>=0&&n<this.tileSources.length&&(this._sequenceIndex=n,this._updateSequenceButtons(n),this.open(this.tileSources[n]),this.referenceStrip&&this.referenceStrip.setFocus(n),this.raiseEvent("page",{page:n})),this},addOverlay:function(o,r,l,h){if(u=n.isPlainObject(o)?o:{element:o,location:r,placement:l,onDraw:h},o=n.getElement(u.element),getOverlayIndex(this.currentOverlays,o)>=0)return this;var u,p=getOverlayObject(this,u);return this.currentOverlays.push(p),p.drawHTML(this.overlaysContainer,this.viewport),this.raiseEvent("add-overlay",{element:o,location:u.location,placement:u.placement}),this},updateOverlay:function(r,l,h){var u;return r=n.getElement(r),(u=getOverlayIndex(this.currentOverlays,r))>=0&&(this.currentOverlays[u].update(l,h),o[this.hash].forceRedraw=!0,this.raiseEvent("update-overlay",{element:r,location:l,placement:h})),this},removeOverlay:function(r){var l;return r=n.getElement(r),(l=getOverlayIndex(this.currentOverlays,r))>=0&&(this.currentOverlays[l].destroy(),this.currentOverlays.splice(l,1),o[this.hash].forceRedraw=!0,this.raiseEvent("remove-overlay",{element:r})),this},clearOverlays:function(){for(;this.currentOverlays.length>0;)this.currentOverlays.pop().destroy();return o[this.hash].forceRedraw=!0,this.raiseEvent("clear-overlay",{}),this},getOverlayById:function(o){var r;return(o=n.getElement(o),(r=getOverlayIndex(this.currentOverlays,o))>=0)?this.currentOverlays[r]:null},_updateSequenceButtons:function(n){this.nextButton&&(this.tileSources&&this.tileSources.length-1!==n?this.nextButton.enable():this.navPrevNextWrap||this.nextButton.disable()),this.previousButton&&(n>0?this.previousButton.enable():this.navPrevNextWrap||this.previousButton.disable())},_showMessage:function(o){this._hideMessage();var r=n.makeNeutralElement("div");r.appendChild(document.createTextNode(o)),this.messageDiv=n.makeCenteredNode(r),n.addClass(this.messageDiv,"openseadragon-message"),this.container.appendChild(this.messageDiv)},_hideMessage:function(){var n=this.messageDiv;n&&(n.parentNode.removeChild(n),delete this.messageDiv)},gestureSettingsByDeviceType:function(n){switch(n){case"mouse":return this.gestureSettingsMouse;case"touch":return this.gestureSettingsTouch;case"pen":return this.gestureSettingsPen;default:return this.gestureSettingsUnknown}},_drawOverlays:function(){var n,o=this.currentOverlays.length;for(n=0;n<o;n++)this.currentOverlays[n].drawHTML(this.overlaysContainer,this.viewport)},_cancelPendingImages:function(){this._loadQueue=[]},removeReferenceStrip:function(){this.showReferenceStrip=!1,this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null)},addReferenceStrip:function(){(this.showReferenceStrip=!0,this.sequenceMode)?!this.referenceStrip&&this.tileSources.length&&this.tileSources.length>1&&(this.referenceStrip=new n.ReferenceStrip({id:this.referenceStripElement,position:this.referenceStripPosition,sizeRatio:this.referenceStripSizeRatio,scroll:this.referenceStripScroll,height:this.referenceStripHeight,width:this.referenceStripWidth,tileSources:this.tileSources,prefixUrl:this.prefixUrl,useCanvas:this.useCanvas,viewer:this}),this.referenceStrip.setFocus(this._sequenceIndex)):n.console.warn('Attempting to display a reference strip while "sequenceMode" is off.')}})}(OpenSeadragon),function(n){function onCanvasClick(n){var o={tracker:n.eventSource,position:n.position,quick:n.quick,shift:n.shift,originalEvent:n.originalEvent,preventDefaultAction:n.preventDefaultAction};if(this.viewer.raiseEvent("navigator-click",o),!o.preventDefaultAction&&n.quick&&this.viewer.viewport&&(this.panVertical||this.panHorizontal)){this.viewer.viewport.flipped&&(n.position.x=this.viewport.getContainerSize().x-n.position.x);var r=this.viewport.pointFromPixel(n.position);this.panVertical?this.panHorizontal||(r.x=this.viewer.viewport.getCenter(!0).x):r.y=this.viewer.viewport.getCenter(!0).y,this.viewer.viewport.panTo(r),this.viewer.viewport.applyConstraints()}}function onCanvasDrag(n){var o={tracker:n.eventSource,position:n.position,delta:n.delta,speed:n.speed,direction:n.direction,shift:n.shift,originalEvent:n.originalEvent,preventDefaultAction:n.preventDefaultAction};this.viewer.raiseEvent("navigator-drag",o),!o.preventDefaultAction&&this.viewer.viewport&&(this.panHorizontal||(n.delta.x=0),this.panVertical||(n.delta.y=0),this.viewer.viewport.flipped&&(n.delta.x=-n.delta.x),this.viewer.viewport.panBy(this.viewport.deltaPointsFromPixels(n.delta)),this.viewer.constrainDuringPan&&this.viewer.viewport.applyConstraints())}function onCanvasRelease(n){n.insideElementPressed&&this.viewer.viewport&&this.viewer.viewport.applyConstraints()}function onCanvasScroll(n){return this.viewer.raiseEvent("navigator-scroll",{tracker:n.eventSource,position:n.position,scroll:n.scroll,shift:n.shift,originalEvent:n.originalEvent}),!1}function _setTransformRotate(n,o){setElementTransform(n,"rotate("+o+"deg)")}function setElementTransform(n,o){n.style.webkitTransform=o,n.style.mozTransform=o,n.style.msTransform=o,n.style.oTransform=o,n.style.transform=o}n.Navigator=function(o){var r,l,h=o.viewer,u=this;function rotate(n){_setTransformRotate(u.displayRegionContainer,n),_setTransformRotate(u.displayRegion,-n),u.viewport.setRotation(n)}o.id?(this.element=document.getElementById(o.id),o.controlOptions={anchor:n.ControlAnchor.NONE,attachToViewer:!1,autoFade:!1}):(o.id="navigator-"+n.now(),this.element=n.makeNeutralElement("div"),o.controlOptions={anchor:n.ControlAnchor.TOP_RIGHT,attachToViewer:!0,autoFade:o.autoFade},o.position&&("BOTTOM_RIGHT"==o.position?o.controlOptions.anchor=n.ControlAnchor.BOTTOM_RIGHT:"BOTTOM_LEFT"==o.position?o.controlOptions.anchor=n.ControlAnchor.BOTTOM_LEFT:"TOP_RIGHT"==o.position?o.controlOptions.anchor=n.ControlAnchor.TOP_RIGHT:"TOP_LEFT"==o.position?o.controlOptions.anchor=n.ControlAnchor.TOP_LEFT:"ABSOLUTE"==o.position&&(o.controlOptions.anchor=n.ControlAnchor.ABSOLUTE,o.controlOptions.top=o.top,o.controlOptions.left=o.left,o.controlOptions.height=o.height,o.controlOptions.width=o.width))),this.element.id=o.id,this.element.className+=" navigator",(o=n.extend(!0,{sizeRatio:n.DEFAULT_SETTINGS.navigatorSizeRatio},o,{element:this.element,tabIndex:-1,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,autoResize:o.autoResize,minZoomImageRatio:1,background:o.background,opacity:o.opacity,borderColor:o.borderColor,displayRegionColor:o.displayRegionColor})).minPixelRatio=this.minPixelRatio=h.minPixelRatio,n.setElementTouchActionNone(this.element),this.borderWidth=2,this.fudge=new n.Point(1,1),this.totalBorderWidths=new n.Point(2*this.borderWidth,2*this.borderWidth).minus(this.fudge),o.controlOptions.anchor!=n.ControlAnchor.NONE&&function(n,r){n.margin="0px",n.border=r+"px solid "+o.borderColor,n.padding="0px",n.background=o.background,n.opacity=o.opacity,n.overflow="hidden"}(this.element.style,this.borderWidth),this.displayRegion=n.makeNeutralElement("div"),this.displayRegion.id=this.element.id+"-displayregion",this.displayRegion.className="displayregion",function(n,r){n.position="relative",n.top="0px",n.left="0px",n.fontSize="0px",n.overflow="hidden",n.border=r+"px solid "+o.displayRegionColor,n.margin="0px",n.padding="0px",n.background="transparent",n.float="left",n.cssFloat="left",n.styleFloat="left",n.zIndex=999999999,n.cursor="default"}(this.displayRegion.style,this.borderWidth),this.displayRegionContainer=n.makeNeutralElement("div"),this.displayRegionContainer.id=this.element.id+"-displayregioncontainer",this.displayRegionContainer.className="displayregioncontainer",this.displayRegionContainer.style.width="100%",this.displayRegionContainer.style.height="100%",h.addControl(this.element,o.controlOptions),this._resizeWithViewer=o.controlOptions.anchor!=n.ControlAnchor.ABSOLUTE&&o.controlOptions.anchor!=n.ControlAnchor.NONE,o.width&&o.height?(this.setWidth(o.width),this.setHeight(o.height)):this._resizeWithViewer&&(r=n.getElementSize(h.element),this.element.style.height=Math.round(r.y*o.sizeRatio)+"px",this.element.style.width=Math.round(r.x*o.sizeRatio)+"px",this.oldViewerSize=r,l=n.getElementSize(this.element),this.elementArea=l.x*l.y),this.oldContainerSize=new n.Point(0,0),n.Viewer.apply(this,[o]),this.displayRegionContainer.appendChild(this.displayRegion),this.element.getElementsByTagName("div")[0].appendChild(this.displayRegionContainer),o.navigatorRotate&&(rotate(o.viewer.viewport?o.viewer.viewport.getRotation():o.viewer.degrees||0),o.viewer.addHandler("rotate",function(n){rotate(n.degrees)})),this.innerTracker.destroy(),this.innerTracker=new n.MouseTracker({element:this.element,dragHandler:n.delegate(this,onCanvasDrag),clickHandler:n.delegate(this,onCanvasClick),releaseHandler:n.delegate(this,onCanvasRelease),scrollHandler:n.delegate(this,onCanvasScroll)}),this.addHandler("reset-size",function(){u.viewport&&u.viewport.goHome(!0)}),h.world.addHandler("item-index-change",function(n){window.setTimeout(function(){var o=u.world.getItemAt(n.previousIndex);u.world.setItemIndex(o,n.newIndex)},1)}),h.world.addHandler("remove-item",function(n){var o=n.item,r=u._getMatchingItem(o);r&&u.world.removeItem(r)}),this.update(h.viewport)},n.extend(n.Navigator.prototype,n.EventSource.prototype,n.Viewer.prototype,{updateSize:function(){if(this.viewport){var o=new n.Point(0===this.container.clientWidth?1:this.container.clientWidth,0===this.container.clientHeight?1:this.container.clientHeight);o.equals(this.oldContainerSize)||(this.viewport.resize(o,!0),this.viewport.goHome(!0),this.oldContainerSize=o,this.drawer.clear(),this.world.draw())}},setWidth:function(n){this.width=n,this.element.style.width="number"==typeof n?n+"px":n,this._resizeWithViewer=!1},setHeight:function(n){this.height=n,this.element.style.height="number"==typeof n?n+"px":n,this._resizeWithViewer=!1},setFlip:function(n){return this.viewport.setFlip(n),this.setDisplayTransform(this.viewer.viewport.getFlip()?"scale(-1,1)":"scale(1,1)"),this},setDisplayTransform:function(n){setElementTransform(this.displayRegion,n),setElementTransform(this.canvas,n),setElementTransform(this.element,n)},update:function(o){var r,l,h,u,p,g;if(r=n.getElementSize(this.viewer.element),this._resizeWithViewer&&r.x&&r.y&&!r.equals(this.oldViewerSize)&&(this.oldViewerSize=r,this.maintainSizeRatio||!this.elementArea?(l=r.x*this.sizeRatio,h=r.y*this.sizeRatio):(l=Math.sqrt(this.elementArea*(r.x/r.y)),h=this.elementArea/l),this.element.style.width=Math.round(l)+"px",this.element.style.height=Math.round(h)+"px",this.elementArea||(this.elementArea=l*h),this.updateSize()),o&&this.viewport){u=o.getBoundsNoRotate(!0),p=this.viewport.pixelFromPointNoRotate(u.getTopLeft(),!1),g=this.viewport.pixelFromPointNoRotate(u.getBottomRight(),!1).minus(this.totalBorderWidths);var m=this.displayRegion.style;m.display=this.world.getItemCount()?"block":"none",m.top=Math.round(p.y)+"px",m.left=Math.round(p.x)+"px";var v=Math.abs(p.x-g.x),T=Math.abs(p.y-g.y);m.width=Math.round(Math.max(v,0))+"px",m.height=Math.round(Math.max(T,0))+"px"}},addTiledImage:function(o){var r=this,l=o.originalTiledImage;delete o.original;var h=n.extend({},o,{success:function(n){var o=n.item;function matchBounds(){r._matchBounds(o,l)}function matchOpacity(){r._matchOpacity(o,l)}function matchCompositeOperation(){r._matchCompositeOperation(o,l)}o._originalForNavigator=l,r._matchBounds(o,l,!0),l.addHandler("bounds-change",matchBounds),l.addHandler("clip-change",matchBounds),l.addHandler("opacity-change",matchOpacity),l.addHandler("composite-operation-change",matchCompositeOperation)}});return n.Viewer.prototype.addTiledImage.apply(this,[h])},_getMatchingItem:function(n){for(var o,r=this.world.getItemCount(),l=0;l<r;l++)if((o=this.world.getItemAt(l))._originalForNavigator===n)return o;return null},_matchBounds:function(n,o,r){var l=o.getBoundsNoRotate();n.setPosition(l.getTopLeft(),r),n.setWidth(l.width,r),n.setRotation(o.getRotation(),r),n.setClip(o.getClip())},_matchOpacity:function(n,o){n.setOpacity(o.opacity)},_matchCompositeOperation:function(n,o){n.setCompositeOperation(o.compositeOperation)}})}(OpenSeadragon),function(n){var o={Errors:{Dzc:"Sorry, we don't support Deep Zoom Collections!",Dzi:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",Xml:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",ImageFormat:"Sorry, we don't support {0}-based Deep Zoom Images.",Security:"It looks like a security restriction stopped us from loading this Deep Zoom Image.",Status:"This space unintentionally left blank ({0} {1}).",OpenFailed:"Unable to open {0}: {1}"},Tooltips:{FullPage:"Toggle full page",Home:"Go home",ZoomIn:"Zoom in",ZoomOut:"Zoom out",NextPage:"Next page",PreviousPage:"Previous page",RotateLeft:"Rotate left",RotateRight:"Rotate right",Flip:"Flip Horizontally"}};n.extend(n,{getString:function(r){var l,h=r.split("."),u=null,p=arguments,g=o;for(l=0;l<h.length-1;l++)g=g[h[l]]||{};return"string"!=typeof(u=g[h[l]])&&(n.console.log("Untranslated source string:",r),u=""),u.replace(/\{\d+\}/g,function(n){var o=parseInt(n.match(/\d+/),10)+1;return o<p.length?p[o]:""})},setString:function(n,r){var l,h=n.split("."),u=o;for(l=0;l<h.length-1;l++)u[h[l]]||(u[h[l]]={}),u=u[h[l]];u[h[l]]=r}})}(OpenSeadragon),function(n){n.Point=function(n,o){this.x="number"==typeof n?n:0,this.y="number"==typeof o?o:0},n.Point.prototype={clone:function(){return new n.Point(this.x,this.y)},plus:function(o){return new n.Point(this.x+o.x,this.y+o.y)},minus:function(o){return new n.Point(this.x-o.x,this.y-o.y)},times:function(o){return new n.Point(this.x*o,this.y*o)},divide:function(o){return new n.Point(this.x/o,this.y/o)},negate:function(){return new n.Point(-this.x,-this.y)},distanceTo:function(n){return Math.sqrt(Math.pow(this.x-n.x,2)+Math.pow(this.y-n.y,2))},squaredDistanceTo:function(n){return Math.pow(this.x-n.x,2)+Math.pow(this.y-n.y,2)},apply:function(o){return new n.Point(o(this.x),o(this.y))},equals:function(o){return o instanceof n.Point&&this.x===o.x&&this.y===o.y},rotate:function(o,r){if(r=r||new n.Point(0,0),o%90==0){var l,h;switch(n.positiveModulo(o,360)){case 0:l=1,h=0;break;case 90:l=0,h=1;break;case 180:l=-1,h=0;break;case 270:l=0,h=-1}}else{var u=o*Math.PI/180;l=Math.cos(u),h=Math.sin(u)}var p=l*(this.x-r.x)-h*(this.y-r.y)+r.x,g=h*(this.x-r.x)+l*(this.y-r.y)+r.y;return new n.Point(p,g)},toString:function(){return"("+Math.round(100*this.x)/100+","+Math.round(100*this.y)/100+")"}}}(OpenSeadragon),function(n){function processResponse(o){var r,l,h=o.responseText,u=o.status;if(o){if(200!==o.status&&0!==o.status)throw r=404==(u=o.status)?"Not Found":o.statusText,Error(n.getString("Errors.Status",u,r))}else throw Error(n.getString("Errors.Security"));if(h.match(/\s*<.*/))try{l=o.responseXML&&o.responseXML.documentElement?o.responseXML:n.parseXml(h)}catch(n){l=o.responseText}else if(h.match(/\s*[\{\[].*/))try{l=n.parseJSON(h)}catch(n){l=h}else l=h;return l}n.TileSource=function(o,r,l,h,u,p){var g,m,v=this,T=arguments;if(g=n.isPlainObject(o)?o:{width:T[0],height:T[1],tileSize:T[2],tileOverlap:T[3],minLevel:T[4],maxLevel:T[5]},n.EventSource.call(this),n.extend(!0,this,g),!this.success){for(m=0;m<arguments.length;m++)if(n.isFunction(arguments[m])){this.success=arguments[m];break}}this.success&&this.addHandler("ready",function(n){v.success(n)}),"string"==n.type(arguments[0])&&(this.url=arguments[0]),this.url?(this.aspectRatio=1,this.dimensions=new n.Point(10,10),this._tileWidth=0,this._tileHeight=0,this.tileOverlap=0,this.minLevel=0,this.maxLevel=0,this.ready=!1,this.getImageInfo(this.url)):(this.ready=!0,this.aspectRatio=g.width&&g.height?g.width/g.height:1,this.dimensions=new n.Point(g.width,g.height),this.tileSize?(this._tileWidth=this._tileHeight=this.tileSize,delete this.tileSize):(this.tileWidth?(this._tileWidth=this.tileWidth,delete this.tileWidth):this._tileWidth=0,this.tileHeight?(this._tileHeight=this.tileHeight,delete this.tileHeight):this._tileHeight=0),this.tileOverlap=g.tileOverlap?g.tileOverlap:0,this.minLevel=g.minLevel?g.minLevel:0,this.maxLevel=void 0!==g.maxLevel&&null!==g.maxLevel?g.maxLevel:g.width&&g.height?Math.ceil(Math.log(Math.max(g.width,g.height))/Math.log(2)):0,this.success&&n.isFunction(this.success)&&this.success(this))},n.TileSource.prototype={getTileSize:function(o){return n.console.error("[TileSource.getTileSize] is deprecated. Use TileSource.getTileWidth() and TileSource.getTileHeight() instead"),this._tileWidth},getTileWidth:function(n){return this._tileWidth?this._tileWidth:this.getTileSize(n)},getTileHeight:function(n){return this._tileHeight?this._tileHeight:this.getTileSize(n)},getLevelScale:function(n){var o,r={};for(o=0;o<=this.maxLevel;o++)r[o]=1/Math.pow(2,this.maxLevel-o);return this.getLevelScale=function(n){return r[n]},this.getLevelScale(n)},getNumTiles:function(o){var r=this.getLevelScale(o),l=Math.ceil(r*this.dimensions.x/this.getTileWidth(o)),h=Math.ceil(r*this.dimensions.y/this.getTileHeight(o));return new n.Point(l,h)},getPixelRatio:function(o){var r=this.dimensions.times(this.getLevelScale(o)),l=1/r.x,h=1/r.y;return new n.Point(l,h)},getClosestLevel:function(){var n,o;for(n=this.minLevel+1;n<=this.maxLevel&&!((o=this.getNumTiles(n)).x>1)&&!(o.y>1);n++);return n-1},getTileAtPoint:function(o,r){var l=r.x>=0&&r.x<=1&&r.y>=0&&r.y<=1/this.aspectRatio;n.console.assert(l,"[TileSource.getTileAtPoint] must be called with a valid point.");var h=this.dimensions.x*this.getLevelScale(o),u=r.x*h,p=r.y*h,g=Math.floor(u/this.getTileWidth(o)),m=Math.floor(p/this.getTileHeight(o));r.x>=1&&(g=this.getNumTiles(o).x-1);var v=1e-15;return r.y>=1/this.aspectRatio-v&&(m=this.getNumTiles(o).y-1),new n.Point(g,m)},getTileBounds:function(o,r,l,h){var u=this.dimensions.times(this.getLevelScale(o)),p=this.getTileWidth(o),g=this.getTileHeight(o),m=0===r?0:p*r-this.tileOverlap,v=0===l?0:g*l-this.tileOverlap,T=p+(0===r?1:2)*this.tileOverlap,S=g+(0===l?1:2)*this.tileOverlap,P=1/u.x;return(T=Math.min(T,u.x-m),S=Math.min(S,u.y-v),h)?new n.Rect(0,0,T,S):new n.Rect(m*P,v*P,T*P,S*P)},getImageInfo:function(o){var r,l,h,u,p,g,m,v=this;o&&(m=(g=(p=o.split("/"))[p.length-1]).lastIndexOf("."))>-1&&(p[p.length-1]=g.slice(0,m)),l=function(r){"string"==typeof r&&(r=n.parseXml(r));var l=n.TileSource.determineType(v,r,o);if(!l){v.raiseEvent("open-failed",{message:"Unable to load TileSource",source:o});return}void 0===(u=l.prototype.configure.apply(v,[r,o])).ajaxWithCredentials&&(u.ajaxWithCredentials=v.ajaxWithCredentials),h=new l(u),v.ready=!0,v.raiseEvent("ready",{tileSource:h})},o.match(/\.js$/)?(r=o.split("/").pop().replace(".js",""),n.jsonp({url:o,async:!1,callbackName:r,callback:l})):n.makeAjaxRequest({url:o,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,success:function(n){l(processResponse(n))},error:function(n,r){var l,h;try{l="HTTP "+n.status+" attempting to load TileSource"}catch(n){l=(h=void 0!==r&&r.toString?r.toString():"Unknown error")+" attempting to load TileSource"}v.raiseEvent("open-failed",{message:l,source:o})}})},supports:function(n,o){return!1},configure:function(n,o){throw Error("Method not implemented.")},getTileUrl:function(n,o,r){throw Error("Method not implemented.")},getTileAjaxHeaders:function(n,o,r){return{}},tileExists:function(n,o,r){var l=this.getNumTiles(n);return n>=this.minLevel&&n<=this.maxLevel&&o>=0&&r>=0&&o<l.x&&r<l.y}},n.extend(!0,n.TileSource.prototype,n.EventSource.prototype),n.TileSource.determineType=function(o,r,l){var h;for(h in OpenSeadragon)if(h.match(/.+TileSource$/)&&n.isFunction(OpenSeadragon[h])&&n.isFunction(OpenSeadragon[h].prototype.supports)&&OpenSeadragon[h].prototype.supports.call(o,r,l))return OpenSeadragon[h];n.console.error("No TileSource was able to open %s %s",l,r)}}(OpenSeadragon),function(n){function configureFromXML(o,r){if(!r||!r.documentElement)throw Error(n.getString("Errors.Xml"));var l,h,u,p,g,m=r.documentElement,v=m.localName||m.tagName,T=r.documentElement.namespaceURI,S=null,P=[];if("Image"==v)try{if(p=m.getElementsByTagName("Size")[0],void 0===p&&(p=m.getElementsByTagNameNS(T,"Size")[0]),S={Image:{xmlns:"http://schemas.microsoft.com/deepzoom/2008",Url:m.getAttribute("Url"),Format:m.getAttribute("Format"),DisplayRect:null,Overlap:parseInt(m.getAttribute("Overlap"),10),TileSize:parseInt(m.getAttribute("TileSize"),10),Size:{Height:parseInt(p.getAttribute("Height"),10),Width:parseInt(p.getAttribute("Width"),10)}}},!n.imageFormatSupported(S.Image.Format))throw Error(n.getString("Errors.ImageFormat",S.Image.Format.toUpperCase()));for(l=m.getElementsByTagName("DisplayRect"),void 0===l&&(l=m.getElementsByTagNameNS(T,"DisplayRect")[0]),g=0;g<l.length;g++)u=(h=l[g]).getElementsByTagName("Rect")[0],void 0===u&&(u=h.getElementsByTagNameNS(T,"Rect")[0]),P.push({Rect:{X:parseInt(u.getAttribute("X"),10),Y:parseInt(u.getAttribute("Y"),10),Width:parseInt(u.getAttribute("Width"),10),Height:parseInt(u.getAttribute("Height"),10),MinLevel:parseInt(h.getAttribute("MinLevel"),10),MaxLevel:parseInt(h.getAttribute("MaxLevel"),10)}});return P.length&&(S.Image.DisplayRect=P),configureFromObject(o,S)}catch(o){throw o instanceof Error?o:Error(n.getString("Errors.Dzi"))}else if("Collection"==v)throw Error(n.getString("Errors.Dzc"));else if("Error"==v)throw Error(m.getElementsByTagName("Message")[0].firstChild.nodeValue);throw Error(n.getString("Errors.Dzi"))}function configureFromObject(o,r){var l,h,u=r.Image,p=u.Url,g=u.Format,m=u.Size,v=u.DisplayRect||[],T=parseInt(m.Width,10),S=parseInt(m.Height,10),P=parseInt(u.TileSize,10),E=parseInt(u.Overlap,10),C=[];for(h=0;h<v.length;h++)l=v[h].Rect,C.push(new n.DisplayRect(parseInt(l.X,10),parseInt(l.Y,10),parseInt(l.Width,10),parseInt(l.Height,10),parseInt(l.MinLevel,10),parseInt(l.MaxLevel,10)));return n.extend(!0,{width:T,height:S,tileSize:P,tileOverlap:E,minLevel:null,maxLevel:null,tilesUrl:p,fileFormat:g,displayRects:C},r)}n.DziTileSource=function(o,r,l,h,u,p,g,m,v){var T,S,P,E;if(E=n.isPlainObject(o)?o:{width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4],fileFormat:arguments[5],displayRects:arguments[6],minLevel:arguments[7],maxLevel:arguments[8]},this._levelRects={},this.tilesUrl=E.tilesUrl,this.fileFormat=E.fileFormat,this.displayRects=E.displayRects,this.displayRects)for(T=this.displayRects.length-1;T>=0;T--)for(P=(S=this.displayRects[T]).minLevel;P<=S.maxLevel;P++)this._levelRects[P]||(this._levelRects[P]=[]),this._levelRects[P].push(S);n.TileSource.apply(this,[E])},n.extend(n.DziTileSource.prototype,n.TileSource.prototype,{supports:function(n,o){var r;return n.Image?r=n.Image.xmlns:n.documentElement&&("Image"==n.documentElement.localName||"Image"==n.documentElement.tagName)&&(r=n.documentElement.namespaceURI),-1!==(r=(r||"").toLowerCase()).indexOf("schemas.microsoft.com/deepzoom/2008")||-1!==r.indexOf("schemas.microsoft.com/deepzoom/2009")},configure:function(o,r){var l;return l=n.isPlainObject(o)?configureFromObject(this,o):configureFromXML(this,o),r&&!l.tilesUrl&&(l.tilesUrl=r.replace(/([^\/]+?)(\.(dzi|xml|js)?(\?[^\/]*)?)?\/?$/,"$1_files/"),-1!=r.search(/\.(dzi|xml|js)\?/)?l.queryParams=r.match(/\?.*/):l.queryParams=""),l},getTileUrl:function(n,o,r){return[this.tilesUrl,n,"/",o,"_",r,".",this.fileFormat,this.queryParams].join("")},tileExists:function(n,o,r){var l,h,u,p,g,m,v,T=this._levelRects[n];if(this.minLevel&&n<this.minLevel||this.maxLevel&&n>this.maxLevel)return!1;if(!T||!T.length)return!0;for(v=T.length-1;v>=0;v--)if(!(n<(l=T[v]).minLevel)&&!(n>l.maxLevel)&&(h=this.getLevelScale(n),u=l.x*h,p=l.y*h,g=u+l.width*h,m=p+l.height*h,u=Math.floor(u/this._tileWidth),p=Math.floor(p/this._tileWidth),g=Math.ceil(g/this._tileWidth),m=Math.ceil(m/this._tileWidth),u<=o&&o<g&&p<=r&&r<m))return!0;return!1}})}(OpenSeadragon),function(n){function canBeTiled(n){var o=-1!==["http://library.stanford.edu/iiif/image-api/compliance.html#level0","http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0","http://iiif.io/api/image/2/level0.json","level0","https://iiif.io/api/image/3/level0.json"].indexOf(Array.isArray(n.profile)?n.profile[0]:n.profile),r=!1;return 2===n.version&&n.profile.length>1&&n.profile[1].supports&&(r=-1!==n.profile[1].supports.indexOf("sizeByW")),3===n.version&&n.extraFeatures&&(r=-1!==n.extraFeatures.indexOf("sizeByWh")),!o||r}function constructLevels(n){for(var o=[],r=0;r<n.sizes.length;r++)o.push({url:n["@id"]+"/full/"+n.sizes[r].width+","+(3===n.version?n.sizes[r].height:"")+"/0/default."+n.tileFormat,width:n.sizes[r].width,height:n.sizes[r].height});return o.sort(function(n,o){return n.width-o.width})}function configureFromXml10(o){if(!o||!o.documentElement)throw Error(n.getString("Errors.Xml"));var r=o.documentElement,l=r.tagName,h=null;if("info"==l)try{return h={},parseXML10(r,h),h}catch(o){throw o instanceof Error?o:Error(n.getString("Errors.IIIF"))}throw Error(n.getString("Errors.IIIF"))}function parseXML10(o,r,l){var h,u;if(3==o.nodeType&&l)(u=o.nodeValue.trim()).match(/^\d*$/)&&(u=Number(u)),r[l]?(n.isArray(r[l])||(r[l]=[r[l]]),r[l].push(u)):r[l]=u;else if(1==o.nodeType)for(h=0;h<o.childNodes.length;h++)parseXML10(o.childNodes[h],r,o.nodeName)}n.IIIFTileSource=function(o){if(n.extend(!0,this,o),!(this.height&&this.width&&this["@id"]))throw Error("IIIF required parameters not provided.");if(o.tileSizePerScaleFactor={},this.tileFormat=this.tileFormat||"jpg",this.version=o.version,this.tile_width&&this.tile_height)o.tileWidth=this.tile_width,o.tileHeight=this.tile_height;else if(this.tile_width)o.tileSize=this.tile_width;else if(this.tile_height)o.tileSize=this.tile_height;else if(this.tiles){if(1==this.tiles.length)o.tileWidth=this.tiles[0].width,o.tileHeight=this.tiles[0].height||this.tiles[0].width,this.scale_factors=this.tiles[0].scaleFactors;else{this.scale_factors=[];for(var r=0;r<this.tiles.length;r++)for(var l=0;l<this.tiles[r].scaleFactors.length;l++){var h=this.tiles[r].scaleFactors[l];this.scale_factors.push(h),o.tileSizePerScaleFactor[h]={width:this.tiles[r].width,height:this.tiles[r].height||this.tiles[r].width}}}}else if(canBeTiled(o)){for(var u=Math.min(this.height,this.width),p=[256,512,1024],g=[],m=0;m<p.length;m++)p[m]<=u&&g.push(p[m]);g.length>0?o.tileSize=Math.max.apply(null,g):o.tileSize=u}else this.sizes&&this.sizes.length>0?(this.emulateLegacyImagePyramid=!0,o.levels=constructLevels(this),n.extend(!0,o,{width:o.levels[o.levels.length-1].width,height:o.levels[o.levels.length-1].height,tileSize:Math.max(o.height,o.width),tileOverlap:0,minLevel:0,maxLevel:o.levels.length-1}),this.levels=o.levels):n.console.error("Nothing in the info.json to construct image pyramids from");if(!o.maxLevel&&!this.emulateLegacyImagePyramid){if(this.scale_factors){var v=Math.max.apply(null,this.scale_factors);o.maxLevel=Math.round(Math.log(v)*Math.LOG2E)}else o.maxLevel=Number(Math.ceil(Math.log(Math.max(this.width,this.height),2)))}n.TileSource.apply(this,[o])},n.extend(n.IIIFTileSource.prototype,n.TileSource.prototype,{supports:function(n,o){return!!n.protocol&&"http://iiif.io/api/image"==n.protocol||!!n["@context"]&&("http://library.stanford.edu/iiif/image-api/1.1/context.json"==n["@context"]||"http://iiif.io/api/image/1/context.json"==n["@context"])||!!n.profile&&0===n.profile.indexOf("http://library.stanford.edu/iiif/image-api/compliance.html")||!!n.identifier&&!!n.width&&!!n.height||!!n.documentElement&&"info"==n.documentElement.tagName&&"http://library.stanford.edu/iiif/image-api/ns/"==n.documentElement.namespaceURI},configure:function(o,r){if(n.isPlainObject(o)){if(o["@context"]){var l=o["@context"];if(Array.isArray(l)){for(var h=0;h<l.length;h++)if("string"==typeof l[h]&&(/^http:\/\/iiif\.io\/api\/image\/[1-3]\/context\.json$/.test(l[h])||"http://library.stanford.edu/iiif/image-api/1.1/context.json"===l[h])){l=l[h];break}}switch(l){case"http://iiif.io/api/image/1/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/context.json":o.version=1;break;case"http://iiif.io/api/image/2/context.json":o.version=2;break;case"http://iiif.io/api/image/3/context.json":o.version=3;break;default:n.console.error("Data has a @context property which contains no known IIIF context URI.")}}else o["@context"]="http://iiif.io/api/image/1.0/context.json",o["@id"]=r.replace("/info.json",""),o.version=1;if(!o["@id"]&&o.id&&(o["@id"]=o.id),o.preferredFormats){for(var u=0;u<o.preferredFormats.length;u++)if(OpenSeadragon.imageFormatSupported(o.preferredFormats[u])){o.tileFormat=o.preferredFormats[u];break}}return o}var p=configureFromXml10(o);return p["@context"]="http://iiif.io/api/image/1.0/context.json",p["@id"]=r.replace("/info.xml",""),p.version=1,p},getTileWidth:function(o){if(this.emulateLegacyImagePyramid)return n.TileSource.prototype.getTileWidth.call(this,o);var r=Math.pow(2,this.maxLevel-o);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[r]?this.tileSizePerScaleFactor[r].width:this._tileWidth},getTileHeight:function(o){if(this.emulateLegacyImagePyramid)return n.TileSource.prototype.getTileHeight.call(this,o);var r=Math.pow(2,this.maxLevel-o);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[r]?this.tileSizePerScaleFactor[r].height:this._tileHeight},getLevelScale:function(o){if(this.emulateLegacyImagePyramid){var r=NaN;return this.levels.length>0&&o>=this.minLevel&&o<=this.maxLevel&&(r=this.levels[o].width/this.levels[this.maxLevel].width),r}return n.TileSource.prototype.getLevelScale.call(this,o)},getNumTiles:function(o){return this.emulateLegacyImagePyramid?this.getLevelScale(o)?new n.Point(1,1):new n.Point(0,0):n.TileSource.prototype.getNumTiles.call(this,o)},getTileAtPoint:function(o,r){return this.emulateLegacyImagePyramid?new n.Point(0,0):n.TileSource.prototype.getTileAtPoint.call(this,o,r)},getTileUrl:function(n,o,r){if(this.emulateLegacyImagePyramid){var l=null;return this.levels.length>0&&n>=this.minLevel&&n<=this.maxLevel&&(l=this.levels[n].url),l}var h,u,p,g,m,v,T,S,P,E,C,R,O,I="0",M=Math.pow(.5,this.maxLevel-n),D=Math.ceil(this.width*M),B=Math.ceil(this.height*M);return h=this.getTileWidth(n),u=this.getTileHeight(n),p=Math.ceil(h/M),g=Math.ceil(u/M),O=1===this.version?"native."+this.tileFormat:"default."+this.tileFormat,D<h&&B<u?(E=2===this.version&&D===this.width?"max":3===this.version&&D===this.width&&B===this.height?"max":3===this.version?D+","+B:D+",",m="full"):(v=o*p,T=r*g,S=Math.min(p,this.width-v),P=Math.min(g,this.height-T),m=0===o&&0===r&&S===this.width&&P===this.height?"full":[v,T,S,P].join(","),C=Math.ceil(S*M),R=Math.ceil(P*M),E=2===this.version&&C===this.width?"max":3===this.version&&C===this.width&&R===this.height?"max":3===this.version?C+","+R:C+","),[this["@id"],m,E,I,O].join("/")},__testonly__:{canBeTiled:canBeTiled,constructLevels:constructLevels}})}(OpenSeadragon),function(n){n.OsmTileSource=function(o,r,l,h,u){var p;p=n.isPlainObject(o)?o:{width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]},p.width&&p.height||(p.width=65572864,p.height=65572864),p.tileSize||(p.tileSize=256,p.tileOverlap=0),p.tilesUrl||(p.tilesUrl="http://tile.openstreetmap.org/"),p.minLevel=8,n.TileSource.apply(this,[p])},n.extend(n.OsmTileSource.prototype,n.TileSource.prototype,{supports:function(n,o){return n.type&&"openstreetmaps"==n.type},configure:function(n,o){return n},getTileUrl:function(n,o,r){return this.tilesUrl+(n-8)+"/"+o+"/"+r+".png"}})}(OpenSeadragon),function(n){n.TmsTileSource=function(o,r,l,h,u){p=n.isPlainObject(o)?o:{width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]};var p,g,m=256*Math.ceil(p.width/256),v=256*Math.ceil(p.height/256);g=m>v?m/256:v/256,p.maxLevel=Math.ceil(Math.log(g)/Math.log(2))-1,p.tileSize=256,p.width=m,p.height=v,n.TileSource.apply(this,[p])},n.extend(n.TmsTileSource.prototype,n.TileSource.prototype,{supports:function(n,o){return n.type&&"tiledmapservice"==n.type},configure:function(n,o){return n},getTileUrl:function(n,o,r){var l=this.getNumTiles(n).y-1;return this.tilesUrl+n+"/"+o+"/"+(l-r)+".png"}})}(OpenSeadragon),function(n){n.ZoomifyTileSource=function(n){n.tileSize=256;var o={x:n.width,y:n.height};for(n.imageSizes=[{x:n.width,y:n.height}],n.gridSize=[this._getGridSize(n.width,n.height,n.tileSize)];parseInt(o.x,10)>n.tileSize||parseInt(o.y,10)>n.tileSize;)o.x=Math.floor(o.x/2),o.y=Math.floor(o.y/2),n.imageSizes.push({x:o.x,y:o.y}),n.gridSize.push(this._getGridSize(o.x,o.y,n.tileSize));n.imageSizes.reverse(),n.gridSize.reverse(),n.minLevel=0,n.maxLevel=n.gridSize.length-1,OpenSeadragon.TileSource.apply(this,[n])},n.extend(n.ZoomifyTileSource.prototype,n.TileSource.prototype,{_getGridSize:function(n,o,r){return{x:Math.ceil(n/r),y:Math.ceil(o/r)}},_calculateAbsoluteTileNumber:function(n,o,r){for(var l=0,h={},u=0;u<n;u++)l+=(h=this.gridSize[u]).x*h.y;return l+((h=this.gridSize[n]).x*r+o)},supports:function(n,o){return n.type&&"zoomifytileservice"==n.type},configure:function(n,o){return n},getTileUrl:function(n,o,r){var l=0;return l=Math.floor(this._calculateAbsoluteTileNumber(n,o,r)/256),this.tilesUrl+"TileGroup"+l+"/"+n+"-"+o+"-"+r+".jpg"}})}(OpenSeadragon),function(n){function filterFiles(o){var r,l,h=[];for(l=0;l<o.length;l++)(r=o[l]).height&&r.width&&r.url?h.push({url:r.url,width:Number(r.width),height:Number(r.height)}):n.console.error("Unsupported image format: %s",r.url?r.url:"<no URL>");return h.sort(function(n,o){return n.height-o.height})}function configureFromXML(o,r){if(!r||!r.documentElement)throw Error(n.getString("Errors.Xml"));var l,h,u=r.documentElement,p=u.tagName,g=null,m=[];if("image"==p)try{for(h=0,g={type:u.getAttribute("type"),levels:[]},m=u.getElementsByTagName("level");h<m.length;h++)l=m[h],g.levels.push({url:l.getAttribute("url"),width:parseInt(l.getAttribute("width"),10),height:parseInt(l.getAttribute("height"),10)});return configureFromObject(o,g)}catch(n){throw n instanceof Error?n:Error("Unknown error parsing Legacy Image Pyramid XML.")}else if("collection"==p)throw Error("Legacy Image Pyramid Collections not yet supported.");else if("error"==p)throw Error("Error: "+r);throw Error("Unknown element "+p)}function configureFromObject(n,o){return o.levels}n.LegacyTileSource=function(o){var r,l,h;n.isArray(o)&&(r={type:"legacy-image-pyramid",levels:o}),r.levels=filterFiles(r.levels),r.levels.length>0?(l=r.levels[r.levels.length-1].width,h=r.levels[r.levels.length-1].height):(l=0,h=0,n.console.error("No supported image formats found")),n.extend(!0,r,{width:l,height:h,tileSize:Math.max(h,l),tileOverlap:0,minLevel:0,maxLevel:r.levels.length>0?r.levels.length-1:0}),n.TileSource.apply(this,[r]),this.levels=r.levels},n.extend(n.LegacyTileSource.prototype,n.TileSource.prototype,{supports:function(n,o){return n.type&&"legacy-image-pyramid"==n.type||n.documentElement&&"legacy-image-pyramid"==n.documentElement.getAttribute("type")},configure:function(o,r){return n.isPlainObject(o)?configureFromObject(this,o):configureFromXML(this,o)},getLevelScale:function(n){var o=NaN;return this.levels.length>0&&n>=this.minLevel&&n<=this.maxLevel&&(o=this.levels[n].width/this.levels[this.maxLevel].width),o},getNumTiles:function(o){return this.getLevelScale(o)?new n.Point(1,1):new n.Point(0,0)},getTileUrl:function(n,o,r){var l=null;return this.levels.length>0&&n>=this.minLevel&&n<=this.maxLevel&&(l=this.levels[n].url),l}})}(OpenSeadragon),function(n){n.ImageTileSource=function(o){o=n.extend({buildPyramid:!0,crossOriginPolicy:!1,ajaxWithCredentials:!1,useCanvas:!0},o),n.TileSource.apply(this,[o])},n.extend(n.ImageTileSource.prototype,n.TileSource.prototype,{supports:function(n,o){return n.type&&"image"===n.type},configure:function(n,o){return n},getImageInfo:function(o){var r=this._image=new Image,l=this;this.crossOriginPolicy&&(r.crossOrigin=this.crossOriginPolicy),this.ajaxWithCredentials&&(r.useCredentials=this.ajaxWithCredentials),n.addEvent(r,"load",function(){l.width=Object.prototype.hasOwnProperty.call(r,"naturalWidth")?r.naturalWidth:r.width,l.height=Object.prototype.hasOwnProperty.call(r,"naturalHeight")?r.naturalHeight:r.height,l.aspectRatio=l.width/l.height,l.dimensions=new n.Point(l.width,l.height),l._tileWidth=l.width,l._tileHeight=l.height,l.tileOverlap=0,l.minLevel=0,l.levels=l._buildLevels(),l.maxLevel=l.levels.length-1,l.ready=!0,l.raiseEvent("ready",{tileSource:l})}),n.addEvent(r,"error",function(){l.raiseEvent("open-failed",{message:"Error loading image at "+o,source:o})}),r.src=o},getLevelScale:function(n){var o=NaN;return n>=this.minLevel&&n<=this.maxLevel&&(o=this.levels[n].width/this.levels[this.maxLevel].width),o},getNumTiles:function(o){return this.getLevelScale(o)?new n.Point(1,1):new n.Point(0,0)},getTileUrl:function(n,o,r){var l=null;return n>=this.minLevel&&n<=this.maxLevel&&(l=this.levels[n].url),l},getContext2D:function(n,o,r){var l=null;return n>=this.minLevel&&n<=this.maxLevel&&(l=this.levels[n].context2D),l},_buildLevels:function(){var o=[{url:this._image.src,width:Object.prototype.hasOwnProperty.call(this._image,"naturalWidth")?this._image.naturalWidth:this._image.width,height:Object.prototype.hasOwnProperty.call(this._image,"naturalHeight")?this._image.naturalHeight:this._image.height}];if(!this.buildPyramid||!n.supportsCanvas||!this.useCanvas)return delete this._image,o;var r=Object.prototype.hasOwnProperty.call(this._image,"naturalWidth")?this._image.naturalWidth:this._image.width,l=Object.prototype.hasOwnProperty.call(this._image,"naturalHeight")?this._image.naturalHeight:this._image.height,h=document.createElement("canvas"),u=h.getContext("2d");if(h.width=r,h.height=l,u.drawImage(this._image,0,0,r,l),o[0].context2D=u,delete this._image,n.isCanvasTainted(h))return o;for(;r>=2&&l>=2;){r=Math.floor(r/2),l=Math.floor(l/2);var p=document.createElement("canvas"),g=p.getContext("2d");p.width=r,p.height=l,g.drawImage(h,0,0,r,l),o.splice(0,0,{context2D:g,width:r,height:l}),h=p,u=g}return o}})}(OpenSeadragon),function(n){n.TileSourceCollection=function(o,r,l,h){n.console.error("TileSourceCollection is deprecated; use World instead")}}(OpenSeadragon),function(n){function scheduleFade(o){n.requestAnimationFrame(function(){updateFade(o)})}function updateFade(o){var r;o.shouldFade&&(r=Math.max(0,r=Math.min(1,r=1-(n.now()-o.fadeBeginTime)/o.fadeLength)),o.imgGroup&&n.setElementOpacity(o.imgGroup,r,!0),r>0&&scheduleFade(o))}function beginFading(o){o.shouldFade=!0,o.fadeBeginTime=n.now()+o.fadeDelay,window.setTimeout(function(){scheduleFade(o)},o.fadeDelay)}function stopFading(o){o.shouldFade=!1,o.imgGroup&&n.setElementOpacity(o.imgGroup,1,!0)}function inTo(o,r){!o.element.disabled&&(r>=n.ButtonState.GROUP&&o.currentState==n.ButtonState.REST&&(stopFading(o),o.currentState=n.ButtonState.GROUP),r>=n.ButtonState.HOVER&&o.currentState==n.ButtonState.GROUP&&(o.imgHover&&(o.imgHover.style.visibility=""),o.currentState=n.ButtonState.HOVER),r>=n.ButtonState.DOWN&&o.currentState==n.ButtonState.HOVER&&(o.imgDown&&(o.imgDown.style.visibility=""),o.currentState=n.ButtonState.DOWN))}function outTo(o,r){!o.element.disabled&&(r<=n.ButtonState.HOVER&&o.currentState==n.ButtonState.DOWN&&(o.imgDown&&(o.imgDown.style.visibility="hidden"),o.currentState=n.ButtonState.HOVER),r<=n.ButtonState.GROUP&&o.currentState==n.ButtonState.HOVER&&(o.imgHover&&(o.imgHover.style.visibility="hidden"),o.currentState=n.ButtonState.GROUP),r<=n.ButtonState.REST&&o.currentState==n.ButtonState.GROUP&&(beginFading(o),o.currentState=n.ButtonState.REST))}n.ButtonState={REST:0,GROUP:1,HOVER:2,DOWN:3},n.Button=function(o){var r=this;n.EventSource.call(this),n.extend(!0,this,{tooltip:null,srcRest:null,srcGroup:null,srcHover:null,srcDown:null,clickTimeThreshold:n.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:n.DEFAULT_SETTINGS.clickDistThreshold,fadeDelay:0,fadeLength:2e3,onPress:null,onRelease:null,onClick:null,onEnter:null,onExit:null,onFocus:null,onBlur:null},o),this.element=o.element||n.makeNeutralElement("div"),o.element||(this.imgRest=n.makeTransparentImage(this.srcRest),this.imgGroup=n.makeTransparentImage(this.srcGroup),this.imgHover=n.makeTransparentImage(this.srcHover),this.imgDown=n.makeTransparentImage(this.srcDown),this.imgRest.alt=this.imgGroup.alt=this.imgHover.alt=this.imgDown.alt=this.tooltip,this.element.style.position="relative",n.setElementTouchActionNone(this.element),this.imgGroup.style.position=this.imgHover.style.position=this.imgDown.style.position="absolute",this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top="0px",this.imgGroup.style.left=this.imgHover.style.left=this.imgDown.style.left="0px",this.imgHover.style.visibility=this.imgDown.style.visibility="hidden",n.Browser.vendor==n.BROWSERS.FIREFOX&&n.Browser.version<3&&(this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top=""),this.element.appendChild(this.imgRest),this.element.appendChild(this.imgGroup),this.element.appendChild(this.imgHover),this.element.appendChild(this.imgDown)),this.addHandler("press",this.onPress),this.addHandler("release",this.onRelease),this.addHandler("click",this.onClick),this.addHandler("enter",this.onEnter),this.addHandler("exit",this.onExit),this.addHandler("focus",this.onFocus),this.addHandler("blur",this.onBlur),this.currentState=n.ButtonState.GROUP,this.fadeBeginTime=null,this.shouldFade=!1,this.element.style.display="inline-block",this.element.style.position="relative",this.element.title=this.tooltip,this.tracker=new n.MouseTracker({element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(o){o.insideElementPressed?(inTo(r,n.ButtonState.DOWN),r.raiseEvent("enter",{originalEvent:o.originalEvent})):o.buttonDownAny||inTo(r,n.ButtonState.HOVER)},focusHandler:function(n){this.enterHandler(n),r.raiseEvent("focus",{originalEvent:n.originalEvent})},exitHandler:function(o){outTo(r,n.ButtonState.GROUP),o.insideElementPressed&&r.raiseEvent("exit",{originalEvent:o.originalEvent})},blurHandler:function(n){this.exitHandler(n),r.raiseEvent("blur",{originalEvent:n.originalEvent})},pressHandler:function(o){inTo(r,n.ButtonState.DOWN),r.raiseEvent("press",{originalEvent:o.originalEvent})},releaseHandler:function(o){o.insideElementPressed&&o.insideElementReleased?(outTo(r,n.ButtonState.HOVER),r.raiseEvent("release",{originalEvent:o.originalEvent})):o.insideElementPressed?outTo(r,n.ButtonState.GROUP):inTo(r,n.ButtonState.HOVER)},clickHandler:function(n){n.quick&&r.raiseEvent("click",{originalEvent:n.originalEvent})},keyHandler:function(n){return 13!==n.keyCode||(r.raiseEvent("click",{originalEvent:n.originalEvent}),r.raiseEvent("release",{originalEvent:n.originalEvent}),!1)}}),outTo(this,n.ButtonState.REST)},n.extend(n.Button.prototype,n.EventSource.prototype,{notifyGroupEnter:function(){inTo(this,n.ButtonState.GROUP)},notifyGroupExit:function(){outTo(this,n.ButtonState.REST)},disable:function(){this.notifyGroupExit(),this.element.disabled=!0,n.setElementOpacity(this.element,.2,!0)},enable:function(){this.element.disabled=!1,n.setElementOpacity(this.element,1,!0),this.notifyGroupEnter()}})}(OpenSeadragon),function(n){n.ButtonGroup=function(o){n.extend(!0,this,{buttons:[],clickTimeThreshold:n.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:n.DEFAULT_SETTINGS.clickDistThreshold,labelText:""},o);var r,l=this.buttons.concat([]),h=this;if(this.element=o.element||n.makeNeutralElement("div"),!o.group)for(r=0,this.element.style.display="inline-block";r<l.length;r++)this.element.appendChild(l[r].element);n.setElementTouchActionNone(this.element),this.tracker=new n.MouseTracker({element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(n){var o;for(o=0;o<h.buttons.length;o++)h.buttons[o].notifyGroupEnter()},exitHandler:function(n){var o;if(!n.insideElementPressed)for(o=0;o<h.buttons.length;o++)h.buttons[o].notifyGroupExit()}})},n.ButtonGroup.prototype={emulateEnter:function(){this.tracker.enterHandler({eventSource:this.tracker})},emulateExit:function(){this.tracker.exitHandler({eventSource:this.tracker})}}}(OpenSeadragon),function(n){n.Rect=function(o,r,l,h,u){var p,g;this.x="number"==typeof o?o:0,this.y="number"==typeof r?r:0,this.width="number"==typeof l?l:0,this.height="number"==typeof h?h:0,this.degrees="number"==typeof u?u:0,this.degrees=n.positiveModulo(this.degrees,360),this.degrees>=270?(p=this.getTopRight(),this.x=p.x,this.y=p.y,g=this.height,this.height=this.width,this.width=g,this.degrees-=270):this.degrees>=180?(p=this.getBottomRight(),this.x=p.x,this.y=p.y,this.degrees-=180):this.degrees>=90&&(p=this.getBottomLeft(),this.x=p.x,this.y=p.y,g=this.height,this.height=this.width,this.width=g,this.degrees-=90)},n.Rect.fromSummits=function(o,r,l){var h=o.distanceTo(r),u=o.distanceTo(l),p=r.minus(o),g=Math.atan(p.y/p.x);return p.x<0?g+=Math.PI:p.y<0&&(g+=2*Math.PI),new n.Rect(o.x,o.y,h,u,g/Math.PI*180)},n.Rect.prototype={clone:function(){return new n.Rect(this.x,this.y,this.width,this.height,this.degrees)},getAspectRatio:function(){return this.width/this.height},getTopLeft:function(){return new n.Point(this.x,this.y)},getBottomRight:function(){return new n.Point(this.x+this.width,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getTopRight:function(){return new n.Point(this.x+this.width,this.y).rotate(this.degrees,this.getTopLeft())},getBottomLeft:function(){return new n.Point(this.x,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getCenter:function(){return new n.Point(this.x+this.width/2,this.y+this.height/2).rotate(this.degrees,this.getTopLeft())},getSize:function(){return new n.Point(this.width,this.height)},equals:function(o){return o instanceof n.Rect&&this.x===o.x&&this.y===o.y&&this.width===o.width&&this.height===o.height&&this.degrees===o.degrees},times:function(o){return new n.Rect(this.x*o,this.y*o,this.width*o,this.height*o,this.degrees)},translate:function(o){return new n.Rect(this.x+o.x,this.y+o.y,this.width,this.height,this.degrees)},union:function(o){var r=this.getBoundingBox(),l=o.getBoundingBox(),h=Math.min(r.x,l.x),u=Math.min(r.y,l.y),p=Math.max(r.x+r.width,l.x+l.width),g=Math.max(r.y+r.height,l.y+l.height);return new n.Rect(h,u,p-h,g-u)},intersection:function(o){var r=1e-10,l=[],h=this.getTopLeft();o.containsPoint(h,r)&&l.push(h);var u=this.getTopRight();o.containsPoint(u,r)&&l.push(u);var p=this.getBottomLeft();o.containsPoint(p,r)&&l.push(p);var g=this.getBottomRight();o.containsPoint(g,r)&&l.push(g);var m=o.getTopLeft();this.containsPoint(m,r)&&l.push(m);var v=o.getTopRight();this.containsPoint(v,r)&&l.push(v);var T=o.getBottomLeft();this.containsPoint(T,r)&&l.push(T);var S=o.getBottomRight();this.containsPoint(S,r)&&l.push(S);for(var P=this._getSegments(),E=o._getSegments(),C=0;C<P.length;C++)for(var R=P[C],O=0;O<E.length;O++){var I=E[O],M=getIntersection(R[0],R[1],I[0],I[1]);M&&l.push(M)}function getIntersection(o,l,h,u){var p=l.minus(o),g=u.minus(h),m=-g.x*p.y+p.x*g.y;if(0===m)return null;var v=(p.x*(o.y-h.y)-p.y*(o.x-h.x))/m,T=(g.x*(o.y-h.y)-g.y*(o.x-h.x))/m;return-r<=v&&v<=1-r&&-r<=T&&T<=1-r?new n.Point(o.x+T*p.x,o.y+T*p.y):null}if(0===l.length)return null;for(var D=l[0].x,B=l[0].x,F=l[0].y,H=l[0].y,L=1;L<l.length;L++){var A=l[L];A.x<D&&(D=A.x),A.x>B&&(B=A.x),A.y<F&&(F=A.y),A.y>H&&(H=A.y)}return new n.Rect(D,F,B-D,H-F)},_getSegments:function(){var n=this.getTopLeft(),o=this.getTopRight(),r=this.getBottomLeft(),l=this.getBottomRight();return[[n,o],[o,l],[l,r],[r,n]]},rotate:function(o,r){if(0===(o=n.positiveModulo(o,360)))return this.clone();r=r||this.getCenter();var l=this.getTopLeft().rotate(o,r),h=this.getTopRight().rotate(o,r).minus(l),u=Math.atan((h=h.apply(function(n){return 1e-15>Math.abs(n)?0:n})).y/h.x);return h.x<0?u+=Math.PI:h.y<0&&(u+=2*Math.PI),new n.Rect(l.x,l.y,this.width,this.height,u/Math.PI*180)},getBoundingBox:function(){if(0===this.degrees)return this.clone();var o=this.getTopLeft(),r=this.getTopRight(),l=this.getBottomLeft(),h=this.getBottomRight(),u=Math.min(o.x,r.x,l.x,h.x),p=Math.max(o.x,r.x,l.x,h.x),g=Math.min(o.y,r.y,l.y,h.y),m=Math.max(o.y,r.y,l.y,h.y);return new n.Rect(u,g,p-u,m-g)},getIntegerBoundingBox:function(){var o=this.getBoundingBox(),r=Math.floor(o.x),l=Math.floor(o.y),h=Math.ceil(o.width+o.x-r),u=Math.ceil(o.height+o.y-l);return new n.Rect(r,l,h,u)},containsPoint:function(n,o){o=o||0;var r=this.getTopLeft(),l=this.getTopRight(),h=this.getBottomLeft(),u=l.minus(r),p=h.minus(r);return(n.x-r.x)*u.x+(n.y-r.y)*u.y>=-o&&(n.x-l.x)*u.x+(n.y-l.y)*u.y<=o&&(n.x-r.x)*p.x+(n.y-r.y)*p.y>=-o&&(n.x-h.x)*p.x+(n.y-h.y)*p.y<=o},toString:function(){return"["+Math.round(100*this.x)/100+", "+Math.round(100*this.y)/100+", "+Math.round(100*this.width)/100+"x"+Math.round(100*this.height)/100+", "+Math.round(100*this.degrees)/100+"deg]"}}}(OpenSeadragon),function(n){var o={};function onStripDrag(o){var r=Number(this.element.style.marginLeft.replace("px","")),l=Number(this.element.style.marginTop.replace("px","")),h=Number(this.element.style.width.replace("px","")),u=Number(this.element.style.height.replace("px","")),p=n.getElementSize(this.viewer.canvas);return this.dragging=!0,this.element&&("horizontal"==this.scroll?-o.delta.x>0?r>-(h-p.x)&&(this.element.style.marginLeft=r+2*o.delta.x+"px",loadPanels(this,p.x,r+2*o.delta.x)):0>-o.delta.x&&r<0&&(this.element.style.marginLeft=r+2*o.delta.x+"px",loadPanels(this,p.x,r+2*o.delta.x)):-o.delta.y>0?l>-(u-p.y)&&(this.element.style.marginTop=l+2*o.delta.y+"px",loadPanels(this,p.y,l+2*o.delta.y)):0>-o.delta.y&&l<0&&(this.element.style.marginTop=l+2*o.delta.y+"px",loadPanels(this,p.y,l+2*o.delta.y))),!1}function onStripScroll(o){var r=Number(this.element.style.marginLeft.replace("px","")),l=Number(this.element.style.marginTop.replace("px","")),h=Number(this.element.style.width.replace("px","")),u=Number(this.element.style.height.replace("px","")),p=n.getElementSize(this.viewer.canvas);return this.element&&("horizontal"==this.scroll?o.scroll>0?r>-(h-p.x)&&(this.element.style.marginLeft=r-60*o.scroll+"px",loadPanels(this,p.x,r-60*o.scroll)):o.scroll<0&&r<0&&(this.element.style.marginLeft=r-60*o.scroll+"px",loadPanels(this,p.x,r-60*o.scroll)):o.scroll<0?l>p.y-u&&(this.element.style.marginTop=l+60*o.scroll+"px",loadPanels(this,p.y,l+60*o.scroll)):o.scroll>0&&l<0&&(this.element.style.marginTop=l+60*o.scroll+"px",loadPanels(this,p.y,l+60*o.scroll))),!1}function loadPanels(o,r,l){var h,u,p,g,m,v,T;for(u=Math.ceil(r/(h="horizontal"==o.scroll?o.panelWidth:o.panelHeight))+5,v=u=(u=(p=Math.ceil((Math.abs(l)+r)/h)+1)-u)<0?0:u;v<p&&v<o.panels.length;v++)if(!(T=o.panels[v]).activePanel){var S,P=o.viewer.tileSources[v];S=P.referenceStripThumbnailUrl?{type:"image",url:P.referenceStripThumbnailUrl}:P,(g=new n.Viewer({id:T.id,tileSources:[S],element:T,navigatorSizeRatio:o.sizeRatio,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,loadTilesWithAjax:o.viewer.loadTilesWithAjax,ajaxHeaders:o.viewer.ajaxHeaders,useCanvas:o.useCanvas})).displayRegion=n.makeNeutralElement("div"),g.displayRegion.id=T.id+"-displayregion",g.displayRegion.className="displayregion",(m=g.displayRegion.style).position="relative",m.top="0px",m.left="0px",m.fontSize="0px",m.overflow="hidden",m.float="left",m.cssFloat="left",m.styleFloat="left",m.zIndex=999999999,m.cursor="default",m.width=o.panelWidth-4+"px",m.height=o.panelHeight-4+"px",g.displayRegion.innerTracker=new n.MouseTracker({element:g.displayRegion,startDisabled:!0}),T.getElementsByTagName("div")[0].appendChild(g.displayRegion),o.miniViewers[T.id]=g,T.activePanel=!0}}function onStripEnter(n){var o=n.eventSource.element;return"horizontal"==this.scroll?o.style.marginBottom="0px":o.style.marginLeft="0px",!1}function onStripExit(o){var r=o.eventSource.element;return"horizontal"==this.scroll?r.style.marginBottom="-"+n.getElementSize(r).y/2+"px":r.style.marginLeft="-"+n.getElementSize(r).x/2+"px",!1}function onKeyDown(n){if(n.preventDefaultAction||n.ctrl||n.alt||n.meta)return!0;switch(n.keyCode){case 38:case 39:return onStripScroll.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 40:case 37:return onStripScroll.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;default:return!0}}function onKeyPress(n){if(n.preventDefaultAction||n.ctrl||n.alt||n.meta)return!0;switch(n.keyCode){case 61:case 48:case 119:case 87:case 100:return onStripScroll.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 45:case 115:case 83:case 97:return onStripScroll.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;default:return!0}}n.ReferenceStrip=function(r){var l,h,u,p=this,g=r.viewer,m=n.getElementSize(g.element);for(r.id||(r.id="referencestrip-"+n.now(),this.element=n.makeNeutralElement("div"),this.element.id=r.id,this.element.className="referencestrip"),r=n.extend(!0,{sizeRatio:n.DEFAULT_SETTINGS.referenceStripSizeRatio,position:n.DEFAULT_SETTINGS.referenceStripPosition,scroll:n.DEFAULT_SETTINGS.referenceStripScroll,clickTimeThreshold:n.DEFAULT_SETTINGS.clickTimeThreshold},r,{element:this.element,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1}),n.extend(this,r),o[this.id]={animating:!1},this.minPixelRatio=this.viewer.minPixelRatio,(h=this.element.style).marginTop="0px",h.marginRight="0px",h.marginBottom="0px",h.marginLeft="0px",h.left="0px",h.bottom="0px",h.border="0px",h.background="#000",h.position="relative",n.setElementTouchActionNone(this.element),n.setElementOpacity(this.element,.8),this.viewer=g,this.innerTracker=new n.MouseTracker({element:this.element,dragHandler:n.delegate(this,onStripDrag),scrollHandler:n.delegate(this,onStripScroll),enterHandler:n.delegate(this,onStripEnter),exitHandler:n.delegate(this,onStripExit),keyDownHandler:n.delegate(this,onKeyDown),keyHandler:n.delegate(this,onKeyPress)}),r.width&&r.height?(this.element.style.width=r.width+"px",this.element.style.height=r.height+"px",g.addControl(this.element,{anchor:n.ControlAnchor.BOTTOM_LEFT})):"horizontal"==r.scroll?(this.element.style.width=m.x*r.sizeRatio*g.tileSources.length+12*g.tileSources.length+"px",this.element.style.height=m.y*r.sizeRatio+"px",g.addControl(this.element,{anchor:n.ControlAnchor.BOTTOM_LEFT})):(this.element.style.height=m.y*r.sizeRatio*g.tileSources.length+12*g.tileSources.length+"px",this.element.style.width=m.x*r.sizeRatio+"px",g.addControl(this.element,{anchor:n.ControlAnchor.TOP_LEFT})),this.panelWidth=m.x*this.sizeRatio+8,this.panelHeight=m.y*this.sizeRatio+8,this.panels=[],this.miniViewers={},u=0;u<g.tileSources.length;u++)(l=n.makeNeutralElement("div")).id=this.element.id+"-"+u,l.style.width=p.panelWidth+"px",l.style.height=p.panelHeight+"px",l.style.display="inline",l.style.float="left",l.style.cssFloat="left",l.style.styleFloat="left",l.style.padding="2px",n.setElementTouchActionNone(l),l.innerTracker=new n.MouseTracker({element:l,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,pressHandler:function(o){o.eventSource.dragging=n.now()},releaseHandler:function(o){var r=o.eventSource,l=Number(r.element.id.split("-")[2]),h=n.now();o.insideElementPressed&&o.insideElementReleased&&r.dragging&&h-r.dragging<r.clickTimeThreshold&&(r.dragging=null,g.goToPage(l))}}),this.element.appendChild(l),l.activePanel=!1,this.panels.push(l);loadPanels(this,"vertical"==this.scroll?m.y:m.x,0),this.setFocus(0)},n.extend(n.ReferenceStrip.prototype,n.EventSource.prototype,n.Viewer.prototype,{setFocus:function(o){var r,l=this.element.querySelector("#"+this.element.id+"-"+o),h=n.getElementSize(this.viewer.canvas),u=Number(this.element.style.width.replace("px","")),p=Number(this.element.style.height.replace("px","")),g=-Number(this.element.style.marginLeft.replace("px","")),m=-Number(this.element.style.marginTop.replace("px",""));this.currentSelected!==l&&(this.currentSelected&&(this.currentSelected.style.background="#000"),this.currentSelected=l,this.currentSelected.style.background="#999","horizontal"==this.scroll?(r=Number(o)*(this.panelWidth+3))>g+h.x-this.panelWidth?(r=Math.min(r,u-h.x),this.element.style.marginLeft=-r+"px",loadPanels(this,h.x,-r)):r<g&&(r=Math.max(0,r-h.x/2),this.element.style.marginLeft=-r+"px",loadPanels(this,h.x,-r)):(r=Number(o)*(this.panelHeight+3))>m+h.y-this.panelHeight?(r=Math.min(r,p-h.y),this.element.style.marginTop=-r+"px",loadPanels(this,h.y,-r)):r<m&&(r=Math.max(0,r-h.y/2),this.element.style.marginTop=-r+"px",loadPanels(this,h.y,-r)),this.currentPage=o,onStripEnter.call(this,{eventSource:this.innerTracker}))},update:function(){return!!o[this.id].animating&&(n.console.log("image reference strip update"),!0)},destroy:function(){if(this.miniViewers)for(var n in this.miniViewers)this.miniViewers[n].destroy();this.element&&this.element.parentNode.removeChild(this.element)}})}(OpenSeadragon),function(n){n.DisplayRect=function(o,r,l,h,u,p){n.Rect.apply(this,[o,r,l,h]),this.minLevel=u,this.maxLevel=p},n.extend(n.DisplayRect.prototype,n.Rect.prototype)}(OpenSeadragon),function(n){function transform(n,o){return(1-Math.exp(-(n*o)))/(1-Math.exp(-n))}n.Spring=function(o){var r=arguments;"object"!=typeof o&&(o={initial:r.length&&"number"==typeof r[0]?r[0]:void 0,springStiffness:r.length>1?r[1].springStiffness:5,animationTime:r.length>1?r[1].animationTime:1.5}),n.console.assert("number"==typeof o.springStiffness&&0!==o.springStiffness,"[OpenSeadragon.Spring] options.springStiffness must be a non-zero number"),n.console.assert("number"==typeof o.animationTime&&o.animationTime>=0,"[OpenSeadragon.Spring] options.animationTime must be a number greater than or equal to 0"),o.exponential&&(this._exponential=!0,delete o.exponential),n.extend(!0,this,o),this.current={value:"number"==typeof this.initial?this.initial:this._exponential?0:1,time:n.now()},n.console.assert(!this._exponential||0!==this.current.value,"[OpenSeadragon.Spring] value must be non-zero for exponential springs"),this.start={value:this.current.value,time:this.current.time},this.target={value:this.current.value,time:this.current.time},this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},n.Spring.prototype={resetTo:function(o){n.console.assert(!this._exponential||0!==o,"[OpenSeadragon.Spring.resetTo] target must be non-zero for exponential springs"),this.start.value=this.target.value=this.current.value=o,this.start.time=this.target.time=this.current.time=n.now(),this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},springTo:function(o){n.console.assert(!this._exponential||0!==o,"[OpenSeadragon.Spring.springTo] target must be non-zero for exponential springs"),this.start.value=this.current.value,this.start.time=this.current.time,this.target.value=o,this.target.time=this.start.time+1e3*this.animationTime,this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},shiftBy:function(o){this.start.value+=o,this.target.value+=o,this._exponential&&(n.console.assert(0!==this.target.value&&0!==this.start.value,"[OpenSeadragon.Spring.shiftBy] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},setExponential:function(o){this._exponential=o,this._exponential&&(n.console.assert(0!==this.current.value&&0!==this.target.value&&0!==this.start.value,"[OpenSeadragon.Spring.setExponential] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},update:function(){this.current.time=n.now(),this._exponential?(o=this.start._logValue,r=this.target._logValue):(o=this.start.value,r=this.target.value);var o,r,l=this.current.time>=this.target.time?r:o+(r-o)*transform(this.springStiffness,(this.current.time-this.start.time)/(this.target.time-this.start.time)),h=this.current.value;return this._exponential?this.current.value=Math.exp(l):this.current.value=l,h!=this.current.value},isAtTargetValue:function(){return this.current.value===this.target.value}}}(OpenSeadragon),function(n){function ImageJob(o){n.extend(!0,this,{timeout:n.DEFAULT_SETTINGS.timeout,jobId:null},o),this.image=null}function completeJob(n,o,r){n.jobsInProgress--,(!n.jobLimit||n.jobsInProgress<n.jobLimit)&&n.jobQueue.length>0&&(n.jobQueue.shift().start(),n.jobsInProgress++),r(o.image,o.errorMsg,o.request)}ImageJob.prototype={errorMsg:null,start:function(){var o=this,r=this.abort;this.image=new Image,this.image.onload=function(){o.finish(!0)},this.image.onabort=this.image.onerror=function(){o.errorMsg="Image load aborted",o.finish(!1)},this.jobId=window.setTimeout(function(){o.errorMsg="Image load exceeded timeout ("+o.timeout+" ms)",o.finish(!1)},this.timeout),this.loadWithAjax?(this.request=n.makeAjaxRequest({url:this.src,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,responseType:"arraybuffer",success:function(n){try{r=new window.Blob([n.response])}catch(o){var r,l=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;if("TypeError"===o.name&&l){var h=new l;h.append(n.response),r=h.getBlob()}}0===r.size&&(o.errorMsg="Empty image response.",o.finish(!1));var u=(window.URL||window.webkitURL).createObjectURL(r);o.image.src=u},error:function(n){o.errorMsg="Image load aborted - XHR error",o.finish(!1)}}),this.abort=function(){o.request.abort(),"function"==typeof r&&r()}):(!1!==this.crossOriginPolicy&&(this.image.crossOrigin=this.crossOriginPolicy),this.image.src=this.src)},finish:function(n){this.image.onload=this.image.onerror=this.image.onabort=null,n||(this.image=null),this.jobId&&window.clearTimeout(this.jobId),this.callback(this)}},n.ImageLoader=function(o){n.extend(!0,this,{jobLimit:n.DEFAULT_SETTINGS.imageLoaderLimit,timeout:n.DEFAULT_SETTINGS.timeout,jobQueue:[],jobsInProgress:0},o)},n.ImageLoader.prototype={addJob:function(n){var o=this,complete=function(r){completeJob(o,r,n.callback)},r={src:n.src,loadWithAjax:n.loadWithAjax,ajaxHeaders:n.loadWithAjax?n.ajaxHeaders:null,crossOriginPolicy:n.crossOriginPolicy,ajaxWithCredentials:n.ajaxWithCredentials,callback:complete,abort:n.abort,timeout:this.timeout},l=new ImageJob(r);!this.jobLimit||this.jobsInProgress<this.jobLimit?(l.start(),this.jobsInProgress++):this.jobQueue.push(l)},clear:function(){for(var n=0;n<this.jobQueue.length;n++){var o=this.jobQueue[n];"function"==typeof o.abort&&o.abort()}this.jobQueue=[]}}}(OpenSeadragon),function(n){n.Tile=function(n,o,r,l,h,u,p,g,m,v){this.level=n,this.x=o,this.y=r,this.bounds=l,this.sourceBounds=v,this.exists=h,this.url=u,this.context2D=p,this.loadWithAjax=g,this.ajaxHeaders=m,this.ajaxHeaders?this.cacheKey=this.url+"+"+JSON.stringify(this.ajaxHeaders):this.cacheKey=this.url,this.loaded=!1,this.loading=!1,this.element=null,this.imgElement=null,this.image=null,this.style=null,this.position=null,this.size=null,this.blendStart=null,this.opacity=null,this.squaredDistance=null,this.visibility=null,this.beingDrawn=!1,this.lastTouchTime=0,this.isRightMost=!1,this.isBottomMost=!1},n.Tile.prototype={toString:function(){return this.level+"/"+this.x+"_"+this.y},_hasTransparencyChannel:function(){return!!this.context2D||this.url.match(".png")},drawHTML:function(o){if(!this.cacheImageRecord){n.console.warn("[Tile.drawHTML] attempting to draw tile %s when it's not cached",this.toString());return}if(!this.loaded){n.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString());return}this.element||(this.element=n.makeNeutralElement("div"),this.imgElement=this.cacheImageRecord.getImage().cloneNode(),this.imgElement.style.msInterpolationMode="nearest-neighbor",this.imgElement.style.width="100%",this.imgElement.style.height="100%",this.style=this.element.style,this.style.position="absolute"),this.element.parentNode!=o&&o.appendChild(this.element),this.imgElement.parentNode!=this.element&&this.element.appendChild(this.imgElement),this.style.top=this.position.y+"px",this.style.left=this.position.x+"px",this.style.height=this.size.y+"px",this.style.width=this.size.x+"px",n.setElementOpacity(this.element,this.opacity)},drawCanvas:function(o,r,l,h){var u,p,g,m=this.position.times(n.pixelDensityRatio),v=this.size.times(n.pixelDensityRatio);if(!this.context2D&&!this.cacheImageRecord){n.console.warn("[Tile.drawCanvas] attempting to draw tile %s when it's not cached",this.toString());return}if(g=this.context2D||this.cacheImageRecord.getRenderedContext(),!this.loaded||!g){n.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString());return}o.save(),o.globalAlpha=this.opacity,"number"==typeof l&&1!==l&&(m=m.times(l),v=v.times(l)),h instanceof n.Point&&(m=m.plus(h)),1===o.globalAlpha&&this._hasTransparencyChannel()&&o.clearRect(m.x,m.y,v.x,v.y),r({context:o,tile:this,rendered:g}),this.sourceBounds?(u=Math.min(this.sourceBounds.width,g.canvas.width),p=Math.min(this.sourceBounds.height,g.canvas.height)):(u=g.canvas.width,p=g.canvas.height),o.drawImage(g.canvas,0,0,u,p,m.x,m.y,v.x,v.y),o.restore()},getScaleForEdgeSmoothing:function(){var o;if(this.cacheImageRecord)o=this.cacheImageRecord.getRenderedContext();else{if(!this.context2D)return n.console.warn("[Tile.drawCanvas] attempting to get tile scale %s when tile's not cached",this.toString()),1;o=this.context2D}return o.canvas.width/(this.size.x*n.pixelDensityRatio)},getTranslationForEdgeSmoothing:function(o,r,l){var h=Math.max(1,Math.ceil((l.x-r.x)/2)),u=Math.max(1,Math.ceil((l.y-r.y)/2));return new n.Point(h,u).minus(this.position.times(n.pixelDensityRatio).times(o||1).apply(function(n){return n%1}))},unload:function(){this.imgElement&&this.imgElement.parentNode&&this.imgElement.parentNode.removeChild(this.imgElement),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=null,this.imgElement=null,this.loaded=!1,this.loading=!1}}}(OpenSeadragon),function(n){n.OverlayPlacement=n.Placement,n.OverlayRotationMode=n.freezeObject({NO_ROTATION:1,EXACT:2,BOUNDING_BOX:3}),n.Overlay=function(o,r,l){var h;h=n.isPlainObject(o)?o:{element:o,location:r,placement:l},this.element=h.element,this.style=h.element.style,this._init(h)},n.Overlay.prototype={_init:function(o){this.location=o.location,this.placement=void 0===o.placement?n.Placement.TOP_LEFT:o.placement,this.onDraw=o.onDraw,this.checkResize=void 0===o.checkResize||o.checkResize,this.width=void 0===o.width?null:o.width,this.height=void 0===o.height?null:o.height,this.rotationMode=o.rotationMode||n.OverlayRotationMode.EXACT,this.location instanceof n.Rect&&(this.width=this.location.width,this.height=this.location.height,this.location=this.location.getTopLeft(),this.placement=n.Placement.TOP_LEFT),this.scales=null!==this.width&&null!==this.height,this.bounds=new n.Rect(this.location.x,this.location.y,this.width,this.height),this.position=this.location},adjust:function(o,r){var l=n.Placement.properties[this.placement];l&&(l.isHorizontallyCentered?o.x-=r.x/2:l.isRight&&(o.x-=r.x),l.isVerticallyCentered?o.y-=r.y/2:l.isBottom&&(o.y-=r.y))},destroy:function(){var o=this.element,r=this.style;o.parentNode&&(o.parentNode.removeChild(o),o.prevElementParent&&(r.display="none",document.body.appendChild(o))),this.onDraw=null,r.top="",r.left="",r.position="",null!==this.width&&(r.width=""),null!==this.height&&(r.height="");var l=n.getCssPropertyWithVendorPrefix("transformOrigin"),h=n.getCssPropertyWithVendorPrefix("transform");l&&h&&(r[l]="",r[h]="")},drawHTML:function(o,r){var l=this.element;l.parentNode!==o&&(l.prevElementParent=l.parentNode,l.prevNextSibling=l.nextSibling,o.appendChild(l),this.style.position="absolute",this.size=n.getElementSize(l));var h=this._getOverlayPositionAndSize(r),u=h.position,p=this.size=h.size,g=h.rotate;if(this.onDraw)this.onDraw(u,p,this.element);else{var m=this.style;m.left=u.x+"px",m.top=u.y+"px",null!==this.width&&(m.width=p.x+"px"),null!==this.height&&(m.height=p.y+"px");var v=n.getCssPropertyWithVendorPrefix("transformOrigin"),T=n.getCssPropertyWithVendorPrefix("transform");v&&T&&(g?(m[v]=this._getTransformOrigin(),m[T]="rotate("+g+"deg)"):(m[v]="",m[T]="")),"none"!==m.display&&(m.display="block")}},_getOverlayPositionAndSize:function(o){var r=o.pixelFromPoint(this.location,!0),l=this._getSizeInPixels(o);this.adjust(r,l);var h=0;if(o.degrees&&this.rotationMode!==n.OverlayRotationMode.NO_ROTATION){if(this.rotationMode===n.OverlayRotationMode.BOUNDING_BOX&&null!==this.width&&null!==this.height){var u=new n.Rect(r.x,r.y,l.x,l.y),p=this._getBoundingBox(u,o.degrees);r=p.getTopLeft(),l=p.getSize()}else h=o.degrees}return{position:r,size:l,rotate:h}},_getSizeInPixels:function(o){var r=this.size.x,l=this.size.y;if(null!==this.width||null!==this.height){var h=o.deltaPixelsFromPointsNoRotate(new n.Point(this.width||0,this.height||0),!0);null!==this.width&&(r=h.x),null!==this.height&&(l=h.y)}if(this.checkResize&&(null===this.width||null===this.height)){var u=this.size=n.getElementSize(this.element);null===this.width&&(r=u.x),null===this.height&&(l=u.y)}return new n.Point(r,l)},_getBoundingBox:function(n,o){var r=this._getPlacementPoint(n);return n.rotate(o,r).getBoundingBox()},_getPlacementPoint:function(o){var r=new n.Point(o.x,o.y),l=n.Placement.properties[this.placement];return l&&(l.isHorizontallyCentered?r.x+=o.width/2:l.isRight&&(r.x+=o.width),l.isVerticallyCentered?r.y+=o.height/2:l.isBottom&&(r.y+=o.height)),r},_getTransformOrigin:function(){var o="",r=n.Placement.properties[this.placement];return r&&(r.isLeft?o="left":r.isRight&&(o="right"),r.isTop?o+=" top":r.isBottom&&(o+=" bottom")),o},update:function(o,r){var l=n.isPlainObject(o)?o:{location:o,placement:r};this._init({location:l.location||this.location,placement:void 0!==l.placement?l.placement:this.placement,onDraw:l.onDraw||this.onDraw,checkResize:l.checkResize||this.checkResize,width:void 0!==l.width?l.width:this.width,height:void 0!==l.height?l.height:this.height,rotationMode:l.rotationMode||this.rotationMode})},getBounds:function(o){n.console.assert(o,"A viewport must now be passed to Overlay.getBounds.");var r=this.width,l=this.height;if(null===r||null===l){var h=o.deltaPointsFromPixelsNoRotate(this.size,!0);null===r&&(r=h.x),null===l&&(l=h.y)}var u=this.location.clone();return this.adjust(u,new n.Point(r,l)),this._adjustBoundsForRotation(o,new n.Rect(u.x,u.y,r,l))},_adjustBoundsForRotation:function(o,r){if(!o||0===o.degrees||this.rotationMode===n.OverlayRotationMode.EXACT)return r;if(this.rotationMode===n.OverlayRotationMode.BOUNDING_BOX){if(null===this.width||null===this.height)return r;var l=this._getOverlayPositionAndSize(o);return o.viewerElementToViewportRectangle(new n.Rect(l.position.x,l.position.y,l.size.x,l.size.y))}return r.rotate(-o.degrees,this._getPlacementPoint(r))}}}(OpenSeadragon),function(n){n.Drawer=function(o){n.console.assert(o.viewer,"[Drawer] options.viewer is required");var r=arguments;if(n.isPlainObject(o)||(o={source:r[0],viewport:r[1],element:r[2]}),n.console.assert(o.viewport,"[Drawer] options.viewport is required"),n.console.assert(o.element,"[Drawer] options.element is required"),o.source&&n.console.error("[Drawer] options.source is no longer accepted; use TiledImage instead"),this.viewer=o.viewer,this.viewport=o.viewport,this.debugGridColor="string"==typeof o.debugGridColor?[o.debugGridColor]:o.debugGridColor||n.DEFAULT_SETTINGS.debugGridColor,o.opacity&&n.console.error("[Drawer] options.opacity is no longer accepted; set the opacity on the TiledImage instead"),this.useCanvas=n.supportsCanvas&&(!this.viewer||this.viewer.useCanvas),this.container=n.getElement(o.element),this.canvas=n.makeNeutralElement(this.useCanvas?"canvas":"div"),this.context=this.useCanvas?this.canvas.getContext("2d"):null,this.sketchCanvas=null,this.sketchContext=null,this.element=this.container,this.container.dir="ltr",this.useCanvas){var l=this._calculateCanvasSize();this.canvas.width=l.x,this.canvas.height=l.y}this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.position="absolute",n.setElementOpacity(this.canvas,this.opacity,!0),this.container.style.textAlign="left",this.container.appendChild(this.canvas),this._imageSmoothingEnabled=!0},n.Drawer.prototype={addOverlay:function(o,r,l,h){return n.console.error("drawer.addOverlay is deprecated. Use viewer.addOverlay instead."),this.viewer.addOverlay(o,r,l,h),this},updateOverlay:function(o,r,l){return n.console.error("drawer.updateOverlay is deprecated. Use viewer.updateOverlay instead."),this.viewer.updateOverlay(o,r,l),this},removeOverlay:function(o){return n.console.error("drawer.removeOverlay is deprecated. Use viewer.removeOverlay instead."),this.viewer.removeOverlay(o),this},clearOverlays:function(){return n.console.error("drawer.clearOverlays is deprecated. Use viewer.clearOverlays instead."),this.viewer.clearOverlays(),this},viewportCoordToDrawerCoord:function(o){var r=this.viewport.pixelFromPointNoRotate(o,!0);return new n.Point(r.x*n.pixelDensityRatio,r.y*n.pixelDensityRatio)},clipWithPolygons:function(n,o){if(this.useCanvas){var r=this._getContext(o);r.beginPath(),n.forEach(function(n){n.forEach(function(n,o){r[0===o?"moveTo":"lineTo"](n.x,n.y)})}),r.clip()}},setOpacity:function(o){n.console.error("drawer.setOpacity is deprecated. Use tiledImage.setOpacity instead.");for(var r=this.viewer.world,l=0;l<r.getItemCount();l++)r.getItemAt(l).setOpacity(o);return this},getOpacity:function(){n.console.error("drawer.getOpacity is deprecated. Use tiledImage.getOpacity instead.");for(var o=this.viewer.world,r=0,l=0;l<o.getItemCount();l++){var h=o.getItemAt(l).getOpacity();h>r&&(r=h)}return r},needsUpdate:function(){return n.console.error("[Drawer.needsUpdate] this function is deprecated. Use World.needsDraw instead."),this.viewer.world.needsDraw()},numTilesLoaded:function(){return n.console.error("[Drawer.numTilesLoaded] this function is deprecated. Use TileCache.numTilesLoaded instead."),this.viewer.tileCache.numTilesLoaded()},reset:function(){return n.console.error("[Drawer.reset] this function is deprecated. Use World.resetItems instead."),this.viewer.world.resetItems(),this},update:function(){return n.console.error("[Drawer.update] this function is deprecated. Use Drawer.clear and World.draw instead."),this.clear(),this.viewer.world.draw(),this},canRotate:function(){return this.useCanvas},destroy:function(){this.canvas.width=1,this.canvas.height=1,this.sketchCanvas=null,this.sketchContext=null},clear:function(){if(this.canvas.innerHTML="",this.useCanvas){var n=this._calculateCanvasSize();if((this.canvas.width!=n.x||this.canvas.height!=n.y)&&(this.canvas.width=n.x,this.canvas.height=n.y,this._updateImageSmoothingEnabled(this.context),null!==this.sketchCanvas)){var o=this._calculateSketchCanvasSize();this.sketchCanvas.width=o.x,this.sketchCanvas.height=o.y,this._updateImageSmoothingEnabled(this.sketchContext)}this._clear()}},_clear:function(n,o){if(this.useCanvas){var r=this._getContext(n);if(o)r.clearRect(o.x,o.y,o.width,o.height);else{var l=r.canvas;r.clearRect(0,0,l.width,l.height)}}},viewportToDrawerRectangle:function(o){var r=this.viewport.pixelFromPointNoRotate(o.getTopLeft(),!0),l=this.viewport.deltaPixelsFromPointsNoRotate(o.getSize(),!0);return new n.Rect(r.x*n.pixelDensityRatio,r.y*n.pixelDensityRatio,l.x*n.pixelDensityRatio,l.y*n.pixelDensityRatio)},drawTile:function(o,r,l,h,u){if(n.console.assert(o,"[Drawer.drawTile] tile is required"),n.console.assert(r,"[Drawer.drawTile] drawingHandler is required"),this.useCanvas){var p=this._getContext(l);h=h||1,o.drawCanvas(p,r,h,u)}else o.drawHTML(this.canvas)},_getContext:function(n){var o=this.context;if(n){if(null===this.sketchCanvas){this.sketchCanvas=document.createElement("canvas");var r=this._calculateSketchCanvasSize();if(this.sketchCanvas.width=r.x,this.sketchCanvas.height=r.y,this.sketchContext=this.sketchCanvas.getContext("2d"),0===this.viewport.getRotation()){var l=this;this.viewer.addHandler("rotate",function resizeSketchCanvas(){if(0!==l.viewport.getRotation()){l.viewer.removeHandler("rotate",resizeSketchCanvas);var n=l._calculateSketchCanvasSize();l.sketchCanvas.width=n.x,l.sketchCanvas.height=n.y}})}this._updateImageSmoothingEnabled(this.sketchContext)}o=this.sketchContext}return o},saveContext:function(n){this.useCanvas&&this._getContext(n).save()},restoreContext:function(n){this.useCanvas&&this._getContext(n).restore()},setClip:function(n,o){if(this.useCanvas){var r=this._getContext(o);r.beginPath(),r.rect(n.x,n.y,n.width,n.height),r.clip()}},drawRectangle:function(n,o,r){if(this.useCanvas){var l=this._getContext(r);l.save(),l.fillStyle=o,l.fillRect(n.x,n.y,n.width,n.height),l.restore()}},blendSketch:function(o,r,l,h){var u=o;if(n.isPlainObject(u)||(u={opacity:o,scale:r,translate:l,compositeOperation:h}),this.useCanvas&&this.sketchCanvas){o=u.opacity,h=u.compositeOperation;var p=u.bounds;if(this.context.save(),this.context.globalAlpha=o,h&&(this.context.globalCompositeOperation=h),p)p.x<0&&(p.width+=p.x,p.x=0),p.x+p.width>this.canvas.width&&(p.width=this.canvas.width-p.x),p.y<0&&(p.height+=p.y,p.y=0),p.y+p.height>this.canvas.height&&(p.height=this.canvas.height-p.y),this.context.drawImage(this.sketchCanvas,p.x,p.y,p.width,p.height,p.x,p.y,p.width,p.height);else{r=u.scale||1;var g=(l=u.translate)instanceof n.Point?l:new n.Point(0,0),m=0,v=0;if(l){var T=this.sketchCanvas.width-this.canvas.width,S=this.sketchCanvas.height-this.canvas.height;m=Math.round(T/2),v=Math.round(S/2)}this.context.drawImage(this.sketchCanvas,g.x-m*r,g.y-v*r,(this.canvas.width+2*m)*r,(this.canvas.height+2*v)*r,-m,-v,this.canvas.width+2*m,this.canvas.height+2*v)}this.context.restore()}},drawDebugInfo:function(o,r,l,h){if(this.useCanvas){var u=this.viewer.world.getIndexOfItem(h)%this.debugGridColor.length,p=this.context;p.save(),p.lineWidth=2*n.pixelDensityRatio,p.font="small-caps bold "+13*n.pixelDensityRatio+"px arial",p.strokeStyle=this.debugGridColor[u],p.fillStyle=this.debugGridColor[u],0!==this.viewport.degrees&&this._offsetForRotation({degrees:this.viewport.degrees}),h.getRotation(!0)%360!=0&&this._offsetForRotation({degrees:h.getRotation(!0),point:h.viewport.pixelFromPointNoRotate(h._getRotationPoint(!0),!0)}),0===h.viewport.degrees&&h.getRotation(!0)%360==0&&h._drawer.viewer.viewport.getFlip()&&h._drawer._flip(),p.strokeRect(o.position.x*n.pixelDensityRatio,o.position.y*n.pixelDensityRatio,o.size.x*n.pixelDensityRatio,o.size.y*n.pixelDensityRatio);var g=(o.position.x+o.size.x/2)*n.pixelDensityRatio,m=(o.position.y+o.size.y/2)*n.pixelDensityRatio;p.translate(g,m),p.rotate(-(Math.PI/180*this.viewport.degrees)),p.translate(-g,-m),0===o.x&&0===o.y&&(p.fillText("Zoom: "+this.viewport.getZoom(),o.position.x*n.pixelDensityRatio,(o.position.y-30)*n.pixelDensityRatio),p.fillText("Pan: "+this.viewport.getBounds().toString(),o.position.x*n.pixelDensityRatio,(o.position.y-20)*n.pixelDensityRatio)),p.fillText("Level: "+o.level,(o.position.x+10)*n.pixelDensityRatio,(o.position.y+20)*n.pixelDensityRatio),p.fillText("Column: "+o.x,(o.position.x+10)*n.pixelDensityRatio,(o.position.y+30)*n.pixelDensityRatio),p.fillText("Row: "+o.y,(o.position.x+10)*n.pixelDensityRatio,(o.position.y+40)*n.pixelDensityRatio),p.fillText("Order: "+l+" of "+r,(o.position.x+10)*n.pixelDensityRatio,(o.position.y+50)*n.pixelDensityRatio),p.fillText("Size: "+o.size.toString(),(o.position.x+10)*n.pixelDensityRatio,(o.position.y+60)*n.pixelDensityRatio),p.fillText("Position: "+o.position.toString(),(o.position.x+10)*n.pixelDensityRatio,(o.position.y+70)*n.pixelDensityRatio),0!==this.viewport.degrees&&this._restoreRotationChanges(),h.getRotation(!0)%360!=0&&this._restoreRotationChanges(),0===h.viewport.degrees&&h.getRotation(!0)%360==0&&h._drawer.viewer.viewport.getFlip()&&h._drawer._flip(),p.restore()}},debugRect:function(o){if(this.useCanvas){var r=this.context;r.save(),r.lineWidth=2*n.pixelDensityRatio,r.strokeStyle=this.debugGridColor[0],r.fillStyle=this.debugGridColor[0],r.strokeRect(o.x*n.pixelDensityRatio,o.y*n.pixelDensityRatio,o.width*n.pixelDensityRatio,o.height*n.pixelDensityRatio),r.restore()}},setImageSmoothingEnabled:function(n){this.useCanvas&&(this._imageSmoothingEnabled=n,this._updateImageSmoothingEnabled(this.context),this.viewer.forceRedraw())},_updateImageSmoothingEnabled:function(n){n.msImageSmoothingEnabled=this._imageSmoothingEnabled,n.imageSmoothingEnabled=this._imageSmoothingEnabled},getCanvasSize:function(o){var r=this._getContext(o).canvas;return new n.Point(r.width,r.height)},getCanvasCenter:function(){return new n.Point(this.canvas.width/2,this.canvas.height/2)},_offsetForRotation:function(o){var r=o.point?o.point.times(n.pixelDensityRatio):this.getCanvasCenter(),l=this._getContext(o.useSketch);l.save(),l.translate(r.x,r.y),this.viewer.viewport.flipped?(l.rotate(-(Math.PI/180*o.degrees)),l.scale(-1,1)):l.rotate(Math.PI/180*o.degrees),l.translate(-r.x,-r.y)},_flip:function(o){var r=(o=o||{}).point?o.point.times(n.pixelDensityRatio):this.getCanvasCenter(),l=this._getContext(o.useSketch);l.translate(r.x,0),l.scale(-1,1),l.translate(-r.x,0)},_restoreRotationChanges:function(n){this._getContext(n).restore()},_calculateCanvasSize:function(){var o=n.pixelDensityRatio,r=this.viewport.getContainerSize();return{x:Math.round(r.x*o),y:Math.round(r.y*o)}},_calculateSketchCanvasSize:function(){var n=this._calculateCanvasSize();if(0===this.viewport.getRotation())return n;var o=Math.ceil(Math.sqrt(n.x*n.x+n.y*n.y));return{x:o,y:o}}}}(OpenSeadragon),function(n){n.Viewport=function(o){var r=arguments;r.length&&r[0]instanceof n.Point&&(o={containerSize:r[0],contentSize:r[1],config:r[2]}),o.config&&(n.extend(!0,o,o.config),delete o.config),this._margins=n.extend({left:0,top:0,right:0,bottom:0},o.margins||{}),delete o.margins,n.extend(!0,this,{containerSize:null,contentSize:null,zoomPoint:null,viewer:null,springStiffness:n.DEFAULT_SETTINGS.springStiffness,animationTime:n.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:n.DEFAULT_SETTINGS.minZoomImageRatio,maxZoomPixelRatio:n.DEFAULT_SETTINGS.maxZoomPixelRatio,visibilityRatio:n.DEFAULT_SETTINGS.visibilityRatio,wrapHorizontal:n.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:n.DEFAULT_SETTINGS.wrapVertical,defaultZoomLevel:n.DEFAULT_SETTINGS.defaultZoomLevel,minZoomLevel:n.DEFAULT_SETTINGS.minZoomLevel,maxZoomLevel:n.DEFAULT_SETTINGS.maxZoomLevel,degrees:n.DEFAULT_SETTINGS.degrees,flipped:n.DEFAULT_SETTINGS.flipped,homeFillsViewer:n.DEFAULT_SETTINGS.homeFillsViewer},o),this._updateContainerInnerSize(),this.centerSpringX=new n.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.centerSpringY=new n.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.zoomSpring=new n.Spring({exponential:!0,initial:1,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,this._setContentBounds(new n.Rect(0,0,1,1),1),this.goHome(!0),this.update()},n.Viewport.prototype={resetContentSize:function(o){return n.console.assert(o,"[Viewport.resetContentSize] contentSize is required"),n.console.assert(o instanceof n.Point,"[Viewport.resetContentSize] contentSize must be an OpenSeadragon.Point"),n.console.assert(o.x>0,"[Viewport.resetContentSize] contentSize.x must be greater than 0"),n.console.assert(o.y>0,"[Viewport.resetContentSize] contentSize.y must be greater than 0"),this._setContentBounds(new n.Rect(0,0,1,o.y/o.x),o.x),this},setHomeBounds:function(o,r){n.console.error("[Viewport.setHomeBounds] this function is deprecated; The content bounds should not be set manually."),this._setContentBounds(o,r)},_setContentBounds:function(o,r){n.console.assert(o,"[Viewport._setContentBounds] bounds is required"),n.console.assert(o instanceof n.Rect,"[Viewport._setContentBounds] bounds must be an OpenSeadragon.Rect"),n.console.assert(o.width>0,"[Viewport._setContentBounds] bounds.width must be greater than 0"),n.console.assert(o.height>0,"[Viewport._setContentBounds] bounds.height must be greater than 0"),this._contentBoundsNoRotate=o.clone(),this._contentSizeNoRotate=this._contentBoundsNoRotate.getSize().times(r),this._contentBounds=o.rotate(this.degrees).getBoundingBox(),this._contentSize=this._contentBounds.getSize().times(r),this._contentAspectRatio=this._contentSize.x/this._contentSize.y,this.viewer&&this.viewer.raiseEvent("reset-size",{contentSize:this._contentSizeNoRotate.clone(),contentFactor:r,homeBounds:this._contentBoundsNoRotate.clone(),contentBounds:this._contentBounds.clone()})},getHomeZoom:function(){if(this.defaultZoomLevel)return this.defaultZoomLevel;var n,o=this._contentAspectRatio/this.getAspectRatio();return(n=this.homeFillsViewer?o>=1?o:1:o>=1?1:o)/this._contentBounds.width},getHomeBounds:function(){return this.getHomeBoundsNoRotate().rotate(-this.getRotation())},getHomeBoundsNoRotate:function(){var o=this._contentBounds.getCenter(),r=1/this.getHomeZoom(),l=r/this.getAspectRatio();return new n.Rect(o.x-r/2,o.y-l/2,r,l)},goHome:function(n){return this.viewer&&this.viewer.raiseEvent("home",{immediately:n}),this.fitBounds(this.getHomeBounds(),n)},getMinZoom:function(){var n=this.getHomeZoom();return this.minZoomLevel?this.minZoomLevel:this.minZoomImageRatio*n},getMaxZoom:function(){var n=this.maxZoomLevel;return n||(n=this._contentSize.x*this.maxZoomPixelRatio/this._containerInnerSize.x/this._contentBounds.width),Math.max(n,this.getHomeZoom())},getAspectRatio:function(){return this._containerInnerSize.x/this._containerInnerSize.y},getContainerSize:function(){return new n.Point(this.containerSize.x,this.containerSize.y)},getMargins:function(){return n.extend({},this._margins)},setMargins:function(o){n.console.assert("object"===n.type(o),"[Viewport.setMargins] margins must be an object"),this._margins=n.extend({left:0,top:0,right:0,bottom:0},o),this._updateContainerInnerSize(),this.viewer&&this.viewer.forceRedraw()},getBounds:function(n){return this.getBoundsNoRotate(n).rotate(-this.getRotation())},getBoundsNoRotate:function(o){var r=this.getCenter(o),l=1/this.getZoom(o),h=l/this.getAspectRatio();return new n.Rect(r.x-l/2,r.y-h/2,l,h)},getBoundsWithMargins:function(n){return this.getBoundsNoRotateWithMargins(n).rotate(-this.getRotation(),this.getCenter(n))},getBoundsNoRotateWithMargins:function(n){var o=this.getBoundsNoRotate(n),r=this._containerInnerSize.x*this.getZoom(n);return o.x-=this._margins.left/r,o.y-=this._margins.top/r,o.width+=(this._margins.left+this._margins.right)/r,o.height+=(this._margins.top+this._margins.bottom)/r,o},getCenter:function(o){var r,l,h,u,p,g,m=new n.Point(this.centerSpringX.current.value,this.centerSpringY.current.value),v=new n.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return o?m:this.zoomPoint?(r=this.pixelFromPoint(this.zoomPoint,!0),u=(h=1/(l=this.getZoom()))/this.getAspectRatio(),p=new n.Rect(m.x-h/2,m.y-u/2,h,u),g=this._pixelFromPoint(this.zoomPoint,p).minus(r).divide(this._containerInnerSize.x*l),v.plus(g)):v},getZoom:function(n){return n?this.zoomSpring.current.value:this.zoomSpring.target.value},_applyZoomConstraints:function(n){return Math.max(Math.min(n,this.getMaxZoom()),this.getMinZoom())},_applyBoundaryConstraints:function(o){var r=new n.Rect(o.x,o.y,o.width,o.height);if(this.wrapHorizontal);else{var l=this.visibilityRatio*r.width,h=r.x+r.width,u=this._contentBoundsNoRotate.x+this._contentBoundsNoRotate.width,p=this._contentBoundsNoRotate.x-h+l,g=u-r.x-l;l>this._contentBoundsNoRotate.width?r.x+=(p+g)/2:g<0?r.x+=g:p>0&&(r.x+=p)}if(this.wrapVertical);else{var m=this.visibilityRatio*r.height,v=r.y+r.height,T=this._contentBoundsNoRotate.y+this._contentBoundsNoRotate.height,S=this._contentBoundsNoRotate.y-v+m,P=T-r.y-m;m>this._contentBoundsNoRotate.height?r.y+=(S+P)/2:P<0?r.y+=P:S>0&&(r.y+=S)}return r},_raiseConstraintsEvent:function(n){this.viewer&&this.viewer.raiseEvent("constrain",{immediately:n})},applyConstraints:function(n){var o=this.getZoom(),r=this._applyZoomConstraints(o);o!==r&&this.zoomTo(r,this.zoomPoint,n);var l=this.getBoundsNoRotate(),h=this._applyBoundaryConstraints(l);return this._raiseConstraintsEvent(n),(l.x!==h.x||l.y!==h.y||n)&&this.fitBounds(h.rotate(-this.getRotation()),n),this},ensureVisible:function(n){return this.applyConstraints(n)},_fitBounds:function(o,r){var l=(r=r||{}).immediately||!1,h=r.constraints||!1,u=this.getAspectRatio(),p=o.getCenter(),g=new n.Rect(o.x,o.y,o.width,o.height,o.degrees+this.getRotation()).getBoundingBox();g.getAspectRatio()>=u?g.height=g.width/u:g.width=g.height*u,g.x=p.x-g.width/2,g.y=p.y-g.height/2;var m=1/g.width;if(h){var v=g.getAspectRatio(),T=this._applyZoomConstraints(m);m!==T&&(m=T,g.width=1/m,g.x=p.x-g.width/2,g.height=g.width/v,g.y=p.y-g.height/2),p=(g=this._applyBoundaryConstraints(g)).getCenter(),this._raiseConstraintsEvent(l)}if(l)return this.panTo(p,!0),this.zoomTo(m,null,!0);this.panTo(this.getCenter(!0),!0),this.zoomTo(this.getZoom(!0),null,!0);var S=this.getBounds(),P=this.getZoom();if(0===P||1e-8>Math.abs(m/P-1))return this.zoomTo(m,!0),this.panTo(p,l);var E=(g=g.rotate(-this.getRotation())).getTopLeft().times(m).minus(S.getTopLeft().times(P)).divide(m-P);return this.zoomTo(m,E,l)},fitBounds:function(n,o){return this._fitBounds(n,{immediately:o,constraints:!1})},fitBoundsWithConstraints:function(n,o){return this._fitBounds(n,{immediately:o,constraints:!0})},fitVertically:function(o){var r=new n.Rect(this._contentBounds.x+this._contentBounds.width/2,this._contentBounds.y,0,this._contentBounds.height);return this.fitBounds(r,o)},fitHorizontally:function(o){var r=new n.Rect(this._contentBounds.x,this._contentBounds.y+this._contentBounds.height/2,this._contentBounds.width,0);return this.fitBounds(r,o)},getConstrainedBounds:function(n){var o;return o=this.getBounds(n),this._applyBoundaryConstraints(o)},panBy:function(o,r){var l=new n.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return this.panTo(l.plus(o),r)},panTo:function(n,o){return o?(this.centerSpringX.resetTo(n.x),this.centerSpringY.resetTo(n.y)):(this.centerSpringX.springTo(n.x),this.centerSpringY.springTo(n.y)),this.viewer&&this.viewer.raiseEvent("pan",{center:n,immediately:o}),this},zoomBy:function(n,o,r){return this.zoomTo(this.zoomSpring.target.value*n,o,r)},zoomTo:function(o,r,l){var h=this;return this.zoomPoint=r instanceof n.Point&&!isNaN(r.x)&&!isNaN(r.y)?r:null,l?this._adjustCenterSpringsForZoomPoint(function(){h.zoomSpring.resetTo(o)}):this.zoomSpring.springTo(o),this.viewer&&this.viewer.raiseEvent("zoom",{zoom:o,refPoint:r,immediately:l}),this},setRotation:function(o){return this.viewer&&this.viewer.drawer.canRotate()&&(this.degrees=n.positiveModulo(o,360),this._setContentBounds(this.viewer.world.getHomeBounds(),this.viewer.world.getContentFactor()),this.viewer.forceRedraw(),this.viewer.raiseEvent("rotate",{degrees:o})),this},getRotation:function(){return this.degrees},resize:function(n,o){var r,l=this.getBoundsNoRotate(),h=l;return this.containerSize.x=n.x,this.containerSize.y=n.y,this._updateContainerInnerSize(),o&&(r=n.x/this.containerSize.x,h.width=l.width*r,h.height=h.width/this.getAspectRatio()),this.viewer&&this.viewer.raiseEvent("resize",{newContainerSize:n,maintain:o}),this.fitBounds(h,!0)},_updateContainerInnerSize:function(){this._containerInnerSize=new n.Point(Math.max(1,this.containerSize.x-(this._margins.left+this._margins.right)),Math.max(1,this.containerSize.y-(this._margins.top+this._margins.bottom)))},update:function(){var n=this;this._adjustCenterSpringsForZoomPoint(function(){n.zoomSpring.update()}),this.centerSpringX.update(),this.centerSpringY.update();var o=this.centerSpringX.current.value!==this._oldCenterX||this.centerSpringY.current.value!==this._oldCenterY||this.zoomSpring.current.value!==this._oldZoom;return this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,o},_adjustCenterSpringsForZoomPoint:function(n){if(this.zoomPoint){var o=this.pixelFromPoint(this.zoomPoint,!0);n();var r=this.pixelFromPoint(this.zoomPoint,!0).minus(o),l=this.deltaPointsFromPixels(r,!0);this.centerSpringX.shiftBy(l.x),this.centerSpringY.shiftBy(l.y),this.zoomSpring.isAtTargetValue()&&(this.zoomPoint=null)}else n()},deltaPixelsFromPointsNoRotate:function(n,o){return n.times(this._containerInnerSize.x*this.getZoom(o))},deltaPixelsFromPoints:function(n,o){return this.deltaPixelsFromPointsNoRotate(n.rotate(this.getRotation()),o)},deltaPointsFromPixelsNoRotate:function(n,o){return n.divide(this._containerInnerSize.x*this.getZoom(o))},deltaPointsFromPixels:function(n,o){return this.deltaPointsFromPixelsNoRotate(n,o).rotate(-this.getRotation())},pixelFromPointNoRotate:function(n,o){return this._pixelFromPointNoRotate(n,this.getBoundsNoRotate(o))},pixelFromPoint:function(n,o){return this._pixelFromPoint(n,this.getBoundsNoRotate(o))},_pixelFromPointNoRotate:function(o,r){return o.minus(r.getTopLeft()).times(this._containerInnerSize.x/r.width).plus(new n.Point(this._margins.left,this._margins.top))},_pixelFromPoint:function(n,o){return this._pixelFromPointNoRotate(n.rotate(this.getRotation(),this.getCenter(!0)),o)},pointFromPixelNoRotate:function(o,r){var l=this.getBoundsNoRotate(r);return o.minus(new n.Point(this._margins.left,this._margins.top)).divide(this._containerInnerSize.x/l.width).plus(l.getTopLeft())},pointFromPixel:function(n,o){return this.pointFromPixelNoRotate(n,o).rotate(-this.getRotation(),this.getCenter(!0))},_viewportToImageDelta:function(o,r){var l=this._contentBoundsNoRotate.width;return new n.Point(o*this._contentSizeNoRotate.x/l,r*this._contentSizeNoRotate.x/l)},viewportToImageCoordinates:function(o,r){if(o instanceof n.Point)return this.viewportToImageCoordinates(o.x,o.y);if(this.viewer){var l=this.viewer.world.getItemCount();if(l>1)n.console.error("[Viewport.viewportToImageCoordinates] is not accurate with multi-image; use TiledImage.viewportToImageCoordinates instead.");else if(1===l)return this.viewer.world.getItemAt(0).viewportToImageCoordinates(o,r,!0)}return this._viewportToImageDelta(o-this._contentBoundsNoRotate.x,r-this._contentBoundsNoRotate.y)},_imageToViewportDelta:function(o,r){var l=this._contentBoundsNoRotate.width;return new n.Point(o/this._contentSizeNoRotate.x*l,r/this._contentSizeNoRotate.x*l)},imageToViewportCoordinates:function(o,r){if(o instanceof n.Point)return this.imageToViewportCoordinates(o.x,o.y);if(this.viewer){var l=this.viewer.world.getItemCount();if(l>1)n.console.error("[Viewport.imageToViewportCoordinates] is not accurate with multi-image; use TiledImage.imageToViewportCoordinates instead.");else if(1===l)return this.viewer.world.getItemAt(0).imageToViewportCoordinates(o,r,!0)}var h=this._imageToViewportDelta(o,r);return h.x+=this._contentBoundsNoRotate.x,h.y+=this._contentBoundsNoRotate.y,h},imageToViewportRectangle:function(o,r,l,h){var u=o;if(u instanceof n.Rect||(u=new n.Rect(o,r,l,h)),this.viewer){var p=this.viewer.world.getItemCount();if(p>1)n.console.error("[Viewport.imageToViewportRectangle] is not accurate with multi-image; use TiledImage.imageToViewportRectangle instead.");else if(1===p)return this.viewer.world.getItemAt(0).imageToViewportRectangle(o,r,l,h,!0)}var g=this.imageToViewportCoordinates(u.x,u.y),m=this._imageToViewportDelta(u.width,u.height);return new n.Rect(g.x,g.y,m.x,m.y,u.degrees)},viewportToImageRectangle:function(o,r,l,h){var u=o;if(u instanceof n.Rect||(u=new n.Rect(o,r,l,h)),this.viewer){var p=this.viewer.world.getItemCount();if(p>1)n.console.error("[Viewport.viewportToImageRectangle] is not accurate with multi-image; use TiledImage.viewportToImageRectangle instead.");else if(1===p)return this.viewer.world.getItemAt(0).viewportToImageRectangle(o,r,l,h,!0)}var g=this.viewportToImageCoordinates(u.x,u.y),m=this._viewportToImageDelta(u.width,u.height);return new n.Rect(g.x,g.y,m.x,m.y,u.degrees)},viewerElementToImageCoordinates:function(n){var o=this.pointFromPixel(n,!0);return this.viewportToImageCoordinates(o)},imageToViewerElementCoordinates:function(n){var o=this.imageToViewportCoordinates(n);return this.pixelFromPoint(o,!0)},windowToImageCoordinates:function(o){n.console.assert(this.viewer,"[Viewport.windowToImageCoordinates] the viewport must have a viewer.");var r=o.minus(n.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(r)},imageToWindowCoordinates:function(o){return n.console.assert(this.viewer,"[Viewport.imageToWindowCoordinates] the viewport must have a viewer."),this.imageToViewerElementCoordinates(o).plus(n.getElementPosition(this.viewer.element))},viewerElementToViewportCoordinates:function(n){return this.pointFromPixel(n,!0)},viewportToViewerElementCoordinates:function(n){return this.pixelFromPoint(n,!0)},viewerElementToViewportRectangle:function(o){return n.Rect.fromSummits(this.pointFromPixel(o.getTopLeft(),!0),this.pointFromPixel(o.getTopRight(),!0),this.pointFromPixel(o.getBottomLeft(),!0))},viewportToViewerElementRectangle:function(o){return n.Rect.fromSummits(this.pixelFromPoint(o.getTopLeft(),!0),this.pixelFromPoint(o.getTopRight(),!0),this.pixelFromPoint(o.getBottomLeft(),!0))},windowToViewportCoordinates:function(o){n.console.assert(this.viewer,"[Viewport.windowToViewportCoordinates] the viewport must have a viewer.");var r=o.minus(n.getElementPosition(this.viewer.element));return this.viewerElementToViewportCoordinates(r)},viewportToWindowCoordinates:function(o){return n.console.assert(this.viewer,"[Viewport.viewportToWindowCoordinates] the viewport must have a viewer."),this.viewportToViewerElementCoordinates(o).plus(n.getElementPosition(this.viewer.element))},viewportToImageZoom:function(o){if(this.viewer){var r=this.viewer.world.getItemCount();if(r>1)n.console.error("[Viewport.viewportToImageZoom] is not accurate with multi-image.");else if(1===r)return this.viewer.world.getItemAt(0).viewportToImageZoom(o)}var l=this._contentSizeNoRotate.x;return o*(this._containerInnerSize.x/l*this._contentBoundsNoRotate.width)},imageToViewportZoom:function(o){if(this.viewer){var r=this.viewer.world.getItemCount();if(r>1)n.console.error("[Viewport.imageToViewportZoom] is not accurate with multi-image.");else if(1===r)return this.viewer.world.getItemAt(0).imageToViewportZoom(o)}return o*(this._contentSizeNoRotate.x/this._containerInnerSize.x/this._contentBoundsNoRotate.width)},toggleFlip:function(){return this.setFlip(!this.getFlip()),this},getFlip:function(){return this.flipped},setFlip:function(n){return this.flipped===n||(this.flipped=n,this.viewer.navigator&&this.viewer.navigator.setFlip(this.getFlip()),this.viewer.forceRedraw(),this.viewer.raiseEvent("flip",{flipped:n})),this}}}(OpenSeadragon),function(n){function updateLevel(n,o,r,l,h,u,p,g,m){var v=p.getBoundingBox().getTopLeft(),T=p.getBoundingBox().getBottomRight();n.viewer&&n.viewer.raiseEvent("update-level",{tiledImage:n,havedrawn:o,level:l,opacity:h,visibility:u,drawArea:p,topleft:v,bottomright:T,currenttime:g,best:m}),resetCoverage(n.coverage,l),resetCoverage(n.loadingCoverage,l);for(var S=n._getCornerTiles(l,v,T),P=S.topLeft,E=S.bottomRight,C=n.source.getNumTiles(l),R=n.viewport.pixelFromPoint(n.viewport.getCenter()),O=P.x;O<=E.x;O++)for(var I=P.y;I<=E.y;I++){if(!n.wrapHorizontal&&!n.wrapVertical){var M=n.source.getTileBounds(l,O,I);if(null===p.intersection(M))continue}m=updateTile(n,r,o,O,I,l,h,u,R,C,g,m)}return m}function updateTile(n,o,r,l,h,u,p,g,m,v,T,S){var P=getTile(l,h,u,n,n.source,n.tilesMatrix,T,v,n._worldWidthCurrent,n._worldHeightCurrent),E=r;n.viewer&&n.viewer.raiseEvent("update-tile",{tiledImage:n,tile:P}),setCoverage(n.coverage,u,l,h,!1);var C=P.loaded||P.loading||isCovered(n.loadingCoverage,u,l,h);if(setCoverage(n.loadingCoverage,u,l,h,C),!P.exists||(o&&!E&&(isCovered(n.coverage,u,l,h)?setCoverage(n.coverage,u,l,h,!0):E=!0),!E))return S;if(positionTile(P,n.source.tileOverlap,n.viewport,m,g,n),!P.loaded){if(P.context2D)setTileLoaded(n,P);else{var R=n._tileCache.getImageRecord(P.cacheKey);R&&setTileLoaded(n,P,R.getImage())}}return P.loaded?blendTile(n,P,l,h,u,p,T)&&(n._needsDraw=!0):P.loading?n._tilesLoading++:C||(S=compareTiles(S,P)),S}function getTile(o,r,l,h,u,p,g,m,v,T){var S,P,E,C,R,O,I,M,D;return p[l]||(p[l]={}),p[l][o]||(p[l][o]={}),p[l][o][r]||(S=(m.x+o%m.x)%m.x,P=(m.y+r%m.y)%m.y,E=u.getTileBounds(l,S,P),C=u.getTileBounds(l,S,P,!0),R=u.tileExists(l,S,P),O=u.getTileUrl(l,S,P),h.loadTilesWithAjax?(I=u.getTileAjaxHeaders(l,S,P),n.isPlainObject(h.ajaxHeaders)&&(I=n.extend({},h.ajaxHeaders,I))):I=null,M=u.getContext2D?u.getContext2D(l,S,P):void 0,E.x+=(o-S)/m.x,E.y+=T/v*((r-P)/m.y),D=new n.Tile(l,o,r,E,R,O,M,h.loadTilesWithAjax,I,C),S===m.x-1&&(D.isRightMost=!0),P===m.y-1&&(D.isBottomMost=!0),p[l][o][r]=D),(D=p[l][o][r]).lastTouchTime=g,D}function loadTile(n,o,r){o.loading=!0,n._imageLoader.addJob({src:o.url,loadWithAjax:o.loadWithAjax,ajaxHeaders:o.ajaxHeaders,crossOriginPolicy:n.crossOriginPolicy,ajaxWithCredentials:n.ajaxWithCredentials,callback:function(l,h,u){onTileLoad(n,o,r,l,h,u)},abort:function(){o.loading=!1}})}function onTileLoad(o,r,l,h,u,p){if(!h){n.console.log("Tile %s failed to load: %s - error: %s",r,r.url,u),o.viewer.raiseEvent("tile-load-failed",{tile:r,tiledImage:o,time:l,message:u,tileRequest:p}),r.loading=!1,r.exists=!1;return}if(l<o.lastResetTime){n.console.log("Ignoring tile %s loaded before reset: %s",r,r.url),r.loading=!1;return}var finish=function(){var n=o.source.getClosestLevel();setTileLoaded(o,r,h,n,p)};o._midDraw?window.setTimeout(finish,1):finish()}function setTileLoaded(n,o,r,l,h){var u=0;function getCompletionCallback(){return u++,completionCallback}function completionCallback(){0==--u&&(o.loading=!1,o.loaded=!0,o.context2D||n._tileCache.cacheTile({image:r,tile:o,cutoff:l,tiledImage:n}),n._needsDraw=!0)}n.viewer.raiseEvent("tile-loaded",{tile:o,tiledImage:n,tileRequest:h,image:r,getCompletionCallback:getCompletionCallback}),getCompletionCallback()()}function positionTile(o,r,l,h,u,p){var g=o.bounds.getTopLeft();g.x*=p._scaleSpring.current.value,g.y*=p._scaleSpring.current.value,g.x+=p._xSpring.current.value,g.y+=p._ySpring.current.value;var m=o.bounds.getSize();m.x*=p._scaleSpring.current.value,m.y*=p._scaleSpring.current.value;var v=l.pixelFromPointNoRotate(g,!0),T=l.pixelFromPointNoRotate(g,!1),S=l.deltaPixelsFromPointsNoRotate(m,!0),P=l.deltaPixelsFromPointsNoRotate(m,!1),E=T.plus(P.divide(2)),C=h.squaredDistanceTo(E);r||(S=S.plus(new n.Point(1,1))),o.isRightMost&&p.wrapHorizontal&&(S.x+=.75),o.isBottomMost&&p.wrapVertical&&(S.y+=.75),o.position=v,o.size=S,o.squaredDistance=C,o.visibility=u}function blendTile(n,o,r,l,h,u,p){var g,m,v=1e3*n.blendTime;if(o.blendStart||(o.blendStart=p),g=p-o.blendStart,m=v?Math.min(1,g/v):1,n.alwaysBlend&&(m*=u),o.opacity=m,n.lastDrawn.push(o),1===m)setCoverage(n.coverage,h,r,l,!0),n._hasOpaqueTile=!0;else if(g<v)return!0;return!1}function providesCoverage(n,o,r,l){var h,u,p,g;if(!n[o])return!1;if(void 0===r||void 0===l){for(p in h=n[o])if(Object.prototype.hasOwnProperty.call(h,p)){for(g in u=h[p])if(Object.prototype.hasOwnProperty.call(u,g)&&!u[g])return!1}return!0}return void 0===n[o][r]||void 0===n[o][r][l]||!0===n[o][r][l]}function isCovered(n,o,r,l){return void 0===r||void 0===l?providesCoverage(n,o+1):providesCoverage(n,o+1,2*r,2*l)&&providesCoverage(n,o+1,2*r,2*l+1)&&providesCoverage(n,o+1,2*r+1,2*l)&&providesCoverage(n,o+1,2*r+1,2*l+1)}function setCoverage(o,r,l,h,u){if(!o[r]){n.console.warn("Setting coverage for a tile before its level's coverage has been reset: %s",r);return}o[r][l]||(o[r][l]={}),o[r][l][h]=u}function resetCoverage(n,o){n[o]={}}function compareTiles(n,o){return n?o.visibility>n.visibility?o:o.visibility==n.visibility&&o.squaredDistance<n.squaredDistance?o:n:o}function drawTiles(o,r){if(0!==o.opacity&&(0!==r.length||o.placeholderFillStyle)){var l,h,u,p,g=r[0];g&&(l=o.opacity<1||o.compositeOperation&&"source-over"!==o.compositeOperation||!o._isBottomItem()&&g._hasTransparencyChannel());var m=o.viewport.getZoom(!0),v=o.viewportToImageZoom(m);r.length>1&&v>o.smoothTileEdgesMinZoom&&!o.iOSDevice&&o.getRotation(!0)%360==0&&n.supportsCanvas&&(l=!0,h=g.getScaleForEdgeSmoothing(),u=g.getTranslationForEdgeSmoothing(h,o._drawer.getCanvasSize(!1),o._drawer.getCanvasSize(!0))),l&&(h||(p=o.viewport.viewportToViewerElementRectangle(o.getClippedBounds(!0)).getIntegerBoundingBox(),o._drawer.viewer.viewport.getFlip()&&(0!==o.viewport.degrees||o.getRotation(!0)%360!=0)&&(p.x=o._drawer.viewer.container.clientWidth-(p.x+p.width)),p=p.times(n.pixelDensityRatio)),o._drawer._clear(!0,p)),!h&&(0!==o.viewport.degrees&&o._drawer._offsetForRotation({degrees:o.viewport.degrees,useSketch:l}),o.getRotation(!0)%360!=0&&o._drawer._offsetForRotation({degrees:o.getRotation(!0),point:o.viewport.pixelFromPointNoRotate(o._getRotationPoint(!0),!0),useSketch:l}),0===o.viewport.degrees&&o.getRotation(!0)%360==0&&o._drawer.viewer.viewport.getFlip()&&o._drawer._flip());var T=!1;if(o._clip){o._drawer.saveContext(l);var S=o.imageToViewportRectangle(o._clip,!0);S=S.rotate(-o.getRotation(!0),o._getRotationPoint(!0));var P=o._drawer.viewportToDrawerRectangle(S);h&&(P=P.times(h)),u&&(P=P.translate(u)),o._drawer.setClip(P,l),T=!0}if(o._croppingPolygons){o._drawer.saveContext(l);try{var E=o._croppingPolygons.map(function(n){return n.map(function(n){var r=o.imageToViewportCoordinates(n.x,n.y,!0).rotate(-o.getRotation(!0),o._getRotationPoint(!0)),l=o._drawer.viewportCoordToDrawerCoord(r);return h&&(l=l.times(h)),l})});o._drawer.clipWithPolygons(E,l)}catch(o){n.console.error(o)}T=!0}if(o.placeholderFillStyle&&!1===o._hasOpaqueTile){var C=o._drawer.viewportToDrawerRectangle(o.getBounds(!0));h&&(C=C.times(h)),u&&(C=C.translate(u));var R=null;R="function"==typeof o.placeholderFillStyle?o.placeholderFillStyle(o,o._drawer.context):o.placeholderFillStyle,o._drawer.drawRectangle(C,R,l)}for(var O=r.length-1;O>=0;O--)g=r[O],o._drawer.drawTile(g,o._drawingHandler,l,h,u),g.beingDrawn=!0,o.viewer&&o.viewer.raiseEvent("tile-drawn",{tiledImage:o,tile:g});T&&o._drawer.restoreContext(l),h||(o.getRotation(!0)%360!=0&&o._drawer._restoreRotationChanges(l),0!==o.viewport.degrees&&o._drawer._restoreRotationChanges(l)),l&&(h&&(0!==o.viewport.degrees&&o._drawer._offsetForRotation({degrees:o.viewport.degrees,useSketch:!1}),o.getRotation(!0)%360!=0&&o._drawer._offsetForRotation({degrees:o.getRotation(!0),point:o.viewport.pixelFromPointNoRotate(o._getRotationPoint(!0),!0),useSketch:!1})),o._drawer.blendSketch({opacity:o.opacity,scale:h,translate:u,compositeOperation:o.compositeOperation,bounds:p}),h&&(o.getRotation(!0)%360!=0&&o._drawer._restoreRotationChanges(!1),0!==o.viewport.degrees&&o._drawer._restoreRotationChanges(!1))),!h&&0===o.viewport.degrees&&o.getRotation(!0)%360==0&&o._drawer.viewer.viewport.getFlip()&&o._drawer._flip(),drawDebugInfo(o,r)}}function drawDebugInfo(o,r){if(o.debugMode)for(var l=r.length-1;l>=0;l--){var h=r[l];try{o._drawer.drawDebugInfo(h,r.length,l,o)}catch(o){n.console.error(o)}}}n.TiledImage=function(o){var r=this;n.console.assert(o.tileCache,"[TiledImage] options.tileCache is required"),n.console.assert(o.drawer,"[TiledImage] options.drawer is required"),n.console.assert(o.viewer,"[TiledImage] options.viewer is required"),n.console.assert(o.imageLoader,"[TiledImage] options.imageLoader is required"),n.console.assert(o.source,"[TiledImage] options.source is required"),n.console.assert(!o.clip||o.clip instanceof n.Rect,"[TiledImage] options.clip must be an OpenSeadragon.Rect if present"),n.EventSource.call(this),this._tileCache=o.tileCache,delete o.tileCache,this._drawer=o.drawer,delete o.drawer,this._imageLoader=o.imageLoader,delete o.imageLoader,o.clip instanceof n.Rect&&(this._clip=o.clip.clone()),delete o.clip;var l=o.x||0;delete o.x;var h=o.y||0;delete o.y,this.normHeight=o.source.dimensions.y/o.source.dimensions.x,this.contentAspectX=o.source.dimensions.x/o.source.dimensions.y;var u=1;o.width?(u=o.width,delete o.width,o.height&&(n.console.error("specifying both width and height to a tiledImage is not supported"),delete o.height)):o.height&&(u=o.height/this.normHeight,delete o.height);var p=o.fitBounds;delete o.fitBounds;var g=o.fitBoundsPlacement||OpenSeadragon.Placement.CENTER;delete o.fitBoundsPlacement;var m=o.degrees||0;delete o.degrees,n.extend(!0,this,{viewer:null,tilesMatrix:{},coverage:{},loadingCoverage:{},lastDrawn:[],lastResetTime:0,_midDraw:!1,_needsDraw:!0,_hasOpaqueTile:!1,_tilesLoading:0,springStiffness:n.DEFAULT_SETTINGS.springStiffness,animationTime:n.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:n.DEFAULT_SETTINGS.minZoomImageRatio,wrapHorizontal:n.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:n.DEFAULT_SETTINGS.wrapVertical,immediateRender:n.DEFAULT_SETTINGS.immediateRender,blendTime:n.DEFAULT_SETTINGS.blendTime,alwaysBlend:n.DEFAULT_SETTINGS.alwaysBlend,minPixelRatio:n.DEFAULT_SETTINGS.minPixelRatio,smoothTileEdgesMinZoom:n.DEFAULT_SETTINGS.smoothTileEdgesMinZoom,iOSDevice:n.DEFAULT_SETTINGS.iOSDevice,debugMode:n.DEFAULT_SETTINGS.debugMode,crossOriginPolicy:n.DEFAULT_SETTINGS.crossOriginPolicy,ajaxWithCredentials:n.DEFAULT_SETTINGS.ajaxWithCredentials,placeholderFillStyle:n.DEFAULT_SETTINGS.placeholderFillStyle,opacity:n.DEFAULT_SETTINGS.opacity,preload:n.DEFAULT_SETTINGS.preload,compositeOperation:n.DEFAULT_SETTINGS.compositeOperation},o),this._preload=this.preload,delete this.preload,this._fullyLoaded=!1,this._xSpring=new n.Spring({initial:l,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._ySpring=new n.Spring({initial:h,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._scaleSpring=new n.Spring({initial:u,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._degreesSpring=new n.Spring({initial:m,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._updateForScale(),p&&this.fitBounds(p,g,!0),this._drawingHandler=function(o){r.viewer.raiseEvent("tile-drawing",n.extend({tiledImage:r},o))}},n.extend(n.TiledImage.prototype,n.EventSource.prototype,{needsDraw:function(){return this._needsDraw},getFullyLoaded:function(){return this._fullyLoaded},_setFullyLoaded:function(n){n!==this._fullyLoaded&&(this._fullyLoaded=n,this.raiseEvent("fully-loaded-change",{fullyLoaded:this._fullyLoaded}))},reset:function(){this._tileCache.clearTilesFor(this),this.lastResetTime=n.now(),this._needsDraw=!0},update:function(){var n=this._xSpring.update(),o=this._ySpring.update(),r=this._scaleSpring.update(),l=this._degreesSpring.update();return(!!n||!!o||!!r||!!l)&&(this._updateForScale(),this._needsDraw=!0,!0)},draw:function(){0!==this.opacity||this._preload?(this._midDraw=!0,this._updateViewport(),this._midDraw=!1):this._needsDraw=!1},destroy:function(){this.reset()},getBounds:function(n){return this.getBoundsNoRotate(n).rotate(this.getRotation(n),this._getRotationPoint(n))},getBoundsNoRotate:function(o){return o?new n.Rect(this._xSpring.current.value,this._ySpring.current.value,this._worldWidthCurrent,this._worldHeightCurrent):new n.Rect(this._xSpring.target.value,this._ySpring.target.value,this._worldWidthTarget,this._worldHeightTarget)},getWorldBounds:function(){return n.console.error("[TiledImage.getWorldBounds] is deprecated; use TiledImage.getBounds instead"),this.getBounds()},getClippedBounds:function(o){var r=this.getBoundsNoRotate(o);if(this._clip){var l=(o?this._worldWidthCurrent:this._worldWidthTarget)/this.source.dimensions.x,h=this._clip.times(l);r=new n.Rect(r.x+h.x,r.y+h.y,h.width,h.height)}return r.rotate(this.getRotation(o),this._getRotationPoint(o))},getContentSize:function(){return new n.Point(this.source.dimensions.x,this.source.dimensions.y)},_viewportToImageDelta:function(o,r,l){var h=l?this._scaleSpring.current.value:this._scaleSpring.target.value;return new n.Point(o*(this.source.dimensions.x/h),r*(this.source.dimensions.y*this.contentAspectX/h))},viewportToImageCoordinates:function(o,r,l){var h;return o instanceof n.Point?(l=r,h=o):h=new n.Point(o,r),h=h.rotate(-this.getRotation(l),this._getRotationPoint(l)),l?this._viewportToImageDelta(h.x-this._xSpring.current.value,h.y-this._ySpring.current.value):this._viewportToImageDelta(h.x-this._xSpring.target.value,h.y-this._ySpring.target.value)},_imageToViewportDelta:function(o,r,l){var h=l?this._scaleSpring.current.value:this._scaleSpring.target.value;return new n.Point(o/this.source.dimensions.x*h,r/this.source.dimensions.y/this.contentAspectX*h)},imageToViewportCoordinates:function(o,r,l){o instanceof n.Point&&(l=r,r=o.y,o=o.x);var h=this._imageToViewportDelta(o,r);return l?(h.x+=this._xSpring.current.value,h.y+=this._ySpring.current.value):(h.x+=this._xSpring.target.value,h.y+=this._ySpring.target.value),h.rotate(this.getRotation(l),this._getRotationPoint(l))},imageToViewportRectangle:function(o,r,l,h,u){var p=o;p instanceof n.Rect?u=r:p=new n.Rect(o,r,l,h);var g=this.imageToViewportCoordinates(p.getTopLeft(),u),m=this._imageToViewportDelta(p.width,p.height,u);return new n.Rect(g.x,g.y,m.x,m.y,p.degrees+this.getRotation(u))},viewportToImageRectangle:function(o,r,l,h,u){var p=o;o instanceof n.Rect?u=r:p=new n.Rect(o,r,l,h);var g=this.viewportToImageCoordinates(p.getTopLeft(),u),m=this._viewportToImageDelta(p.width,p.height,u);return new n.Rect(g.x,g.y,m.x,m.y,p.degrees-this.getRotation(u))},viewerElementToImageCoordinates:function(n){var o=this.viewport.pointFromPixel(n,!0);return this.viewportToImageCoordinates(o)},imageToViewerElementCoordinates:function(n){var o=this.imageToViewportCoordinates(n);return this.viewport.pixelFromPoint(o,!0)},windowToImageCoordinates:function(n){var o=n.minus(OpenSeadragon.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(o)},imageToWindowCoordinates:function(n){return this.imageToViewerElementCoordinates(n).plus(OpenSeadragon.getElementPosition(this.viewer.element))},_viewportToTiledImageRectangle:function(o){var r=this._scaleSpring.current.value;return o=o.rotate(-this.getRotation(!0),this._getRotationPoint(!0)),new n.Rect((o.x-this._xSpring.current.value)/r,(o.y-this._ySpring.current.value)/r,o.width/r,o.height/r,o.degrees)},viewportToImageZoom:function(n){return this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x*n},imageToViewportZoom:function(n){return n/(this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x)},setPosition:function(n,o){var r=this._xSpring.target.value===n.x&&this._ySpring.target.value===n.y;if(o){if(r&&this._xSpring.current.value===n.x&&this._ySpring.current.value===n.y)return;this._xSpring.resetTo(n.x),this._ySpring.resetTo(n.y),this._needsDraw=!0}else{if(r)return;this._xSpring.springTo(n.x),this._ySpring.springTo(n.y),this._needsDraw=!0}r||this._raiseBoundsChange()},setWidth:function(n,o){this._setScale(n,o)},setHeight:function(n,o){this._setScale(n/this.normHeight,o)},setCroppingPolygons:function(o){var isXYObject=function(o){return o instanceof n.Point||"number"==typeof o.x&&"number"==typeof o.y},objectToSimpleXYObject=function(n){return n.map(function(n){try{if(isXYObject(n))return{x:n.x,y:n.y};throw Error()}catch(n){throw Error("A Provided cropping polygon point is not supported")}})};try{if(!n.isArray(o))throw Error("Provided cropping polygon is not an array");this._croppingPolygons=o.map(function(n){return objectToSimpleXYObject(n)})}catch(o){n.console.error("[TiledImage.setCroppingPolygons] Cropping polygon format not supported"),n.console.error(o),this._croppingPolygons=null}},resetCroppingPolygons:function(){this._croppingPolygons=null},fitBounds:function(o,r,l){r=r||n.Placement.CENTER;var h=n.Placement.properties[r],u=this.contentAspectX,p=0,g=0,m=1,v=1;if(this._clip&&(u=this._clip.getAspectRatio(),m=this._clip.width/this.source.dimensions.x,v=this._clip.height/this.source.dimensions.y,o.getAspectRatio()>u?(p=this._clip.x/this._clip.height*o.height,g=this._clip.y/this._clip.height*o.height):(p=this._clip.x/this._clip.width*o.width,g=this._clip.y/this._clip.width*o.width)),o.getAspectRatio()>u){var T=o.height/v,S=0;h.isHorizontallyCentered?S=(o.width-o.height*u)/2:h.isRight&&(S=o.width-o.height*u),this.setPosition(new n.Point(o.x-p+S,o.y-g),l),this.setHeight(T,l)}else{var P=o.width/m,E=0;h.isVerticallyCentered?E=(o.height-o.width/u)/2:h.isBottom&&(E=o.height-o.width/u),this.setPosition(new n.Point(o.x-p,o.y-g+E),l),this.setWidth(P,l)}},getClip:function(){return this._clip?this._clip.clone():null},setClip:function(o){n.console.assert(!o||o instanceof n.Rect,"[TiledImage.setClip] newClip must be an OpenSeadragon.Rect or null"),o instanceof n.Rect?this._clip=o.clone():this._clip=null,this._needsDraw=!0,this.raiseEvent("clip-change")},getOpacity:function(){return this.opacity},setOpacity:function(n){n!==this.opacity&&(this.opacity=n,this._needsDraw=!0,this.raiseEvent("opacity-change",{opacity:this.opacity}))},getPreload:function(){return this._preload},setPreload:function(n){this._preload=!!n,this._needsDraw=!0},getRotation:function(n){return n?this._degreesSpring.current.value:this._degreesSpring.target.value},setRotation:function(n,o){this._degreesSpring.target.value===n&&this._degreesSpring.isAtTargetValue()||(o?this._degreesSpring.resetTo(n):this._degreesSpring.springTo(n),this._needsDraw=!0,this._raiseBoundsChange())},_getRotationPoint:function(n){return this.getBoundsNoRotate(n).getCenter()},getCompositeOperation:function(){return this.compositeOperation},setCompositeOperation:function(n){n!==this.compositeOperation&&(this.compositeOperation=n,this._needsDraw=!0,this.raiseEvent("composite-operation-change",{compositeOperation:this.compositeOperation}))},_setScale:function(n,o){var r=this._scaleSpring.target.value===n;if(o){if(r&&this._scaleSpring.current.value===n)return;this._scaleSpring.resetTo(n),this._updateForScale(),this._needsDraw=!0}else{if(r)return;this._scaleSpring.springTo(n),this._updateForScale(),this._needsDraw=!0}r||this._raiseBoundsChange()},_updateForScale:function(){this._worldWidthTarget=this._scaleSpring.target.value,this._worldHeightTarget=this.normHeight*this._scaleSpring.target.value,this._worldWidthCurrent=this._scaleSpring.current.value,this._worldHeightCurrent=this.normHeight*this._scaleSpring.current.value},_raiseBoundsChange:function(){this.raiseEvent("bounds-change")},_isBottomItem:function(){return this.viewer.world.getItemAt(0)===this},_getLevelsInterval:function(){var n=Math.max(this.source.minLevel,Math.floor(Math.log(this.minZoomImageRatio)/Math.log(2))),o=this.viewport.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(0),!0).x*this._scaleSpring.current.value,r=Math.min(Math.abs(this.source.maxLevel),Math.abs(Math.floor(Math.log(o/this.minPixelRatio)/Math.log(2))));return{lowestLevel:n=Math.min(n,r=Math.max(r,this.source.minLevel||0)),highestLevel:r}},_updateViewport:function(){for(this._needsDraw=!1,this._tilesLoading=0,this.loadingCoverage={};this.lastDrawn.length>0;)this.lastDrawn.pop().beingDrawn=!1;var o=this.viewport,r=this._viewportToTiledImageRectangle(o.getBoundsWithMargins(!0));if(!this.wrapHorizontal&&!this.wrapVertical){var l=this._viewportToTiledImageRectangle(this.getClippedBounds(!0));if(null===(r=r.intersection(l)))return}for(var h=this._getLevelsInterval(),u=h.lowestLevel,p=h.highestLevel,g=null,m=!1,v=n.now(),T=p;T>=u;T--){var S=!1,P=o.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(T),!0).x*this._scaleSpring.current.value;if(T===u||!m&&P>=this.minPixelRatio)S=!0,m=!0;else if(!m)continue;var E=o.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(T),!1).x*this._scaleSpring.current.value,C=o.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(Math.max(this.source.getClosestLevel(),0)),!1).x*this._scaleSpring.current.value,R=this.immediateRender?1:C;if(g=updateLevel(this,m,S,T,Math.min(1,(P-.5)/.5),R/Math.abs(R-E),r,v,g),providesCoverage(this.coverage,T))break}drawTiles(this,this.lastDrawn),g&&!g.context2D?(loadTile(this,g,v),this._needsDraw=!0,this._setFullyLoaded(!1)):this._setFullyLoaded(0===this._tilesLoading)},_getCornerTiles:function(o,r,l){this.wrapHorizontal?(h=n.positiveModulo(r.x,1),u=n.positiveModulo(l.x,1)):(h=Math.max(0,r.x),u=Math.min(1,l.x));var h,u,p,g,m=1/this.source.aspectRatio;this.wrapVertical?(p=n.positiveModulo(r.y,m),g=n.positiveModulo(l.y,m)):(p=Math.max(0,r.y),g=Math.min(m,l.y));var v=this.source.getTileAtPoint(o,new n.Point(h,p)),T=this.source.getTileAtPoint(o,new n.Point(u,g)),S=this.source.getNumTiles(o);return this.wrapHorizontal&&(v.x+=S.x*Math.floor(r.x),T.x+=S.x*Math.floor(l.x)),this.wrapVertical&&(v.y+=S.y*Math.floor(r.y/m),T.y+=S.y*Math.floor(l.y/m)),{topLeft:v,bottomRight:T}}})}(OpenSeadragon),function(n){var TileRecord=function(o){n.console.assert(o,"[TileCache.cacheTile] options is required"),n.console.assert(o.tile,"[TileCache.cacheTile] options.tile is required"),n.console.assert(o.tiledImage,"[TileCache.cacheTile] options.tiledImage is required"),this.tile=o.tile,this.tiledImage=o.tiledImage},ImageRecord=function(o){n.console.assert(o,"[ImageRecord] options is required"),n.console.assert(o.image,"[ImageRecord] options.image is required"),this._image=o.image,this._tiles=[]};ImageRecord.prototype={destroy:function(){this._image=null,this._renderedContext=null,this._tiles=null},getImage:function(){return this._image},getRenderedContext:function(){if(!this._renderedContext){var n=document.createElement("canvas");n.width=this._image.width,n.height=this._image.height,this._renderedContext=n.getContext("2d"),this._renderedContext.drawImage(this._image,0,0),this._image=null}return this._renderedContext},setRenderedContext:function(o){n.console.error("ImageRecord.setRenderedContext is deprecated. The rendered context should be created by the ImageRecord itself when calling ImageRecord.getRenderedContext."),this._renderedContext=o},addTile:function(o){n.console.assert(o,"[ImageRecord.addTile] tile is required"),this._tiles.push(o)},removeTile:function(o){for(var r=0;r<this._tiles.length;r++)if(this._tiles[r]===o){this._tiles.splice(r,1);return}n.console.warn("[ImageRecord.removeTile] trying to remove unknown tile",o)},getTileCount:function(){return this._tiles.length}},n.TileCache=function(o){o=o||{},this._maxImageCacheCount=o.maxImageCacheCount||n.DEFAULT_SETTINGS.maxImageCacheCount,this._tilesLoaded=[],this._imagesLoaded=[],this._imagesLoadedCount=0},n.TileCache.prototype={numTilesLoaded:function(){return this._tilesLoaded.length},cacheTile:function(o){n.console.assert(o,"[TileCache.cacheTile] options is required"),n.console.assert(o.tile,"[TileCache.cacheTile] options.tile is required"),n.console.assert(o.tile.cacheKey,"[TileCache.cacheTile] options.tile.cacheKey is required"),n.console.assert(o.tiledImage,"[TileCache.cacheTile] options.tiledImage is required");var r=o.cutoff||0,l=this._tilesLoaded.length,h=this._imagesLoaded[o.tile.cacheKey];if(!h&&(n.console.assert(o.image,"[TileCache.cacheTile] options.image is required to create an ImageRecord"),h=this._imagesLoaded[o.tile.cacheKey]=new ImageRecord({image:o.image}),this._imagesLoadedCount++),h.addTile(o.tile),o.tile.cacheImageRecord=h,this._imagesLoadedCount>this._maxImageCacheCount){for(var u,p,g,m,v,T,S=null,P=-1,E=null,C=this._tilesLoaded.length-1;C>=0;C--)if(!((u=(T=this._tilesLoaded[C]).tile).level<=r)&&!u.beingDrawn){if(!S){S=u,P=C,E=T;continue}m=u.lastTouchTime,p=S.lastTouchTime,v=u.level,g=S.level,(m<p||m==p&&v>g)&&(S=u,P=C,E=T)}S&&P>=0&&(this._unloadTile(E),l=P)}this._tilesLoaded[l]=new TileRecord({tile:o.tile,tiledImage:o.tiledImage})},clearTilesFor:function(o){n.console.assert(o,"[TileCache.clearTilesFor] tiledImage is required");for(var r,l=0;l<this._tilesLoaded.length;++l)(r=this._tilesLoaded[l]).tiledImage===o&&(this._unloadTile(r),this._tilesLoaded.splice(l,1),l--)},getImageRecord:function(o){return n.console.assert(o,"[TileCache.getImageRecord] cacheKey is required"),this._imagesLoaded[o]},_unloadTile:function(o){n.console.assert(o,"[TileCache._unloadTile] tileRecord is required");var r=o.tile,l=o.tiledImage;r.unload(),r.cacheImageRecord=null;var h=this._imagesLoaded[r.cacheKey];h.removeTile(r),!h.getTileCount()&&(h.destroy(),delete this._imagesLoaded[r.cacheKey],this._imagesLoadedCount--),l.viewer.raiseEvent("tile-unloaded",{tile:r,tiledImage:l})}}}(OpenSeadragon),function(n){n.World=function(o){var r=this;n.console.assert(o.viewer,"[World] options.viewer is required"),n.EventSource.call(this),this.viewer=o.viewer,this._items=[],this._needsDraw=!1,this._autoRefigureSizes=!0,this._needsSizesFigured=!1,this._delegatedFigureSizes=function(n){r._autoRefigureSizes?r._figureSizes():r._needsSizesFigured=!0},this._figureSizes()},n.extend(n.World.prototype,n.EventSource.prototype,{addItem:function(o,r){if(n.console.assert(o,"[World.addItem] item is required"),n.console.assert(o instanceof n.TiledImage,"[World.addItem] only TiledImages supported at this time"),void 0!==(r=r||{}).index){var l=Math.max(0,Math.min(this._items.length,r.index));this._items.splice(l,0,o)}else this._items.push(o);this._autoRefigureSizes?this._figureSizes():this._needsSizesFigured=!0,this._needsDraw=!0,o.addHandler("bounds-change",this._delegatedFigureSizes),o.addHandler("clip-change",this._delegatedFigureSizes),this.raiseEvent("add-item",{item:o})},getItemAt:function(o){return n.console.assert(void 0!==o,"[World.getItemAt] index is required"),this._items[o]},getIndexOfItem:function(o){return n.console.assert(o,"[World.getIndexOfItem] item is required"),n.indexOf(this._items,o)},getItemCount:function(){return this._items.length},setItemIndex:function(o,r){n.console.assert(o,"[World.setItemIndex] item is required"),n.console.assert(void 0!==r,"[World.setItemIndex] index is required");var l=this.getIndexOfItem(o);if(r>=this._items.length)throw Error("Index bigger than number of layers.");r!==l&&-1!==l&&(this._items.splice(l,1),this._items.splice(r,0,o),this._needsDraw=!0,this.raiseEvent("item-index-change",{item:o,previousIndex:l,newIndex:r}))},removeItem:function(o){n.console.assert(o,"[World.removeItem] item is required");var r=n.indexOf(this._items,o);-1!==r&&(o.removeHandler("bounds-change",this._delegatedFigureSizes),o.removeHandler("clip-change",this._delegatedFigureSizes),o.destroy(),this._items.splice(r,1),this._figureSizes(),this._needsDraw=!0,this._raiseRemoveItem(o))},removeAll:function(){for(this.viewer._cancelPendingImages(),o=0;o<this._items.length;o++)(n=this._items[o]).removeHandler("bounds-change",this._delegatedFigureSizes),n.removeHandler("clip-change",this._delegatedFigureSizes),n.destroy();var n,o,r=this._items;for(this._items=[],this._figureSizes(),this._needsDraw=!0,o=0;o<r.length;o++)n=r[o],this._raiseRemoveItem(n)},resetItems:function(){for(var n=0;n<this._items.length;n++)this._items[n].reset()},update:function(){for(var n=!1,o=0;o<this._items.length;o++)n=this._items[o].update()||n;return n},draw:function(){for(var n=0;n<this._items.length;n++)this._items[n].draw();this._needsDraw=!1},needsDraw:function(){for(var n=0;n<this._items.length;n++)if(this._items[n].needsDraw())return!0;return this._needsDraw},getHomeBounds:function(){return this._homeBounds.clone()},getContentFactor:function(){return this._contentFactor},setAutoRefigureSizes:function(n){this._autoRefigureSizes=n,n&this._needsSizesFigured&&(this._figureSizes(),this._needsSizesFigured=!1)},arrange:function(o){var r,l,h,u,p,g,m=(o=o||{}).immediately||!1,v=o.layout||n.DEFAULT_SETTINGS.collectionLayout,T=o.rows||n.DEFAULT_SETTINGS.collectionRows,S=o.columns||n.DEFAULT_SETTINGS.collectionColumns,P=o.tileSize||n.DEFAULT_SETTINGS.collectionTileSize,E=P+(o.tileMargin||n.DEFAULT_SETTINGS.collectionTileMargin);r=!o.rows&&S?S:Math.ceil(this._items.length/T);var C=0,R=0;this.setAutoRefigureSizes(!1);for(var O=0;O<this._items.length;O++)O&&O%r==0&&("horizontal"===v?(R+=E,C=0):(C+=E,R=0)),p=(u=(h=(l=this._items[O]).getBounds()).width>h.height?P:P*(h.width/h.height))*(h.height/h.width),g=new n.Point(C+(P-u)/2,R+(P-p)/2),l.setPosition(g,m),l.setWidth(u,m),"horizontal"===v?C+=E:R+=E;this.setAutoRefigureSizes(!0)},_figureSizes:function(){var o=this._homeBounds?this._homeBounds.clone():null,r=this._contentSize?this._contentSize.clone():null,l=this._contentFactor||0;if(this._items.length){var h=this._items[0],u=h.getBounds();this._contentFactor=h.getContentSize().x/u.width;for(var p=h.getClippedBounds().getBoundingBox(),g=p.x,m=p.y,v=p.x+p.width,T=p.y+p.height,S=1;S<this._items.length;S++)u=(h=this._items[S]).getBounds(),this._contentFactor=Math.max(this._contentFactor,h.getContentSize().x/u.width),g=Math.min(g,(p=h.getClippedBounds().getBoundingBox()).x),m=Math.min(m,p.y),v=Math.max(v,p.x+p.width),T=Math.max(T,p.y+p.height);this._homeBounds=new n.Rect(g,m,v-g,T-m),this._contentSize=new n.Point(this._homeBounds.width*this._contentFactor,this._homeBounds.height*this._contentFactor)}else this._homeBounds=new n.Rect(0,0,1,1),this._contentSize=new n.Point(1,1),this._contentFactor=1;this._contentFactor===l&&this._homeBounds.equals(o)&&this._contentSize.equals(r)||this.raiseEvent("metrics-change",{})},_raiseRemoveItem:function(n){this.raiseEvent("remove-item",{item:n})}})}(OpenSeadragon)}}]);