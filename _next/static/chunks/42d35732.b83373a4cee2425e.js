"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5045],{95449:(e,t,i)=>{i.r(t),i.d(t,{default:()=>ro});var n,a,r,l=i(3748),o=i(11806),s=i(57906),d=i(14232),c=i(79106),u=i(97559),m=i(57186),p=i(3135),h=i(18433),f=i(98793),g=i(72511),v=i(46008),y=i(67661),b=i(73046),w=i(97568),x=i(23686),E=i(67376),S=i(50664),C=i(11600),k=i(73139),A=i(25376),I=i(10887),R=i(29938);let T="clover",$=Object.fromEntries(Object.entries({en:{commonClose:"Close",commonNext:"Next",commonPrevious:"Previous",commonSearch:"Search",commonSearchPlaceholder:"Search...",commonShare:"Share",commonViewAll:"View All",copyFailure:"Failed",copySuccess:"Copied",contentSearchLoading:"Loading...",contentSearchPlaceholder:"Search",contentSearchResultsNone:"No Results",contentSearchResultsMore:"More Results",informationPanelTabs:"Select",informationPanelTabsClose:"Viewer",informationPanelTabsAbout:"About",informationPanelTabsAnnotations:"Annotations",informationPanelTabsSearch:"Search",informationPanelToggle:"More Information",shareCollectionJson:"View Collection",shareCollectionCopy:"Copy Collection URL",shareManifestJson:"View Manifest",shareManifestCopy:"Copy Manifest URL"},pt:{}}).map(([e,t])=>[e,{[`${T}`]:t}]));o.Ay.use(l.A).use(s.r9).init({defaultNS:T,fallbackLng:"en",ns:[T],resources:{...$}});var O=function(e){return function(){let t={type:e,getType:()=>e,toString:()=>e};return(e,i)=>({...t,...void 0!==e&&{payload:e},...void 0!==i&&{meta:i}})}},M="@iiif/IMPORT_ENTITIES",L="@iiif/MODIFY_ENTITY_FIELD",P="@iiif/REORDER_ENTITY_FIELD",F="@iiif/ADD_REFERENCE",z="@iiif/UPDATE_REFERENCE",_="@iiif/REMOVE_REFERENCE",j="@iiif/ADD_METADATA",B="@iiif/REMOVE_METADATA",H="@iiif/UPDATE_METADATA",D="@iiif/REORDER_METADATA",V=O(M)(),W=O(L)(),N=(O(P)(),O(F)(),O(_)(),O(z)(),O(j)(),O(H)(),O(B)(),O(D)(),{modifyEntityField:W}),q="@iiif/ADD_MAPPING",U="@iiif/ADD_MAPPINGS",Q=O(q)(),G=O(U)(),J="RESOURCE_ERROR",X="RESOURCE_LOADING",Y="RESOURCE_READY",Z="@iiif/REQUEST_RESOURCE",K="@iiif/REQUEST_ERROR",ee="@iiif/REQUEST_MISMATCH",et="@iiif/REQUEST_COMPLETE",ei=O(Z)(),en=O(K)(),ea=O(ee)(),er=O(et)(),el="@iiif/BATCH",eo=O(el)(),es=(e,t)=>{let{entities:i,resource:n,mapping:a}=(0,c.z)(t);if(void 0===n.id)return[en({id:e,message:"ID is not defined in resource."})];let r=[V({entities:i}),G({mapping:a})];return n.id!==e&&(r.push(Q({id:e,type:n.type})),r.push(ea({requestId:e,actualId:n.id}))),r.push(er({id:e})),r},ed=Number.isNaN||function(e){return"number"==typeof e&&e!=e};function ec(e,t){if(!Array.isArray(e)||!Array.isArray(t))return e===t;if(e.length!==t.length)return!1;for(let a=0;a<e.length;a++){var i,n;if(!((i=e[a])===(n=t[a])||ed(i)&&ed(n)))return!1}return!0}function eu(e,t,i){let n=e.iiif.requests[t],a=e.iiif.mapping[t];if(!a||!e.iiif.entities[a][n.resourceUri])return;let r=e.iiif.entities[a][n.resourceUri];if(r&&r[c.c]){let e=r[c.c].find(e=>e[c.d]===r.id);return(0,c.j)(r,e)}return r}function em(e,t,{waitTimeout:i=30}={}){return(n,a)=>{let r=e.getStore(),l=r.getState(),o=l.iiif.requests[n];if(o){if(o.loadingState===Y){let e=eu(l,n);if(e)return e}switch(o.loadingState){case J:break;case X:return(async()=>{let e,t=!1;try{let a=await Promise.race([new Promise((i,a)=>{t||(e=r.subscribe(()=>{let e=r.getState();if(e.iiif.requests[n].loadingState===J)return void a();if(e.iiif.requests[n].loadingState===Y){let t=eu(e,n);t?i(t):a()}}))}),new Promise((e,n)=>setTimeout(()=>{t=!0,n()},60*i*1e3))]);if(e&&e(),a)return a}catch{e&&e()}})()}}e.dispatch(ei({id:n}));let s=t=>{if(!t)return;t.id||t["@id"]||(t["@type"]&&(t["@id"]=n),t.id=n);let i=es(n,t);return e.dispatch(eo({actions:i})),eu(r.getState(),n)};try{let i=t(n,a);return i&&"function"==typeof i.then?(async()=>{try{return s(await i)}catch(t){throw e.dispatch(en({id:n,message:t.toString()})),t}})():s(i)}catch(t){throw e.dispatch(en({id:n,message:t.toString()})),t}}}function ep(){return{Collection:{},Manifest:{},Canvas:{},AnnotationPage:{},AnnotationCollection:{},Annotation:{},ContentResource:{},Range:{},Service:{},Selector:{},Agent:{}}}let eh={};var ef=e=>{let t,i=new Set,n=(e,n)=>{let a="function"==typeof e?e(t):e;if(!Object.is(a,t)){let e=t;t=n??("object"!=typeof a||null===a)?a:Object.assign({},t,a),i.forEach(i=>i(t,e))}},a=()=>t,r={setState:n,getState:a,getInitialState:()=>l,subscribe:e=>(i.add(e),()=>i.delete(e)),destroy:()=>{(eh?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),i.clear()}},l=t=e(n,a,r);return r},eg=e=>e?ef(e):ef,ev="@iiif/SET_META_VALUE",ey="@iiif/SET_META_VALUE_DYNAMIC",eb="@iiif/UNSET_META_VALUE",ew=O(ev)(),ex=O(ey)(),eE=(O(eb)(),{setMetaValue:ew,setMetaValueDynamic:ex});let eS={};var eC=(e,t)=>(i,n,a)=>(a.dispatch=t=>(i(i=>e(i,t),!1,t),t),a.dispatchFromDevtools=!0,{dispatch:(...e)=>a.dispatch(...e),...t}),ek=new Map,eA=e=>{let t=ek.get(e);return t?Object.fromEntries(Object.entries(t.stores).map(([e,t])=>[e,t.getState()])):{}},eI=(e,t,i)=>{if(void 0===e)return{type:"untracked",connection:t.connect(i)};let n=ek.get(i.name);if(n)return{type:"tracked",store:e,...n};let a={connection:t.connect(i),stores:{}};return ek.set(i.name,a),{type:"tracked",store:e,...a}},eR=(e,t={})=>(i,n,a)=>{let r,{enabled:l,anonymousActionType:o,store:s,...d}=t;try{r=(l??(eS?"production":void 0)!=="production")&&window.__REDUX_DEVTOOLS_EXTENSION__}catch{}if(!r)return(eS?"production":void 0)!=="production"&&l&&console.warn("[zustand devtools middleware] Please install/enable Redux devtools extension"),e(i,n,a);let{connection:c,...u}=eI(s,r,d),m=!0;a.setState=(e,t,r)=>{let l=i(e,t);if(!m)return l;let u=void 0===r?{type:o||"anonymous"}:"string"==typeof r?{type:r}:r;return void 0===s?null==c||c.send(u,n()):null==c||c.send({...u,type:`${s}/${u.type}`},{...eA(d.name),[s]:a.getState()}),l};let p=(...e)=>{let t=m;m=!1,i(...e),m=t},h=e(a.setState,n,a);if("untracked"===u.type?null==c||c.init(h):(u.stores[u.store]=a,null==c||c.init(Object.fromEntries(Object.entries(u.stores).map(([e,t])=>[e,e===u.store?h:t.getState()])))),a.dispatchFromDevtools&&"function"==typeof a.dispatch){let e=!1,t=a.dispatch;a.dispatch=(...i)=>{(eS?"production":void 0)==="production"||"__setState"!==i[0].type||e||(console.warn('[zustand devtools middleware] "__setState" action type is reserved to set state from the devtools. Avoid using it.'),e=!0),t(...i)}}return c.subscribe(e=>{var t;switch(e.type){case"ACTION":if("string"!=typeof e.payload)return void console.error("[zustand devtools middleware] Unsupported action format");return eT(e.payload,e=>{if("__setState"===e.type){if(void 0===s)return void p(e.state);1!==Object.keys(e.state).length&&console.error(`
                    [zustand devtools middleware] Unsupported __setState action format. 
                    When using 'store' option in devtools(), the 'state' should have only one key, which is a value of 'store' that was passed in devtools(),
                    and value of this only key should be a state object. Example: { "type": "__setState", "state": { "abc123Store": { "foo": "bar" } } }
                    `);let t=e.state[s];return void(null==t||JSON.stringify(a.getState())!==JSON.stringify(t)&&p(t))}a.dispatchFromDevtools&&"function"==typeof a.dispatch&&a.dispatch(e)});case"DISPATCH":switch(e.payload.type){case"RESET":return p(h),void 0===s?null==c?void 0:c.init(a.getState()):null==c?void 0:c.init(eA(d.name));case"COMMIT":if(void 0===s){null==c||c.init(a.getState());break}return null==c?void 0:c.init(eA(d.name));case"ROLLBACK":return eT(e.state,e=>{if(void 0===s){p(e),null==c||c.init(a.getState());return}p(e[s]),null==c||c.init(eA(d.name))});case"JUMP_TO_STATE":case"JUMP_TO_ACTION":return eT(e.state,e=>{if(void 0===s)return void p(e);JSON.stringify(a.getState())!==JSON.stringify(e[s])&&p(e[s])});case"IMPORT_STATE":{let{nextLiftedState:i}=e.payload,n=null==(t=i.computedStates.slice(-1)[0])?void 0:t.state;if(!n)return;p(void 0===s?n:n[s]),null==c||c.send(null,i);break}case"PAUSE_RECORDING":return m=!m}return}}),h},eT=(e,t)=>{let i;try{i=JSON.parse(e)}catch(e){console.error("[zustand devtools middleware] Could not parse the received json",e)}void 0!==i&&t(i)},e$=e=>(t,i,n)=>{let a=n.subscribe;return n.subscribe=(e,t,i)=>{let r=e;if(t){let a=(null==i?void 0:i.equalityFn)||Object.is,l=e(n.getState());r=i=>{let n=e(i);if(!a(l,n)){let e=l;t(l=n,e)}},null!=i&&i.fireImmediately&&t(l,l)}return a(r)},e(t,i,n)};function eO(e,t,i,n){return!(!e[i]||!e[i][t]||!e[i][t][n]||!Array.isArray(e[i][t][n]))}function eM(e){return e.payload}function eL(e,t){return typeof e>"u"?t:e}function eP(e={}){let t=Object.keys(e);return function(i={},n){let a=!1,r={};for(let l=0;l<t.length;l++){let o=t[l];r[o]=e[o](i[o],n),a=a||r[o]!==i[o]}return a?r:i}}var eF=eP({mapping:(e={},t)=>{switch(t.type){case q:return{...e,[t.payload.id]:t.payload.type};case U:return{...e,...t.payload.mapping};default:return e}},entities:(e=ep(),t)=>{var i;let n=(i,n)=>({...e,[eM(t).type]:{...e[eM(t).type],[eM(t).id]:{...i,...n}}});switch(t.type){case L:{if(!e[eM(t).type]||!e[eM(t).type][eM(t).id])return e;let i=e[eM(t).type][eM(t).id];return"string"==typeof i?e:n(i,{[eM(t).key]:eM(t).value})}case P:{if(!eO(e,eM(t).id,eM(t).type,eM(t).key))return e;let i=e[eM(t).type][eM(t).id];if("string"==typeof i)return e;let a=Array.from(i[eM(t).key]),[r]=a.splice(eM(t).startIndex,1);return a.splice(eM(t).endIndex,0,r),n(i,{[eM(t).key]:a})}case M:{let i=Object.keys(eM(t).entities),n={...e};for(let a of i){let i=eM(t).entities[a],r={...e[a]||{}},l=!1,o=Object.keys(i||{})||[];if(i&&o){for(let t of o)l=!0,r[t]=e[a][t]?function(e,t){let i={},n=[];for(let[a,r]of Object.entries(e||{})){n.push(a);let e=(t||{})[a];if(!e||0===e.length){i[a]=r;continue}i[a]=e}for(let[e,a]of Object.entries(t||{}))-1===n.indexOf(e)&&(i[e]=a);return i}(e[a][t],i[t]):i[t];l&&(n[a]=r)}}return n}case F:{if(!eO(e,eM(t).id,eM(t).type,eM(t).key))return e;let i=e[eM(t).type][eM(t).id],a=Array.from(i[eM(t).key]);return a.splice(eL(eM(t).index,a.length+1),0,eM(t).reference),n(i,{[eM(t).key]:a})}case z:case _:{if(!eO(e,eM(t).id,eM(t).type,eM(t).key))return e;let a=e[eM(t).type][eM(t).id],r=Array.from(a[eM(t).key]),l=eL(eM(t).index,r.findIndex(e=>e&&e.id===eM(t).reference.id));return -1===l||(null==(i=r[l])?void 0:i.id)!==eM(t).reference.id?e:(t.type===z?r.splice(l,1,eM(t).reference):r.splice(l,1),n(a,{[eM(t).key]:r}))}case j:{let i=e[eM(t).type][eM(t).id];if(!i)return e;let a=Array.from(i.metadata||[]),r=eM(t);return a.splice(eL(t.payload.beforeIndex,a.length+1),0,{label:r.label,value:r.label}),n(i,{metadata:a})}case D:{let i=e[eM(t).type][eM(t).id];if("string"==typeof i||!i)return e;let a=Array.from(i.metadata||[]),[r]=a.splice(eM(t).startIndex,1);return a.splice(eM(t).endIndex,0,r),n(i,{metadata:a})}case H:case B:{let i=e[eM(t).type][eM(t).id],a=Array.from(i.metadata||[]),r=eM(t).atIndex;return typeof r>"u"||-1===r||!a[r]?e:(t.type===H?a.splice(r,1,{label:eM(t).label,value:eM(t).value}):a.splice(r,1),n(i,{metadata:a}))}default:return e}},requests:(e={},t)=>{switch(t.type){case Z:case"@iiif/REQUEST_OFFLINE_RESOURCE":return{...e,[t.payload.id]:{requestUri:t.payload.id,loadingState:X,uriMismatch:!1,resourceUri:t.payload.id}};case ee:return{...e,[t.payload.requestId]:{...e[t.payload.requestId]||{},uriMismatch:!0,resourceUri:t.payload.actualId},[t.payload.actualId]:{requestUri:t.payload.requestId,loadingState:e[t.payload.requestId].loadingState,uriMismatch:!0,resourceUri:t.payload.actualId}};case K:return{...e,[t.payload.id]:{...e[t.payload.id]||{},loadingState:J,error:t.payload.message}};case et:return{...e,[t.payload.id]:{...e[t.payload.id]||{},loadingState:Y,error:void 0}}}return e},meta:(e={},t)=>{let{id:i,updateValue:n,value:a,meta:r,key:l}=t&&t.payload||{};switch(t.type){case ev:return{...e,[i]:{...e[i]||{},[r]:{...e[i]&&e[i][r]||{},[l]:a}}};case ey:return{...e,[i]:{...e[i]||{},[r]:{...e[i]&&e[i][r]||{},[l]:n(e[i]&&e[i][r]?e[i][r][l]:void 0)}}};case eb:return e[i]&&e[i][r]&&e[i][r][l]?{...e,[i]:{...e[i]||{},[r]:{...e[i]&&e[i][r]||{},[l]:void 0}}}:e;default:return e}}}),ez=Object.defineProperty,e_=(e,t,i)=>t in e?ez(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,ej=(e,t,i)=>(e_(e,"symbol"!=typeof t?t+"":t,i),i);function eB(e,t,i,n=!0){t[eV]=t[eV]||[],t[eV].push(e);let a=new Map;Object.defineProperty(t,e,{enumerable:n,get(){if(typeof t[eH][e]>"u")return;let n=t[eH][e];if(!n)return n;let r=i.get(t[eH][e],{parent:this.id?{id:this.id,type:this.type}:void 0});return a.has(r)||(a.clear(),a.set(r,eN(r,i))),a.get(r)},set(n){t[eH][e]!==n&&(this[eD]?i.modifyEntityField({id:this.id,type:this.type},e,function e(t){return Array.isArray(t)?t.map(t=>e(t)):t&&t.type?{id:t.id,type:t.type}:t}(n)):this[eH][e]=n)}})}var eH=Symbol.for("_refs_"),eD=Symbol.for("_reactive_"),eV=Symbol.for("_defined_"),eW=Symbol.for("_parent_");function eN(e,t,i=!1,n){if(Array.isArray(e))return e.map(e=>eN(e,t,i));if(!e||!e.type||!e.id)return e;let a=Object.assign(Object.create(function(e,t=!1,i){let n={id:"",type:"unknown",[eV]:[],[eH]:{},[eW]:null,[eD]:null,is(e){return"string"==typeof e?this.id===e:!!e.id&&e.id===this.id},reactive(){if(!this[eD])return this[eD]=this.subscribe(()=>this.refresh(),!0),()=>{this.unreactive()}},refresh(){if(this.id){let e=this.unwrap();for(let t of Object.keys(e||{}))this[eV].includes(t)?this[eH][t]=e[t]:this[t]=e[t]}},unreactive(){this[eD]&&(this[eD](),this[eD]=null)},unwrap(){if(!this.id)throw Error("Invalid object");let t=this[eW];return e.get(this.id,{parent:t?{id:t,type:"unknown"}:void 0})},toPresentation3(){return e.toPresentation3(this.unwrap())},toPresentation2(){return e.toPresentation2(this.unwrap())},valueOf(){return this.unwrap()},toJSON(){return{...this,items:this.items,annotations:this.annotations,structures:this.structures,seeAlso:this.seeAlso,service:this.service,services:this.services,rendering:this.rendering,partOf:this.partOf,start:this.start,supplementary:this.supplementary,homepage:this.homepage,thumbnail:this.thumbnail,placeholderCanvas:this.placeholderCanvas,accompanyingCanvas:this.accompanyingCanvas,provider:this.provider}},subscribe(t,i=!0){return e.subscribe(()=>this.id?e.get(this.id):null,t,i)}};return eB("items",n,e),eB("annotations",n,e),eB("structures",n,e),eB("seeAlso",n,e),eB("rendering",n,e),eB("partOf",n,e),eB("start",n,e,!1),eB("supplementary",n,e),eB("homepage",n,e),eB("thumbnail",n,e),eB("placeholderCanvas",n,e,!1),eB("accompanyingCanvas",n,e,!1),eB("provider",n,e),eB("body",n,e),eB("logo",n,e),n}(t,i)),e);return i&&a.reactive(),a}function eq(e){switch(e){case"Image":case"Video":case"Sound":case"Dataset":case"Text":case"Composite":case"List":case"Independents":case"Audience":return"ContentResource";case"ImageService1":case"ImageService2":case"ImageService3":return"Service"}return e}var eU=class{constructor(e,t){ej(this,"options"),ej(this,"store"),ej(this,"emitter"),ej(this,"isBatching",!1),ej(this,"batchQueue",[]),ej(this,"remoteFetcher"),ej(this,"staticFetcher"),ej(this,"defaultFetcher",e=>fetch(e).then(e=>e.json())),this.options=Object.assign({reducers:{},customFetcher:this.defaultFetcher,enableDevtools:!0},e||{}),this.store=t||function(e={}){var t;let{enableDevtools:i=!1,iiifStoreName:n="iiif",defaultState:a={iiif:{entities:ep(),meta:{},mapping:{},requests:{}}},customReducers:r={}}=e,l=(t=eP({[n]:eF,...r}),(e,i)=>i&&i.type===el?i.payload.actions.reduce(t,e):i&&"@iiif/BATCH_IMPORT"===i.type?{...e,iiif:{...e.iiif,...i.payload.state}}:t(e,i));return eg(e$(("u">typeof window&&window.__REDUX_DEVTOOLS_EXTENSION__?eR:(e,t)=>e)(eC(l,a),{enabled:i})))}({customReducers:this.options.reducers,defaultState:this.options.defaultState,enableDevtools:this.options.enableDevtools}),this.emitter=function(e){return{all:e=e||new Map,on:function(t,i){var n=e.get(t);n?n.push(i):e.set(t,[i])},off:function(t,i){var n=e.get(t);n&&(i?n.splice(n.indexOf(i)>>>0,1):e.set(t,[]))},emit:function(t,i){var n=e.get(t);n&&n.slice().map(function(e){e(i)}),(n=e.get("*"))&&n.slice().map(function(e){e(t,i)})}}}(),this.remoteFetcher=em(this,this.options.customFetcher),this.staticFetcher=em(this,(e,t)=>t)}batch(e){this.isBatching=!0;try{e(this),this.isBatching=!1,this.dispatch(eo({actions:this.batchQueue}))}catch(e){throw this.batchQueue=[],this.isBatching=!1,e}this.batchQueue=[]}async asyncBatch(e){this.isBatching=!0;try{await e(this),this.isBatching=!1,this.dispatch(eo({actions:this.batchQueue}))}catch(e){throw this.batchQueue=[],this.isBatching=!1,e}this.batchQueue=[]}modifyEntityField(e,t,i){this.dispatch(N.modifyEntityField({id:e.id,type:e.type,key:t,value:i}))}dispatch(e){if(this.isBatching)this.batchQueue.push(e);else{if(e.type===el){for(let t of e.payload.actions)this.emitter.emit(t.type,{action:t,state:this.store.getState()});this.store.dispatch(e);let t=this.getState();for(let i of e.payload.actions)this.emitter.emit(`after:${i.type}`,{action:i,state:t});return}this.emitter.emit(e.type,{action:e,state:this.store.getState()}),this.store.dispatch(e);let t=this.store.getState();this.emitter.emit(`after:${e.type}`,{action:e,state:t});return}}on(e,t){return this.emitter.on(e,t),()=>{this.emitter.off(e,t)}}serialize(e,t){return(0,c.B)(this.getState().iiif,e,t)}toPresentation2(e){return this.serialize(e,c.E)}toPresentation3(e){return this.serialize(e,c.F)}hydrate(e,t,i={}){return this.get(e,t,{...i,skipSelfReturn:!1})}get(e,t,i={}){"string"!=typeof t&&(i=t||{},t=void 0);let{skipSelfReturn:n=!0}=i||{},a=i.parent?"string"==typeof i.parent?i.parent:i.parent.id:void 0;if(Array.isArray(e))return e.map(e=>this.get(e,i));let r=this.getState();if((0,u.a)(e)&&!i.preserveSpecificResources&&(e=e.source),"string"==typeof e){let i=eq(t||r.iiif.mapping[e]);if(!i)return n?null:{id:e,type:"unknown"};e={id:e,type:i}}if(e&&e.partOf&&!a&&!i.skipPartOfCheck){let t=Array.isArray(e.partOf)?e.partOf[0]:e.partOf;t&&("string"==typeof t&&(a=t),"string"==typeof t.id&&(a=t.id))}let l=eq(t||(null==e?void 0:e.type)),o=null==e?void 0:e.id,s=r.iiif.entities[l];if(!s){let t=r.iiif.requests[o];return t&&t.resourceUri!==o?this.get(t.resourceUri,i):n?null:e}let d=s[e.id];if(d&&d[c.c]){let e=d[c.c].find(e=>a?e[c.d]===a:e[c.d]===d.id);return(0,c.j)(d,e)}return s[e.id]||(n?null:e)}select(e){return e(this.getState())}getStore(){return this.store}getState(){return this.store.getState()}deep(e,t){if(typeof e>"u")return this.get(t,{skipSelfReturn:!1});if("function"==typeof e)try{let i=e(this.get(t,{skipSelfReturn:!1})),n=e=>this.deep(e,i);return n.size=Array.isArray(i)?i.length:1,n}catch{let e=e=>this.deep(e,void 0);return e.size=0,e}let i=t=>this.deep(t,e);return i.size=Array.isArray(e)?e.length:1,i}loadManifest(e,t){let i="string"==typeof e?e:e.id;return this.load(i,t)}loadCollection(e,t){let i="string"==typeof e?e:e.id;return this.load(i,t)}load(e,t){let i="string"==typeof e?e:e.id;return t?Promise.resolve(this.staticFetcher(i,t)):Promise.resolve(this.remoteFetcher(i))}loadSync(e,t){let i="string"==typeof e?e:e.id;return this.staticFetcher(i,t)}loadManifestSync(e,t){let i="string"==typeof e?e:e.id;return this.loadSync(i,t)}loadCollectionSync(e,t){let i="string"==typeof e?e:e.id;return this.loadSync(i,t)}areInputsEqual(e,t){return ec(e,t)}subscribe(e,t,i){return typeof i>"u"&&(typeof t>"u"||!1===t||!0===t)&&(i=t,t=e,e=e=>e),this.store.subscribe(e,e=>t(e,this),{equalityFn:ec,fireImmediately:!i})}async ensureLoaded(e){let t="string"==typeof e?e:e.id;this.requestStatus(t)||await this.load(t)}requestStatus(e){return this.select(t=>t.iiif.requests[e])}getResourceMeta(e,t){let i=this.getState().iiif.meta[e];if(i)return t?i[t]:i}getObject(e,t,i={}){let{reactive:n,...a}=i;return eN(this.get(e,t,a),this,n)}async loadObject(e,t){return eN(await this.load(e,t),this)}async loadManifestObject(e,t){return eN(await this.loadManifest(e,t),this)}async loadCollectionObject(e,t){return eN(await this.loadCollection(e,t),this)}wrapObject(e){return eN(this.get(e,{skipSelfReturn:!1}),this)}isWrapped(e){return!!e[eV]}setMetaValue([e,t,i],n){this.dispatch("function"==typeof n?eE.setMetaValueDynamic({id:e,meta:t,key:i,updateValue:n}):eE.setMetaValue({id:e,meta:t,key:i,value:n}))}};let eQ=e=>{let t=e.toString().split(":"),i=Math.ceil(parseInt(t[0])),n=Math.ceil(parseInt(t[1])),a=eZ(Math.ceil(parseInt(t[2])),2),r=`${0!==i&&n<10?(n+"").padStart(2,"0"):n}:${a}`;return 0!==i&&(r=`${i}:${r}`),r},eG=e=>eQ(new Date(1e3*e).toISOString().substr(11,8)),eJ=(e,t)=>{if("object"!=typeof e||null===e)return t;for(let i in t)"object"!=typeof t[i]||null===t[i]||Array.isArray(t[i])?e[i]=t[i]:(e[i]||(e[i]={}),e[i]=eJ(e[i],t[i]));return e},eX=e=>e.split("").reduce(function(e,t){return(e=(e<<5)-e+t.charCodeAt(0))&e},0),eY=(e,t)=>Object.hasOwn(e,t)?e[t].toString():void 0,eZ=(e,t)=>String(e).padStart(t,"0"),eK={annotationOverlays:{backgroundColor:"#6666ff",borderColor:"#000099",borderType:"solid",borderWidth:"1px",opacity:"0.5",renderOverlays:!0,zoomLevel:2},background:"transparent",canvasBackgroundColor:"#6662",canvasHeight:"500px",contentSearch:{searchResultsLimit:20,overlays:{backgroundColor:"#ff6666",borderColor:"#990000",borderType:"solid",borderWidth:"1px",opacity:"0.5",renderOverlays:!0,zoomLevel:4}},crossOrigin:void 0,ignoreCaptionLabels:[],informationPanel:{vtt:{autoScroll:{enabled:!0,settings:{behavior:"smooth",block:"center"}}},open:!0,renderAbout:!0,renderSupplementing:!0,renderToggle:!0,renderAnnotation:!0,renderContentSearch:!0},openSeadragon:{},requestHeaders:{"Content-Type":"application/json"},showDownload:!0,showIIIFBadge:!0,showTitle:!0,withCredentials:!1};function e0(e){let t={...eK.informationPanel.vtt.autoScroll};return"object"==typeof e&&(t="enabled"in e?e:{enabled:!0,settings:e}),!1===e&&(t.enabled=!1),function({behavior:e,block:t}){let i=["auto","instant","smooth"],n=["center","end","nearest","start"];if(!i.includes(e))throw TypeError(`'${e}' not in ${i.join(" | ")}`);if(!n.includes(t))throw TypeError(`'${t}' not in ${n.join(" | ")}`)}(t.settings),t}let e1=e0(null==(a=null==(n=null==eK?void 0:eK.informationPanel)?void 0:n.vtt)?void 0:a.autoScroll),e2={activeCanvas:"",activeManifest:"",activeSelector:void 0,OSDImageLoaded:!1,collection:{},configOptions:eK,customDisplays:[],plugins:[],isAutoScrollEnabled:e1.enabled,isAutoScrolling:!1,isInformationOpen:null==(r=null==eK?void 0:eK.informationPanel)?void 0:r.open,isLoaded:!1,isUserScrolling:void 0,sequence:[[],[]],vault:new eU,openSeadragonViewer:null,viewerId:(0,m.A)(),visibleCanvases:[],visibleAnnotations:[]},e3=d.createContext(e2),e4=d.createContext(e2);function e5(e,t){switch(t.type){case"updateActiveCanvas":return t.canvasId||(t.canvasId=""),{...e,activeCanvas:t.canvasId};case"updateActiveManifest":return{...e,activeManifest:t.manifestId};case"updateOSDImageLoaded":return{...e,OSDImageLoaded:t.OSDImageLoaded};case"updateAutoScrollAnnotationEnabled":return{...e,isAutoScrollEnabled:t.isAutoScrollEnabled};case"updateAutoScrolling":return{...e,isAutoScrolling:t.isAutoScrolling};case"updateCollection":return{...e,collection:t.collection};case"updateConfigOptions":return{...e,configOptions:eJ(e.configOptions,t.configOptions)};case"updateContentStateAnnotation":return{...e,contentStateAnnotation:t.contentStateAnnotation};case"updateInformationOpen":return{...e,isInformationOpen:t.isInformationOpen};case"updateInformationPanelResource":return{...e,informationPanelResource:t.informationPanelResource};case"updateIsLoaded":return{...e,isLoaded:t.isLoaded};case"updateManifestSequence":return{...e,sequence:t.sequence};case"updateUserScrolling":return{...e,isUserScrolling:t.isUserScrolling};case"updateOpenSeadragonViewer":return{...e,openSeadragonViewer:t.openSeadragonViewer};case"updateViewerId":return{...e,viewerId:t.viewerId};case"updateActiveSelector":return{...e,activeSelector:t.selector};case"updateVisibleCanvases":return{...e,visibleCanvases:t.visibleCanvases};default:throw Error(`Unhandled action type: ${t.type}`)}}let e6=({initialState:e=e2,children:t})=>{let[i,n]=(0,d.useReducer)(e5,e),{openSeadragonViewer:a}=i;return(0,d.useEffect)(()=>{if(a)return a.addHandler("update-viewport",()=>{let e=a.viewport,t=e.getBounds(),i=e.viewportToImageRectangle(t);n({type:"updateActiveSelector",selector:{type:"FragmentSelector",value:`xywh=${[Math.round(i.x),Math.round(i.y),Math.round(i.width),Math.round(i.height)].join(",")}`}})}),()=>{a.removeAllHandlers("update-viewport")}},[a]),d.createElement(e3.Provider,{value:i},d.createElement(e4.Provider,{value:n},t))};function e8(){let e=d.useContext(e3);if(void 0===e)throw Error("useViewerState must be used within a ViewerProvider");return e}function e7(){let e=d.useContext(e4);if(void 0===e)throw Error("useViewerDispatch must be used within a ViewerProvider");return e}let e9=async(e,t)=>{let i=e.get({id:t,type:"Canvas"});if(!(null!=i&&i.annotations)||!i.annotations[0])return[];let n=e.get(i.annotations).filter(e=>!!e.items&&e),a=[];for(let t of n)if(t.items.length>0){let e=t.label||{none:["Annotations"]};a.push({...t,label:e})}else{let i={};try{i=await e.load(t.id)}catch(e){console.log(e)}if(i.items&&i.items.length>0){let e=i.label||{none:["Annotations"]};a.push({...i,label:e})}}return a},te=async(e,t,i)=>{try{if(null==i||null==i.q)return{};let n=i.q.trim(),a=new URL(t);return a.searchParams.set("q",n),await e.load(a.toString())}catch(e){return console.warn("Error in getContentSearchResources:",e),{}}},tt=(e,t,i,n)=>{var a,r;let l={canvas:void 0,accompanyingCanvas:void 0,annotationPage:void 0,annotations:[]};if(l.canvas=e.get(t),l.canvas&&(l.annotationPage=e.get(l.canvas.items[0]),l.accompanyingCanvas=null!=(a=l.canvas)&&a.accompanyingCanvas?e.get(null==(r=l.canvas)?void 0:r.accompanyingCanvas):void 0),l.annotationPage){let a=e.get(l.annotationPage.items).map(t=>({body:e.get(t.body[0].id),motivation:t.motivation,type:"Annotation"})),r=[];a.forEach(t=>{"Choice"===t.body.type?t.body.items.forEach(i=>r.push({...t,id:i.id,body:e.get(i.id)})):r.push(t)}),l.annotations=r.filter(a=>{if(a){if(!a.body||!a.motivation)return void console.error("Invalid annotation after Hyperion parsing: missing either 'body' or 'motivation'",a);let r=a.body;Array.isArray(r)&&(r=r[0]);let l=e.get(r.id);if(l)switch(i){case"painting":return a.target===t.id&&a.motivation&&"painting"===a.motivation[0]&&n.includes(l.type)&&(a.body=l),!!a;case"supplementing":return;default:throw Error("Invalid annotation motivation.")}}})}return l},ti=(e,t="en")=>{if(!e)return"";if(!e[t]){let t=Object.getOwnPropertyNames(e);if(t.length>0)return e[t[0]]}return e[t]},tn=(e,t)=>{let i=tt(e,{id:t,type:"Canvas"},"painting",["Image","Sound","Video"]);if(0!==i.annotations.length&&i.annotations&&i.annotations)return i.annotations.map(e=>null==e?void 0:e.body)},ta={xxs:"(max-width: 349px)",xs:"(max-width: 575px)",sm:"(max-width: 767px)",md:"(max-width: 991px)",lg:"(max-width: 90rem)",xl:"(min-width: calc(90rem + 1px))"},{styled:tr,css:tl,keyframes:to,createTheme:ts}=(0,v.GC)({theme:{colors:{primary:"#1a1d1e",primaryMuted:"#26292b",primaryAlt:"#151718",accent:"hsl(209 100% 38.2%)",accentMuted:"hsl(209 80% 61.8%)",accentAlt:"hsl(209 80% 30%)",secondary:"#FFFFFF",secondaryMuted:"#e6e8eb",secondaryAlt:"#c1c8cd"},fontSizes:{1:"12px",2:"13px",3:"15px",4:"17px",5:"19px",6:"21px",7:"27px",8:"35px",9:"59px"},lineHeights:{1:"12px",2:"13px",3:"15px",4:"17px",5:"19px",6:"21px",7:"27px",8:"35px",9:"59px"},sizes:{1:"5px",2:"10px",3:"15px",4:"20px",5:"25px",6:"35px",7:"45px",8:"65px",9:"80px"},space:{1:"5px",2:"10px",3:"15px",4:"20px",5:"25px",6:"35px",7:"45px",8:"65px",9:"80px"},radii:{1:"4px",2:"6px",3:"8px",4:"12px",round:"50%",pill:"9999px"},transitions:{all:"all 200ms cubic-bezier(0.16, 1, 0.3, 1)"},zIndices:{1:"100",2:"200",3:"300",4:"400",max:"999"}},media:ta}),td=tr("div",{display:"flex",flexDirection:"column",alignItems:"center"}),tc=tr("p",{fontWeight:"bold",fontSize:"x-large"}),tu=tr("span",{fontSize:"medium"}),tm=({error:e})=>{let{message:t}=e;return d.createElement(td,{role:"alert"},d.createElement(tc,{"data-testid":"headline"},"Something went wrong"),t&&d.createElement(tu,null,`Error message: ${t}`," "))},tp=tr("div",{position:"relative",zIndex:"0"}),th=tr("div",{display:"flex",flexDirection:"row",flexGrow:"1",overflow:"hidden"}),tf=tr("div",{display:"flex",flexDirection:"column",flexGrow:"1",flexShrink:"1",width:"100%",height:"100%","&[data-aside-active='true']":{width:"61.8%","@sm":{width:"0",opacity:"0"}},"&[data-aside-toggle='false']":{"@sm":{width:"100% !important",opacity:"1 !important"}}}),tg=tr("aside",{display:"flex",flexGrow:"1",flexShrink:"0",width:"0",maxHeight:"100%","&[data-aside-active='true']":{width:"38.2%","@sm":{width:"100%"}},"&[data-aside-toggle='false']":{"@sm":{width:"0 !important"}}}),tv=tr("div",{display:"flex",flexDirection:"column",fontSmooth:"auto",webkitFontSmoothing:"antialiased",'&[data-absolute-position="true"]':{position:"absolute",width:"100%",height:"100%",zIndex:"0"},"> div":{display:"flex",flexDirection:"column",flexGrow:"1",justifyContent:"flex-start",height:"100%",maxHeight:"100%","@sm":{[`& ${th}`]:{flexGrow:"1"},[`& ${tf}`]:{flexGrow:"0"}}},"@sm":{padding:"0"},"&[data-information-panel-open='true']":{"@sm":{}}}),ty=tr(y.bL,{display:"flex",flexDirection:"column",width:"100%",height:"100%",flexGrow:"1",flexShrink:"0",position:"relative",zIndex:"1",maskImage:"linear-gradient(180deg, rgba(0, 0, 0, 1) calc(100% -  2rem), transparent 100%)","@sm":{marginTop:"0.5rem",boxShadow:"none"}}),tb=tr(y.B8,{display:"flex",flexGrow:"0",margin:"0 1.618rem",borderBottom:"5px solid #6663","@sm":{margin:"0 1rem"}}),tw=tr(y.l9,{display:"flex",position:"relative",padding:"0.5rem 1.618rem",background:"none",backgroundColor:"transparent",fontFamily:"inherit",border:"none",opacity:"0.7",fontSize:"1rem",lineHeight:"1rem",whiteSpace:"nowrap",cursor:"pointer",fontWeight:400,transition:"$all","&[data-value='manifest-back']":{display:"none;","@sm":{display:"block"}},"&::after":{width:"0",height:"4px",content:"",position:"absolute",bottom:"-4px",left:"0",transition:"$all"},"&[data-state='active']":{opacity:"1",fontWeight:700,"&::after":{width:"100%",backgroundColor:"$accent"}}}),tx=tr(y.UC,{display:"flex",flexDirection:"column",flexGrow:"1",flexShrink:"0",position:"absolute",top:"0",left:"0","&[data-state='active']":{width:"100%",height:"calc(100% - 2rem)",padding:"1.618rem 0"}}),tE=tr(({handleScroll:e,children:t,className:i})=>d.createElement("div",{className:i,onScroll:e},t),{position:"relative",height:"100%",width:"100%",overflowY:"scroll"}),tS={position:"relative",display:"flex",margin:"0 1.618rem",padding:"0.5rem 0",fontFamily:"inherit",fontSize:"0.8333rem",lineHeight:"1.47rem",color:"inherit",background:"none",borderRadius:"3px",border:"none"},tC=tr("button",{textAlign:"left","&:hover":{color:"$accent"}}),tk=tr("div",{display:"flex",flexDirection:"column",width:"100%",header:{margin:"0 1.618rem 0.5rem ",fontWeight:700,fontSize:"0.8333rem",em:{fontStyle:"normal",fontWeight:400,opacity:.7}},paddingBottom:"1rem",marginBottom:"1rem",borderBottom:"1px solid #0001"}),tA=tr("div",{gap:"1rem",fontSize:"1rem",lineHeight:"1.47em",margin:"0","&[data-content-search=true]":{em:{fontWeight:700,display:"inline"}}}),tI=tr("div",{...tS,display:"flex",flexDirection:"row",gap:"1rem","&[data-format='text/vtt']":{marginTop:"-1rem","> span":{display:"none"}},"> span":{display:"flex",width:"2rem",height:"2rem",backgroundColor:"#0001",flexShrink:"0",borderRadius:"3px",marginTop:"0.25rem"},"&[data-content='None']":{button:{div:{opacity:"0.7"},"&:hover, &:focus":{div:{opacity:"1"}}}},[`&[dir=rtl] ${tA}`]:{textAlign:"right !important"}}),tR=({value:e,handleClick:t})=>d.createElement(tC,{onClick:t},d.createElement(tA,{dangerouslySetInnerHTML:{__html:e}})),tT=({caption:e,handleClick:t,imageUri:i})=>d.createElement(tC,{onClick:t},d.createElement("img",{src:i,alt:`A visual annotation for ${e}`}),d.createElement("span",null,e)),t$=({value:e,handleClick:t})=>{let i=(0,b.A)(e);return d.createElement(tC,{onClick:t},d.createElement(tA,{dangerouslySetInnerHTML:{__html:i.html}}))},tO=({value:e,handleClick:t,isContentSearch:i})=>d.createElement(tC,{onClick:t},d.createElement(tA,{dangerouslySetInnerHTML:{__html:e},"data-content-search":i})),tM=()=>{function e(e){return e.map(e=>{let t=e.identifier||(0,m.A)();return{...e,identifier:t}})}return{addIdentifiersToParsedCues:e,createNestedCues:function(t){var i;let n=[],a=[];for(let r of e(t)){for(;a.length>0&&a[a.length-1].end<=r.start;)a.pop();a.length>0?(a[a.length-1].children||(a[a.length-1].children=[]),null==(i=a[a.length-1].children)||i.push(r)):n.push(r),a.push(r)}return n},isChild:function(e,t=[]){return t.some(t=>e.start>=t.start&&e.end<=t.end)},orderCuesByTime:function(e=[]){return e.sort((e,t)=>e.start-t.start)},parseVttData:function(e){return new Promise((t,i)=>{let n=[],a=new w.WebVTT.Parser(window,w.WebVTT.StringDecoder());a.oncue=e=>{let t=w.WebVTT.convertCueToDOMTree(window,e.text),i=t.innerHTML||"&nbsp;",a=t.textContent||"";n.push({identifier:(0,m.A)(),start:e.startTime,end:e.endTime,align:e.align,html:i,text:a})},a.onflush=()=>t(n),a.onparsingerror=e=>i(e),a.parse(e),a.flush()})}}},tL=tr(x.bL,{display:"flex",flexDirection:"column",width:"100%"}),tP=tr(x.q7,{...tS,justifyContent:"space-between",textAlign:"left",flexGrow:1,margin:0,marginLeft:"-1rem",padding:"0.618rem 1rem",width:"calc(100% + 2rem)",fontSize:"1rem",strong:{marginLeft:"1rem"},"&:hover":{color:"$accent"},"&[aria-checked='true']":{background:"#6662"}}),tF=e=>{for(;e&&e!==document.body;){let t=window.getComputedStyle(e).overflowY;if("visible"!==t&&"hidden"!==t&&e.scrollHeight>e.clientHeight)return e;e=e.parentNode}return null},tz=({html:e,text:t,start:i,end:n})=>{var a,r;let l=e7(),{configOptions:o,isAutoScrollEnabled:s,isUserScrolling:c}=e8(),u=null==(r=null==(a=null==o?void 0:o.informationPanel)?void 0:a.vtt)?void 0:r.autoScroll,[m,p]=(0,d.useState)(!1),h=(0,d.useRef)(null),f=document.getElementById("clover-iiif-video");return(0,d.useEffect)(()=>(null==f||f.addEventListener("timeupdate",()=>{let{currentTime:e}=f;p(i<=e&&e<n)}),()=>document.removeEventListener("timeupdate",()=>{})),[n,i,f]),(0,d.useEffect)(()=>{var e;if(s&&m&&h.current&&!c){let t=h.current;if(t&&t instanceof HTMLElement){let i=tF(t);if(i&&i instanceof HTMLElement){let n;switch(null==(e=null==u?void 0:u.settings)?void 0:e.block){case"center":let a=i.getBoundingClientRect();n=t.offsetTop+t.offsetHeight-Math.floor((a.bottom-a.top)/2);break;case"end":n=t.offsetTop+t.offsetHeight-(i.clientHeight-t.clientHeight)+2;break;default:n=t.offsetTop-2}l({type:"updateAutoScrolling",isAutoScrolling:!0}),(()=>{var e;return i.scrollTo({top:n,left:0,behavior:null==(e=null==u?void 0:u.settings)?void 0:e.behavior})})(),setTimeout(()=>l({type:"updateAutoScrolling",isAutoScrolling:!1}),750)}}}},[u,m,c,s,l]),d.createElement(tP,{ref:h,"aria-checked":m,"data-testid":"information-panel-cue",onClick:()=>{f&&(f.pause(),f.currentTime=i,f.play())},value:t},d.createElement("div",{className:"webvtt-cue",dangerouslySetInnerHTML:{__html:e}}),d.createElement("strong",null,eG(i)))},t_=tr("ul",{listStyle:"none",paddingLeft:"1rem",position:"relative","&&:first-child":{paddingLeft:"0"},"& li ul":{[`& ${tP}`]:{backgroundColor:"unset","&::before":{content:"none"},"&::after":{content:"none"}}},"&:first-child":{margin:"0 0 1.618rem"}}),tj=({items:e})=>d.createElement(t_,null,e.map(e=>{let{html:t,text:i,start:n,end:a,children:r,identifier:l}=e;return d.createElement("li",{key:l},d.createElement(tz,{html:t,text:i,start:n,end:a}),r&&d.createElement(tj,{items:r}))})),tB=({inlineCues:e,label:t,vttUri:i})=>{let[n,a]=d.useState(e||[]),{createNestedCues:r,orderCuesByTime:l,parseVttData:o}=tM(),[s,c]=d.useState();return(0,d.useEffect)(()=>{i&&fetch(i,{headers:{"Content-Type":"text/plain",Accept:"application/json"}}).then(e=>e.text()).then(e=>{o(e).then(e=>{a(r(l(e)))})}).catch(e=>{console.error(i,e.toString()),c(e)})},[i]),d.createElement(tL,{"data-testid":"annotation-item-vtt","aria-label":`${ti(t)}`},s&&d.createElement("div",{"data-testid":"error-message"},"Network Error: ",s.toString()),d.createElement(tj,{items:n}))},tH=e=>{var t;return e&&["ar","fa","ur","ps","dv","sd","ug","ku","he","yi","jrb","jpr","nqo"].includes(Array.isArray(e)?null==(t=e[0])?void 0:t.split("-")[0]:null==e?void 0:e.split("-")[0])?"RTL":"LTR"},tD=e=>{var t,i,n,a,r;let l={id:"string"==typeof e?e:e.source};if("string"==typeof e){if(e.includes("#xywh=")){let t=e.split("#xywh=");if(t&&t[1]){let[e,i,n,a]=t[1].split(",").map(e=>Number(e));l={id:t[0],rect:{x:e,y:i,w:n,h:a}}}}else if(e.includes("#t=")){let t=e.split("#t=");t&&t[1]&&(l={id:t[0],t:t[1]})}}else if("object"==typeof e){if((null==(t=e.selector)?void 0:t.type)==="PointSelector")l={id:e.source,point:{x:e.selector.x,y:e.selector.y}};else if((null==(i=e.selector)?void 0:i.type)==="SvgSelector")l={id:e.source,svg:e.selector.value};else if((null==(n=e.selector)?void 0:n.type)==="FragmentSelector"&&null!=(a=e.selector)&&a.value.includes("xywh=")&&"Canvas"==e.source.type&&e.source.id){let t=null==(r=e.selector)?void 0:r.value.split("xywh=");if(t&&t[1]){let[i,n,a,r]=t[1].split(",").map(e=>Number(e));l={id:e.source.id,rect:{x:i,y:n,w:a,h:r}}}}}return l},tV=({annotation:e,targetResource:t,isContentSearch:i,isContentState:n})=>{var a,r,l,o,s,c,u;let{target:m}=e,p=null==(a=null==m?void 0:m.selector)?void 0:a.type,h=(null==(l=null==(r=null==m?void 0:m.selector)?void 0:r.value)?void 0:l.split("=")[1])||"full",[f,g]="full"!==h?null==h?void 0:h.split(",").slice(2):[100,100],v="PointSelector"===p&&null!=(o=null==m?void 0:m.selector)&&o.t?[{start:null==(s=null==m?void 0:m.selector)?void 0:s.t,end:0,html:" ",text:" ",styles:"",children:[]}]:void 0,y=`${t}/${h}/!${((e,t)=>{let i=Math.max(e,t);return[Math.round(e/i*100),Math.round(t/i*100)].join(",")})(f,g)}/0/default.jpg`,b=e8(),w=e7(),{openSeadragonViewer:x,vault:E,visibleCanvases:S}=b,C=null!=e&&e.body?null==(c=null==e?void 0:e.body)?void 0:c.map(e=>E.get(e.id)):[],{format:k="PointSelector"===p?"text/vtt":"text/plain",language:A="none",value:I="",chars:R=""}=C[0]?C[0]:{},T=(null==(u=C[0])?void 0:u.label)||{none:["t"]},$=I||R||"None",O=A?tH(A).toLocaleLowerCase():"LTR";function M(){var t;let i=null==x?void 0:x.getOverlayById(e.id);if(i&&null!=x&&x.viewport){null!=i&&i.element&&(null==(t=i.element)||t.focus());let e=null==i?void 0:i.getBounds(x.viewport);e.x-=.2,e.y-=.2,e.width+=.5,e.height+=.5,x.viewport.fitBounds(e,!1)}}function L(t){var i;t.preventDefault(),t.stopPropagation();let n=(null==(i=null==e?void 0:e.target)?void 0:i.source)||(null==e?void 0:e.target),a=null==n?void 0:n.id;S.map(e=>e.id).includes(a)?M():w({type:"updateActiveCanvas",canvasId:a})}return(0,d.useEffect)(()=>{if(!x||!n)return;let t=setInterval(()=>{(null==x?void 0:x.getOverlayById(e.id))&&(M(),x.container.className="clover-iiif-content-state",clearInterval(t))},1e3);return()=>clearInterval(t)},[x,n]),d.createElement(tI,{dir:O,"data-format":k,"data-content":$,className:"clover-iiif-annotation-item"},d.createElement("span",{style:{backgroundImage:`url(${y})`,backgroundSize:"cover",backgroundPosition:"center"}}),function(){var e,t,n;switch(k){case"text/plain":return d.createElement(tO,{value:$,handleClick:L,isContentSearch:i});case"text/html":return d.createElement(tR,{value:$,handleClick:L});case"text/markdown":return d.createElement(t$,{value:$,handleClick:L});case"text/vtt":return d.createElement(tB,{inlineCues:v,label:T,vttUri:(null==(e=C[0])?void 0:e.id)||void 0});case null==(t=null==k?void 0:k.match(/^image\//))?void 0:t.input:let a=(null==(n=C.find(e=>{var t;return!(null!=(t=e.id)&&t.includes("vault://"))}))?void 0:n.id)||"";return d.createElement(tT,{caption:I,handleClick:L,imageUri:a});default:return d.createElement(tO,{value:$,handleClick:L})}}())},tW=(e,t="none")=>{if(!e)return null;if("string"==typeof e)return[e];if(!e[t]){let t=Object.getOwnPropertyNames(e);if(t.length>0)return e[t[0]]}return e[t]&&Array.isArray(e[t])?e[t]:null},tN=(e,t="none",i=", ")=>{let n=tW(e,t);return Array.isArray(n)?n.join(`${i}`):n};function tq(e,t){let i=Object.keys(e).filter(e=>t.includes(e)?null:e),n={};return i.forEach(t=>{n[t]=e[t]}),n}let tU=tr("span",{}),tQ=e=>{let{as:t,label:i}=e,n=tq(e,["as","label"]);return d.createElement(tU,{as:t,...n},tN(i,n.lang))},tG=(e,t="200,",i="full")=>{let n;Array.isArray(e)&&(e=e[0]);let{id:a,service:r}=e;if(!r)return a;if(Array.isArray(e.service)&&e.service.length>0&&(n=r[0]),n){if(n["@id"])return`${n["@id"]}/${i}/${t}/0/default.jpg`;if(n.id)return`${n.id}/${i}/${t}/0/default.jpg`}},tJ=tr("img",{objectFit:"cover"}),tX=e=>{let t,i=(0,d.useRef)(null),{contentResource:n,altAsLabel:a,region:r="full"}=e;a&&(t=tN(a));let l=tq(e,["contentResource","altAsLabel"]),{type:o,id:s,width:c=200,height:u=200,duration:m}=n;(0,d.useEffect)(()=>{if(!s&&!i.current||["Image"].includes(o)||!s.includes("m3u8"))return;let e=new S.Ay;return i.current&&(e.attachMedia(i.current),e.on(S.Ay.Events.MEDIA_ATTACHED,function(){e.loadSource(s)})),e.on(S.Ay.Events.ERROR,function(t,i){if(i.fatal)switch(i.type){case S.Ay.ErrorTypes.NETWORK_ERROR:console.error(`fatal ${t} network error encountered, try to recover`),e.startLoad();break;case S.Ay.ErrorTypes.MEDIA_ERROR:console.error(`fatal ${t} media error encountered, try to recover`),e.recoverMediaError();break;default:e.destroy()}}),()=>{e&&(e.detachMedia(),e.destroy())}},[s,o]);let p=(0,d.useCallback)(()=>{if(!i.current)return;let e=0,t=30;if(m&&(t=m),!s.split("#t=")&&m&&(e=.1*m),s.split("#t=").pop()){let t=s.split("#t=").pop();t&&(e=parseInt(t.split(",")[0]))}let n=i.current;n.autoplay=!0,n.currentTime=e,setTimeout(()=>p(),1e3*t)},[m,s]);(0,d.useEffect)(()=>p(),[p]);let h=tG(n,`${c},${u}`,r);switch(o){case"Image":return d.createElement(tJ,{as:"img",alt:t,css:{width:c,height:u},key:s,src:h,...l});case"Video":return d.createElement(tJ,{as:"video",css:{width:c,height:u},disablePictureInPicture:!0,key:s,loop:!0,muted:!0,onPause:p,ref:i,src:s});default:return console.warn(`Resource type: ${o} is not valid or not yet supported in Primitives.`),d.createElement(d.Fragment,null)}},tY=tr("a",{}),tZ=e=>{let{children:t,homepage:i}=e,n=tq(e,["children","homepage"]);return d.createElement(d.Fragment,null,i&&i.map(e=>{let i=tN(e.label,n.lang);return d.createElement(tY,{"aria-label":t?i:void 0,href:e.id,key:e.id,...n},t||i)}))},tK={delimiter:", "},t0=(0,d.createContext)(void 0),t1=()=>{let e=(0,d.useContext)(t0);if(void 0===e)throw Error("usePrimitivesContext must be used with a PrimitivesProvider");return e},t2=({children:e,initialState:t=tK})=>{let i=t3(t,"delimiter");return d.createElement(t0.Provider,{value:{delimiter:i}},e)},t3=(e,t)=>Object.hasOwn(e,t)?e[t].toString():void 0,t4=tr("span",{}),t5=e=>{let{as:t,markup:i}=e,{delimiter:n}=t1();if(!i)return d.createElement(d.Fragment,null);let a=tq(e,["as","markup"]),r={__html:E(tN(i,a.lang,n),{allowedAttributes:{a:["href"],img:["alt","src","height","width"]},allowedSchemes:["http","https","mailto"],allowedTags:["a","b","br","i","img","p","small","span","sub","sup"]})};return d.createElement(t4,{as:t,...a,dangerouslySetInnerHTML:r})},t6=e=>d.useContext(t0)?d.createElement(t5,{...e}):d.createElement(t2,null,d.createElement(t5,{...e})),t8=({as:e="dd",lang:t,value:i})=>d.createElement(t6,{markup:i,as:e,lang:t}),t7=tr("span",{}),t9=({as:e="dd",customValueContent:t,lang:i,value:n})=>{var a;let{delimiter:r}=t1(),l=null==(a=tW(n,i))?void 0:a.map(e=>(0,d.cloneElement)(t,{value:e}));return d.createElement(t7,{as:e,lang:i},null==l?void 0:l.map((e,t)=>[t>0&&`${r}`,d.createElement(d.Fragment,{key:t},e)]))},ie=e=>{var t;let{item:i,lang:n,customValueContent:a}=e,{label:r,value:l}=i,o=null==(t=tN(r))?void 0:t.replace(" ","-").toLowerCase();return d.createElement("div",{role:"group","data-label":o},d.createElement(tQ,{as:"dt",label:r,lang:n}),a?d.createElement(t9,{as:"dd",customValueContent:a,value:l,lang:n}):d.createElement(t8,{as:"dd",value:l,lang:n}))},it=tr("dl",{}),ii=e=>{let{as:t,customValueContent:i,metadata:n}=e;if(!Array.isArray(n))return d.createElement(d.Fragment,null);let a=eY(e,"customValueDelimiter"),r=tq(e,["as","customValueContent","customValueDelimiter","metadata"]);return d.createElement(t2,{..."string"==typeof a?{initialState:{delimiter:a}}:void 0},n.length>0&&d.createElement(it,{as:t,...r},n.map((e,t)=>{let n=i?function(e,t){let i=t.filter(t=>{let{matchingLabel:i}=t,n=Object.keys(t.matchingLabel)[0],a=tN(i,n);if(tN(e,n)===a)return!0}).map(e=>e.Content);if(Array.isArray(i))return i[0]}(e.label,i):void 0;return d.createElement(ie,{customValueContent:n,item:e,key:t,lang:null==r?void 0:r.lang})})))};tr("li",{}),tr("ul",{});let ia=tr("li",{}),ir=tr("ul",{}),il=e=>{let{as:t,rendering:i}=e,n=tq(e,["as","rendering"]);return d.createElement(ir,{as:t},i&&i.map(e=>{let t=tN(e.label,n.lang);return d.createElement(ia,{key:e.id},d.createElement("a",{href:e.id,...n,target:"_blank"},t||e.id))}))},io=tr("dl",{}),is=e=>{let{as:t,requiredStatement:i}=e;if(!i)return d.createElement(d.Fragment,null);let n=eY(e,"customValueDelimiter"),a=tq(e,["as","customValueDelimiter","requiredStatement"]);return d.createElement(t2,{..."string"==typeof n?{initialState:{delimiter:n}}:void 0},d.createElement(io,{as:t,...a},d.createElement(ie,{item:i,lang:a.lang})))},id=tr("li",{}),ic=tr("ul",{}),iu=e=>{let{as:t,seeAlso:i}=e,n=tq(e,["as","seeAlso"]);return d.createElement(ic,{as:t},i&&i.map(e=>{let t=tN(e.label,n.lang);return d.createElement(id,{key:e.id},d.createElement("a",{href:e.id,...n},t||e.id))}))},im=e=>{let{as:t,summary:i}=e,n=tq(e,["as","customValueDelimiter","summary"]);return d.createElement(t6,{as:t,markup:i,...n})},ip=e=>{let{thumbnail:t,region:i}=e,n=tq(e,["thumbnail"]);return d.createElement(d.Fragment,null,t&&t.map(e=>d.createElement(tX,{contentResource:e,key:e.id,region:i,...n})))},ih=({annotationPage:e})=>{var t,i,n,a,r,l;let{vault:o}=e8();if(!e||!e.items||(null==(t=e.items)?void 0:t.length)===0)return d.createElement(d.Fragment,null);let s=e.items.map(e=>o.get(e.id));if(!s)return d.createElement(d.Fragment,null);let c=s.reduce((e,t)=>(e.canvas=t.target.source.id,e.annotations=[],e.annotations.push(null==t?void 0:t.id),e),{}),u=o.get(c.canvas),m=tn(o,u.id),p=null!=(i=null==m?void 0:m[0])&&i.service?(null==(a=null==(n=null==m?void 0:m[0])?void 0:n.service[0])?void 0:a.id)||(null==(l=null==(r=null==m?void 0:m[0])?void 0:r.service[0])?void 0:l["@id"]):void 0;return d.createElement(tk,{"data-testid":"annotation-page"},u&&d.createElement("header",null,d.createElement(tQ,{label:u.label})),d.createElement("div",{"data-testid":"annotation-page-items"},null==s?void 0:s.map(e=>d.createElement(tV,{annotation:e,targetResource:p,key:e.id}))))},ig=tr("div",{form:{display:"flex",alignItems:"center",width:"100%",height:"100%",gap:"1rem",padding:"0 1.618rem 1.618rem",".content-search-input":{flexGrow:"1",input:{width:"100%",border:"none",backgroundColor:"$secondaryMuted",color:"$primary",marginRight:"1rem",height:"2rem",padding:"0 1rem",borderRadius:"1rem",fontFamily:"inherit",fontSize:"1rem",lineHeight:"1rem",boxShadow:"inset 1px 1px 2px #0001","&::placeholder":{color:"#0006"}}}}}),iv=tr("button",{display:"flex",background:"none",border:"none",width:"2rem",height:"2rem",padding:"0",margin:"0",fontWeight:"700",borderRadius:"2rem",backgroundColor:"$accent",color:"$secondary",cursor:"pointer",boxSizing:"content-box",transition:"$all",svg:{height:"60%",width:"60%",padding:"20%",fill:"$secondary",stroke:"$secondary",opacity:"1",filter:"drop-shadow(5px 5px 5px #000D)",boxSizing:"inherit",transition:"$all"},"&:disabled":{backgroundColor:"transparent",boxShadow:"none",svg:{opacity:"0.25"}}}),iy=({searchServiceUrl:e,setContentSearchResource:t,setLoading:i})=>{let{t:n}=(0,s.Bd)(),[a,r]=(0,d.useState)(),{openSeadragonViewer:l,vault:o}=e8();async function c(n){if(n.preventDefault(),l&&e){if(!a||""===a.trim())return void t({});i(!0),te(o,e,{q:a}).then(e=>{t(e),i(!1)})}}let u=n("contentSearchPlaceholder");return d.createElement(ig,null,d.createElement(C.bL,{onSubmit:c,className:"content-search-form"},d.createElement(C.D0,{className:"content-search-input",name:"searchTerms",onChange:e=>{e.preventDefault(),r(e.target.value)}},d.createElement(C.Ec,{placeholder:u})),d.createElement(C.XT,{asChild:!0},d.createElement(iv,{type:"submit"},d.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},d.createElement("title",null,n("informationPanelTabsSearch")),d.createElement("path",{d:"M456.69 421.39L362.6 327.3a173.81 173.81 0 0034.84-104.58C397.44 126.38 319.06 48 222.72 48S48 126.38 48 222.72s78.38 174.72 174.72 174.72A173.81 173.81 0 00327.3 362.6l94.09 94.09a25 25 0 0035.3-35.3zM97.92 222.72a124.8 124.8 0 11124.8 124.8 124.95 124.95 0 01-124.8-124.8z"}))))))},ib=({searchServiceUrl:e,setContentSearchResource:t,activeCanvas:i,annotationPage:n})=>{let a,{vault:r}=e8(),{t:l}=(0,s.Bd)(),[o,c]=(0,d.useState)(!1),[u,m]=(0,d.useState)({});return(0,d.useEffect)(()=>{var e;null!=n&&n.items&&m((null==(e=null==n?void 0:n.items)?void 0:e.map(e=>r.get(e.id))).reduce((e,t)=>{let i=t.target.source.id;return e[i]||(e[i]=[]),e[i].push(t.id),e},{}))},[n]),d.createElement(d.Fragment,null,d.createElement(iy,{searchServiceUrl:e,setContentSearchResource:t,activeCanvas:i,setLoading:c}),o?d.createElement("span",null,l("contentSearchLoading")):u&&Object.keys(u).length>0&&Object.keys(u).map(e=>(a=r.get(e),d.createElement(tk,{key:e,"data-testid":"annotation-page"},a&&d.createElement("header",null,d.createElement(tQ,{label:a.label})),u[e].map(e=>{var t,i,n,l,o;let s=r.get(e),c=tn(r,a.id),u=null!=(t=null==c?void 0:c[0])&&t.service?(null==(n=null==(i=null==c?void 0:c[0])?void 0:i.service[0])?void 0:n.id)||(null==(o=null==(l=null==c?void 0:c[0])?void 0:l.service[0])?void 0:o["@id"]):void 0;return d.createElement(tV,{annotation:s,targetResource:u,key:s.id,isContentSearch:!0})})))))},iw=tr("div",{width:"100%",padding:" 0 1.618rem 2rem",display:"flex",flexDirection:"column",overflow:"auto",position:"absolute",fontWeight:"400",fontSize:"1rem",zIndex:"0",img:{maxWidth:"100px",maxHeight:"100px",objectFit:"contain",color:"transparent",margin:"0 0 1rem",borderRadius:"3px",backgroundColor:"$secondaryMuted"},video:{display:"none"},"a, a:visited":{color:"$accent"},p:{fontSize:"1rem",lineHeight:"1.47em",margin:"0"},dl:{margin:"0",dt:{fontWeight:"700",margin:"1rem 0 0.25rem"},dd:{margin:"0"}},".manifest-property-title":{fontWeight:"700",margin:"1rem 0 0.25rem"},"ul, ol":{padding:"0",margin:"0",li:{fontSize:"1rem",lineHeight:"1.45em",listStyle:"none",margin:"0.25rem 0 0.25rem"}}}),ix=tr("div",{position:"relative",width:"100%",height:"100%",zIndex:"0"}),iE=({homepage:e})=>(null==e?void 0:e.length)===0?d.createElement(d.Fragment,null):d.createElement(d.Fragment,null,d.createElement("span",{className:"manifest-property-title"},"Homepage"),d.createElement(tZ,{homepage:e})),iS=({id:e,htmlLabel:t,parent:i="manifest"})=>d.createElement(d.Fragment,null,d.createElement("span",{className:"manifest-property-title"},t),d.createElement("a",{href:e,target:"_blank",id:`iiif-${i}-id`},e)),iC=({metadata:e,parent:t="manifest"})=>e?d.createElement(d.Fragment,null,d.createElement(ii,{metadata:e,id:`iiif-${t}-metadata`})):d.createElement(d.Fragment,null),ik=({rendering:e})=>(null==e?void 0:e.length)===0?d.createElement(d.Fragment,null):d.createElement(d.Fragment,null,d.createElement("span",{className:"manifest-property-title"},"Alternate formats"),d.createElement(il,{rendering:e})),iA=({requiredStatement:e,parent:t="manifest"})=>e?d.createElement(d.Fragment,null,d.createElement(is,{requiredStatement:e,id:`iiif-${t}-required-statement`})):d.createElement(d.Fragment,null),iI=({rights:e})=>e?d.createElement(d.Fragment,null,d.createElement("span",{className:"manifest-property-title"},"Rights"),d.createElement("a",{href:e,target:"_blank"},e)):d.createElement(d.Fragment,null),iR=({seeAlso:e})=>(null==e?void 0:e.length)===0?d.createElement(d.Fragment,null):d.createElement(d.Fragment,null,d.createElement("span",{className:"manifest-property-title"},"See Also"),d.createElement(iu,{seeAlso:e})),iT=({summary:e,parent:t="manifest"})=>e?d.createElement(d.Fragment,null,d.createElement(im,{summary:e,as:"p",id:`iiif-${t}-summary`})):d.createElement(d.Fragment,null),i$=({label:e,thumbnail:t})=>(null==t?void 0:t.length)===0?d.createElement(d.Fragment,null):d.createElement(d.Fragment,null,d.createElement(ip,{altAsLabel:e||{none:["resource"]},thumbnail:t,style:{backgroundColor:"#6663",objectFit:"cover"}})),iO=()=>{let{activeManifest:e,vault:t}=e8(),[i,n]=(0,d.useState)(),[a,r]=(0,d.useState)([]),[l,o]=(0,d.useState)([]),[s,c]=(0,d.useState)([]),[u,m]=(0,d.useState)([]);return(0,d.useEffect)(()=>{var i,a,l,s;let d=t.get(e);d&&(n(d),(null==(i=d.homepage)?void 0:i.length)>0&&r(t.get(d.homepage)),(null==(a=d.seeAlso)?void 0:a.length)>0&&o(t.get(d.seeAlso)),(null==(l=d.rendering)?void 0:l.length)>0&&c(t.get(d.rendering)),(null==(s=d.thumbnail)?void 0:s.length)>0&&m(t.get(d.thumbnail)))},[e,t]),i?d.createElement(ix,null,d.createElement(iw,null,d.createElement(i$,{thumbnail:u,label:i.label}),d.createElement(iT,{summary:i.summary}),d.createElement(iC,{metadata:i.metadata}),d.createElement(iA,{requiredStatement:i.requiredStatement}),d.createElement(iI,{rights:i.rights}),d.createElement(iE,{homepage:a}),d.createElement(iR,{seeAlso:l}),d.createElement(ik,{rendering:s}),d.createElement(iS,{id:i.id,htmlLabel:"IIIF Manifest"}))):d.createElement(d.Fragment,null)},iM=({contentStateAnnotation:e})=>{var t,i,n,a,r,l;let{vault:o}=e8();if(!e)return d.createElement(d.Fragment,null);let s=(null==(t=null==e?void 0:e.target)?void 0:t.source)||(null==e?void 0:e.target),c=o.get(null==s?void 0:s.id),u=tn(o,c.id),m=null!=(i=null==u?void 0:u[0])&&i.service?(null==(a=null==(n=null==u?void 0:u[0])?void 0:n.service[0])?void 0:a.id)||(null==(l=null==(r=null==u?void 0:u[0])?void 0:r.service[0])?void 0:l["@id"]):void 0;return d.createElement(tk,{"data-testid":"annotation-page"},c&&d.createElement("header",null,d.createElement(tQ,{label:c.label})," ",d.createElement("em",null,"(Shared)")),d.createElement("div",{"data-testid":"annotation-page-items"},d.createElement(tV,{annotation:e,targetResource:m,key:e.id,isContentState:!0})))},iL=({activeCanvas:e,annotationResources:t,searchServiceUrl:i,setContentSearchResource:n,contentSearchResource:a})=>{var r;let{t:l}=(0,s.Bd)(),o=e7(),{contentStateAnnotation:c,informationPanelResource:u,isAutoScrolling:m,isUserScrolling:p,vault:h,configOptions:f,plugins:v}=e8(),{informationPanel:y}=f,b=null==y?void 0:y.renderAbout,w=null==y?void 0:y.renderAnnotation,x=h.get({id:e,type:"Canvas"}),E=null==y?void 0:y.renderContentSearch,S=null==y?void 0:y.renderToggle,C=(null==(r=null==c?void 0:c.target)?void 0:r.source)||(null==c?void 0:c.target),k=!!c&&C.id===e,A=!!(null!=t&&t.length)||k,{pluginsWithInfoPanel:I}=function(e){let t=[];return e.forEach(e=>{var i;null!=(i=e.informationPanel)&&i.component&&t.push(e)}),{pluginsWithInfoPanel:t}}(v);return(0,d.useEffect)(()=>{["manifest-about","manifest-annotations","manifest-content-search"].includes(String(null==y?void 0:y.defaultTab))?o({type:"updateInformationPanelResource",informationPanelResource:null==y?void 0:y.defaultTab}):o(k?{type:"updateInformationPanelResource",informationPanelResource:"manifest-annotations"}:{type:"updateInformationPanelResource",informationPanelResource:"manifest-about"})},[]),(0,d.useEffect)(()=>{A||o({type:"updateInformationPanelResource",informationPanelResource:"manifest-about"})},[A]),d.createElement(ty,{"data-testid":"information-panel",defaultValue:u,onValueChange:e=>{o({type:"updateInformationPanelResource",informationPanelResource:e})},orientation:"horizontal",value:u,className:"clover-viewer-information-panel"},d.createElement(tb,{"aria-label":l("informationPanelTabs"),"data-testid":"information-panel-list"},S&&d.createElement(tw,{value:"manifest-back","data-value":"manifest-back",onClick:()=>{o({type:"updateInformationOpen",isInformationOpen:!1})},as:"button"},l("informationPanelTabsClose")),b&&d.createElement(tw,{value:"manifest-about"},l("informationPanelTabsAbout")),E&&a&&d.createElement(tw,{value:"manifest-content-search"},l("informationPanelTabsSearch")),w&&A&&d.createElement(tw,{value:"manifest-annotations"},l("informationPanelTabsAnnotations")),I&&I.map((e,t)=>{var i;return d.createElement(tw,{key:t,value:e.id},d.createElement(tQ,{label:null==(i=e.informationPanel)?void 0:i.label}))})),d.createElement(tE,{handleScroll:function(){if(!m){clearTimeout(p);let e=setTimeout(()=>{o({type:"updateUserScrolling",isUserScrolling:void 0})},1500);o({type:"updateUserScrolling",isUserScrolling:e})}}},b&&d.createElement(tx,{value:"manifest-about"},d.createElement(iO,null)),E&&a&&d.createElement(tx,{value:"manifest-content-search"},d.createElement(ib,{searchServiceUrl:i,setContentSearchResource:n,activeCanvas:e,annotationPage:a})),w&&t&&d.createElement(tx,{value:"manifest-annotations"},c&&k&&d.createElement(iM,{contentStateAnnotation:c}),t.map(e=>d.createElement(ih,{key:e.id,annotationPage:e}))),I&&I.map((e,t)=>(function(e,t){var i,n;let a=null==(i=null==e?void 0:e.informationPanel)?void 0:i.component;return void 0===a?d.createElement(d.Fragment,null):d.createElement(tx,{key:t,value:e.id},d.createElement(g.ErrorBoundary,{FallbackComponent:tm},d.createElement(a,{...null==(n=null==e?void 0:e.informationPanel)?void 0:n.componentProps,canvas:x,useViewerDispatch:e7,useViewerState:e8})))})(e,t))))},iP=tr("svg",{display:"inline-flex",variants:{isLarge:{true:{height:"4rem",width:"4rem"}},isMedium:{true:{height:"2rem",width:"2rem"}},isSmall:{true:{height:"1rem",width:"1rem"}}}}),iF=e=>d.createElement(iP,{...e,"data-testid":"icon-svg",role:"img",viewBox:"0 0 512 512",xmlns:"http://www.w3.org/2000/svg"},e.children);iF.Title=({children:e})=>d.createElement("title",null,e),iF.Add=()=>d.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32",d:"M256 112v288M400 256H112"}),iF.Audio=()=>d.createElement(d.Fragment,null,d.createElement("path",{d:"M232 416a23.88 23.88 0 01-14.2-4.68 8.27 8.27 0 01-.66-.51L125.76 336H56a24 24 0 01-24-24V200a24 24 0 0124-24h69.75l91.37-74.81a8.27 8.27 0 01.66-.51A24 24 0 01256 120v272a24 24 0 01-24 24zm-106.18-80zm-.27-159.86zM320 336a16 16 0 01-14.29-23.19c9.49-18.87 14.3-38 14.3-56.81 0-19.38-4.66-37.94-14.25-56.73a16 16 0 0128.5-14.54C346.19 208.12 352 231.44 352 256c0 23.86-6 47.81-17.7 71.19A16 16 0 01320 336z"}),d.createElement("path",{d:"M368 384a16 16 0 01-13.86-24C373.05 327.09 384 299.51 384 256c0-44.17-10.93-71.56-29.82-103.94a16 16 0 0127.64-16.12C402.92 172.11 416 204.81 416 256c0 50.43-13.06 83.29-34.13 120a16 16 0 01-13.87 8z"}),d.createElement("path",{d:"M416 432a16 16 0 01-13.39-24.74C429.85 365.47 448 323.76 448 256c0-66.5-18.18-108.62-45.49-151.39a16 16 0 1127-17.22C459.81 134.89 480 181.74 480 256c0 64.75-14.66 113.63-50.6 168.74A16 16 0 01416 432z"})),iF.Close=()=>d.createElement("path",{d:"M289.94 256l95-95A24 24 0 00351 127l-95 95-95-95a24 24 0 00-34 34l95 95-95 95a24 24 0 1034 34l95-95 95 95a24 24 0 0034-34z"}),iF.Download=()=>d.createElement(d.Fragment,null,d.createElement("path",{d:"M336 176h40a40 40 0 0140 40v208a40 40 0 01-40 40H136a40 40 0 01-40-40V216a40 40 0 0140-40h40",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32"}),d.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32",d:"M176 272l80 80 80-80M256 48v288"})),iF.Image=()=>d.createElement("path",{d:"M416 64H96a64.07 64.07 0 00-64 64v256a64.07 64.07 0 0064 64h320a64.07 64.07 0 0064-64V128a64.07 64.07 0 00-64-64zm-80 64a48 48 0 11-48 48 48.05 48.05 0 0148-48zM96 416a32 32 0 01-32-32v-67.63l94.84-84.3a48.06 48.06 0 0165.8 1.9l64.95 64.81L172.37 416zm352-32a32 32 0 01-32 32H217.63l121.42-121.42a47.72 47.72 0 0161.64-.16L448 333.84z"}),iF.Video=()=>d.createElement("path",{d:"M464 384.39a32 32 0 01-13-2.77 15.77 15.77 0 01-2.71-1.54l-82.71-58.22A32 32 0 01352 295.7v-79.4a32 32 0 0113.58-26.16l82.71-58.22a15.77 15.77 0 012.71-1.54 32 32 0 0145 29.24v192.76a32 32 0 01-32 32zM268 400H84a68.07 68.07 0 01-68-68V180a68.07 68.07 0 0168-68h184.48A67.6 67.6 0 01336 179.52V332a68.07 68.07 0 01-68 68z"});let iz=to({"0%":{opacity:0,transform:"translateY(1rem)"},"100%":{opacity:1,transform:"translateY(0)"}}),i_=to({"0%":{opacity:0,transform:"translateY(1rem)"},"100%":{opacity:1,transform:"translateY(0)"}}),ij=tr(k.i3,{fill:"$secondaryAlt"}),iB=tr(k.bm,{position:"absolute",right:"0",top:"0",padding:"0.5rem",margin:"0",cursor:"pointer",border:"none",background:"none",fill:"inherit","&:hover":{opacity:"0.75"}}),iH=tr(k.UC,{border:"none",backgroundColor:"white",fill:"inhrerit",padding:"1rem 2rem 1rem 1rem",width:"auto",minWidth:"200px",maxWidth:"350px",borderRadius:"3px",boxShadow:"5px 5px 13px #0002",animationDuration:"0.3s",animationTimingFunction:"cubic-bezier(0.16, 1, 0.3, 1)",'&[data-side="top"]':{animationName:i_},'&[data-side="bottom"]':{animationName:iz},'&[data-align="end"]':{[`& ${ij}`]:{margin:"0 0.7rem"}}}),iD=tr(k.l9,{display:"inline-flex",padding:"0.5rem 0",margin:"0 0.5rem 0 0",cursor:"pointer",border:"none",background:"none","> button, > span":{margin:"0"}}),iV=tr(k.bL,{boxSizing:"content-box"}),iW=({children:e})=>d.createElement(iV,null,e);iW.Trigger=e=>d.createElement(iD,{...e},e.children),iW.Content=e=>d.createElement(iH,{...e,sideOffset:5,collisionPadding:21},d.createElement(ij,null),d.createElement(iB,null,d.createElement(iF,{isSmall:!0},d.createElement(iF.Close,null))),e.children);let iN=tr("div",{boxSizing:"border-box",display:"inline-flex",alignItems:"center",borderRadius:"2px",padding:"$1",marginBottom:"$2",marginRight:"$2",backgroundColor:"$lightGrey",color:"$richBlack50",textTransform:"uppercase",fontSize:"$2",objectFit:"contain",lineHeight:"1em !important","&:last-child":{marginRight:"0"},[`${iP}`]:{position:"absolute",left:"$1",height:"$3",width:"$3"},variants:{isIcon:{true:{position:"relative",paddingLeft:"$5"}}}}),iq=tr("span",{background:"transparent",opacity:"0",border:"3px solid transparent",position:"absolute",width:"100%",height:"100%",zIndex:"0",left:"0",top:"0",transition:"$all"}),iU=tr("span",{display:"flex"}),iQ=tr("span",{display:"flex",width:"1.2111rem",height:"0.7222rem"}),iG=tr("span",{display:"inline-flex",marginLeft:"5px",marginBottom:"-1px"}),iJ=tr("div",{position:"relative",display:"flex",backgroundColor:"$secondaryAlt",width:"inherit",height:"100px",overflow:"hidden",borderRadius:"3px",".media-thumbnail-lazyload":{width:"100%",height:"100%",borderRadius:"3px"},img:{width:"100%",height:"100%",objectFit:"cover",objectPosition:"top center",filter:"blur(0)",transform:"scale3d(1, 1, 1)",borderRadius:"3px",transition:"$all",color:"transparent"},[`& ${iU}`]:{position:"absolute",right:"0",bottom:"0",[`& ${iN}`]:{display:"none",margin:"0",paddingLeft:"0",fontSize:"0.7222rem",backgroundColor:"#000d",color:"$secondary",fill:"$secondary",borderBottomLeftRadius:"0",borderTopRightRadius:"0"}}}),iX=tr(x.q7,{display:"flex",flexShrink:"0",padding:"0",cursor:"pointer",background:"none",border:"none",fontFamily:"inherit",lineHeight:"1.25em",fontSize:"1rem",textAlign:"left",figure:{margin:"0",width:"161.8px",figcaption:{marginTop:"0.5rem",fontWeight:"400",fontSize:"0.8333rem",display:"-webkit-box",overflow:"hidden",MozBoxOrient:"vertical",WebkitBoxOrient:"vertical",WebkitLineClamp:"5","@sm":{fontSize:"0.8333rem"}}}}),iY=tr(x.bL,{display:"flex",flexDirection:"row",flexGrow:"1",overflowX:"scroll",position:"relative",zIndex:"0",gap:"1rem",padding:"1.618rem 0"}),iZ=tr("div",{display:"flex",flexDirection:"row","&[data-active='true']":{[`& ${iX}`]:{figcaption:{fontWeight:"700"},[`& ${iN}`]:{backgroundColor:"$accent"},[`& ${iq}`]:{background:"#0003",opacity:"1",borderBottom:"3px solid $accent"},"&:first-of-type":{[`& ${iq}`]:{borderRight:"unset"}},"&:last-of-type":{[`& ${iq}`]:{borderLeft:"unset"}}}},[`& ${iX}`]:{[`& ${iJ}`]:{borderRadius:"unset"},"&:first-of-type":{[`& ${iJ}`]:{borderTopLeftRadius:"3px",borderBottomLeftRadius:"3px"}},"&:last-of-type":{[`& ${iJ}`]:{borderTopRightRadius:"3px",borderBottomRightRadius:"3px"},[`& ${iN}`]:{display:"flex"}}}}),iK=tr("div",{position:"absolute",right:"1rem",top:"1rem",display:"flex",justifyContent:"flex-end",zIndex:"1"}),i0=tr("input",{flexGrow:"1",border:"none",backgroundColor:"$secondaryMuted",color:"$primary",marginRight:"1rem",height:"2rem",padding:"0 1rem",borderRadius:"2rem",fontFamily:"inherit",fontSize:"1rem",lineHeight:"1rem",boxShadow:"inset 1px 1px 2px #0001","&::placeholder":{color:"$primaryMuted"}}),i1=tr("button",{display:"flex",background:"none",border:"none",width:"2rem !important",height:"2rem !important",padding:"0",margin:"0",fontWeight:"700",borderRadius:"2rem",backgroundColor:"$accent",color:"$secondary",cursor:"pointer",boxSizing:"content-box !important",transition:"$all",svg:{height:"60%",width:"60%",padding:"20%",fill:"$secondary",stroke:"$secondary",opacity:"1",filter:"drop-shadow(5px 5px 5px #000D)",boxSizing:"inherit",transition:"$all"},"&:disabled":{backgroundColor:"transparent",boxShadow:"none",svg:{opacity:"0.25"}}}),i2=tr("div",{display:"flex",marginRight:"0.618rem",backgroundColor:"$accentAlt",borderRadius:"2rem",boxShadow:"5px 5px 5px #0003",color:"$secondary",alignItems:"center","> span":{display:"flex",margin:"0 0.5rem",fontSize:"0.7222rem",fontWeight:"bold",gap:"0.25rem",em:{opacity:"0.25"}}}),i3=tr("div",{display:"flex",position:"relative",zIndex:"1",width:"100%",padding:"0",transition:"$all",variants:{isToggle:{true:{paddingTop:"2.618rem",[`& ${iK}`]:{width:"calc(100% - 2rem)","@sm":{width:"calc(100% - 2rem)"}}}}}}),i4=(e,t)=>{(0,d.useEffect)(()=>{function i(i){i.key===e&&t()}return window.addEventListener("keyup",i),()=>window.removeEventListener("keyup",i)},[])},i5=({title:e})=>d.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},d.createElement("title",null,e),d.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M244 400L100 256l144-144M120 256h292"})),i6=({title:e})=>d.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},d.createElement("title",null,e),d.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M268 112l144 144-144 144M392 256H100"})),i8=({title:e})=>d.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},d.createElement("title",null,e),d.createElement("path",{d:"M289.94 256l95-95A24 24 0 00351 127l-95 95-95-95a24 24 0 00-34 34l95 95-95 95a24 24 0 1034 34l95-95 95 95a24 24 0 0034-34z"})),i7=({title:e})=>d.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},d.createElement("title",null,e),d.createElement("path",{d:"M456.69 421.39L362.6 327.3a173.81 173.81 0 0034.84-104.58C397.44 126.38 319.06 48 222.72 48S48 126.38 48 222.72s78.38 174.72 174.72 174.72A173.81 173.81 0 00327.3 362.6l94.09 94.09a25 25 0 0035.3-35.3zM97.92 222.72a124.8 124.8 0 11124.8 124.8 124.95 124.95 0 01-124.8-124.8z"})),i9=({handleCanvasToggle:e,handleFilter:t,activeIndex:i,canvasLength:n})=>{let[a,r]=(0,d.useState)(!1),[l,o]=(0,d.useState)(!1),[c,u]=(0,d.useState)(!1),{t:m}=(0,s.Bd)();return(0,d.useEffect)(()=>{u(0===i),i===n-1?o(!0):o(!1)},[i,n]),i4("Escape",()=>{r(!1),t("")}),d.createElement(i3,{isToggle:a},d.createElement(iK,null,a&&d.createElement(i0,{autoFocus:!0,onChange:e=>t(e.target.value),placeholder:m("commonSearchPlaceholder")}),!a&&d.createElement(i2,null,d.createElement(i1,{onClick:()=>e(-1),disabled:c,type:"button"},d.createElement(i5,{title:m("commonPrevious")})),d.createElement("span",null,i+1," ",d.createElement("em",null,"/")," ",n),d.createElement(i1,{onClick:()=>e(1),disabled:l,type:"button"},d.createElement(i6,{title:m("commonNext")}))),d.createElement(i1,{onClick:()=>{r(e=>!e),t("")},type:"button",className:"clover-viewer-media-search"},a?d.createElement(i8,{title:m("commonClose")}):d.createElement(i7,{title:m("commonSearch")}))))},ne=({children:e,rootMargin:t="100px",attributes:i={},isVisibleCallback:n=()=>{}})=>{let a=(0,d.useRef)(null),[r,l]=(0,d.useState)(!1);return(0,d.useEffect)(()=>{let e=a.current;if(!e)return;let i=new IntersectionObserver(([e])=>{e.isIntersecting&&(n(!0),l(!0),i.disconnect())},{rootMargin:t});return i.observe(e),()=>i.disconnect()},[a]),d.createElement("div",{ref:a,...i},r?e:null)};var nt={},ni={get:e=>e,setMetaValue([e,t,i],n){let a=ni.getResourceMeta(e,t),r=a?a[i]:void 0,l="function"==typeof n?n(r):n;nt[e]={...nt[e]||{},[t]:{...(nt[e]||{})[t]||{},[i]:l}}},getResourceMeta:(e,t)=>{let i=nt[e];if(i)return t?i[t]:i},load:async e=>fetch("string"==typeof e?e:e.id).then(e=>e.json()),requestStatus(e){}},nn=Object.defineProperty,na=(e,t,i)=>t in e?nn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,nr=(e,t,i)=>(na(e,"symbol"!=typeof t?t+"":t,i),i);function nl(e){return e.endsWith("info.json")?e:e.endsWith("/")?`${e}info.json`:`${e}/info.json`}var no="http://library.stanford.edu/iiif/image-api/compliance.html#level1",ns="http://library.stanford.edu/iiif/image-api/compliance.html#level2",nd="http://library.stanford.edu/iiif/image-api/conformance.html#level1",nc="http://library.stanford.edu/iiif/image-api/conformance.html#level2",nu="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1",nm="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2",np="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level1",nh="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level2",nf="http://iiif.io/api/image/1/level1.json",ng="http://iiif.io/api/image/1/profiles/level1.json",nv="http://iiif.io/api/image/1/level2.json",ny="http://iiif.io/api/image/1/profiles/level2.json",nb="http://iiif.io/api/image/2/level1.json",nw="http://iiif.io/api/image/2/profiles/level1.json",nx="http://iiif.io/api/image/2/level2.json",nE="http://iiif.io/api/image/2/profiles/level2.json",nS="level1",nC="level2",nk="http://iiif.io/api/image/2/level1",nA="http://iiif.io/api/image/2/level2",nI="https://iiif.io/api/image/1.1/compliance/#level1",nR="https://iiif.io/api/image/1.1/compliance/#level2",nT=[nA,ns,nc,nm,nh,nv,ny,nx,nE,nC,nR],n$=[...nT,nk,no,nd,nu,np,nf,ng,nb,nw,nS,nI],nO=["http://iiif.io/api/image/2/level0",nk,nA,"http://library.stanford.edu/iiif/image-api/compliance.html#level0",no,ns,"http://library.stanford.edu/iiif/image-api/conformance.html#level0",nd,nc,"http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0",nu,nm,"http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level0",np,nh,"http://iiif.io/api/image/1/level0.json","http://iiif.io/api/image/1/profiles/level0.json",nf,ng,nv,ny,"http://iiif.io/api/image/2/level0.json","http://iiif.io/api/image/2/profiles/level0.json",nb,nw,nx,nE,"level0",nS,nC,"https://iiif.io/api/image/1.1/compliance/#level0",nI,nR],nM={extraFormats:["jpg"],extraQualities:["default"],extraFeatures:["sizeByWhListed"]},nL={extraFormats:["jpg"],extraQualities:["default"],extraFeatures:["baseUriRedirect","cors","jsonldMediaType","regionByPx","regionSquare","sizeByWhListed","sizeByH","sizeByW","sizeByWh"]},nP={extraFormats:["jpg","png"],extraQualities:["default"],extraFeatures:["baseUriRedirect","cors","jsonldMediaType","regionByPct","regionByPx","regionSquare","rotationBy90s","sizeByWhListed","sizeByConfinedWh","sizeByH","sizeByPct","sizeByW","sizeByWh"]};function nF(e){return e["@id"]?e["@id"]:e.id?e.id:void 0}function nz(e){if(!e||!e.profile||!nF(e))return!1;for(let t of Array.isArray(e.profile)?e.profile:[e.profile])if("string"==typeof t&&-1!==nO.indexOf(t))return!0;return!1}function n_(e,t){if(t&&t.profile){let i=t.profile;if(i){let t=Array.isArray(i)?i:[i];return t.includes(`level${e}`)||t.includes(`http://iiif.io/api/image/2/level${e}.json`)||t.includes(`http://iiif.io/api/image/1/level${e}.json`)||t.includes(`http://iiif.io/api/image/1/profiles/level${e}.json`)}}return!1}function nj(e){return nz(e)?n_(0,e)?0:n_(1,e)?1:n_(2,e)?2:null:null}function nB(e){return -1!==(e["@context"]?Array.isArray(e["@context"])?e["@context"]:[e["@context"]]:[]).indexOf("http://iiif.io/api/image/3/context.json")}function nH(e){let t=e.match(/^.*\/(full)\/(((\d+),(\d+)?)|max)\/(\d+)\/default\.(jpg|png|jpeg)$/);if(t&&t[4]&&t[5]){let i=t[1],n=parseInt(t[4],10),a=parseInt(t[5],10),r=t[7];if(("max"===i||"full"===i)&&n&&a&&r)return{type:"fixed",id:e,height:a,width:n}}return{type:"unknown",id:e}}function nD(e){if("string"==typeof e)return nH(e);let t=e["@type"]?e["@type"]:e.type?e.type:void 0;if("Image"!==t&&"sc:Image"!==t)return null;let i=nF(e);return i?i&&e.width&&e.height?{id:i,type:"fixed",width:e.width,height:e.height,unsafe:!0}:nH(i):null}function nV(e){let t=[],i=e.length;for(let n=0;n<i;n++){let i=e[n];if(!i)continue;let a=function(e){return nz(e)?(e&&e.sizes?e.sizes:[]).map(t=>({id:nF(e),type:"fixed-service",height:t.height,width:t.width,level:nj(e),version:nB(e)?3:2})):[]}(i);a.length&&t.push(...a);let r=function(e){if(!function(e){if(!nz(e))return!1;for(let t of Array.isArray(e.profile)?e.profile:[e.profile])if("string"==typeof t){if(-1!==n$.indexOf(t))return!0}else{let e=[...t.supports||[],...t.extraFeatures||[]];if(-1!==e.indexOf("regionByPx")&&(-1!==e.indexOf("sizeByW")||-1!==e.indexOf("sizeByWh")))return!0}return!1}(e))return[];let t=[],i=Array.isArray(e.profile)?e.profile:[e.profile],n=i.length;for(let t=0;t<n;t++){let n=i[t];if(n&&"string"!=typeof n&&(n.maxHeight||n.maxWidth))return[{id:nF(e),type:"variable",minWidth:0,minHeight:0,maxHeight:n.maxHeight||n.maxWidth,maxWidth:n.maxWidth||n.maxHeight,level:nj(e),version:"http://iiif.io/api/image/3/context.json"===e["@context"]?3:2}]}if(e.tiles){let i=e.tiles.length;for(let n=0;n<i;n++){let i=e.tiles[n];i&&(i.height||i.width)&&t.push({id:nF(e),type:"variable",minHeight:0,minWidth:0,maxHeight:i.height||i.width,maxWidth:i.width,level:nj(e),version:nB(e)?3:2})}}return t}(i);r.length&&t.push(...r)}return t}function nW(e){let t=e.service?Array.isArray(e.service)?e.service:[e.service]:[],i=t.length,n=[];for(let e=0;e<i;e++)nz(t[e])&&n.push(t[e]);return n}function nN(e,t,i){let n=function(e){let t=function(e,t=""){let{path:i,scheme:n,server:a,prefix:r}=function(e,t=""){let i=e.match(/^(([a-zA-Z]+):\/\/([^/]+))?((.*)+)/);if(!i)throw Error(`Invalid or unknown input ${e}`);let n=i[2],a=i[3],r=i[4];if("/"===r[0]&&(r=r.substring(1)),t.length>0){if("/"===t[0]&&(t=t.substring(1)),t!==r.substring(0,t.length))throw Error(`Path does not start with prefix (path: ${r}, prefix: ${t})`);r=r.substring(t.length)}return{scheme:n,server:a,path:r,prefix:t}}(e,t),l=(i||"").split("/").reverse(),[o,s,d,c,...u]=l,m=u.reverse().filter(Boolean).join("/");if(1===l.length||""===o)return{type:"base",scheme:n,server:a,prefix:r,identifier:m};if("info.json"===o){let[,...e]=l;return{type:"info",scheme:n,server:a,prefix:r,identifier:e.reverse().filter(Boolean).join("/")}}let p=(o||"").split(".");if(typeof p[1]>"u"||typeof p[0]>"u"||typeof c>"u"||typeof d>"u"||typeof s>"u")throw Error("Invalid image request");return{type:"image",scheme:n,server:a,prefix:r,identifier:m,originalPath:i,region:function(e){try{if("full"===e)return{full:!0};if("square"===e)return{square:!0};let t=e.startsWith("pct:"),i=e.substr(4*!!t).split(",").map(e=>parseFloat(e));return{x:i[0],y:i[1],w:i[2],h:i[3],percent:t}}catch{throw Error("Expected 'full', 'square' or 'x,y,w,h'. Found "+e)}}(c),size:function(e){let t={upscaled:!1,max:!1,confined:!1};if("^"===e[0]&&(t.upscaled=!0,e=e.slice(1)),"max"===e||"full"===e)return t.max=!0,t.serialiseAsFull="full"===e,t;if("!"===e[0]&&(t.confined=!0,e=e.slice(1)),"p"===e[0])return t.percentScale=parseFloat(e.slice(4)),t;let i=e.split(",").map(e=>e.trim());return i.length&&"u">typeof i[0]&&(""!==i[0]&&(t.width=parseInt(i[0],10)),"u">typeof i[1]&&""!==i[1]?(t.height=parseInt(i[1],10),t.version=2):t.version=3),t}(d),rotation:function(e){let t={angle:0};if("!"===e[0]&&(t.mirror=!0,e=e.substr(1)),t.angle=parseFloat(e)%360,Number.isNaN(t.angle))throw Error(`Invalid rotation ${e}`);return t}(s),quality:p[0],format:p[1]}}(nl(e.id));if("info"!==t.type)throw Error("Invalid service URL");let i=function(e){let t=e?Array.isArray(e.profile)?e.profile:[e.profile]:[],i={extraQualities:[],extraFormats:[],extraFeatures:[]};for(let e of t){var n;if("string"==typeof e&&(n=e,e=-1!==nT.indexOf(n)?nP:-1!==n$.indexOf(n)?nL:nM),e){if(e.formats)for(let t of e.formats)-1===i.extraFormats.indexOf(t)&&i.extraFormats.push(t);if(e.qualities)for(let t of e.qualities)-1===i.extraQualities.indexOf(t)&&i.extraQualities.push(t);if(e.supports)for(let t of e.supports)-1===i.extraFeatures.indexOf(t)&&i.extraFeatures.push(t);if(e.maxHeight&&(i.maxHeight=e.maxHeight),e.maxWidth&&(i.maxWidth=e.maxWidth),e.maxArea&&(i.maxArea=e.maxArea),e.extraFormats)for(let t of e.extraFormats)-1===i.extraFormats.indexOf(t)&&i.extraFormats.push(t);if(e.extraQualities)for(let t of e.extraQualities)-1===i.extraQualities.indexOf(t)&&i.extraQualities.push(t);if(e.extraFeatures)for(let t of e.extraFeatures)-1===i.extraFeatures.indexOf(t)&&i.extraFeatures.push(t);e.maxHeight&&(i.maxHeight=e.maxHeight),e.maxWidth&&(i.maxWidth=e.maxWidth),e.maxArea&&(i.maxArea=e.maxArea)}}if(e.extraFormats)for(let t of e.extraFormats)-1===i.extraFormats.indexOf(t)&&i.extraFormats.push(t);if(e.extraFeatures)for(let t of e.extraFeatures)-1===i.extraFeatures.indexOf(t)&&i.extraFeatures.push(t);if(e.extraQualities)for(let t of e.extraQualities)-1===i.extraQualities.indexOf(t)&&i.extraQualities.push(t);return i}(e);return{identifier:t.identifier,originalPath:"",server:t.server,prefix:t.prefix,scheme:t.scheme,type:"image",quality:-1===i.extraQualities.indexOf("default")?i.extraQualities[0]:"default",region:{full:!0},size:{max:!0,upscaled:!1,confined:!1},format:"jpg",rotation:{angle:0}}}({"@context":3===e.version?"http://iiif.io/api/image/3/context.json":"http://iiif.io/api/image/2/context.json",id:nl(nF(e)),profile:null===e.level||typeof e.level>"u"?"level0":`level${e.level}`,type:3===e.version?"ImageService3":"ImageService2"});if("image"!==n.type)throw Error("Invalid service");return n.size.max=!1,n.size.width=t,n.size.height=i,{id:function(e,t){let i=e.prefix.startsWith("/")?e.prefix.substr(1):e.prefix,n=`${e.scheme}://${e.server}/${i?`${i}/`:""}${e.identifier}`;if("base"===e.type)return n;if("info"===e.type)return`${n}/info.json`;let{size:a}=e,{region:r,rotation:l,format:o,quality:s}=e;return[n,function({x:e=0,y:t=0,w:i,h:n,full:a,square:r,percent:l}){if(a)return"full";if(r)return"square";if(typeof i>"u"||typeof n>"u")throw Error("RegionParameter: invalid region");let o=`${e},${t},${i},${n}`;return l?`pct:${o}`:o}(r),function({max:e,percentScale:t,upscaled:i,confined:n,width:a,height:r,serialiseAsFull:l,version:o}){let s=[];return i&&s.push("^"),e?s.push(l?"full":"max"):(n&&s.push("!"),t&&s.push(`pct:${t}`),a&&s.push(`${a}`),s.push(","),r&&3===o&&s.push(`${r}`)),s.join("")}(a),`${l.mirror?"!":""}${(l.angle||0)%360}`,`${s}.${o}`].filter(Boolean).join("/")}(n),type:"fixed",width:t,height:i||e.height/(e.width||1)*t,unsafe:e.width>t}}function nq(e){let t=e.replace(/(https?:\/\/)?(www.)?/i,"");return -1!==t.indexOf("/")?t.split("/")[0]:t}var nU=class{constructor(e={}){nr(this,"config",{verificationsRequired:1,approximateServices:!1,enableFetching:!0,disableThrottling:!1}),nr(this,"fetchingCount",0),nr(this,"imageServices",{}),nr(this,"knownImageServers",{}),this.config=Object.assign(this.config,e)}setConfig(e){Object.assign(this.config,e)}sample(e,t,i=!0){let n=nq(nF(e)),a=nl(nF(e)),r=this.knownImageServers[n];return this.imageServices[a]=Object.assign(e,{real:!0}),r||!e.tiles||n_(0,e)?this.verify(e):(this.knownImageServers[n]={verifications:0,malformed:!1,root:n,preLoaded:i,sampledId:nF(e),verified:!1,server:null,result:{context:e["@context"]||[],sampledProfile:e.profile,resourceServiceRatio:t&&e.height?t.height/e.height:1,sampledSizes:e.sizes||[],sizeRatios:function(e,t,i){let n=i.length,a=[];for(let t=0;t<n;t++){let n=i[t];if(n){let t=n.width;a.push(e/t)}}return a}(e.width,e.height,e.sizes||[]),sampledTiles:e.tiles||[]}},!0)}preLoad(e,t=!0){this.knownImageServers[e.root]=e,t&&(this.knownImageServers[e.root].malformed=!1,this.knownImageServers[e.root].verifications=this.config.verificationsRequired)}predict(e,t=!1,i=!1){let n=null==e?void 0:e.source,a=nq(nF(e)),r=this.knownImageServers[a],l=nl(nF(e));return this.imageServices[l]?this.imageServices[l]||null:!(!this.config.approximateServices||!r||!r.result||!(null!=n&&n.height||e.height)||!(null!=n&&n.width||e.width)||!i&&(r.malformed||r.verifications<this.config.verificationsRequired)||n_(0,e.source))?(this.imageServices[l]||(this.imageServices[l]={"@context":r.result.context,"@id":nF(e),id:nF(e),protocol:"http://iiif.io/api/image",tiles:(null==n?void 0:n.tiles)||function(e,t,i){let n=e>t?e:t,a=i.length,r=[];for(let e=0;e<a;e++){let t=i[e];if(!t||0===t.scaleFactors.length)continue;let a=t.scaleFactors[0];if(!a)continue;let l=n/a,o=[a];for(;l>=t.width;)a*=2,o.push(a),l/=2;r.push({...t,scaleFactors:o})}return r}(e.width,e.height,r.result.sampledTiles),sizes:(null==n?void 0:n.sizes)||function(e,t,i){let n=i.length,a=[];for(let r=0;r<n;r++){let n=i[r];n&&a.push({width:Math.floor(e/n),height:Math.floor(t/n)})}return a}(Math.round(e.width/r.result.resourceServiceRatio),Math.round(e.height/r.result.resourceServiceRatio),r.result.sizeRatios),profile:(null==n?void 0:n.profile)||r.result.sampledProfile,height:(null==n?void 0:n.height)||e.height,width:(null==n?void 0:n.width)||e.width,real:!1}),this.imageServices[l]||null):null}async getThumbnailFromResource(e,t,i=!0,n=[]){let a=e?await this.getImageCandidates(e,i):[];return function(e,t){let i=[],n=Object.assign({unsafeImageService:!1,atAnyCost:!0,fallback:!0,minHeight:64,minWidth:64,maxHeight:1/0,maxWidth:1/0,returnAllOptions:!1,preferFixedSize:!1,allowUnsafe:!1,explain:!1,height:0,width:0},e),a=(e,t=0)=>n.explain?i.push(Array(t).fill(0).map(e=>"    ").join("")+e().trim()):void 0,r=[],l=[],o=null;a(()=>`Using configuration: ${JSON.stringify(n,null,2)}`);let s=(e,t)=>{let i;if(a(()=>"Swapping choice",3),i=n.width?n.width:n.maxWidth,e.height<=n.maxHeight&&e.width<=n.maxWidth&&e.height>=n.minHeight&&e.width>=n.minWidth&&(!t||Math.abs(e.width-i)<Math.abs(t.width-i))){if(n.preferFixedSize&&e.unsafe){a(()=>`We found an image that was marked as unsafe, but it was the best size. (${e.id})`,4),l.push(e);return}n.returnAllOptions&&t&&l.push(t),a(()=>`We found a new image that was the best size. (${e.id})`,4),o=e}else n.returnAllOptions&&l.push(e)};a(()=>`The input shows we have ${t.length} list(s) of candidates to choose from.`);let d=t.length;for(let e=0;e<d;e++){let i=t[e]();a(()=>`Candidate group ${e}: ${JSON.stringify(i,null,2)}`,1);let l=i.length;a(()=>`Checking candidate list number ${e} and found ${l} potential ways of creating image(s)`,1);for(let e=0;e<l;e++){let t=i[e];a(()=>`-> Checking candidate ${e}`,1),"unknown"===t.type&&n.atAnyCost&&(a(()=>'We\'ve found an unknown image type, adding this to the "last resort" list',2),r.push(t)),"fixed"===t.type&&(t.unsafe?(a(()=>'We\'ve found an unsafe fixed image type, adding this to the "last resort" list',2),r.push(t)):(a(()=>"We've found a fixed size image, checking if it matches the request",2),s(t,o))),"fixed-service"===t.type&&(n.unsafeImageService?(a(()=>"Checking for an image from the tile source, without calculating the right height and width (unsafeImageService)",2),s(nN(t,n.width,n.height),o)):(a(()=>"Checking for an image from the tile source 3",2),s(nN(t,t.width,t.height),o))),"variable"===t.type&&t.maxWidth&&s(nN({id:t.id,type:"fixed-service",width:t.maxWidth,height:t.maxWidth,level:t.level,version:t.version},t.maxWidth),o)}if(o&&!n.returnAllOptions){if(o.unsafe||n.allowUnsafe)continue;a(()=>`We found a match in choice list number ${e}, no searching any more`);break}}return n.atAnyCost&&0===l.length?(a(()=>o?`We found an image! ${o.id} of type ${o.type}`:'We found no images, but "atAnyCost" is set, so returning that'),{best:o||r[0]||null,fallback:r.slice(1),log:i}):n.returnAllOptions?(a(()=>"Returning all options that we have found"),{best:(n.atAnyCost?o||l[0]||r[0]:o||l[0])||null,fallback:[...l,...r],log:i}):(a(()=>"Returning the best image that we found, and a fallback"),{best:o||l[0]||null,fallback:o?l:l.slice(1),log:i})}(t,[()=>n,()=>a])}async getImageCandidates(e,t=!0){if(t&&e&&e.height&&e.width)for(let t of nW(e)){let i={id:nF(t),width:t.width?t.width:e.width,height:t.height?t.height:e.height,source:t};await this.loadService(i)}return function(e,t=!0,i){let n=[],a=nD(e);if(null===a)return n;if(n.push(a),t&&e&&e.width&&e.height){let t=[];for(let n of nW(e)){let a={id:nF(n),width:e.width,height:e.height};if(i.canLoadSync(a)){let n=i.loadServiceSync(a);n&&(n.height||(n.height=e.height),n.width||(n.width=e.width),t.push(...nV([n])))}}if(t.length)return n.push(...t),n}return e.service&&n.push(...nV(e.service)),n}(e,t,this)}async verify(e){let t=this.predict(e,!1,!0),i=await this.fetchService(nF(e));if(!t)return!1;let n=t.height===i.height&&t.width===i.width&&t["@context"]===i["@context"]&&function(e,t){if(e.length!==t.length)return!1;if(0===e.length&&0===t.length)return!0;let i=e.length,n=!0;for(let a=0;a<i;a++){let i=e[a],r=t[a];if(i.width!==r.width||i.height!==r.height){n=!1;break}}if(n)return!0;let a=0;for(let n=0;n<i;n++)for(let r=0;r<i;r++)if(e[n].width===t[r].width&&e[n].height===t[r].height){a++;break}return a===i}(t.sizes||[],i.sizes||[]);if(n){let t=nq(nF(e)),i=this.knownImageServers[t];i&&(i.verifications+=1,i.verifications>=this.config.verificationsRequired&&(i.verified=!0))}return n}canLoadSync(e){let t="string"==typeof e?e:nF(e),i=nl(t);if(this.imageServices[i])return!0;let n=this.knownImageServers[nq(t)];return!!(n&&!n.malformed&&n.verifications>=this.config.verificationsRequired)}async markAsMalformed(e){return this.knownImageServers[nq(nF(e))].malformed=!0,this.loadService(e,!0)}async fetchService(e,t=!1){let i=nl(e),n=this.imageServices[i];if(n&&(!t||n.real))return n;if(!this.config.enableFetching)throw Error("Fetching is not enabled");let a=await this.fetch(i).then(e=>e.json());return!a.id&&a["@id"]&&(a.id=a["@id"]),a.id!==e&&(a.id=e,a["@id"]&&(a["@id"]=e)),this.imageServices[i]=Object.assign(a,{real:!0}),this.imageServices[i]}async fetch(e,t){return fetch(e,t)}async loadService(e,t=!1){if(!this.config.disableThrottling){let e=!0;for(;e;)if(this.fetchingCount>=this.config.verificationsRequired)await new Promise(e=>setTimeout(e,500));else{e=!1;break}}let i=this.knownImageServers[nq(nF(e))];if(i&&!i.malformed&&!t){await i.result;let t=this.loadServiceSync(e);if(t)return t}this.fetchingCount++;let n=await this.fetchService(nF(e),t);return this.fetchingCount--,n.real&&this.sample(n,e),n}loadServiceSync(e){let t=nl(nF(e));return this.imageServices[t]?this.imageServices[t]:this.config.approximateServices?this.predict(e):null}};new nU;var nQ=new nU,nG=new Map;let nJ=({type:e})=>{switch(e){case"Sound":return d.createElement(iF.Audio,null);case"Image":default:return d.createElement(iF.Image,null);case"Video":return d.createElement(iF.Video,null)}},nX=({canvas:e,canvasIndex:t,isActive:i,type:n,handleChange:a})=>{let[r,l]=(0,d.useState)(!1),[o,s]=(0,d.useState)(),{vault:c}=e8(),u=null!=e&&e.label?tN(null==e?void 0:e.label):String(t+1);return(0,d.useEffect)(()=>{r&&(async()=>{var t,i;try{if((null==(t=null==e?void 0:e.thumbnail)?void 0:t.length)!==0)s(null==(i=null==e?void 0:e.thumbnail[0])?void 0:i.id);else{let{best:t}=await function(e,{vault:t=ni,dereference:i=!1,...n}={}){let a=nG.get(t);return a||(a=function(e=ni,t={}){let i=t.imageServiceLoader||nQ;async function n(t,a,r=!1,l=[],o){let s=()=>i.getThumbnailFromResource(void 0,a,r,l);if(!t)return await i.getThumbnailFromResource(void 0,a,r,l);if("string"==typeof t){let e=nD(t);return e&&l.push(e),await i.getThumbnailFromResource(void 0,a,r,l)}let d=e.get(t,{skipSelfReturn:!1});if("string"==typeof d)return{best:nD(d),fallback:[],log:[]};if(!d)return await s();switch(await (async t=>{if(t&&t.thumbnail&&t.thumbnail.length){let n=e.get(t.thumbnail[0]),a=await i.getImageCandidates(n,r);a&&a.length&&l.push(...a)}})(d),d.type){case"Annotation":{let t=Array.isArray(d.body)?d.body:[d.body],n=e.get(t[0]);return o&&!n.width&&(n.width=o.width,n.height=o.height),await i.getThumbnailFromResource(n,a,r,l)}case"Canvas":return n(d.items[0],a,r,l,{width:d.width,height:d.height});case"AnnotationPage":return n(d.items[0],a,r,l,o);case"Choice":return!d.items||d.items[0]?await s():n(d.items[0],a,r,l,o);case"Collection":{let e=d.items[0];return e?n(e,a,r,l,o):await s()}case"Manifest":{let e=d.items[0];return e?n(e,a,r,l,o):await s()}case"SpecificResource":case"Image":case"Dataset":case"Sound":case"Text":case"TextualBody":case"Video":return o&&!d.width&&(d.width=o.width,d.height=o.height),i.getThumbnailFromResource(d,a,r,l)}return await s()}return{getBestThumbnailAtSize:n}}(t),nG.set(t,a)),a.getBestThumbnailAtSize(e,n,i)}(e,{vault:c,dereference:!0,width:200,height:200});s(null==t?void 0:t.id)}}catch(e){console.error("Error fetching thumbnail",e)}})()},[e,r]),d.createElement(iX,{"aria-checked":i,"data-testid":"media-thumbnail","data-canvas":t,onClick:()=>a(e.id),value:e.id},d.createElement("figure",null,d.createElement(iJ,null,d.createElement(ne,{isVisibleCallback:e=>{l(e)},attributes:{className:"media-thumbnail-lazyload","data-lazyload":String(r),"data-testid":"media-thumbnail-lazyload"}},o&&d.createElement("img",{alt:u,"data-testid":"media-thumbnail-image",src:o})),d.createElement(iq,null),d.createElement(iU,null,d.createElement(iN,{isIcon:!0,"data-testid":"thumbnail-tag"},d.createElement(iQ,null),d.createElement(iF,{"aria-label":n},d.createElement(nJ,{type:n})),["Video","Sound"].includes(n)&&d.createElement(iG,null,eG(e.duration))))),d.createElement("figcaption",{"data-testid":"fig-caption"},e.label?d.createElement(tQ,{label:e.label}):(t+1).toString())))},nY=e=>e.body?e.body.type:"Image",nZ=({items:e})=>{let{t}=(0,s.Bd)(),i=e7(),{activeCanvas:n,vault:a,sequence:r}=e8(),[l,o]=(0,d.useState)(""),[c,u]=(0,d.useState)([]),[m,p]=(0,d.useState)(0),h=d.useRef(null),f=e=>{n!==e&&i({type:"updateActiveCanvas",canvasId:e})};return(0,d.useEffect)(()=>{if(!c.length){let t=["Image","Sound","Video"];u(e.map(e=>tt(a,e,"painting",t)).filter(e=>e.annotations.length>0))}},[e,c.length,a]),(0,d.useEffect)(()=>{c.forEach((e,t)=>{null!=e&&e.canvas&&e.canvas.id===n&&p(t)})},[n,c]),(0,d.useEffect)(()=>{let e=document.querySelector(`[data-canvas="${m}"]`);if(e instanceof HTMLElement&&h.current){let t=e.offsetLeft-h.current.offsetWidth/2+e.offsetWidth/2;h.current.scrollTo({left:t,behavior:"smooth"})}},[m]),d.createElement(d.Fragment,null,d.createElement(i9,{handleFilter:e=>o(e),handleCanvasToggle:e=>{let t=r[1].findIndex(e=>e.includes(m)),i=t+e>=0?t+e:r[1].length-1;if(!r[1][i])return;let n=r[1][i][0],a=r[0][n].id;a&&f(a)},activeIndex:m,canvasLength:e.length}),d.createElement(iY,{"aria-label":t("media.selectItem"),"data-testid":"media","data-active-canvas":e[m].id,"data-canvas-length":e.length,"data-filter":l,ref:h},r[1].filter(e=>e.some(e=>{var t;let i=r[0][e].id,n=c.find(e=>{var t;return(null==(t=null==e?void 0:e.canvas)?void 0:t.id)===i});if(!n)return!1;let a=tN(null==(t=null==n?void 0:n.canvas)?void 0:t.label)||"";return!(l&&!a.toLowerCase().includes(l.toLowerCase()))})).map((e,t)=>{let i=e.map(e=>r[0][e].id).includes(n);return d.createElement(iZ,{"data-active":i,key:t},e.map(e=>{var t,i;let a=r[0][e].id,l=c.find(e=>{var t;return(null==(t=null==e?void 0:e.canvas)?void 0:t.id)===a});return l?d.createElement(nX,{canvas:l.canvas,canvasIndex:c.findIndex(e=>e===l),handleChange:f,isActive:n===(null==(t=null==l?void 0:l.canvas)?void 0:t.id),key:null==(i=null==l?void 0:l.canvas)?void 0:i.id,type:nY(l.annotations[0])}):null}))})))},nK=tr("button",{position:"absolute",background:"none",border:"none",cursor:"zoom-in",margin:"0",padding:"0",width:"100%",height:"100%",transition:"$all",opacity:1,display:"flex",alignItems:"center",justifyContent:"center",img:{width:"100%",height:"100%",objectFit:"contain",color:"transparent",aspectRatio:"auto"},"&[data-paged=true]":{"img:first-child ":{objectPosition:"100% 50%"},"img:last-child":{objectPosition:"0 50%"}},"&[data-active=false]":{opacity:0,objectPosition:"50% 50%"},variants:{isMedia:{true:{cursor:"pointer"}}}}),n0=tr("button",{display:"flex",height:"2rem",width:"2rem",borderRadius:"2rem",padding:"0",margin:"0",fontFamily:"inherit",background:"none",backgroundColor:"$primary",border:"none",color:"white",cursor:"pointer",marginLeft:"0.618rem",filter:"drop-shadow(2px 2px 5px #0003)",transition:"$all",boxSizing:"content-box !important","&:first-child":{marginLeft:"0"},"@xs":{marginBottom:"0.618rem",marginLeft:"0","&:last-child":{marginBottom:"0"}},svg:{height:"60%",width:"60%",padding:"20%",fill:"$secondary",stroke:"$secondary",filter:"drop-shadow(2px 2px 5px #0003)",transition:"$all",boxSizing:"inherit"},"&:hover, &:focus":{backgroundColor:"$accent"},"&[data-button=rotate-right]":{"&:hover, &:focus":{svg:{rotate:"45deg"}}},"&[data-button=rotate-left]":{transform:"scaleX(-1)","&:hover, &:focus":{svg:{rotate:"45deg"}}},"&[data-button=reset]":{"&:hover, &:focus":{svg:{rotate:"-15deg"}}}}),n1=tr(n0,{position:"absolute",width:"2rem",top:"1rem",right:"1rem",zIndex:100,display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",transition:"$all",borderRadius:"50%",backgroundColor:"$accent",cursor:"pointer","&:hover, &:focus":{backgroundColor:"$accent !important"},variants:{isInteractive:{true:{"&:hover":{opacity:"1"}},false:{}},isMedia:{true:{cursor:"pointer !important"}}},compoundVariants:[{isInteractive:!1,isMedia:!0,css:{top:"50%",right:"50%",width:"4rem",height:"4rem",transform:"translate(50%,-50%)"}}]}),n2=tr("div",{position:"relative",display:"flex",flexDirection:"column",flexGrow:"1",flexShrink:"1",gap:"1rem",zIndex:"0",overflow:"hidden","&:hover":{[`${n1}`]:{backgroundColor:"$accent"},[`${nK}`]:{backgroundColor:"#6662"}}}),n3=tr("div",{width:"100%",height:"100%"}),n4=tr("svg",{height:"19px",color:"$accent",fill:"$accent",stroke:"$accent",display:"flex",margin:"0.25rem 0.85rem"}),n5=tr(A.l9,{fontSize:"1.25rem",fontWeight:"400",fontFamily:"inherit",alignSelf:"flex-start",flexGrow:"1",cursor:"pointer",transition:"$all",border:"1px solid #6663",boxShadow:"2px 2px 5px #0001",borderRadius:"3px",display:"flex",alignItems:"center",paddingLeft:"0.5rem",width:"100%","@sm":{fontSize:"1rem"}}),n6=tr(A.UC,{borderRadius:"3px",boxShadow:"3px 3px 8px #0003",backgroundColor:"$secondary",marginTop:"2.25rem",marginLeft:"6px",paddingBottom:"0.25rem",maxHeight:"calc(61.8vh - 2.5rem) !important",borderTopLeftRadius:"0",border:"1px solid $secondaryMuted",maxWidth:"90vw"}),n8=tr(A.q7,{display:"flex",alignItems:"center",fontFamily:"inherit",padding:"0.25rem 0.5rem",color:"$primary",fontWeight:"400",fontSize:"0.8333rem",cursor:"pointer",backgroundColor:"$secondary",width:"calc(100% - 1rem)","> span":{whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"},'&[data-state="checked"]':{fontWeight:"700",color:"$primary !important"},"&:hover":{color:"$accent"},img:{width:"31px",height:"31px",marginRight:"0.5rem",borderRadius:"3px"}}),n7=tr(A.JU,{color:"$primaryMuted",fontFamily:"inherit",fontSize:"0.85rem",padding:"0.5rem 1rem 0.5rem 0.5rem",display:"flex",alignItems:"center",marginBottom:"0.25rem",borderRadius:"3px",borderTopLeftRadius:"0",borderBottomLeftRadius:"0",borderBottomRightRadius:"0",backgroundColor:"$secondaryMuted"}),n9=tr(A.bL,{position:"relative",zIndex:"5",width:"100%"}),ae=({direction:e,title:t})=>d.createElement(n4,{xmlns:"http://www.w3.org/2000/svg",focusable:"false",viewBox:"0 0 512 512",role:"img"},d.createElement("title",null,t),"up"===e&&d.createElement(()=>d.createElement("path",{d:"M414 321.94L274.22 158.82a24 24 0 00-36.44 0L98 321.94c-13.34 15.57-2.28 39.62 18.22 39.62h279.6c20.5 0 31.56-24.05 18.18-39.62z"}),null),"down"===e&&d.createElement(()=>d.createElement("path",{d:"M98 190.06l139.78 163.12a24 24 0 0036.44 0L414 190.06c13.34-15.57 2.28-39.62-18.22-39.62h-279.6c-20.5 0-31.56 24.05-18.18 39.62z"}),null)),at=({children:e,label:t,maxHeight:i,onValueChange:n,value:a})=>d.createElement(n9,{onValueChange:n,value:a},d.createElement(n5,{"data-testid":"select-button"},d.createElement(A.yv,{"data-testid":"select-button-value"}),d.createElement(A.wB,null,d.createElement(ae,{direction:"down",title:"select"}))),d.createElement(A.Vp,null,d.createElement(n6,{css:{maxHeight:`${i} !important`},"data-testid":"select-content"},d.createElement(A.p8,null,d.createElement(ae,{direction:"up",title:"scroll up for more"})),d.createElement(A.H,null,d.createElement(A.s3,null,t&&d.createElement(n7,null,d.createElement(tQ,{"data-testid":"select-label",label:t})),e)),d.createElement(A.y2,null,d.createElement(ae,{direction:"down",title:"scroll down for more"}))))),ai=e=>d.createElement(n8,{...e},e.thumbnail&&d.createElement(ip,{thumbnail:e.thumbnail}),d.createElement(A.h,null,d.createElement(tQ,{label:e.label})),d.createElement(A.h3,null)),an=window.OpenSeadragon;if(!an&&!(an=I))throw Error("OpenSeadragon is missing.");let aa="http://www.w3.org/2000/svg";an.Viewer&&(an.Viewer.prototype.svgOverlay=function(){return this._svgOverlayInfo||(this._svgOverlayInfo=new ar(this)),this._svgOverlayInfo});let ar=function(e){let t=this;this._viewer=e,this._containerWidth=0,this._containerHeight=0,this._svg=document.createElementNS(aa,"svg"),this._svg.style.position="absolute",this._svg.style.left=0,this._svg.style.top=0,this._svg.style.width="100%",this._svg.style.height="100%",this._viewer.canvas.appendChild(this._svg),this._node=document.createElementNS(aa,"g"),this._svg.appendChild(this._node),this._viewer.addHandler("animation",function(){t.resize()}),this._viewer.addHandler("open",function(){t.resize()}),this._viewer.addHandler("rotate",function(){t.resize()}),this._viewer.addHandler("flip",function(){t.resize()}),this._viewer.addHandler("resize",function(){t.resize()}),this.resize()};ar.prototype={node:function(){return this._node},resize:function(){this._containerWidth!==this._viewer.container.clientWidth&&(this._containerWidth=this._viewer.container.clientWidth,this._svg.setAttribute("width",this._containerWidth)),this._containerHeight!==this._viewer.container.clientHeight&&(this._containerHeight=this._viewer.container.clientHeight,this._svg.setAttribute("height",this._containerHeight));let e=this._viewer.viewport.pixelFromPoint(new an.Point(0,0),!0),t=this._viewer.viewport.getZoom(!0),i=this._viewer.viewport.getRotation(),n=this._viewer.viewport.getFlip(),a=this._viewer.viewport._containerInnerSize.x,r=a*t,l=r;n&&(r=-r,e.x=-e.x+a),this._node.setAttribute("transform","translate("+e.x+","+e.y+") scale("+r+","+l+") rotate("+i+")")},onClick:function(e,t){new an.MouseTracker({element:e,clickHandler:t}).setTracking(!0)}};let al=e=>fetch(`${e.replace(/\/$/,"")}/info.json`).then(e=>e.json()).then(e=>e).catch(t=>{console.error(`The IIIF tilesource ${e.replace(/\/$/,"")}/info.json failed to load: ${t}`)}),ao=e=>{let t,i;if(Array.isArray(e)&&(t=e[0])){let e;i="@id"in t?t["@id"]:t.id}return i},as=e=>{var t,i,n,a,r,l,o,s,d,c,u,m,p,h,f;let g,v={};switch(null==e?void 0:e.type){case"SpecificResource":v={manifest:g=null==(n=null==(i=null==(t=null==e?void 0:e.target)?void 0:t.partOf)?void 0:i[0])?void 0:n.id,canvas:null==(a=null==e?void 0:e.target)?void 0:a.id},null!=e&&e.selector&&(v.selector=e.selector);break;case"Range":case"Annotation":let y=(null==(r=null==e?void 0:e.target)?void 0:r.source)||(null==e?void 0:e.target),b=null==(l=null==e?void 0:e.target)?void 0:l.selector;v={manifest:null==(s=null==(o=null==y?void 0:y.partOf)?void 0:o[0])?void 0:s.id,canvas:null==y?void 0:y.id},((null==(d=null==e?void 0:e.target)?void 0:d.type)==="SpecificResource"||null!=(c=null==e?void 0:e.target)&&c.selector)&&(v.selector=b);break;case"Canvas":if(v={manifest:g=null==(m=null==(u=null==e?void 0:e.partOf)?void 0:u[0])?void 0:m.id,canvas:null==e?void 0:e.id},null!=(p=null==e?void 0:e.id)&&p.includes("#xywh=")){let[t,i]=e.id.split("#xywh=");v.canvas=t,v.selector={type:"FragmentSelector",value:`xywh=${i}`}}break;case"Manifest":g=null==e?void 0:e.id,v={collection:null==(f=null==(h=null==e?void 0:e.partOf)?void 0:h[0])?void 0:f.id,manifest:null==e?void 0:e.id};break;case"Collection":v={collection:g=null==e?void 0:e.id}}return{resourceId:g,active:v}},ad=e=>{if(ap(e))return{resourceId:e};{let t=JSON.parse((0,p.B6)(e)),{active:i}=as(t);return{active:i,resourceId:null==t?void 0:t.resourceId,resourceObject:t}}},ac=e=>{let{resourceId:t,resourceObject:i}=ad(e);return i||t},au=e=>e.items.map(e=>e.id)[0],am=e=>{let t=e.items.filter(e=>"Manifest"===e.type).map(e=>e.id);return 0==t.length?null:t[0]},ap=e=>{try{new URL(e)}catch{return!1}return!0};var ah=(e=>(e.TiledImage="tiledImage",e.SimpleImage="simpleImage",e))(ah||{});let af=e=>{let t=Array.isArray(null==e?void 0:e.service)&&(null==e?void 0:e.service.length)>0;return{uri:t?ao(null==e?void 0:e.service):null==e?void 0:e.id,imageType:t?ah.TiledImage:ah.SimpleImage}},ag=(e,t)=>({uri:e,imageType:t?ah.TiledImage:ah.SimpleImage}),av=tr("div",{position:"absolute !important",zIndex:"1",top:"1rem",left:"1rem",width:"161.8px",height:"100px",backgroundColor:"#000D",boxShadow:"5px 5px 5px #0002",borderRadius:"3px",".displayregion":{border:" 3px solid $accent !important",boxShadow:"0 0 3px #0006"},"@sm":{width:"123px",height:"76px"},"@xs":{width:"100px",height:"61.8px"}}),ay=tr("div",{position:"relative",width:"100%",height:"100%",zIndex:"0",".clover-iiif-image-openseadragon-annotation":{position:"relative",backgroundColor:"transparent",border:"2px solid #0003",boxSizing:"content-box",borderRadius:"3px",boxShadow:"0 0 38vw 38vw transparent",transition:"box-shadow 100ms ease-in-out",zIndex:"0",label:{opacity:0,position:"absolute",lineHeight:"1.47rem",pointerEvents:"none",textAlign:"center",minWidth:"300px",maxWidth:"20vw",padding:"0.5rem",borderRadius:"3px",top:"calc(100% + 0.5rem)",left:"50%",transform:"translate(-50%, 0)",backgroundColor:"$primary",color:"$secondary",transition:"opacity 100ms ease-in-out"},"&[data-active=true]":{border:"2px solid $accent !important",boxShadow:"0 0 38vw 38vw #0003",zIndex:"99999999",label:{opacity:1}}}}),ab=tr("div",{width:"100%",height:"100%",maxHeight:"100vh",background:"transparent",backgroundSize:"contain",color:"white",position:"relative",zIndex:"0",overflow:"hidden",variants:{hasNavigator:{true:{[`${av}`]:{display:"block"}},false:{[`${av}`]:{display:"none"}}}}}),aw=({className:e,id:t,label:i,children:n})=>{let a=i.toLowerCase().replace(/\s/g,"-");return d.createElement(n0,{id:t,className:e,"data-testid":"openseadragon-button","data-button":a},d.createElement("svg",{xmlns:"http://www.w3.org/2000/svg","aria-labelledby":`${t}-svg-title`,"data-testid":"openseadragon-button-svg",focusable:"false",viewBox:"0 0 512 512",role:"img"},d.createElement("title",{id:`${t}-svg-title`},i),n))},ax=tr("div",{position:"absolute",zIndex:"1",top:"1rem",right:"1rem",display:"flex","@xs":{flexDirection:"column",zIndex:"2"},variants:{hasPlaceholder:{true:{right:"3.618rem","@xs":{top:"3.618rem",right:"1rem"}},false:{right:"1rem","@xs":{top:"1rem",right:"1rem"}}}}}),aE=()=>d.createElement("path",{strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M256 112v288M400 256H112"}),aS=()=>d.createElement("path",{strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M400 256H112"}),aC=()=>d.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32",d:"M432 320v112H320M421.8 421.77L304 304M80 192V80h112M90.2 90.23L208 208M320 80h112v112M421.77 90.2L304 208M192 432H80V320M90.23 421.8L208 304"}),ak=()=>d.createElement("path",{d:"M448 440a16 16 0 01-12.61-6.15c-22.86-29.27-44.07-51.86-73.32-67C335 352.88 301 345.59 256 344.23V424a16 16 0 01-27 11.57l-176-168a16 16 0 010-23.14l176-168A16 16 0 01256 88v80.36c74.14 3.41 129.38 30.91 164.35 81.87C449.32 292.44 464 350.9 464 424a16 16 0 01-16 16z"}),aA=()=>d.createElement(d.Fragment,null,d.createElement("path",{fill:"none",strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M400 148l-21.12-24.57A191.43 191.43 0 00240 64C134 64 48 150 48 256s86 192 192 192a192.09 192.09 0 00181.07-128"}),d.createElement("path",{d:"M464 97.42V208a16 16 0 01-16 16H337.42c-14.26 0-21.4-17.23-11.32-27.31L436.69 86.1C446.77 76 464 83.16 464 97.42z"})),aI=({_cloverViewerHasPlaceholder:e,config:t})=>{let{activeCanvas:i,plugins:n,vault:a,openSeadragonViewer:r}=e8(),l=a.get({id:i,type:"Canvas"});return(0,d.useEffect)(()=>{if(!r)return;let e=r.viewport.getRotation();r.addHandler("home",()=>{r.viewport.setRotation(e)})},[r]),d.createElement(ax,{"data-testid":"clover-iiif-image-openseadragon-controls",hasPlaceholder:e},t.showZoomControl&&d.createElement(d.Fragment,null,d.createElement(aw,{id:t.zoomInButton,label:"zoom in"},d.createElement(aE,null)),d.createElement(aw,{id:t.zoomOutButton,label:"zoom out"},d.createElement(aS,null))),t.showFullPageControl&&d.createElement(aw,{id:t.fullPageButton,label:"full page"},d.createElement(aC,null)),t.showRotationControl&&d.createElement(d.Fragment,null,d.createElement(aw,{id:t.rotateRightButton,label:"rotate right"},d.createElement(aA,null)),d.createElement(aw,{id:t.rotateLeftButton,label:"rotate left"},d.createElement(aA,null))),t.showHomeControl&&d.createElement(aw,{id:t.homeButton,label:"reset"},d.createElement(ak,null)),n.filter(e=>{var t;return null==(t=e.imageViewer)?void 0:t.controls}).map((e,t)=>{var i,n,a,r;let o=null==(n=null==(i=e.imageViewer)?void 0:i.controls)?void 0:n.component;return d.createElement(o,{key:t,...null==(r=null==(a=null==e?void 0:e.imageViewer)?void 0:a.controls)?void 0:r.componentProps,canvas:l,useViewerDispatch:e7,useViewerState:e8})}))};async function aR(e,t=3,i=500){try{return await e()}catch(n){if(t<=0)throw n;return await new Promise(e=>setTimeout(e,i)),aR(e,t-1,i)}}let aT=e=>new Promise(t=>setTimeout(t,e)),a$=async(e,t,i=3,n=300)=>{for(let a=0;a<i;a++){let i=t?t-1:0,a=e.getItemAt(i);if(a)return a;await aT(n)}throw Error("No base item found at index 0 after retries")},aO=({annotations:e,ariaLabel:t,config:i,uri:n,_cloverViewerHasPlaceholder:a,imageType:r,openSeadragonCallback:l})=>{let[o,s]=(0,d.useState)([]),[c,u]=(0,d.useState)([]),[m,p]=(0,d.useState)(),[h,f]=(0,d.useState)([]),g=e7(),v=(0,d.useRef)(!1);function y(){m&&(null==l||l(m))}return(0,d.useEffect)(()=>(v.current||(v.current=!0,m||p(I(i))),()=>null==m?void 0:m.destroy()),[]),(0,d.useEffect)(()=>{y()},[m,l]),(0,d.useEffect)(()=>{m&&JSON.stringify(n)!==JSON.stringify(c)&&(m.forceRedraw(),u(n))},[m,c,n]),(0,d.useEffect)(()=>{c.length&&m&&(m.close(),(async()=>{switch(r){case"simpleImage":let t=1,i=0;for(let n=0;n<c.length;n++){let a=c[n];if(e){let e=new Image;e.src=a,await e.decode(),f(t=>[...t,{width:null==e?void 0:e.width,height:null==e?void 0:e.height}])}try{if(0!==n){let e=(await a$(m.world,n)).getBounds();i=e.x+e.width,t=e.height}m.addSimpleImage({url:a,x:i,y:0,height:t,success:()=>{s(e=>[...e,a]),"function"==typeof g&&g({type:"updateOSDImageLoaded",OSDImageLoaded:!0})}})}catch(e){console.error(`Failed to load image at ${a}:`,e)}}break;case"tiledImage":{let e=1,t=0;for(let i=0;i<c.length;i++){let n=c[i];try{let a=await aR(()=>al(n),3,1e3);if(!a)throw Error(`No tile source for ${n}`);if(0!==i){let n=(await a$(m.world,i)).getBounds();t=n.x+n.width,e=n.height}m.addTiledImage({tileSource:a,x:t,y:0,height:e,success:()=>{s(e=>[...e,n]),"function"==typeof g&&g({type:"updateOSDImageLoaded",OSDImageLoaded:!0})}})}catch(e){console.error(`Failed to load tile at ${n}:`,e)}}break}default:console.warn(`Unsupported imageType: "${r}"`)}})().catch(e=>console.error("Error drawing tiles",e)))},[c,r,m]),(0,d.useEffect)(()=>{if(o){let e=0,t=()=>{if(e<3){let i=null==m?void 0:m.world.getHomeBounds();i&&(null==m||m.viewport.fitBounds(i,!0)),e++,setTimeout(t,50)}};t(),null==m||m.addHandler("canvas-click",e=>{let t=null==m?void 0:m.getOverlayById(e.originalTarget.id);if(t){let i=null==t?void 0:t.getBounds(m.viewport);return i.x-=.1,i.y-=.1,i.width+=.2,i.height+=.2,null==m||m.viewport.fitBounds(i,!1),e.preventDefaultAction=!0}})}},[o]),(0,d.useEffect)(()=>{e&&(null==m||m.clearOverlays(),e.forEach(e=>{var t,i,n,a;let{annotation:r,targetIndex:l}=e,o=(null==(i=null==(t=null==m?void 0:m.viewport)?void 0:t.getBounds())?void 0:i.width)||1,s=null==m?void 0:m.world.getItemAt(l),d=s?(null==s?void 0:s.getBounds().width)/(null==s?void 0:s.getContentSize().x):(null==(n=h[l])?void 0:n.width)/o,c=tD(null==r?void 0:r.target),u=null!=r&&r.body?null==(a=null==r?void 0:r.body[0])?void 0:a.value:void 0;if(null!=c&&c.rect){let{x:e,y:t,w:i,h:n}=null==c?void 0:c.rect,a=function(e,t,i){let n=e*i;if(0===t)return n;for(;t>0;){let e=null==m?void 0:m.world.getItemAt(t-1);if(e)n+=e.getBounds().width,t--;else break}return n}(e,l,d),o=new I.Rect(a,t*d,i*d,n*d),s=document.createElement("button");if(s.classList.add("clover-iiif-image-openseadragon-annotation"),s.id=r.id,s.setAttribute("tabindex","0"),s.setAttribute("role","button"),s.setAttribute("data-active","true"),s.setAttribute("tabindex","0"),s.setAttribute("role","button"),s.setAttribute("data-active","false"),u){s.setAttribute("aria-label",u);let e=document.createElement("label");e.innerHTML=u,s.appendChild(e)}s.addEventListener("mousedown",e=>{e.stopPropagation(),e.preventDefault()}),s.addEventListener("touchstart",e=>{e.stopPropagation(),e.preventDefault()}),s.addEventListener("click",e=>{e.stopPropagation(),e.preventDefault()}),s.addEventListener("keydown",e=>{if("Enter"===e.key){e.stopPropagation(),e.preventDefault();let t=new I.Rect(o.x-.1,o.y-.1,o.width+.2,o.height+.2);null==m||m.viewport.fitBounds(t,!1)}}),s.addEventListener("focus",()=>{s.setAttribute("data-active","true")}),s.addEventListener("mouseover",()=>{s.setAttribute("data-active","true")}),s.addEventListener("mouseout",()=>{s.removeAttribute("data-active")}),s.addEventListener("blur",()=>{s.removeAttribute("data-active")}),null==m||m.addOverlay(s,o,I.Placement.CENTER)}}),y())},[o,e]),d.createElement(ab,{className:"clover-iiif-image-openseadragon","data-testid":"clover-iiif-image-openseadragon","data-openseadragon-instance":i.id,hasNavigator:i.showNavigator},d.createElement(aI,{_cloverViewerHasPlaceholder:a,config:i}),i.showNavigator&&d.createElement(av,{id:i.navigatorId,"data-testid":"clover-iiif-image-openseadragon-navigator"}),d.createElement(ay,{id:i.id,"data-testid":"clover-iiif-image-openseadragon-viewport",role:"img",...t&&{"aria-label":t}}))},aM=({_cloverViewerHasPlaceholder:e=!1,annotations:t,body:i,instanceId:n,isTiledImage:a=!1,label:r,src:l="",openSeadragonCallback:o,openSeadragonConfig:s={}})=>{let c=n??(0,m.A)(),u="string"==typeof r?r:tN(r),p={...function(e){return{id:`openseadragon-${e}`,navigatorId:`openseadragon-navigator-${e}`,loadTilesWithAjax:!0,fullPageButton:`fullPage-${e}`,homeButton:`reset-${e}`,rotateLeftButton:`rotateLeft-${e}`,rotateRightButton:`rotateRight-${e}`,zoomInButton:`zoomIn-${e}`,zoomOutButton:`zoomOut-${e}`,showNavigator:!0,showFullPageControl:!0,showHomeControl:!0,showRotationControl:!0,showZoomControl:!0,navigatorBorderColor:"transparent",gestureSettingsMouse:{clickToZoom:!0,dblClickToZoom:!0,pinchToZoom:!0,scrollToZoom:!1}}}(c),...s},h=Array.isArray(i)?i:i?[i]:[],f=Array.isArray(l)?l:l?[l]:[],v=[],y=ah.SimpleImage;if(h.length){let e=h.map(af);v=e.map(e=>e.uri).filter(Boolean),y=e.some(e=>e.imageType===ah.TiledImage)?ah.TiledImage:ah.SimpleImage}else if(f.length){let e=f.map(e=>ag(e,a));v=e.map(e=>e.uri).filter(Boolean),y=e.some(e=>e.imageType===ah.TiledImage)?ah.TiledImage:ah.SimpleImage}return v.length?d.createElement(g.ErrorBoundary,{FallbackComponent:tm},d.createElement(aO,{_cloverViewerHasPlaceholder:e,annotations:t,ariaLabel:u,config:p,imageType:y,key:c,uri:v,openSeadragonCallback:e=>{null==o||o(e)}})):null},aL=({isActive:e,isMedia:t,items:i,setIsInteractive:n})=>{let{vault:a}=e8(),[r,l]=(0,d.useState)([]),o=r.length>1;if((0,d.useEffect)(()=>{l([]);let e=i.map(e=>{let t=tn(a,e.id);if(!t)return null;let{id:i,width:n,height:r}=t[0];return i?{src:i,width:n||640,height:r||640,alt:e.label?ti(e.label):"placeholder image"}:null}).filter(e=>null!==e);e.length&&l(e)},[i,o]),!e||!r.length)return null;let s=r.map(e=>e.width/e.height*1),c=s.reduce((e,t)=>e+t,0);return d.createElement(nK,{onClick:()=>n(!0),isMedia:t,className:"clover-viewer-placeholder","data-active":e,"data-paged":o},r.map((e,t)=>{let i=s[t]/c*100;return d.createElement("img",{...e,key:t,alt:e.alt,style:{width:`${i}%`}})}))},aP=tr("canvas",{position:"absolute",width:"100%",height:"100%",zIndex:"0"}),aF=d.forwardRef((e,t)=>{let i=d.useRef(null),n=(0,d.useCallback)(()=>{var e,n;if(null!=(e=t.current)&&e.currentTime&&(null==(n=t.current)?void 0:n.currentTime)>0)return;let a=t.current;if(!a)return;let r=new AudioContext,l=r.createMediaElementSource(a),o=r.createAnalyser(),s=i.current;if(!s)return;s.width=a.offsetWidth,s.height=a.offsetHeight;let d=s.getContext("2d");l.connect(o),o.connect(r.destination),o.fftSize=256;let c=o.frequencyBinCount,u=new Uint8Array(c);setInterval(function(){!function(e,t,i,n,a,r){let l=a/i*2.6,o,s=0;e.getByteFrequencyData(n),t.fillStyle="#000000",t.fillRect(0,0,a,r);for(let e=0;e<i;e++)o=2*n[e],t.fillStyle="rgba(78, 42, 132, 1)",t.fillRect(s,r-o,l,o),s+=l+6}(o,d,c,u,s.width,s.height)},20)},[t]);return d.useEffect(()=>{t&&t.current&&(t.current.onplay=n)},[n,t]),d.createElement(aP,{ref:i,role:"presentation"})}),az=tr("div",{position:"relative",backgroundColor:"$primaryAlt",display:"flex",flexGrow:"0",flexShrink:"1",height:"100%",zIndex:"1",video:{backgroundColor:"transparent",objectFit:"contain",width:"100%",height:"100%",position:"relative",zIndex:"1"}}),a_=({resource:e,ignoreCaptionLabels:t})=>{let i=ti(e.label,"en");return Array.isArray(i)&&i.some(e=>t.includes(e))?null:d.createElement("track",{key:e.id,src:e.id,label:Array.isArray(i)?i[0]:i,srcLang:"en","data-testid":"player-track"})},aj=["application/vnd.apple.mpegurl","vnd.apple.mpegurl","audio/mpegurl","audio/x-mpegurl","application/x-mpegurl","video/x-mpegurl","video/mpegurl","application/mpegurl"],aB=({allSources:e,annotationResources:t,painting:i})=>{let[n,a]=d.useState(0),[r,l]=d.useState(),o=d.useRef(null),s=(null==i?void 0:i.type)==="Sound",c=e7(),{activeCanvas:u,configOptions:m,contentStateAnnotation:p,vault:h}=e8();return(0,d.useEffect)(()=>{if(!i.id||!o.current)return;if(null!=o&&o.current){let e=o.current;e.src=i.id,e.load()}if("m3u8"!==i.id.split(".").pop()&&i.format&&!aj.includes(i.format))return;let e=new S.Ay({xhrSetup:function(e,t){e.withCredentials=!!m.withCredentials}});return e.attachMedia(o.current),e.on(S.Ay.Events.MEDIA_ATTACHED,function(){e.loadSource(i.id)}),e.on(S.Ay.Events.ERROR,function(t,i){if(i.fatal)switch(i.type){case S.Ay.ErrorTypes.NETWORK_ERROR:console.error(`fatal ${t} network error encountered, try to recover`),e.startLoad();break;case S.Ay.ErrorTypes.MEDIA_ERROR:console.error(`fatal ${t} media error encountered, try to recover`),e.recoverMediaError();break;default:e.destroy()}}),()=>{if(e&&o.current){let t=o.current;e.detachMedia(),e.destroy(),t.currentTime=0}}},[m.withCredentials,i.id]),(0,d.useEffect)(()=>{var e,t,i,a;let r=h.get(u),o=null!=(e=r.accompanyingCanvas)&&e.id?tn(h,null==(t=r.accompanyingCanvas)?void 0:t.id):null,s=null!=(i=r.placeholderCanvas)&&i.id?tn(h,null==(a=r.placeholderCanvas)?void 0:a.id):null;o&&s?l(0===n?s[0].id:o[0].id):(o&&l(o[0].id),s&&l(s[0].id))},[u,n,h]),(0,d.useEffect)(()=>{let e=null==o?void 0:o.current;if(!e)return;let t=null,i=!1,n=()=>{i||(i=!0,t=setInterval(()=>{!e||e.paused||e.ended||(a(e.currentTime),c({type:"updateActiveSelector",selector:{type:"PointSelector",t:Math.round(e.currentTime)}}))},500)),e&&e.paused&&(a(e.currentTime),c({type:"updateActiveSelector",selector:{type:"PointSelector",t:Math.round(e.currentTime)}}))};return e.addEventListener("timeupdate",n),()=>{null==e||e.removeEventListener("timeupdate",n),t&&clearInterval(t)}},[i.id,u]),(0,d.useEffect)(()=>{var e,t;if(p){let i=null==o?void 0:o.current;if(!i)return;let{type:n,t:r,value:l}=(null==(e=null==p?void 0:p.target)?void 0:e.selector)||{};if(((null==(t=null==p?void 0:p.target)?void 0:t.source)||(null==p?void 0:p.target)).id!==u)return;if(r&&"PointSelector"===n&&(a(r),i.currentTime=r),"FragmentSelector"===n&&l){let e=l.split("=")[1];if(!e)return;let t=e.split(",")[0];a(t),i.currentTime=t}}},[o,p]),d.createElement(az,{css:{backgroundColor:m.canvasBackgroundColor,maxHeight:m.canvasHeight,position:"relative"},"data-testid":"player-wrapper",className:"clover-viewer-player-wrapper"},d.createElement("video",{id:"clover-iiif-video",key:i.id,ref:o,"data-src":i.id,controls:!0,height:i.height,width:i.width,crossOrigin:m.crossOrigin,poster:r,style:{maxHeight:m.canvasHeight,position:"relative",zIndex:"1"}},e.map(e=>d.createElement("source",{src:e.id,type:e.format,key:e.id})),(null==t?void 0:t.length)>0&&t.map(e=>{let t=[];return e.items.forEach(e=>{h.get(e.id).body.forEach(e=>{let i=h.get(e.id);t.push(i)})}),t.map(e=>d.createElement(a_,{resource:e,ignoreCaptionLabels:m.ignoreCaptionLabels||[],key:e.id}))}),"Sorry, your browser doesn't support embedded videos."),s&&d.createElement(aF,{ref:o}))},aH=()=>d.createElement("svg",{xmlns:"http://www.w3.org/2000/svg","aria-labelledby":"close-svg-title",focusable:"false",viewBox:"0 0 512 512",role:"img"},d.createElement("title",{id:"close-svg-title"},"close"),d.createElement("path",{d:"M289.94 256l95-95A24 24 0 00351 127l-95 95-95-95a24 24 0 00-34 34l95 95-95 95a24 24 0 1034 34l95-95 95 95a24 24 0 0034-34z"})),aD=({isMedia:e})=>d.createElement("svg",{xmlns:"http://www.w3.org/2000/svg","aria-labelledby":"open-svg-title",focusable:"false",viewBox:"0 0 512 512",role:"img"},d.createElement("title",{id:"open-svg-title"},"open"),e?d.createElement("path",{d:"M133 440a35.37 35.37 0 01-17.5-4.67c-12-6.8-19.46-20-19.46-34.33V111c0-14.37 7.46-27.53 19.46-34.33a35.13 35.13 0 0135.77.45l247.85 148.36a36 36 0 010 61l-247.89 148.4A35.5 35.5 0 01133 440z"}):d.createElement(d.Fragment,null,d.createElement("path",{d:"m456.69,421.39l-94.09-94.09c22.65-30.16,34.88-66.86,34.84-104.58,0-96.34-78.38-174.72-174.72-174.72S48,126.38,48,222.72s78.38,174.72,174.72,174.72c37.72.04,74.42-12.19,104.58-34.84l94.09,94.09c10.29,9.2,26.1,8.32,35.3-1.98,8.48-9.49,8.48-23.83,0-33.32Zm-233.97-73.87c-68.89-.08-124.72-55.91-124.8-124.8h0c0-68.93,55.87-124.8,124.8-124.8s124.8,55.87,124.8,124.8-55.87,124.8-124.8,124.8Z"}),d.createElement("path",{d:"m279.5,197.76h-3.35s-28.47,0-28.47,0v-31.82c-.77-13.79-12.57-24.33-26.36-23.56-12.71.71-22.85,10.86-23.56,23.56v3.35h0v28.47h-31.82c-13.79.77-24.33,12.57-23.56,26.36.71,12.71,10.86,22.85,23.56,23.56h3.35s28.47,0,28.47,0v31.82c.77,13.79,12.57,24.33,26.36,23.56,12.71-.71,22.85-10.86,23.56-23.56v-3.35h0v-28.47h31.82c13.79-.77,24.33-12.57,23.56-26.36-.71-12.71-10.86-22.85-23.56-23.56Z"}))),aV=({handleToggle:e,isInteractive:t,isMedia:i})=>d.createElement(n1,{onClick:e,isInteractive:t,isMedia:i,"data-testid":"placeholder-toggle"},t?d.createElement(aH,null):d.createElement(aD,{isMedia:i})),aW=({activeCanvas:e,annotationResources:t,contentSearchResource:i,isMedia:n,painting:a})=>{var r,l,o,s;let[c,u]=d.useState(0),[m,p]=d.useState(!1),[h,f]=d.useState([]),[g,v]=d.useState([]),[y,b]=d.useState(0),{configOptions:w,customDisplays:x,contentStateAnnotation:E,informationPanelResource:S,openSeadragonViewer:C,vault:k,viewerId:A,visibleCanvases:I}=e8(),[R,T]=d.useState([]),$=!!E&&e===(null==(l=null==(r=null==E?void 0:E.target)?void 0:r.source)?void 0:l.id),O=e7(),M=k.get(e),L=g.length&&!m&&!n,P=(null==a?void 0:a.length)>1,F=`${A}-${eX(e+c+JSON.stringify(I)+y)}`,z=()=>{p(!m),b(e=>e+1)},_=x.find(t=>{var i;let n=!1,{canvasId:r,paintingFormat:l}=t.target;if(Array.isArray(r)&&r.length>0&&(n=r.includes(e)),Array.isArray(l)&&l.length>0){let e=(null==(i=a[c])?void 0:i.format)||"";n=!!(e&&l.includes(e))}return n});(0,d.useEffect)(()=>{$&&L&&0===y&&z()},[$,L]),(0,d.useEffect)(()=>{L&&(O({type:"updateOpenSeadragonViewer",openSeadragonViewer:void 0}),O({type:"updateActiveSelector",selector:void 0}))},[L]),(0,d.useEffect)(()=>{var e,n,a;let r=[];if("manifest-annotations"===S&&(null==t||t.forEach((e,t)=>{var i;null==(i=null==e?void 0:e.items)||i.forEach(e=>{let i=k.get(e.id);i&&r.push({annotation:{...i,body:i.body.map(e=>k.get(e.id)||e)},targetIndex:t})})}),E)){let t=(null==(e=null==E?void 0:E.target)?void 0:e.source)||(null==E?void 0:E.target);r.push({annotation:{...E,body:null==(n=null==E?void 0:E.body)?void 0:n.map(e=>k.get(e.id)||e)},targetIndex:I.findIndex(e=>e.id===t.id)})}"manifest-content-search"===S&&(null==(a=null==i?void 0:i.items)||a.forEach(e=>{let t=k.get(e.id);if(t){let e=I.findIndex(e=>e.id===t.target.source.id);"number"==typeof e&&r.push({annotation:{...t,body:t.body.map(e=>k.get(e.id)||e)},targetIndex:e})}})),T(r)},[t,i,E,S,I]),(0,d.useEffect)(()=>{if(!n){let e=I.map(e=>{let t=tn(k,e.id);return t?t[c]:void 0}).filter(Boolean),t=I.map(e=>{var t;let i=e.id,n=k.get(i),a=null==(t=null==n?void 0:n.placeholderCanvas)?void 0:t.id;return a&&a?{id:a,label:null==n?void 0:n.label}:null}).filter(e=>null!==e);f(e),v(t)}},[c,e,I,n,M]),(0,d.useEffect)(()=>{u(0)},[I]);let j=null==(o=null==_?void 0:_.display)?void 0:o.component;return d.createElement(n2,{className:"clover-viewer-painting"},d.createElement(n3,{style:{backgroundColor:w.canvasBackgroundColor,height:"auto"===w.canvasHeight?"100%":w.canvasHeight}},!!g.length&&!n&&d.createElement(aV,{handleToggle:z,isInteractive:m,isMedia:n}),!!(null!=g&&g.length)&&!n&&d.createElement(aL,{isActive:!!L,isMedia:n,items:g,setIsInteractive:p}),!L&&!_&&(n?d.createElement(aB,{allSources:a,painting:a[c],annotationResources:t}):a&&d.createElement(aM,{_cloverViewerHasPlaceholder:!!(null!=g&&g.length),annotations:R,body:h,instanceId:F,key:F,openSeadragonCallback:e=>{e&&!L&&(null==C?void 0:C.id)!==`openseadragon-${F}`&&O({type:"updateOpenSeadragonViewer",openSeadragonViewer:e})},openSeadragonConfig:w.openSeadragon})),!L&&j&&d.createElement(j,{id:e,annotationBody:a[c],...null==_?void 0:_.display.componentProps})),P&&d.createElement(at,{value:null==(s=a[c])?void 0:s.id,onValueChange:e=>{u(a.findIndex(t=>t.id===e))},maxHeight:"200px"},null==a?void 0:a.map(e=>d.createElement(ai,{value:null==e?void 0:e.id,key:null==e?void 0:e.id,label:null==e?void 0:e.label}))))},aN=({activeCanvas:e,annotationResources:t,searchServiceUrl:i,setContentSearchResource:n,contentSearchResource:a,isAudioVideo:r,items:l,painting:o})=>{var s,c;let{contentStateAnnotation:u,isInformationOpen:m,configOptions:p,sequence:h,visibleCanvases:f}=e8(),{informationPanel:g}=p,v=f.map(e=>e.id),y=(t.length>0||v.includes(null==(c=null==(s=null==u?void 0:u.target)?void 0:s.source)?void 0:c.id))&&(null==g?void 0:g.renderAnnotation)&&!g.open,b=(null==g?void 0:g.renderAbout)&&m||y,w=null==g?void 0:g.renderToggle;return d.createElement(th,{className:"clover-viewer-content","data-testid":"clover-viewer-content"},d.createElement(tf,{"data-aside-active":b,"data-aside-toggle":w},d.createElement(aW,{activeCanvas:e,annotationResources:t,contentSearchResource:a,isMedia:r,painting:o}),h[1].length>1&&d.createElement(tp,{className:"clover-viewer-media-wrapper"},d.createElement(nZ,{items:l,activeItem:0}))),b&&d.createElement(tg,{"data-aside-active":b,"data-aside-toggle":w},d.createElement(iL,{activeCanvas:e,annotationResources:t,searchServiceUrl:i,setContentSearchResource:n,contentSearchResource:a})))},aq=tr(iW.Trigger,{width:"30px",padding:"5px"}),aU=tr(iW.Content,{display:"flex",flexDirection:"column",fontSize:"0.8333rem",border:"none",boxShadow:"2px 2px 5px #0003",zIndex:"2",button:{display:"flex",textDecoration:"none",marginBottom:"0.5em",color:"$accentAlt",cursor:"pointer",background:"$secondary",border:"none","&:last-child":{marginBottom:"0"}}}),aQ=tr("span",{fontSize:"1.33rem",alignSelf:"flex-start",flexGrow:"0",flexShrink:"1",padding:"1rem","@sm":{fontSize:"1rem"},"&.visually-hidden":{position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",border:"0"}}),aG=tr("header",{display:"flex",backgroundColor:"transparent !important",justifyContent:"space-between",alignItems:"flex-start",width:"100%",[`> ${n9}`]:{flexGrow:"1",flexShrink:"0"},form:{flexGrow:"0",flexShrink:"1"}}),aJ=tr("div",{display:"flex",alignItems:"flex-end",justifyContent:"flex-end",padding:"1rem",flexShrink:"0",flexGrow:"1"}),aX=()=>{var e;let t=e7(),{activeManifest:i,collection:n,configOptions:a,vault:r}=e8(),l=null==a?void 0:a.canvasHeight;return d.createElement("div",{style:{margin:"0.75rem"}},d.createElement(at,{label:n.label,maxHeight:l,value:i,onValueChange:e=>{t({type:"updateActiveCanvas",canvasId:void 0}),t({type:"updateActiveManifest",manifestId:e}),t({type:"updateViewerId",viewerId:(0,m.A)()})}},null==(e=null==n?void 0:n.items)?void 0:e.map(e=>d.createElement(ai,{value:e.id,key:e.id,thumbnail:null!=e&&e.thumbnail?r.get(null==e?void 0:e.thumbnail):void 0,label:e.label}))))},aY=(e,t=2500)=>{let{t:i}=(0,s.Bd)(),[n,a]=(0,d.useState)(""),r=(0,d.useCallback)(()=>{navigator.clipboard.writeText(e).then(()=>a(i("copySuccess")),()=>a(i("copyFailure")))},[e]);return(0,d.useEffect)(()=>{if(!n)return;let e=setTimeout(()=>a(""),t);return()=>clearTimeout(e)},[n]),[n,r]},aZ=tr("span",{display:"flex",alignContent:"center",alignItems:"center",padding:"0.125rem 0.25rem 0",marginTop:"-0.125rem",marginLeft:"0.5rem",backgroundColor:"$accent",color:"$secondary",borderRadius:"3px",lineHeight:"1em"}),aK=({status:e})=>e?d.createElement(aZ,{"data-copy-status":e},e):null,a0=({textPrompt:e,textToCopy:t})=>{let[i,n]=aY(t);return d.createElement("button",{onClick:n},e," ",d.createElement(aK,{status:i}))},a1=({title:e})=>{let t="#ed1d33",i="#2873ab";return d.createElement("svg",{viewBox:"0 0 493.35999 441.33334",id:"iiif-logo",version:"1.1"},d.createElement("title",null,e),d.createElement("g",{transform:"matrix(1.3333333,0,0,-1.3333333,0,441.33333)"},d.createElement("g",{transform:"scale(0.1)"},d.createElement("path",{style:{fill:i},d:"M 65.2422,2178.75 775.242,1915 773.992,15 65.2422,276.25 v 1902.5"}),d.createElement("path",{style:{fill:i},d:"m 804.145,2640.09 c 81.441,-240.91 -26.473,-436.2 -241.04,-436.2 -214.558,0 -454.511,195.29 -535.9527,436.2 -81.4335,240.89 26.4805,436.18 241.0387,436.18 214.567,0 454.512,-195.29 535.954,-436.18"}),d.createElement("path",{style:{fill:t},d:"M 1678.58,2178.75 968.578,1915 969.828,15 1678.58,276.25 v 1902.5"}),d.createElement("path",{style:{fill:t},d:"m 935.082,2640.09 c -81.437,-240.91 26.477,-436.2 241.038,-436.2 214.56,0 454.51,195.29 535.96,436.2 81.43,240.89 -26.48,436.18 -241.04,436.18 -214.57,0 -454.52,-195.29 -535.958,-436.18"}),d.createElement("path",{style:{fill:i},d:"m 1860.24,2178.75 710,-263.75 -1.25,-1900 -708.75,261.25 v 1902.5"}),d.createElement("path",{style:{fill:i},d:"m 2603.74,2640.09 c 81.45,-240.91 -26.47,-436.2 -241.03,-436.2 -214.58,0 -454.52,195.29 -535.96,436.2 -81.44,240.89 26.48,436.18 241.03,436.18 214.57,0 454.51,-195.29 535.96,-436.18"}),d.createElement("path",{style:{fill:t},d:"m 3700.24,3310 v -652.5 c 0,0 -230,90 -257.5,-142.5 -2.5,-247.5 0,-336.25 0,-336.25 l 257.5,83.75 V 1690 l -258.61,-92.5 V 262.5 L 2735.24,0 v 2360 c 0,0 -15,850 965,950"}))))},a2=tr(R.bL,{all:"unset",height:"2rem",width:"3.236rem",backgroundColor:"#6663",borderRadius:"9999px",position:"relative",WebkitTapHighlightColor:"transparent",cursor:"pointer","&:focus":{boxShadow:"0 0 0 2px $secondaryAlt"},'&[data-state="checked"]':{backgroundColor:"$accent",boxShadow:"inset 2px 2px 5px #0003"}}),a3=tr(R.zi,{display:"block",height:"calc(2rem - 12px)",width:"calc(2rem - 12px)",backgroundColor:"$secondary",borderRadius:"100%",boxShadow:"2px 2px 5px #0001",transition:"$all",transform:"translateX(6px)",willChange:"transform",span:{fontFamily:"monospace",fontSize:"0.8333rem",fontWeight:"700",display:"flex",height:"100%",width:"100%",alignItems:"center",justifyContent:"center",color:"$primary",opacity:"0.382",userSelect:"none",pointerEvents:"none"},'&[data-state="checked"]':{transform:"translateX(calc(1.236rem + 6px))",span:{opacity:"1",color:"$accent"}}});tr("label",{fontSize:"0.8333rem",fontWeight:"400",lineHeight:"1em",userSelect:"none",cursor:"pointer",paddingRight:"0.618rem"});let a4=tr("form",{display:"flex",flexShrink:"0",flexGrow:"1",alignItems:"center",marginLeft:"1.618rem"}),a5=d.memo(()=>{let{isInformationOpen:e}=e8(),t=e7(),{t:i}=(0,s.Bd)();return d.createElement(a4,null,d.createElement(a2,{checked:e,onCheckedChange:e=>{t({type:"updateInformationOpen",isInformationOpen:e})},id:"information-toggle","aria-label":i("informationPanelToggle"),name:"toggled?"},d.createElement(a3,null,d.createElement("span",null,"i"))))}),a6=tr(iW.Trigger,{width:"30px",padding:"5px",marginBottom:"auto"}),a8=tr(aU,{h3:{color:"$primaryAlt",fontSize:"$2",fontWeight:"700",margin:"$2 0"},button:{},"& ul li":{marginBottom:"$1"}});function a7(e,t){let i=[];if(!e)return i;for(let n of e)if(n.id){let e=t.get(n.id);e&&i.push(e)}return i}function a9(e,t){return e.map(({format:e,id:i,label:n})=>({format:e,id:function(e){let{vault:t}=e8();try{let i=e&&t.get(e);if(!i)throw Error(`Vault entity ${e} not found.`);return(null==i?void 0:i["@id"])||(null==i?void 0:i.id)}catch(t){return console.error(t),e}}(i),label:tN(n)||t}))}let re=()=>{let{allPages:e,individualPages:t}=function(){let e=function(){let{activeCanvas:e,activeManifest:t,vault:i}=e8(),[n,a]=(0,d.useState)({root:[],canvas:[]});return(0,d.useEffect)(()=>{let n=i.get(t),r=i.get(e),l=null==n?void 0:n.rendering,o=null==r?void 0:r.rendering;a({root:a7(l,i),canvas:a7(o,i)})},[e,t,i]),{...n}}();return{allPages:a9((null==e?void 0:e.root)||[],"Root Rendering Label"),individualPages:a9((null==e?void 0:e.canvas)||[],"Canvas Rendering Label")}}(),i=e.length>0||t.length>0,n=e=>{window.open(e,"_blank")};return i?d.createElement(iW,null,d.createElement(a6,{"data-testid":"download-button"},d.createElement(iF,null,d.createElement(iF.Download,null))),d.createElement(a8,{"data-testid":"download-content"},t.length>0&&d.createElement(d.Fragment,null,d.createElement("h3",null,"Individual Pages"),d.createElement("ul",null,t.map(({format:e,id:t,label:i})=>d.createElement("li",{key:i},d.createElement("button",{onClick:()=>n(t)},i," (",e,")"))))),e.length>0&&d.createElement(d.Fragment,null,d.createElement("h3",null,"All Pages"),d.createElement("ul",null,e.map(({format:e,id:t,label:i})=>d.createElement("li",{key:i},d.createElement("button",{onClick:()=>n(t)},i," (",e,")"))))))):null},rt=({manifestId:e,manifestLabel:t})=>{let{collection:i,configOptions:n}=e8(),{informationPanel:a,showDownload:r,showIIIFBadge:l,showTitle:o}=n,c=r||l||(null==a?void 0:a.renderToggle),{t:u}=(0,s.Bd)();return d.createElement(aG,{className:"clover-viewer-header"},null!=i&&i.items?d.createElement(aX,null):d.createElement(aQ,{className:o?"":"visually-hidden"},o&&d.createElement(tQ,{label:t,className:"label"})),c&&d.createElement(aJ,null,r&&d.createElement(re,null),l&&d.createElement(iW,null,d.createElement(aq,null,d.createElement(a1,{title:u("commonShare")})),d.createElement(aU,null,(null==i?void 0:i.items)&&d.createElement("button",{onClick:e=>{e.preventDefault(),window.open(i.id,"_blank")}},u("shareCollectionJson")),d.createElement("button",{onClick:t=>{t.preventDefault(),window.open(e,"_blank")}},u("shareManifestJson"))," ",(null==i?void 0:i.items)&&d.createElement(a0,{textPrompt:u("shareCollectionCopy"),textToCopy:i.id}),d.createElement(a0,{textPrompt:u("shareManifestCopy"),textToCopy:e}))),(null==a?void 0:a.renderToggle)&&d.createElement(a5,null)))},ri=e=>{let t=()=>!!window.matchMedia&&window.matchMedia(e).matches,[i,n]=(0,d.useState)(t);return(0,d.useEffect)(()=>{let e=()=>n(t);return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)}),i},rn=({manifest:e,theme:t,iiifContentSearchQuery:i})=>{var n;let a=e8(),r=e7(),{activeCanvas:l,isInformationOpen:o,vault:s,configOptions:c,visibleCanvases:u}=a,m=(null==c?void 0:c.canvasHeight)&&["100%","auto"].includes(null==c?void 0:c.canvasHeight),[p,v]=(0,d.useState)(!1),[y,b]=(0,d.useState)([]),[w,x]=(0,d.useState)([]),[E,S]=(0,d.useState)(),C=ri(ta.sm),[k,A]=(0,d.useState)(),I=(0,d.useCallback)(e=>{r({type:"updateInformationOpen",isInformationOpen:e})},[r]);(0,d.useEffect)(()=>{var e;null!=(e=null==c?void 0:c.informationPanel)&&e.open&&I(!C)},[C,null==(n=null==c?void 0:c.informationPanel)?void 0:n.open]),(0,d.useEffect)(()=>{},[C]),(0,d.useEffect)(()=>{let t=tn(s,l);t&&(v(["Sound","Video"].indexOf(t[0].type)>-1),b(t)),r({type:"updateVisibleCanvases",visibleCanvases:(0,h.iT)(s,e,l)})},[l,C,e,s,r]),(0,d.useEffect)(()=>{(async()=>{x((await Promise.all(u.map(e=>e9(s,e.id)))).flat())})()},[u]);let R=e.service.some(e=>["SearchService1","SearchService2"].includes(e.type||e["@type"]));return(0,d.useEffect)(()=>{if(R){let t=e.service.find(e=>["SearchService1","SearchService2"].includes(e.type||e["@type"]));t&&A(t.id||t["@id"])}},[e,R]),(0,d.useEffect)(()=>{var e;k&&(null==(e=c.informationPanel)?void 0:e.renderContentSearch)!==!1&&te(s,k,i).then(e=>S(e))},[k]),d.createElement(g.ErrorBoundary,{FallbackComponent:tm},d.createElement(tv,{className:`${t} clover-viewer`,css:{background:null==c?void 0:c.background},"data-absolute-position":m,"data-information-panel-open":o},d.createElement(f.bL,{open:o,onOpenChange:I},d.createElement(rt,{manifestLabel:e.label,manifestId:e.id}),d.createElement(aN,{activeCanvas:l,painting:y,annotationResources:w,searchServiceUrl:k,setContentSearchResource:S,contentSearchResource:E,items:e.items,isAudioVideo:p}))))},ra={ignoreCache:!1,headers:{Accept:"application/json, text/javascript, text/plain"},timeout:5e3,withCredentials:!1};function rr(e,t=null){return{ok:!1,status:e.status,statusText:e.statusText,headers:e.getAllResponseHeaders(),data:t||e.statusText,json:()=>JSON.parse(t||e.statusText)}}let rl={"@context":"http://iiif.io/api/presentation/3/context.json",id:"https://example.org/iiif/content-state/specific-resource",type:"Annotation",motivation:["contentState"],target:{type:"SpecificResource",source:{id:"https://example.org/iiif/manifest/canvas/0",type:"Canvas",partOf:[{id:"https://example.org/iiif/manifest",type:"Manifest"}]}},body:[]},ro=({canvasIdCallback:e,contentStateCallback:t,customDisplays:i=[],plugins:n=[],customTheme:a,iiifContent:r,id:l,manifestId:o,options:s,iiifContentSearchQuery:c})=>{var u,m,p;let h=r;l&&(h=l),o&&(h=o);let f=e0(null==(m=null==(u=null==s?void 0:s.informationPanel)?void 0:u.vtt)?void 0:m.autoScroll);return d.createElement(e6,{initialState:{...e2,customDisplays:i,plugins:n,isAutoScrollEnabled:f.enabled,isInformationOpen:!!(null!=(p=null==s?void 0:s.informationPanel)&&p.open),vault:new eU({customFetcher:e=>(function(e,t=ra){let i=t.headers||ra.headers;return new Promise((n,a)=>{let r=new XMLHttpRequest;r.open("get",e),r.withCredentials=t.withCredentials,i&&Object.keys(i).forEach(e=>r.setRequestHeader(e,i[e])),r.onload=()=>{n({ok:r.status>=200&&r.status<300,status:r.status,statusText:r.statusText,headers:r.getAllResponseHeaders(),data:r.responseText,json:()=>JSON.parse(r.responseText)})},r.onerror=()=>{a(rr(r,"Failed to make request."))},r.ontimeout=()=>{a(rr(r,"Request took longer than expected."))},r.send()})})(e,{withCredentials:null==s?void 0:s.withCredentials,headers:null==s?void 0:s.requestHeaders}).then(e=>JSON.parse(e.data))})}},d.createElement(rs,{iiifContent:h,canvasIdCallback:e,contentStateCallback:t,customTheme:a,options:s,iiifContentSearchQuery:c}))},rs=({canvasIdCallback:e,contentStateCallback:t,customTheme:i,iiifContent:n,options:a,iiifContentSearchQuery:r})=>{let l=e7(),{activeCanvas:o,activeManifest:s,activeSelector:c,isLoaded:u,vault:m,visibleCanvases:f}=e8(),[g,y]=(0,d.useState)(),[b,w]=(0,d.useState)(),x={};if(i&&(x=(0,v.an)("custom",i)),(0,d.useEffect)(()=>{l({type:"updateActiveSelector",selector:void 0})},[o,s]),(0,d.useEffect)(()=>{var i;if(e&&e(o),t&&s&&o){let e=(null==(i=f[0])?void 0:i.id)||o,n=`${s}/state/${eX(e+JSON.stringify(c))}`,a={...rl,id:n,target:{type:"SpecificResource",source:{id:e,type:"Canvas",partOf:[{id:s,type:"Manifest"}]},selector:c}};t({json:a,encoded:(0,p.PP)(JSON.stringify(a))})}},[o,s,c,e,t,f]),(0,d.useEffect)(()=>{s&&m.load(s).then(e=>{if(!e)return;w(e);let t=(0,h.X)(m,e);l({type:"updateActiveCanvas",canvasId:o||au(e)}),l({type:"updateManifestSequence",sequence:t})}).catch(e=>{console.error(`Manifest failed to load: ${e}`)}).finally(()=>{l({type:"updateIsLoaded",isLoaded:!0})})},[n,s,l,m]),(0,d.useEffect)(()=>{l({type:"updateConfigOptions",configOptions:a}),(async()=>{var e;if(!n)return;let t=ac(n);try{let e=await m.load(t);y(e)}catch(i){if(t&&t.id||console.error(`Failed to load resource: ${i}`),null!=t&&t.id&&(null==t?void 0:t.type)==="Annotation"&&null!=(e=null==t?void 0:t.motivation)&&e.includes("contentState")){let e=await m.loadSync(t.id,t);e&&y(e)}else null!=t&&t.id&&["Canvas","Manifest"].includes(null==t?void 0:t.type)&&await m.loadSync(t.id,t)&&y({...rl,target:t})}})()},[l,n,a,m]),(0,d.useEffect)(()=>{if(g)switch(g.type){case"Annotation":if(null!=g&&g.motivation&&(Array.isArray(null==g?void 0:g.motivation)?null!=g&&g.motivation.includes("contentState"):(null==g?void 0:g.motivation)==="content-state")){let{active:e}=as(g);l({type:"updateActiveManifest",manifestId:e.manifest}),l({type:"updateActiveCanvas",canvasId:e.canvas}),l({type:"updateContentStateAnnotation",contentStateAnnotation:g})}break;case"Collection":let e=am(g);l({type:"updateCollection",collection:g}),e&&l({type:"updateActiveManifest",manifestId:e});break;case"Manifest":l({type:"updateActiveManifest",manifestId:g.id})}},[l,n,g]),!u)if(null==a||!a.customLoadingComponent)return d.createElement(d.Fragment,null,"Loading");else{let e=a.customLoadingComponent;return d.createElement(e,null)}return b&&b.items?0===b.items.length?(console.log(`The IIIF manifest ${n} does not contain canvases.`),d.createElement(d.Fragment,null)):d.createElement(rn,{manifest:b,theme:x,key:b.id,iiifContentSearchQuery:r}):(console.log(`The IIIF manifest ${n} failed to load.`),d.createElement(d.Fragment,null))}}}]);