"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7679],{10795:function(a,l,o){o.r(l),o.d(l,{default:function(){return Xc}});var s,u,m,h,g=o(15059),v=o(36609),b=o(12849),w=o(67294),x=o(68188),E=o(7207),C=o(57632),k=o(39597),A=o(76076),I=o(42216),O=o(4511),M=o(86744),P=o(82968),z=o(29619),F=o(94801),L=o(59821),_=o(91036),H=o(93041),V=o(43338),N=o(79890),q=o(38886),U=o(69203),G=o(22512);let Y="clover",K=Object.fromEntries(Object.entries({en:{commonClose:"Close",commonNext:"Next",commonPrevious:"Previous",commonSearch:"Search",commonSearchPlaceholder:"Search...",commonShare:"Share",commonViewAll:"View All",copyFailure:"Failed",copySuccess:"Copied",contentSearchLoading:"Loading...",contentSearchPlaceholder:"Search",contentSearchResultsNone:"No Results",contentSearchResultsMore:"More Results",informationPanelTabs:"Select",informationPanelTabsClose:"Viewer",informationPanelTabsAbout:"About",informationPanelTabsAnnotations:"Annotations",informationPanelTabsSearch:"Search",informationPanelToggle:"More Information",shareCollectionJson:"View Collection",shareCollectionCopy:"Copy Collection URL",shareManifestJson:"View Manifest",shareManifestCopy:"Copy Manifest URL"},pt:{}}).map(([a,l])=>[a,{[`${Y}`]:l}]));v.ZP.use(g.Z).use(b.Db).init({defaultNS:Y,fallbackLng:"en",ns:[Y],resources:{...K}});var W=function(a){return function(){let l={type:a,getType:()=>a,toString:()=>a};return(a,o)=>({...l,...void 0!==a&&{payload:a},...void 0!==o&&{meta:o}})}},ee="@iiif/IMPORT_ENTITIES",ei="@iiif/MODIFY_ENTITY_FIELD",en="@iiif/REORDER_ENTITY_FIELD",er="@iiif/ADD_REFERENCE",el="@iiif/UPDATE_REFERENCE",eo="@iiif/REMOVE_REFERENCE",es="@iiif/ADD_METADATA",ed="@iiif/REMOVE_METADATA",eu="@iiif/UPDATE_METADATA",em="@iiif/REORDER_METADATA",ep=W(ee)(),eh=W(ei)(),ef=W(en)(),eg=W(er)(),ev=W(eo)(),ey=W(el)(),eb=W(es)(),ew=W(eu)(),ex={importEntities:ep,modifyEntityField:eh,reorderEntityField:ef,addReference:eg,removeReference:ev,updateReference:ey,addMetadata:eb,removeMetadata:W(ed)(),updateMetadata:ew,reorderMetadata:W(em)()},eE="@iiif/ADD_MAPPING",eS="@iiif/ADD_MAPPINGS",eC=W(eE)(),ek=W(eS)(),eR="RESOURCE_ERROR",eA="RESOURCE_LOADING",eI="RESOURCE_READY",e$="@iiif/REQUEST_RESOURCE",eT="@iiif/REQUEST_ERROR",eO="@iiif/REQUEST_MISMATCH",eM="@iiif/REQUEST_COMPLETE",eP=W(e$)(),ez=W(eT)(),eF=W(eO)(),eL=W(eM)(),ej="@iiif/BATCH",e_=W(ej)(),ea=(a,l)=>{let{entities:o,resource:s,mapping:u}=(0,x.z)(l);if(void 0===s.id)return[ez({id:a,message:"ID is not defined in resource."})];let m=[ep({entities:o}),ek({mapping:u})];return s.id!==a&&(m.push(eC({id:a,type:s.type})),m.push(eF({requestId:a,actualId:s.id}))),m.push(eL({id:a})),m},eB=Number.isNaN||function(a){return"number"==typeof a&&a!=a};function Rt(a,l){if(!Array.isArray(a)||!Array.isArray(l))return a===l;if(a.length!==l.length)return!1;for(let u=0;u<a.length;u++){var o,s;if(!((o=a[u])===(s=l[u])||eB(o)&&eB(s)))return!1}return!0}function Ge(a,l,o){let s=a.iiif.requests[l],u=a.iiif.mapping[l];if(!u||!a.iiif.entities[u][s.resourceUri])return;let m=a.iiif.entities[u][s.resourceUri];if(m&&m[x.c]){let a=m[x.c].find(a=>a[x.d]===m.id);return(0,x.j)(m,a)}return m}function Tt(a,l,{waitTimeout:o=30}={}){return(s,u)=>{let m=a.getStore(),h=m.getState(),g=h.iiif.requests[s];if(g){if(g.loadingState===eI){let a=Ge(h,s);if(a)return a}switch(g.loadingState){case eR:break;case eA:return(async()=>{let a,l=!1;try{let u=await Promise.race([new Promise((o,u)=>{l||(a=m.subscribe(()=>{let a=m.getState();if(a.iiif.requests[s].loadingState===eR){u();return}if(a.iiif.requests[s].loadingState===eI){let l=Ge(a,s);l?o(l):u()}}))}),new Promise((a,s)=>setTimeout(()=>{l=!0,s()},6e4*o))]);if(a&&a(),u)return u}catch{a&&a()}})()}}a.dispatch(eP({id:s}));let c=l=>{if(!l)return;l.id||l["@id"]||(l["@type"]&&(l["@id"]=s),l.id=s);let o=ea(s,l);return a.dispatch(e_({actions:o})),Ge(m.getState(),s)};try{let o=l(s,u);return o&&"function"==typeof o.then?(async()=>{try{return c(await o)}catch(l){throw a.dispatch(ez({id:s,message:l.toString()})),l}})():c(o)}catch(l){throw a.dispatch(ez({id:s,message:l.toString()})),l}}}function gr(){return{Collection:{},Manifest:{},Canvas:{},AnnotationPage:{},AnnotationCollection:{},Annotation:{},ContentResource:{},Range:{},Service:{},Selector:{},Agent:{}}}let eD={};var kt=a=>{let l;let o=new Set,n=(a,s)=>{let u="function"==typeof a?a(l):a;if(!Object.is(u,l)){let a=l;l=s??("object"!=typeof u||null===u)?u:Object.assign({},l,u),o.forEach(o=>o(l,a))}},i=()=>l,s={setState:n,getState:i,getInitialState:()=>u,subscribe:a=>(o.add(a),()=>o.delete(a)),destroy:()=>{(eD?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),o.clear()}},u=l=a(n,i,s);return s},ia=a=>a?kt(a):kt,eW="@iiif/SET_META_VALUE",eH="@iiif/SET_META_VALUE_DYNAMIC",eV="@iiif/UNSET_META_VALUE",eN={setMetaValue:W(eW)(),setMetaValueDynamic:W(eH)(),unsetMetaValue:W(eV)()};let eq={};var ca=(a,l)=>(o,s,u)=>(u.dispatch=l=>(o(o=>a(o,l),!1,l),l),u.dispatchFromDevtools=!0,{dispatch:(...a)=>u.dispatch(...a),...l}),eU=new Map,ke=a=>{let l=eU.get(a);return l?Object.fromEntries(Object.entries(l.stores).map(([a,l])=>[a,l.getState()])):{}},da=(a,l,o)=>{if(void 0===a)return{type:"untracked",connection:l.connect(o)};let s=eU.get(o.name);if(s)return{type:"tracked",store:a,...s};let u={connection:l.connect(o),stores:{}};return eU.set(o.name,u),{type:"tracked",store:a,...u}},ma=(a,l={})=>(o,s,u)=>{let m;let{enabled:h,anonymousActionType:g,store:v,...b}=l;try{m=(h??(eq?"production":void 0)!=="production")&&window.__REDUX_DEVTOOLS_EXTENSION__}catch{}if(!m)return(eq?"production":void 0)!=="production"&&h&&console.warn("[zustand devtools middleware] Please install/enable Redux devtools extension"),a(o,s,u);let{connection:w,...x}=da(v,m,b),E=!0;u.setState=(a,l,m)=>{let h=o(a,l);if(!E)return h;let x=void 0===m?{type:g||"anonymous"}:"string"==typeof m?{type:m}:m;return void 0===v?null==w||w.send(x,s()):null==w||w.send({...x,type:`${v}/${x.type}`},{...ke(b.name),[v]:u.getState()}),h};let p=(...a)=>{let l=E;E=!1,o(...a),E=l},C=a(u.setState,s,u);if("untracked"===x.type?null==w||w.init(C):(x.stores[x.store]=u,null==w||w.init(Object.fromEntries(Object.entries(x.stores).map(([a,l])=>[a,a===x.store?C:l.getState()])))),u.dispatchFromDevtools&&"function"==typeof u.dispatch){let a=!1,l=u.dispatch;u.dispatch=(...o)=>{(eq?"production":void 0)==="production"||"__setState"!==o[0].type||a||(console.warn('[zustand devtools middleware] "__setState" action type is reserved to set state from the devtools. Avoid using it.'),a=!0),l(...o)}}return w.subscribe(a=>{var l;switch(a.type){case"ACTION":if("string"!=typeof a.payload){console.error("[zustand devtools middleware] Unsupported action format");return}return Je(a.payload,a=>{if("__setState"===a.type){if(void 0===v){p(a.state);return}1!==Object.keys(a.state).length&&console.error(`
                    [zustand devtools middleware] Unsupported __setState action format. 
                    When using 'store' option in devtools(), the 'state' should have only one key, which is a value of 'store' that was passed in devtools(),
                    and value of this only key should be a state object. Example: { "type": "__setState", "state": { "abc123Store": { "foo": "bar" } } }
                    `);let l=a.state[v];if(null==l)return;JSON.stringify(u.getState())!==JSON.stringify(l)&&p(l);return}u.dispatchFromDevtools&&"function"==typeof u.dispatch&&u.dispatch(a)});case"DISPATCH":switch(a.payload.type){case"RESET":return p(C),void 0===v?null==w?void 0:w.init(u.getState()):null==w?void 0:w.init(ke(b.name));case"COMMIT":if(void 0===v){null==w||w.init(u.getState());break}return null==w?void 0:w.init(ke(b.name));case"ROLLBACK":return Je(a.state,a=>{if(void 0===v){p(a),null==w||w.init(u.getState());return}p(a[v]),null==w||w.init(ke(b.name))});case"JUMP_TO_STATE":case"JUMP_TO_ACTION":return Je(a.state,a=>{if(void 0===v){p(a);return}JSON.stringify(u.getState())!==JSON.stringify(a[v])&&p(a[v])});case"IMPORT_STATE":{let{nextLiftedState:o}=a.payload,s=null==(l=o.computedStates.slice(-1)[0])?void 0:l.state;if(!s)return;p(void 0===v?s:s[v]),null==w||w.send(null,o);break}case"PAUSE_RECORDING":return E=!E}return}}),C},Je=(a,l)=>{let o;try{o=JSON.parse(a)}catch(a){console.error("[zustand devtools middleware] Could not parse the received json",a)}void 0!==o&&l(o)},ha=a=>(l,o,s)=>{let u=s.subscribe;return s.subscribe=(a,l,o)=>{let m=a;if(l){let u=(null==o?void 0:o.equalityFn)||Object.is,h=a(s.getState());m=o=>{let s=a(o);if(!u(h,s)){let a=h;l(h=s,a)}},null!=o&&o.fireImmediately&&l(h,h)}return u(m)},a(l,o,s)};function Ye(a,l,o,s){return!(!a[o]||!a[o][l]||!a[o][l][s]||!Array.isArray(a[o][l][s]))}function R(a){return a.payload}function Xe(a,l){return typeof a>"u"?l:a}function wr(a={}){let l=Object.keys(a);return function(o={},s){let u=!1,m={};for(let h=0;h<l.length;h++){let g=l[h];m[g]=a[g](o[g],s),u=u||m[g]!==o[g]}return u?m:o}}var eQ=wr({mapping:(a={},l)=>{switch(l.type){case eE:return{...a,[l.payload.id]:l.payload.type};case eS:return{...a,...l.payload.mapping};default:return a}},entities:(a=gr(),l)=>{var o;let r=(o,s)=>({...a,[R(l).type]:{...a[R(l).type],[R(l).id]:{...o,...s}}});switch(l.type){case ei:{if(!a[R(l).type]||!a[R(l).type][R(l).id])return a;let o=a[R(l).type][R(l).id];return"string"==typeof o?a:r(o,{[R(l).key]:R(l).value})}case en:{if(!Ye(a,R(l).id,R(l).type,R(l).key))return a;let o=a[R(l).type][R(l).id];if("string"==typeof o)return a;let s=Array.from(o[R(l).key]),[u]=s.splice(R(l).startIndex,1);return s.splice(R(l).endIndex,0,u),r(o,{[R(l).key]:s})}case ee:{let o=Object.keys(R(l).entities),s={...a};for(let u of o){let o=R(l).entities[u],m={...a[u]||{}},h=!1,g=Object.keys(o||{})||[];if(o&&g){for(let l of g)h=!0,m[l]=a[u][l]?function(a,l){let o={},s=[];for(let[u,m]of Object.entries(a||{})){s.push(u);let a=(l||{})[u];if(!a||0===a.length){o[u]=m;continue}o[u]=a}for(let[a,u]of Object.entries(l||{}))-1===s.indexOf(a)&&(o[a]=u);return o}(a[u][l],o[l]):o[l];h&&(s[u]=m)}}return s}case er:{if(!Ye(a,R(l).id,R(l).type,R(l).key))return a;let o=a[R(l).type][R(l).id],s=Array.from(o[R(l).key]);return s.splice(Xe(R(l).index,s.length+1),0,R(l).reference),r(o,{[R(l).key]:s})}case el:case eo:{if(!Ye(a,R(l).id,R(l).type,R(l).key))return a;let s=a[R(l).type][R(l).id],u=Array.from(s[R(l).key]),m=Xe(R(l).index,u.findIndex(a=>a&&a.id===R(l).reference.id));return -1===m||(null==(o=u[m])?void 0:o.id)!==R(l).reference.id?a:(l.type===el?u.splice(m,1,R(l).reference):u.splice(m,1),r(s,{[R(l).key]:u}))}case es:{let o=a[R(l).type][R(l).id];if(!o)return a;let s=Array.from(o.metadata||[]),u=R(l);return s.splice(Xe(l.payload.beforeIndex,s.length+1),0,{label:u.label,value:u.label}),r(o,{metadata:s})}case em:{let o=a[R(l).type][R(l).id];if("string"==typeof o||!o)return a;let s=Array.from(o.metadata||[]),[u]=s.splice(R(l).startIndex,1);return s.splice(R(l).endIndex,0,u),r(o,{metadata:s})}case eu:case ed:{let o=a[R(l).type][R(l).id],s=Array.from(o.metadata||[]),u=R(l).atIndex;return typeof u>"u"||-1===u||!s[u]?a:(l.type===eu?s.splice(u,1,{label:R(l).label,value:R(l).value}):s.splice(u,1),r(o,{metadata:s}))}default:return a}},requests:(a={},l)=>{switch(l.type){case e$:case"@iiif/REQUEST_OFFLINE_RESOURCE":return{...a,[l.payload.id]:{requestUri:l.payload.id,loadingState:eA,uriMismatch:!1,resourceUri:l.payload.id}};case eO:return{...a,[l.payload.requestId]:{...a[l.payload.requestId]||{},uriMismatch:!0,resourceUri:l.payload.actualId},[l.payload.actualId]:{requestUri:l.payload.requestId,loadingState:a[l.payload.requestId].loadingState,uriMismatch:!0,resourceUri:l.payload.actualId}};case eT:return{...a,[l.payload.id]:{...a[l.payload.id]||{},loadingState:eR,error:l.payload.message}};case eM:return{...a,[l.payload.id]:{...a[l.payload.id]||{},loadingState:eI,error:void 0}}}return a},meta:(a={},l)=>{let{id:o,updateValue:s,value:u,meta:m,key:h}=l&&l.payload||{};switch(l.type){case eW:return{...a,[o]:{...a[o]||{},[m]:{...a[o]&&a[o][m]||{},[h]:u}}};case eH:return{...a,[o]:{...a[o]||{},[m]:{...a[o]&&a[o][m]||{},[h]:s(a[o]&&a[o][m]?a[o][m][h]:void 0)}}};case eV:return a[o]&&a[o][m]&&a[o][m][h]?{...a,[o]:{...a[o]||{},[m]:{...a[o]&&a[o][m]||{},[h]:void 0}}}:a;default:return a}}}),eG=Object.defineProperty,Ia=(a,l,o)=>l in a?eG(a,l,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[l]=o,de=(a,l,o)=>(Ia(a,"symbol"!=typeof l?l+"":l,o),o);function Q(a,l,o,s=!0){l[eX]=l[eX]||[],l[eX].push(a);let u=new Map;Object.defineProperty(l,a,{enumerable:s,get(){if(typeof l[eZ][a]>"u")return;let s=l[eZ][a];if(!s)return s;let m=o.get(l[eZ][a],{parent:this.id?{id:this.id,type:this.type}:void 0});return u.has(m)||(u.clear(),u.set(m,ge(m,o))),u.get(m)},set(s){l[eZ][a]!==s&&(this[eJ]?o.modifyEntityField({id:this.id,type:this.type},a,function xr(a){return Array.isArray(a)?a.map(a=>xr(a)):a&&a.type?{id:a.id,type:a.type}:a}(s)):this[eZ][a]=s)}})}var eZ=Symbol.for("_refs_"),eJ=Symbol.for("_reactive_"),eX=Symbol.for("_defined_"),eY=Symbol.for("_parent_");function ge(a,l,o=!1,s){if(Array.isArray(a))return a.map(a=>ge(a,l,o));if(!a||!a.type||!a.id)return a;let u=function(a,l=!1,o){let s={id:"",type:"unknown",[eX]:[],[eZ]:{},[eY]:null,[eJ]:null,is(a){return"string"==typeof a?this.id===a:!!a.id&&a.id===this.id},reactive(){if(!this[eJ])return this[eJ]=this.subscribe(()=>this.refresh(),!0),()=>{this.unreactive()}},refresh(){if(this.id){let a=this.unwrap();for(let l of Object.keys(a||{}))this[eX].includes(l)?this[eZ][l]=a[l]:this[l]=a[l]}},unreactive(){this[eJ]&&(this[eJ](),this[eJ]=null)},unwrap(){if(!this.id)throw Error("Invalid object");let l=this[eY];return a.get(this.id,{parent:l?{id:l,type:"unknown"}:void 0})},toPresentation3(){return a.toPresentation3(this.unwrap())},toPresentation2(){return a.toPresentation2(this.unwrap())},valueOf(){return this.unwrap()},toJSON(){return{...this,items:this.items,annotations:this.annotations,structures:this.structures,seeAlso:this.seeAlso,service:this.service,services:this.services,rendering:this.rendering,partOf:this.partOf,start:this.start,supplementary:this.supplementary,homepage:this.homepage,thumbnail:this.thumbnail,placeholderCanvas:this.placeholderCanvas,accompanyingCanvas:this.accompanyingCanvas,provider:this.provider}},subscribe(l,o=!0){return a.subscribe(()=>this.id?a.get(this.id):null,l,o)}};return Q("items",s,a),Q("annotations",s,a),Q("structures",s,a),Q("seeAlso",s,a),Q("rendering",s,a),Q("partOf",s,a),Q("start",s,a,!1),Q("supplementary",s,a),Q("homepage",s,a),Q("thumbnail",s,a),Q("placeholderCanvas",s,a,!1),Q("accompanyingCanvas",s,a,!1),Q("provider",s,a),Q("body",s,a),Q("logo",s,a),s}(l,o),m=Object.create(u),h=Object.assign(m,a);return o&&h.reactive(),h}function Ot(a){switch(a){case"Image":case"Video":case"Sound":case"Dataset":case"Text":case"Composite":case"List":case"Independents":case"Audience":return"ContentResource";case"ImageService1":case"ImageService2":case"ImageService3":return"Service"}return a}var eK=class{constructor(a,l){var o;de(this,"options"),de(this,"store"),de(this,"emitter"),de(this,"isBatching",!1),de(this,"batchQueue",[]),de(this,"remoteFetcher"),de(this,"staticFetcher"),de(this,"defaultFetcher",a=>fetch(a).then(a=>a.json())),this.options=Object.assign({reducers:{},customFetcher:this.defaultFetcher,enableDevtools:!0},a||{}),this.store=l||function(a={}){var l;let{enableDevtools:o=!1,iiifStoreName:s="iiif",defaultState:u={iiif:{entities:gr(),meta:{},mapping:{},requests:{}}},customReducers:m={}}=a,h=(l=wr({[s]:eQ,...m}),(a,o)=>o&&o.type===ej?o.payload.actions.reduce(l,a):o&&"@iiif/BATCH_IMPORT"===o.type?{...a,iiif:{...a.iiif,...o.payload.state}}:l(a,o)),g="u">typeof window&&window.__REDUX_DEVTOOLS_EXTENSION__?ma:(a,l)=>a;return ia(ha(g(ca(h,u),{enabled:o})))}({customReducers:this.options.reducers,defaultState:this.options.defaultState,enableDevtools:this.options.enableDevtools}),this.emitter={all:o=o||new Map,on:function(a,l){var s=o.get(a);s?s.push(l):o.set(a,[l])},off:function(a,l){var s=o.get(a);s&&(l?s.splice(s.indexOf(l)>>>0,1):o.set(a,[]))},emit:function(a,l){var s=o.get(a);s&&s.slice().map(function(a){a(l)}),(s=o.get("*"))&&s.slice().map(function(o){o(a,l)})}},this.remoteFetcher=Tt(this,this.options.customFetcher),this.staticFetcher=Tt(this,(a,l)=>l)}batch(a){this.isBatching=!0;try{a(this),this.isBatching=!1,this.dispatch(e_({actions:this.batchQueue}))}catch(a){throw this.batchQueue=[],this.isBatching=!1,a}this.batchQueue=[]}async asyncBatch(a){this.isBatching=!0;try{await a(this),this.isBatching=!1,this.dispatch(e_({actions:this.batchQueue}))}catch(a){throw this.batchQueue=[],this.isBatching=!1,a}this.batchQueue=[]}modifyEntityField(a,l,o){this.dispatch(ex.modifyEntityField({id:a.id,type:a.type,key:l,value:o}))}dispatch(a){if(this.isBatching)this.batchQueue.push(a);else{if(a.type===ej){for(let l of a.payload.actions)this.emitter.emit(l.type,{action:l,state:this.store.getState()});this.store.dispatch(a);let l=this.getState();for(let o of a.payload.actions)this.emitter.emit(`after:${o.type}`,{action:o,state:l});return}this.emitter.emit(a.type,{action:a,state:this.store.getState()}),this.store.dispatch(a);let l=this.store.getState();this.emitter.emit(`after:${a.type}`,{action:a,state:l});return}}on(a,l){return this.emitter.on(a,l),()=>{this.emitter.off(a,l)}}serialize(a,l){return(0,x.B)(this.getState().iiif,a,l)}toPresentation2(a){return this.serialize(a,x.E)}toPresentation3(a){return this.serialize(a,x.F)}hydrate(a,l,o={}){return this.get(a,l,{...o,skipSelfReturn:!1})}get(a,l,o={}){"string"!=typeof l&&(o=l||{},l=void 0);let{skipSelfReturn:s=!0}=o||{},u=o.parent?"string"==typeof o.parent?o.parent:o.parent.id:void 0;if(Array.isArray(a))return a.map(a=>this.get(a,o));let m=this.getState();if((0,E.a)(a)&&!o.preserveSpecificResources&&(a=a.source),"string"==typeof a){let o=Ot(l||m.iiif.mapping[a]);if(!o)return s?null:{id:a,type:"unknown"};a={id:a,type:o}}if(a&&a.partOf&&!u&&!o.skipPartOfCheck){let l=Array.isArray(a.partOf)?a.partOf[0]:a.partOf;l&&("string"==typeof l&&(u=l),"string"==typeof l.id&&(u=l.id))}let h=Ot(l||(null==a?void 0:a.type)),g=null==a?void 0:a.id,v=m.iiif.entities[h];if(!v){let l=m.iiif.requests[g];return l&&l.resourceUri!==g?this.get(l.resourceUri,o):s?null:a}let b=v[a.id];if(b&&b[x.c]){let a=b[x.c].find(a=>u?a[x.d]===u:a[x.d]===b.id);return(0,x.j)(b,a)}return v[a.id]||(s?null:a)}select(a){return a(this.getState())}getStore(){return this.store}getState(){return this.store.getState()}deep(a,l){if(typeof a>"u")return this.get(l,{skipSelfReturn:!1});if("function"==typeof a)try{let o=a(this.get(l,{skipSelfReturn:!1})),i=a=>this.deep(a,o);return i.size=Array.isArray(o)?o.length:1,i}catch{let i=a=>this.deep(a,void 0);return i.size=0,i}let r=l=>this.deep(l,a);return r.size=Array.isArray(a)?a.length:1,r}loadManifest(a,l){let o="string"==typeof a?a:a.id;return this.load(o,l)}loadCollection(a,l){let o="string"==typeof a?a:a.id;return this.load(o,l)}load(a,l){let o="string"==typeof a?a:a.id;return l?Promise.resolve(this.staticFetcher(o,l)):Promise.resolve(this.remoteFetcher(o))}loadSync(a,l){let o="string"==typeof a?a:a.id;return this.staticFetcher(o,l)}loadManifestSync(a,l){let o="string"==typeof a?a:a.id;return this.loadSync(o,l)}loadCollectionSync(a,l){let o="string"==typeof a?a:a.id;return this.loadSync(o,l)}areInputsEqual(a,l){return Rt(a,l)}subscribe(a,l,o){return typeof o>"u"&&(typeof l>"u"||!1===l||!0===l)&&(o=l,l=a,a=a=>a),this.store.subscribe(a,a=>l(a,this),{equalityFn:Rt,fireImmediately:!o})}async ensureLoaded(a){let l="string"==typeof a?a:a.id;this.requestStatus(l)||await this.load(l)}requestStatus(a){return this.select(l=>l.iiif.requests[a])}getResourceMeta(a,l){let o=this.getState().iiif.meta[a];if(o)return l?o[l]:o}getObject(a,l,o={}){let{reactive:s,...u}=o;return ge(this.get(a,l,u),this,s)}async loadObject(a,l){return ge(await this.load(a,l),this)}async loadManifestObject(a,l){return ge(await this.loadManifest(a,l),this)}async loadCollectionObject(a,l){return ge(await this.loadCollection(a,l),this)}wrapObject(a){return ge(this.get(a,{skipSelfReturn:!1}),this)}isWrapped(a){return!!a[eX]}setMetaValue([a,l,o],s){this.dispatch("function"==typeof s?eN.setMetaValueDynamic({id:a,meta:l,key:o,updateValue:s}):eN.setMetaValue({id:a,meta:l,key:o,value:s}))}};let ka=a=>{let l=a.toString().split(":"),o=Math.ceil(parseInt(l[0])),s=Math.ceil(parseInt(l[1])),u=$a(Math.ceil(parseInt(l[2])),2),m=`${0!==o&&s<10?(s+"").padStart(2,"0"):s}:${u}`;return 0!==o&&(m=`${o}:${m}`),m},Sr=a=>{let l=new Date(1e3*a).toISOString().substr(11,8);return ka(l)},Cr=(a,l)=>{if("object"!=typeof a||null===a)return l;for(let o in l)"object"!=typeof l[o]||null===l[o]||Array.isArray(l[o])?a[o]=l[o]:(a[o]||(a[o]={}),a[o]=Cr(a[o],l[o]));return a},Ir=a=>a.split("").reduce(function(a,l){return(a=(a<<5)-a+l.charCodeAt(0))&a},0),Ar=(a,l)=>Object.hasOwn(a,l)?a[l].toString():void 0,$a=(a,l)=>String(a).padStart(l,"0"),e0={annotationOverlays:{backgroundColor:"#6666ff",borderColor:"#000099",borderType:"solid",borderWidth:"1px",opacity:"0.5",renderOverlays:!0,zoomLevel:2},background:"transparent",canvasBackgroundColor:"#6662",canvasHeight:"500px",contentSearch:{searchResultsLimit:20,overlays:{backgroundColor:"#ff6666",borderColor:"#990000",borderType:"solid",borderWidth:"1px",opacity:"0.5",renderOverlays:!0,zoomLevel:4}},crossOrigin:void 0,ignoreCaptionLabels:[],informationPanel:{vtt:{autoScroll:{enabled:!0,settings:{behavior:"smooth",block:"center"}}},open:!0,renderAbout:!0,renderSupplementing:!0,renderToggle:!0,renderAnnotation:!0,renderContentSearch:!0},openSeadragon:{},requestHeaders:{"Content-Type":"application/json"},showDownload:!0,showIIIFBadge:!0,showTitle:!0,withCredentials:!1};function Rr(a){let l={...e0.informationPanel.vtt.autoScroll};return"object"==typeof a&&(l="enabled"in a?a:{enabled:!0,settings:a}),!1===a&&(l.enabled=!1),function({behavior:a,block:l}){let o=["auto","instant","smooth"],s=["center","end","nearest","start"];if(!o.includes(a))throw TypeError(`'${a}' not in ${o.join(" | ")}`);if(!s.includes(l))throw TypeError(`'${l}' not in ${s.join(" | ")}`)}(l.settings),l}let e1=Rr(null==(m=null==(u=null==e0?void 0:e0.informationPanel)?void 0:u.vtt)?void 0:m.autoScroll),e2={activeCanvas:"",activeManifest:"",activeSelector:void 0,OSDImageLoaded:!1,collection:{},configOptions:e0,customDisplays:[],plugins:[],isAutoScrollEnabled:e1.enabled,isAutoScrolling:!1,isInformationOpen:null==(h=null==e0?void 0:e0.informationPanel)?void 0:h.open,isLoaded:!1,isUserScrolling:void 0,sequence:[[],[]],vault:new eK,openSeadragonViewer:null,viewerId:(0,C.Z)(),visibleCanvases:[],visibleAnnotations:[]},e3=w.createContext(e2),e4=w.createContext(e2);function Fa(a,l){switch(l.type){case"updateActiveCanvas":return l.canvasId||(l.canvasId=""),{...a,activeCanvas:l.canvasId};case"updateActiveManifest":return{...a,activeManifest:l.manifestId};case"updateOSDImageLoaded":return{...a,OSDImageLoaded:l.OSDImageLoaded};case"updateAutoScrollAnnotationEnabled":return{...a,isAutoScrollEnabled:l.isAutoScrollEnabled};case"updateAutoScrolling":return{...a,isAutoScrolling:l.isAutoScrolling};case"updateCollection":return{...a,collection:l.collection};case"updateConfigOptions":return{...a,configOptions:Cr(a.configOptions,l.configOptions)};case"updateContentStateAnnotation":return{...a,contentStateAnnotation:l.contentStateAnnotation};case"updateInformationOpen":return{...a,isInformationOpen:l.isInformationOpen};case"updateInformationPanelResource":return{...a,informationPanelResource:l.informationPanelResource};case"updateIsLoaded":return{...a,isLoaded:l.isLoaded};case"updateManifestSequence":return{...a,sequence:l.sequence};case"updateUserScrolling":return{...a,isUserScrolling:l.isUserScrolling};case"updateOpenSeadragonViewer":return{...a,openSeadragonViewer:l.openSeadragonViewer};case"updateViewerId":return{...a,viewerId:l.viewerId};case"updateActiveSelector":return{...a,activeSelector:l.selector};case"updateVisibleCanvases":return{...a,visibleCanvases:l.visibleCanvases};default:throw Error(`Unhandled action type: ${l.type}`)}}let _a=({initialState:a=e2,children:l})=>{let[o,s]=(0,w.useReducer)(Fa,a),{openSeadragonViewer:u}=o;return(0,w.useEffect)(()=>{if(u)return u.addHandler("update-viewport",()=>{let a=u.viewport,l=a.getBounds(),o=a.viewportToImageRectangle(l),m=`xywh=${[Math.round(o.x),Math.round(o.y),Math.round(o.width),Math.round(o.height)].join(",")}`;s({type:"updateActiveSelector",selector:{type:"FragmentSelector",value:m}})}),()=>{u.removeAllHandlers("update-viewport")}},[u]),w.createElement(e3.Provider,{value:o},w.createElement(e4.Provider,{value:s},l))};function D(){let a=w.useContext(e3);if(void 0===a)throw Error("useViewerState must be used within a ViewerProvider");return a}function X(){let a=w.useContext(e4);if(void 0===a)throw Error("useViewerDispatch must be used within a ViewerProvider");return a}let za=async(a,l)=>{let o=a.get({id:l,type:"Canvas"});if(!(null!=o&&o.annotations)||!o.annotations[0])return[];let s=a.get(o.annotations).filter(a=>!!a.items&&a),u=[];for(let l of s)if(l.items.length>0){let a=l.label||{none:["Annotations"]};u.push({...l,label:a})}else{let o={};try{o=await a.load(l.id)}catch(a){console.log(a)}if(o.items&&o.items.length>0){let a=o.label||{none:["Annotations"]};u.push({...o,label:a})}}return u},$r=async(a,l,o)=>{try{if(null==o||null==o.q)return{};let s=o.q.trim(),u=new URL(l);return u.searchParams.set("q",s),await a.load(u.toString())}catch(a){return console.warn("Error in getContentSearchResources:",a),{}}},Mr=(a,l,o,s)=>{var u,m;let h={canvas:void 0,accompanyingCanvas:void 0,annotationPage:void 0,annotations:[]};if(h.canvas=a.get(l),h.canvas&&(h.annotationPage=a.get(h.canvas.items[0]),h.accompanyingCanvas=null!=(u=h.canvas)&&u.accompanyingCanvas?a.get(null==(m=h.canvas)?void 0:m.accompanyingCanvas):void 0),h.annotationPage){let u=a.get(h.annotationPage.items).map(l=>({body:a.get(l.body[0].id),motivation:l.motivation,type:"Annotation"})),m=[];u.forEach(l=>{"Choice"===l.body.type?l.body.items.forEach(o=>m.push({...l,id:o.id,body:a.get(o.id)})):m.push(l)}),h.annotations=m.filter(u=>{if(u){if(!u.body||!u.motivation){console.error("Invalid annotation after Hyperion parsing: missing either 'body' or 'motivation'",u);return}let m=u.body;Array.isArray(m)&&(m=m[0]);let h=a.get(m.id);if(h)switch(o){case"painting":return u.target===l.id&&u.motivation&&"painting"===u.motivation[0]&&s.includes(h.type)&&(u.body=h),!!u;case"supplementing":return;default:throw Error("Invalid annotation motivation.")}}})}return h},vt=(a,l="en")=>{if(!a)return"";if(!a[l]){let l=Object.getOwnPropertyNames(a);if(l.length>0)return a[l[0]]}return a[l]},me=(a,l)=>{let o=Mr(a,{id:l,type:"Canvas"},"painting",["Image","Sound","Video"]);if(0!==o.annotations.length&&o.annotations&&o.annotations)return o.annotations.map(a=>null==a?void 0:a.body)},e5={xxs:"(max-width: 349px)",xs:"(max-width: 575px)",sm:"(max-width: 767px)",md:"(max-width: 991px)",lg:"(max-width: 90rem)",xl:"(min-width: calc(90rem + 1px))"},{styled:e6,css:e8,keyframes:e7,createTheme:e9}=(0,M.Th)({theme:{colors:{primary:"#1a1d1e",primaryMuted:"#26292b",primaryAlt:"#151718",accent:"hsl(209 100% 38.2%)",accentMuted:"hsl(209 80% 61.8%)",accentAlt:"hsl(209 80% 30%)",secondary:"#FFFFFF",secondaryMuted:"#e6e8eb",secondaryAlt:"#c1c8cd"},fontSizes:{1:"12px",2:"13px",3:"15px",4:"17px",5:"19px",6:"21px",7:"27px",8:"35px",9:"59px"},lineHeights:{1:"12px",2:"13px",3:"15px",4:"17px",5:"19px",6:"21px",7:"27px",8:"35px",9:"59px"},sizes:{1:"5px",2:"10px",3:"15px",4:"20px",5:"25px",6:"35px",7:"45px",8:"65px",9:"80px"},space:{1:"5px",2:"10px",3:"15px",4:"20px",5:"25px",6:"35px",7:"45px",8:"65px",9:"80px"},radii:{1:"4px",2:"6px",3:"8px",4:"12px",round:"50%",pill:"9999px"},transitions:{all:"all 200ms cubic-bezier(0.16, 1, 0.3, 1)"},zIndices:{1:"100",2:"200",3:"300",4:"400",max:"999"}},media:e5}),te=e6("div",{display:"flex",flexDirection:"column",alignItems:"center"}),ti=e6("p",{fontWeight:"bold",fontSize:"x-large"}),tn=e6("span",{fontSize:"medium"}),yt=({error:a})=>{let{message:l}=a;return w.createElement(te,{role:"alert"},w.createElement(ti,{"data-testid":"headline"},"Something went wrong"),l&&w.createElement(tn,null,`Error message: ${l}`," "))},ta=e6("div",{position:"relative",zIndex:"0"}),tr=e6("div",{display:"flex",flexDirection:"row",flexGrow:"1",overflow:"hidden"}),tl=e6("div",{display:"flex",flexDirection:"column",flexGrow:"1",flexShrink:"1",width:"100%",height:"100%","&[data-aside-active='true']":{width:"61.8%","@sm":{width:"0",opacity:"0"}},"&[data-aside-toggle='false']":{"@sm":{width:"100% !important",opacity:"1 !important"}}}),ts=e6("aside",{display:"flex",flexGrow:"1",flexShrink:"0",width:"0",maxHeight:"100%","&[data-aside-active='true']":{width:"38.2%","@sm":{width:"100%"}},"&[data-aside-toggle='false']":{"@sm":{width:"0 !important"}}}),tc=e6("div",{display:"flex",flexDirection:"column",fontSmooth:"auto",webkitFontSmoothing:"antialiased",'&[data-absolute-position="true"]':{position:"absolute",width:"100%",height:"100%",zIndex:"0"},"> div":{display:"flex",flexDirection:"column",flexGrow:"1",justifyContent:"flex-start",height:"100%",maxHeight:"100%","@sm":{[`& ${tr}`]:{flexGrow:"1"},[`& ${tl}`]:{flexGrow:"0"}}},"@sm":{padding:"0"},"&[data-information-panel-open='true']":{"@sm":{}}}),td=e6(P.fC,{display:"flex",flexDirection:"column",width:"100%",height:"100%",flexGrow:"1",flexShrink:"0",position:"relative",zIndex:"1",maskImage:"linear-gradient(180deg, rgba(0, 0, 0, 1) calc(100% -  2rem), transparent 100%)","@sm":{marginTop:"0.5rem",boxShadow:"none"}}),tu=e6(P.aV,{display:"flex",flexGrow:"0",margin:"0 1.618rem",borderBottom:"5px solid #6663","@sm":{margin:"0 1rem"}}),tm=e6(P.xz,{display:"flex",position:"relative",padding:"0.5rem 1.618rem",background:"none",backgroundColor:"transparent",fontFamily:"inherit",border:"none",opacity:"0.7",fontSize:"1rem",lineHeight:"1rem",whiteSpace:"nowrap",cursor:"pointer",fontWeight:400,transition:"$all","&[data-value='manifest-back']":{display:"none;","@sm":{display:"block"}},"&::after":{width:"0",height:"4px",content:"",position:"absolute",bottom:"-4px",left:"0",transition:"$all"},"&[data-state='active']":{opacity:"1",fontWeight:700,"&::after":{width:"100%",backgroundColor:"$accent"}}}),tp=e6(P.VY,{display:"flex",flexDirection:"column",flexGrow:"1",flexShrink:"0",position:"absolute",top:"0",left:"0","&[data-state='active']":{width:"100%",height:"calc(100% - 2rem)",padding:"1.618rem 0"}}),th=e6(({handleScroll:a,children:l,className:o})=>w.createElement("div",{className:o,onScroll:a},l),{position:"relative",height:"100%",width:"100%",overflowY:"scroll"}),tf={position:"relative",display:"flex",margin:"0 1.618rem",padding:"0.5rem 0",fontFamily:"inherit",fontSize:"0.8333rem",lineHeight:"1.47rem",color:"inherit",background:"none",borderRadius:"3px",border:"none"},tg=e6("button",{textAlign:"left","&:hover":{color:"$accent"}}),tv=e6("div",{display:"flex",flexDirection:"column",width:"100%",header:{margin:"0 1.618rem 0.5rem ",fontWeight:700,fontSize:"0.8333rem",em:{fontStyle:"normal",fontWeight:400,opacity:.7}},paddingBottom:"1rem",marginBottom:"1rem",borderBottom:"1px solid #0001"}),ty=e6("div",{gap:"1rem",fontSize:"1rem",lineHeight:"1.47em",margin:"0","&[data-content-search=true]":{em:{fontWeight:700,display:"inline"}}}),tb=e6("div",{...tf,display:"flex",flexDirection:"row",gap:"1rem","&[data-format='text/vtt']":{marginTop:"-1rem","> span":{display:"none"}},"> span":{display:"flex",width:"2rem",height:"2rem",backgroundColor:"#0001",flexShrink:"0",borderRadius:"3px",marginTop:"0.25rem"},"&[data-content='None']":{button:{div:{opacity:"0.7"},"&:hover, &:focus":{div:{opacity:"1"}}}},[`&[dir=rtl] ${ty}`]:{textAlign:"right !important"}}),Ja=({value:a,handleClick:l})=>w.createElement(tg,{onClick:l},w.createElement(ty,{dangerouslySetInnerHTML:{__html:a}})),Ya=({caption:a,handleClick:l,imageUri:o})=>w.createElement(tg,{onClick:l},w.createElement("img",{src:o,alt:`A visual annotation for ${a}`}),w.createElement("span",null,a)),Xa=({value:a,handleClick:l})=>{let o=(0,z.Z)(a);return w.createElement(tg,{onClick:l},w.createElement(ty,{dangerouslySetInnerHTML:{__html:o.html}}))},Pt=({value:a,handleClick:l,isContentSearch:o})=>w.createElement(tg,{onClick:l},w.createElement(ty,{dangerouslySetInnerHTML:{__html:a},"data-content-search":o})),Za=()=>{function e(a){return a.map(a=>{let l=a.identifier||(0,C.Z)();return{...a,identifier:l}})}return{addIdentifiersToParsedCues:e,createNestedCues:function(a){var l;let o=[],s=[],u=e(a);for(let a of u){for(;s.length>0&&s[s.length-1].end<=a.start;)s.pop();s.length>0?(s[s.length-1].children||(s[s.length-1].children=[]),null==(l=s[s.length-1].children)||l.push(a)):o.push(a),s.push(a)}return o},isChild:function(a,l=[]){return l.some(l=>a.start>=l.start&&a.end<=l.end)},orderCuesByTime:function(a=[]){return a.sort((a,l)=>a.start-l.start)}}},tw=e6(F.fC,{display:"flex",flexDirection:"column",width:"100%"}),tx=e6(F.ck,{...tf,justifyContent:"space-between",textAlign:"left",flexGrow:1,margin:0,marginLeft:"-1rem",padding:"0.618rem 1rem",width:"calc(100% + 2rem)",fontSize:"1rem",strong:{marginLeft:"1rem"},"&:hover":{color:"$accent"},"&[aria-checked='true']":{background:"#6662"}}),to=a=>{for(;a&&a!==document.body;){let l=window.getComputedStyle(a).overflowY;if("visible"!==l&&"hidden"!==l&&a.scrollHeight>a.clientHeight)return a;a=a.parentNode}return null},ro=({label:a,start:l,end:o})=>{var s,u;let m=X(),{configOptions:h,isAutoScrollEnabled:g,isUserScrolling:v}=D(),b=null==(u=null==(s=null==h?void 0:h.informationPanel)?void 0:s.vtt)?void 0:u.autoScroll,[x,E]=(0,w.useState)(!1),C=(0,w.useRef)(null),k=document.getElementById("clover-iiif-video");return(0,w.useEffect)(()=>(null==k||k.addEventListener("timeupdate",()=>{let{currentTime:a}=k;E(l<=a&&a<o)}),()=>document.removeEventListener("timeupdate",()=>{})),[o,l,k]),(0,w.useEffect)(()=>{var a,l;if(g&&x&&C.current&&!v){let o=C.current;if(o&&o instanceof HTMLElement){let s=to(o);if(s&&s instanceof HTMLElement){let u;switch(null==(a=null==b?void 0:b.settings)?void 0:a.block){case"center":let h=s.getBoundingClientRect();u=o.offsetTop+o.offsetHeight-Math.floor((h.bottom-h.top)/2);break;case"end":u=o.offsetTop+o.offsetHeight-(s.clientHeight-o.clientHeight)+2;break;default:u=o.offsetTop-2}m({type:"updateAutoScrolling",isAutoScrolling:!0}),s.scrollTo({top:u,left:0,behavior:null==(l=null==b?void 0:b.settings)?void 0:l.behavior}),setTimeout(()=>m({type:"updateAutoScrolling",isAutoScrolling:!1}),750)}}}},[b,x,v,g,m]),w.createElement(tx,{ref:C,"aria-checked":x,"data-testid":"information-panel-cue",onClick:()=>{k&&(k.pause(),k.currentTime=l,k.play())},value:a},w.createElement("span",null,a),w.createElement("strong",null,Sr(l)))},tE=e6("ul",{listStyle:"none",paddingLeft:"1rem",position:"relative","&&:first-child":{paddingLeft:"0"},"& li ul":{[`& ${tx}`]:{backgroundColor:"unset","&::before":{content:"none"},"&::after":{content:"none"}}},"&:first-child":{margin:"0 0 1.618rem"}}),Dr=({items:a})=>w.createElement(tE,null,a.map(a=>{let{text:l,start:o,end:s,children:u,identifier:m}=a;return w.createElement("li",{key:m},w.createElement(ro,{label:l,start:o,end:s}),u&&w.createElement(Dr,{items:u}))})),io=({inlineCues:a,label:l,vttUri:o})=>{let[s,u]=w.useState(a||[]),{createNestedCues:m,orderCuesByTime:h}=Za(),[g,v]=w.useState();return(0,w.useEffect)(()=>{o&&fetch(o,{headers:{"Content-Type":"text/plain",Accept:"application/json"}}).then(a=>a.text()).then(a=>{let l=(0,L.parse)(a).cues,o=h(l),s=m(o);u(s)}).catch(a=>{console.error(o,a.toString()),v(a)})},[o]),w.createElement(tw,{"data-testid":"annotation-item-vtt","aria-label":`${vt(l)}`},g&&w.createElement("div",{"data-testid":"error-message"},"Network Error: ",g.toString()),w.createElement(Dr,{items:s}))},ao=a=>{var l;if(!a)return"LTR";let o=Array.isArray(a)?null==(l=a[0])?void 0:l.split("-")[0]:null==a?void 0:a.split("-")[0];return["ar","fa","ur","ps","dv","sd","ug","ku","he","yi","jrb","jpr","nqo"].includes(o)?"RTL":"LTR"},oo=a=>{var l,o,s,u,m;let h={id:"string"==typeof a?a:a.source};if("string"==typeof a){if(a.includes("#xywh=")){let l=a.split("#xywh=");if(l&&l[1]){let[a,o,s,u]=l[1].split(",").map(a=>Number(a));h={id:l[0],rect:{x:a,y:o,w:s,h:u}}}}else if(a.includes("#t=")){let l=a.split("#t=");l&&l[1]&&(h={id:l[0],t:l[1]})}}else if("object"==typeof a){if((null==(l=a.selector)?void 0:l.type)==="PointSelector")h={id:a.source,point:{x:a.selector.x,y:a.selector.y}};else if((null==(o=a.selector)?void 0:o.type)==="SvgSelector")h={id:a.source,svg:a.selector.value};else if((null==(s=a.selector)?void 0:s.type)==="FragmentSelector"&&null!=(u=a.selector)&&u.value.includes("xywh=")&&"Canvas"==a.source.type&&a.source.id){let l=null==(m=a.selector)?void 0:m.value.split("xywh=");if(l&&l[1]){let[o,s,u,m]=l[1].split(",").map(a=>Number(a));h={id:a.source.id,rect:{x:o,y:s,w:u,h:m}}}}}return h},wt=({annotation:a,targetResource:l,isContentSearch:o,isContentState:s})=>{var u,m,h,g,v,b,x;let{target:E}=a,C=null==(u=null==E?void 0:E.selector)?void 0:u.type,k=(null==(h=null==(m=null==E?void 0:E.selector)?void 0:m.value)?void 0:h.split("=")[1])||"full",[A,I]="full"!==k?null==k?void 0:k.split(",").slice(2):[100,100],O="PointSelector"===C&&null!=(g=null==E?void 0:E.selector)&&g.t?[{start:null==(v=null==E?void 0:E.selector)?void 0:v.t,end:0,text:" ",styles:"",children:[]}]:void 0,M=`${l}/${k}/!${((a,l)=>{let o=Math.max(a,l);return[Math.round(a/o*100),Math.round(l/o*100)].join(",")})(A,I)}/0/default.jpg`,P=D(),z=X(),{openSeadragonViewer:F,vault:L,visibleCanvases:_}=P,H=null!=a&&a.body?null==(b=null==a?void 0:a.body)?void 0:b.map(a=>L.get(a.id)):[],{format:V="PointSelector"===C?"text/vtt":"text/plain",language:N="none",value:q="",chars:U=""}=H[0]?H[0]:{},G=(null==(x=H[0])?void 0:x.label)||{none:["t"]},Y=q||U||"None",K=N?ao(N).toLocaleLowerCase():"LTR";function $(){var l;let o=null==F?void 0:F.getOverlayById(a.id);if(o&&null!=F&&F.viewport){null!=o&&o.element&&(null==(l=o.element)||l.focus());let a=null==o?void 0:o.getBounds(F.viewport);a.x-=.2,a.y-=.2,a.width+=.5,a.height+=.5,F.viewport.fitBounds(a,!1)}}function T(l){var o;l.preventDefault(),l.stopPropagation();let s=(null==(o=null==a?void 0:a.target)?void 0:o.source)||(null==a?void 0:a.target),u=null==s?void 0:s.id;_.map(a=>a.id).includes(u)?$():z({type:"updateActiveCanvas",canvasId:u})}return(0,w.useEffect)(()=>{if(!F||!s)return;let l=setInterval(()=>{(null==F?void 0:F.getOverlayById(a.id))&&($(),F.container.className="clover-iiif-content-state",clearInterval(l))},1e3);return()=>clearInterval(l)},[F,s]),w.createElement(tb,{dir:K,"data-format":V,"data-content":Y,className:"clover-iiif-annotation-item"},w.createElement("span",{style:{backgroundImage:`url(${M})`,backgroundSize:"cover",backgroundPosition:"center"}}),function(){var a,l,s;switch(V){case"text/plain":return w.createElement(Pt,{value:Y,handleClick:T,isContentSearch:o});case"text/html":return w.createElement(Ja,{value:Y,handleClick:T});case"text/markdown":return w.createElement(Xa,{value:Y,handleClick:T});case"text/vtt":return w.createElement(io,{inlineCues:O,label:G,vttUri:(null==(a=H[0])?void 0:a.id)||void 0});case null==(l=null==V?void 0:V.match(/^image\//))?void 0:l.input:let u=(null==(s=H.find(a=>{var l;return!(null!=(l=a.id)&&l.includes("vault://"))}))?void 0:s.id)||"";return w.createElement(Ya,{caption:q,handleClick:T,imageUri:u});default:return w.createElement(Pt,{value:Y,handleClick:T})}}())},Br=(a,l="none")=>{if(!a)return null;if("string"==typeof a)return[a];if(!a[l]){let l=Object.getOwnPropertyNames(a);if(l.length>0)return a[l[0]]}return a[l]&&Array.isArray(a[l])?a[l]:null},Z=(a,l="none",o=", ")=>{let s=Br(a,l);return Array.isArray(s)?s.join(`${o}`):s};function ae(a,l){let o=Object.keys(a).filter(a=>l.includes(a)?null:a),s={};return o.forEach(l=>{s[l]=a[l]}),s}let tS=e6("span",{}),ce=a=>{let{as:l,label:o}=a,s=ae(a,["as","label"]);return w.createElement(tS,{as:l,...s},Z(o,s.lang))},uo=(a,l="200,",o="full")=>{let s;Array.isArray(a)&&(a=a[0]);let{id:u,service:m}=a;if(!m)return u;if(Array.isArray(a.service)&&a.service.length>0&&(s=m[0]),s){if(s["@id"])return`${s["@id"]}/${o}/${l}/0/default.jpg`;if(s.id)return`${s.id}/${o}/${l}/0/default.jpg`}},tC=e6("img",{objectFit:"cover"}),mo=a=>{let l;let o=(0,w.useRef)(null),{contentResource:s,altAsLabel:u,region:m="full"}=a;u&&(l=Z(u));let h=ae(a,["contentResource","altAsLabel"]),{type:g,id:v,width:b=200,height:x=200,duration:E}=s;(0,w.useEffect)(()=>{if(!v&&!o.current||["Image"].includes(g)||!v.includes("m3u8"))return;let a=new H.ZP;return o.current&&(a.attachMedia(o.current),a.on(H.ZP.Events.MEDIA_ATTACHED,function(){a.loadSource(v)})),a.on(H.ZP.Events.ERROR,function(l,o){if(o.fatal)switch(o.type){case H.ZP.ErrorTypes.NETWORK_ERROR:console.error(`fatal ${l} network error encountered, try to recover`),a.startLoad();break;case H.ZP.ErrorTypes.MEDIA_ERROR:console.error(`fatal ${l} media error encountered, try to recover`),a.recoverMediaError();break;default:a.destroy()}}),()=>{a&&(a.detachMedia(),a.destroy())}},[v,g]);let C=(0,w.useCallback)(()=>{if(!o.current)return;let a=0,l=30;if(E&&(l=E),!v.split("#t=")&&E&&(a=.1*E),v.split("#t=").pop()){let l=v.split("#t=").pop();l&&(a=parseInt(l.split(",")[0]))}let s=o.current;s.autoplay=!0,s.currentTime=a,setTimeout(()=>C(),1e3*l)},[E,v]);(0,w.useEffect)(()=>C(),[C]);let k=uo(s,`${b},${x}`,m);switch(g){case"Image":return w.createElement(tC,{as:"img",alt:l,css:{width:b,height:x},key:v,src:k,...h});case"Video":return w.createElement(tC,{as:"video",css:{width:b,height:x},disablePictureInPicture:!0,key:v,loop:!0,muted:!0,onPause:C,ref:o,src:v});default:return console.warn(`Resource type: ${g} is not valid or not yet supported in Primitives.`),w.createElement(w.Fragment,null)}},tk=e6("a",{}),ho=a=>{let{children:l,homepage:o}=a,s=ae(a,["children","homepage"]);return w.createElement(w.Fragment,null,o&&o.map(a=>{let o=Z(a.label,s.lang);return w.createElement(tk,{"aria-label":l?o:void 0,href:a.id,key:a.id,...s},l||o)}))},tR={delimiter:", "},tA=(0,w.createContext)(void 0),Hr=()=>{let a=(0,w.useContext)(tA);if(void 0===a)throw Error("usePrimitivesContext must be used with a PrimitivesProvider");return a},Et=({children:a,initialState:l=tR})=>{let o=go(l,"delimiter");return w.createElement(tA.Provider,{value:{delimiter:o}},a)},go=(a,l)=>Object.hasOwn(a,l)?a[l].toString():void 0,tI=e6("span",{}),_t=a=>{let{as:l,markup:o}=a,{delimiter:s}=Hr();if(!o)return w.createElement(w.Fragment,null);let u=ae(a,["as","markup"]),m={__html:_(Z(o,u.lang,s),{allowedAttributes:{a:["href"],img:["alt","src","height","width"]},allowedSchemes:["http","https","mailto"],allowedTags:["a","b","br","i","img","p","small","span","sub","sup"]})};return w.createElement(tI,{as:l,...u,dangerouslySetInnerHTML:m})},Vr=a=>w.useContext(tA)?w.createElement(_t,{...a}):w.createElement(Et,null,w.createElement(_t,{...a})),yo=({as:a="dd",lang:l,value:o})=>w.createElement(Vr,{markup:o,as:a,lang:l}),t$=e6("span",{}),wo=({as:a="dd",customValueContent:l,lang:o,value:s})=>{var u;let{delimiter:m}=Hr(),h=null==(u=Br(s,o))?void 0:u.map(a=>(0,w.cloneElement)(l,{value:a}));return w.createElement(t$,{as:a,lang:o},null==h?void 0:h.map((a,l)=>[l>0&&`${m}`,w.createElement(w.Fragment,{key:l},a)]))},Nr=a=>{var l;let{item:o,lang:s,customValueContent:u}=a,{label:m,value:h}=o,g=null==(l=Z(m))?void 0:l.replace(" ","-").toLowerCase();return w.createElement("div",{role:"group","data-label":g},w.createElement(ce,{as:"dt",label:m,lang:s}),u?w.createElement(wo,{as:"dd",customValueContent:u,value:h,lang:s}):w.createElement(yo,{as:"dd",value:h,lang:s}))},tT=e6("dl",{}),So=a=>{let{as:l,customValueContent:o,metadata:s}=a;if(!Array.isArray(s))return w.createElement(w.Fragment,null);let u=Ar(a,"customValueDelimiter"),m=ae(a,["as","customValueContent","customValueDelimiter","metadata"]);return w.createElement(Et,{..."string"==typeof u?{initialState:{delimiter:u}}:void 0},s.length>0&&w.createElement(tT,{as:l,...m},s.map((a,l)=>{let s=o?function(a,l){let o=l.filter(l=>{let{matchingLabel:o}=l,s=Object.keys(l.matchingLabel)[0],u=Z(o,s);if(Z(a,s)===u)return!0}).map(a=>a.Content);if(Array.isArray(o))return o[0]}(a.label,o):void 0;return w.createElement(Nr,{customValueContent:s,item:a,key:l,lang:null==m?void 0:m.lang})})))};e6("li",{}),e6("ul",{});let tO=e6("li",{}),tM=e6("ul",{}),Ao=a=>{let{as:l,rendering:o}=a,s=ae(a,["as","rendering"]);return w.createElement(tM,{as:l},o&&o.map(a=>{let l=Z(a.label,s.lang);return w.createElement(tO,{key:a.id},w.createElement("a",{href:a.id,...s,target:"_blank"},l||a.id))}))},tP=e6("dl",{}),To=a=>{let{as:l,requiredStatement:o}=a;if(!o)return w.createElement(w.Fragment,null);let s=Ar(a,"customValueDelimiter"),u=ae(a,["as","customValueDelimiter","requiredStatement"]);return w.createElement(Et,{..."string"==typeof s?{initialState:{delimiter:s}}:void 0},w.createElement(tP,{as:l,...u},w.createElement(Nr,{item:o,lang:u.lang})))},tz=e6("li",{}),tF=e6("ul",{}),Mo=a=>{let{as:l,seeAlso:o}=a,s=ae(a,["as","seeAlso"]);return w.createElement(tF,{as:l},o&&o.map(a=>{let l=Z(a.label,s.lang);return w.createElement(tz,{key:a.id},w.createElement("a",{href:a.id,...s},l||a.id))}))},Oo=a=>{let{as:l,summary:o}=a,s=ae(a,["as","customValueDelimiter","summary"]);return w.createElement(Vr,{as:l,markup:o,...s})},Wr=a=>{let{thumbnail:l,region:o}=a,s=ae(a,["thumbnail"]);return w.createElement(w.Fragment,null,l&&l.map(a=>w.createElement(mo,{contentResource:a,key:a.id,region:o,...s})))},Po=({annotationPage:a})=>{var l,o,s,u,m,h;let g=D(),{vault:v}=g;if(!a||!a.items||(null==(l=a.items)?void 0:l.length)===0)return w.createElement(w.Fragment,null);let b=a.items.map(a=>v.get(a.id));if(!b)return w.createElement(w.Fragment,null);let x=b.reduce((a,l)=>(a.canvas=l.target.source.id,a.annotations=[],a.annotations.push(null==l?void 0:l.id),a),{}),E=v.get(x.canvas),C=me(v,E.id),k=null!=(o=null==C?void 0:C[0])&&o.service?(null==(u=null==(s=null==C?void 0:C[0])?void 0:s.service[0])?void 0:u.id)||(null==(h=null==(m=null==C?void 0:C[0])?void 0:m.service[0])?void 0:h["@id"]):void 0;return w.createElement(tv,{"data-testid":"annotation-page"},E&&w.createElement("header",null,w.createElement(ce,{label:E.label})),w.createElement("div",{"data-testid":"annotation-page-items"},null==b?void 0:b.map(a=>w.createElement(wt,{annotation:a,targetResource:k,key:a.id}))))},tL=e6("div",{form:{display:"flex",alignItems:"center",width:"100%",height:"100%",gap:"1rem",padding:"0 1.618rem 1.618rem",".content-search-input":{flexGrow:"1",input:{width:"100%",border:"none",backgroundColor:"$secondaryMuted",color:"$primary",marginRight:"1rem",height:"2rem",padding:"0 1rem",borderRadius:"1rem",fontFamily:"inherit",fontSize:"1rem",lineHeight:"1rem",boxShadow:"inset 1px 1px 2px #0001","&::placeholder":{color:"#0006"}}}}}),tj=e6("button",{display:"flex",background:"none",border:"none",width:"2rem",height:"2rem",padding:"0",margin:"0",fontWeight:"700",borderRadius:"2rem",backgroundColor:"$accent",color:"$secondary",cursor:"pointer",boxSizing:"content-box",transition:"$all",svg:{height:"60%",width:"60%",padding:"20%",fill:"$secondary",stroke:"$secondary",opacity:"1",filter:"drop-shadow(5px 5px 5px #000D)",boxSizing:"inherit",transition:"$all"},"&:disabled":{backgroundColor:"transparent",boxShadow:"none",svg:{opacity:"0.25"}}}),zo=({searchServiceUrl:a,setContentSearchResource:l,setLoading:o})=>{let{t:s}=(0,b.$G)(),[u,m]=(0,w.useState)(),h=D(),{openSeadragonViewer:g,vault:v}=h;async function d(s){if(s.preventDefault(),g&&a){if(!u||""===u.trim()){l({});return}o(!0),$r(v,a,{q:u}).then(a=>{l(a),o(!1)})}}let x=s("contentSearchPlaceholder");return w.createElement(tL,null,w.createElement(V.fC,{onSubmit:d,className:"content-search-form"},w.createElement(V.gN,{className:"content-search-input",name:"searchTerms",onChange:a=>{a.preventDefault(),m(a.target.value)}},w.createElement(V.oT,{placeholder:x})),w.createElement(V.k4,{asChild:!0},w.createElement(tj,{type:"submit"},w.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},w.createElement("title",null,s("informationPanelTabsSearch")),w.createElement("path",{d:"M456.69 421.39L362.6 327.3a173.81 173.81 0 0034.84-104.58C397.44 126.38 319.06 48 222.72 48S48 126.38 48 222.72s78.38 174.72 174.72 174.72A173.81 173.81 0 00327.3 362.6l94.09 94.09a25 25 0 0035.3-35.3zM97.92 222.72a124.8 124.8 0 11124.8 124.8 124.95 124.95 0 01-124.8-124.8z"}))))))},Lo=({searchServiceUrl:a,setContentSearchResource:l,activeCanvas:o,annotationPage:s})=>{let u;let m=D(),{vault:h}=m,{t:g}=(0,b.$G)(),[v,x]=(0,w.useState)(!1),[E,C]=(0,w.useState)({});return(0,w.useEffect)(()=>{var a;if(!(null!=s&&s.items))return;let l=(null==(a=null==s?void 0:s.items)?void 0:a.map(a=>h.get(a.id))).reduce((a,l)=>{let o=l.target.source.id;return a[o]||(a[o]=[]),a[o].push(l.id),a},{});C(l)},[s]),w.createElement(w.Fragment,null,w.createElement(zo,{searchServiceUrl:a,setContentSearchResource:l,activeCanvas:o,setLoading:x}),v?w.createElement("span",null,g("contentSearchLoading")):E&&Object.keys(E).length>0&&Object.keys(E).map(a=>(u=h.get(a),w.createElement(tv,{key:a,"data-testid":"annotation-page"},u&&w.createElement("header",null,w.createElement(ce,{label:u.label})),E[a].map(a=>{var l,o,s,m,g;let v=h.get(a),b=me(h,u.id),x=null!=(l=null==b?void 0:b[0])&&l.service?(null==(s=null==(o=null==b?void 0:b[0])?void 0:o.service[0])?void 0:s.id)||(null==(g=null==(m=null==b?void 0:b[0])?void 0:m.service[0])?void 0:g["@id"]):void 0;return w.createElement(wt,{annotation:v,targetResource:x,key:v.id,isContentSearch:!0})})))))},t_=e6("div",{width:"100%",padding:" 0 1.618rem 2rem",display:"flex",flexDirection:"column",overflow:"auto",position:"absolute",fontWeight:"400",fontSize:"1rem",zIndex:"0",img:{maxWidth:"100px",maxHeight:"100px",objectFit:"contain",color:"transparent",margin:"0 0 1rem",borderRadius:"3px",backgroundColor:"$secondaryMuted"},video:{display:"none"},"a, a:visited":{color:"$accent"},p:{fontSize:"1rem",lineHeight:"1.47em",margin:"0"},dl:{margin:"0",dt:{fontWeight:"700",margin:"1rem 0 0.25rem"},dd:{margin:"0"}},".manifest-property-title":{fontWeight:"700",margin:"1rem 0 0.25rem"},"ul, ol":{padding:"0",margin:"0",li:{fontSize:"1rem",lineHeight:"1.45em",listStyle:"none",margin:"0.25rem 0 0.25rem"}}}),tB=e6("div",{position:"relative",width:"100%",height:"100%",zIndex:"0"}),Ho=({homepage:a})=>(null==a?void 0:a.length)===0?w.createElement(w.Fragment,null):w.createElement(w.Fragment,null,w.createElement("span",{className:"manifest-property-title"},"Homepage"),w.createElement(ho,{homepage:a})),Vo=({id:a,htmlLabel:l,parent:o="manifest"})=>w.createElement(w.Fragment,null,w.createElement("span",{className:"manifest-property-title"},l),w.createElement("a",{href:a,target:"_blank",id:`iiif-${o}-id`},a)),No=({metadata:a,parent:l="manifest"})=>a?w.createElement(w.Fragment,null,w.createElement(So,{metadata:a,id:`iiif-${l}-metadata`})):w.createElement(w.Fragment,null),Wo=({rendering:a})=>(null==a?void 0:a.length)===0?w.createElement(w.Fragment,null):w.createElement(w.Fragment,null,w.createElement("span",{className:"manifest-property-title"},"Alternate formats"),w.createElement(Ao,{rendering:a})),Uo=({requiredStatement:a,parent:l="manifest"})=>a?w.createElement(w.Fragment,null,w.createElement(To,{requiredStatement:a,id:`iiif-${l}-required-statement`})):w.createElement(w.Fragment,null),qo=({rights:a})=>a?w.createElement(w.Fragment,null,w.createElement("span",{className:"manifest-property-title"},"Rights"),w.createElement("a",{href:a,target:"_blank"},a)):w.createElement(w.Fragment,null),jo=({seeAlso:a})=>(null==a?void 0:a.length)===0?w.createElement(w.Fragment,null):w.createElement(w.Fragment,null,w.createElement("span",{className:"manifest-property-title"},"See Also"),w.createElement(Mo,{seeAlso:a})),Go=({summary:a,parent:l="manifest"})=>a?w.createElement(w.Fragment,null,w.createElement(Oo,{summary:a,as:"p",id:`iiif-${l}-summary`})):w.createElement(w.Fragment,null),Qo=({label:a,thumbnail:l})=>(null==l?void 0:l.length)===0?w.createElement(w.Fragment,null):w.createElement(w.Fragment,null,w.createElement(Wr,{altAsLabel:a||{none:["resource"]},thumbnail:l,style:{backgroundColor:"#6663",objectFit:"cover"}})),Jo=()=>{let a=D(),{activeManifest:l,vault:o}=a,[s,u]=(0,w.useState)(),[m,h]=(0,w.useState)([]),[g,v]=(0,w.useState)([]),[b,x]=(0,w.useState)([]),[E,C]=(0,w.useState)([]);return(0,w.useEffect)(()=>{var a,s,m,g;let b=o.get(l);b&&(u(b),(null==(a=b.homepage)?void 0:a.length)>0&&h(o.get(b.homepage)),(null==(s=b.seeAlso)?void 0:s.length)>0&&v(o.get(b.seeAlso)),(null==(m=b.rendering)?void 0:m.length)>0&&x(o.get(b.rendering)),(null==(g=b.thumbnail)?void 0:g.length)>0&&C(o.get(b.thumbnail)))},[l,o]),s?w.createElement(tB,null,w.createElement(t_,null,w.createElement(Qo,{thumbnail:E,label:s.label}),w.createElement(Go,{summary:s.summary}),w.createElement(No,{metadata:s.metadata}),w.createElement(Uo,{requiredStatement:s.requiredStatement}),w.createElement(qo,{rights:s.rights}),w.createElement(Ho,{homepage:m}),w.createElement(jo,{seeAlso:g}),w.createElement(Wo,{rendering:b}),w.createElement(Vo,{id:s.id,htmlLabel:"IIIF Manifest"}))):w.createElement(w.Fragment,null)},Xo=({contentStateAnnotation:a})=>{var l,o,s,u,m,h;let g=D(),{vault:v}=g;if(!a)return w.createElement(w.Fragment,null);let b=(null==(l=null==a?void 0:a.target)?void 0:l.source)||(null==a?void 0:a.target),x=v.get(null==b?void 0:b.id),E=me(v,x.id),C=null!=(o=null==E?void 0:E[0])&&o.service?(null==(u=null==(s=null==E?void 0:E[0])?void 0:s.service[0])?void 0:u.id)||(null==(h=null==(m=null==E?void 0:E[0])?void 0:m.service[0])?void 0:h["@id"]):void 0;return w.createElement(tv,{"data-testid":"annotation-page"},x&&w.createElement("header",null,w.createElement(ce,{label:x.label})," ",w.createElement("em",null,"(Shared)")),w.createElement("div",{"data-testid":"annotation-page-items"},w.createElement(wt,{annotation:a,targetResource:C,key:a.id,isContentState:!0})))},Ko=({activeCanvas:a,annotationResources:l,searchServiceUrl:o,setContentSearchResource:s,contentSearchResource:u})=>{var m;let{t:h}=(0,b.$G)(),g=X(),v=D(),{contentStateAnnotation:x,informationPanelResource:E,isAutoScrolling:C,isUserScrolling:k,vault:A,configOptions:I,plugins:M}=v,{informationPanel:P}=I,z=null==P?void 0:P.renderAbout,F=null==P?void 0:P.renderAnnotation,L=A.get({id:a,type:"Canvas"}),_=null==P?void 0:P.renderContentSearch,H=null==P?void 0:P.renderToggle,V=(null==(m=null==x?void 0:x.target)?void 0:m.source)||(null==x?void 0:x.target),N=!!x&&V.id===a,q=!!(null!=l&&l.length)||N,{pluginsWithInfoPanel:U}=function(a){let l=[];return a.forEach(a=>{var o;null!=(o=a.informationPanel)&&o.component&&l.push(a)}),{pluginsWithInfoPanel:l}}(M);return(0,w.useEffect)(()=>{["manifest-about","manifest-annotations","manifest-content-search"].includes(String(null==P?void 0:P.defaultTab))?g({type:"updateInformationPanelResource",informationPanelResource:null==P?void 0:P.defaultTab}):g(N?{type:"updateInformationPanelResource",informationPanelResource:"manifest-annotations"}:{type:"updateInformationPanelResource",informationPanelResource:"manifest-about"})},[]),(0,w.useEffect)(()=>{q||g({type:"updateInformationPanelResource",informationPanelResource:"manifest-about"})},[q]),w.createElement(td,{"data-testid":"information-panel",defaultValue:E,onValueChange:a=>{g({type:"updateInformationPanelResource",informationPanelResource:a})},orientation:"horizontal",value:E,className:"clover-viewer-information-panel"},w.createElement(tu,{"aria-label":h("informationPanelTabs"),"data-testid":"information-panel-list"},H&&w.createElement(tm,{value:"manifest-back","data-value":"manifest-back",onClick:()=>{g({type:"updateInformationOpen",isInformationOpen:!1})},as:"button"},h("informationPanelTabsClose")),z&&w.createElement(tm,{value:"manifest-about"},h("informationPanelTabsAbout")),_&&u&&w.createElement(tm,{value:"manifest-content-search"},h("informationPanelTabsSearch")),F&&q&&w.createElement(tm,{value:"manifest-annotations"},h("informationPanelTabsAnnotations")),U&&U.map((a,l)=>{var o;return w.createElement(tm,{key:l,value:a.id},w.createElement(ce,{label:null==(o=a.informationPanel)?void 0:o.label}))})),w.createElement(th,{handleScroll:function(){if(!C){clearTimeout(k);let a=setTimeout(()=>{g({type:"updateUserScrolling",isUserScrolling:void 0})},1500);g({type:"updateUserScrolling",isUserScrolling:a})}}},z&&w.createElement(tp,{value:"manifest-about"},w.createElement(Jo,null)),_&&u&&w.createElement(tp,{value:"manifest-content-search"},w.createElement(Lo,{searchServiceUrl:o,setContentSearchResource:s,activeCanvas:a,annotationPage:u})),F&&l&&w.createElement(tp,{value:"manifest-annotations"},x&&N&&w.createElement(Xo,{contentStateAnnotation:x}),l.map(a=>w.createElement(Po,{key:a.id,annotationPage:a}))),U&&U.map((a,l)=>(function(a,l){var o,s;let u=null==(o=null==a?void 0:a.informationPanel)?void 0:o.component;return void 0===u?w.createElement(w.Fragment,null):w.createElement(tp,{key:l,value:a.id},w.createElement(O.ErrorBoundary,{FallbackComponent:yt},w.createElement(u,{...null==(s=null==a?void 0:a.informationPanel)?void 0:s.componentProps,canvas:L,useViewerDispatch:X,useViewerState:D})))})(a,l))))},tD=e6("svg",{display:"inline-flex",variants:{isLarge:{true:{height:"4rem",width:"4rem"}},isMedium:{true:{height:"2rem",width:"2rem"}},isSmall:{true:{height:"1rem",width:"1rem"}}}}),j=a=>w.createElement(tD,{...a,"data-testid":"icon-svg",role:"img",viewBox:"0 0 512 512",xmlns:"http://www.w3.org/2000/svg"},a.children);j.Title=({children:a})=>w.createElement("title",null,a),j.Add=()=>w.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32",d:"M256 112v288M400 256H112"}),j.Audio=()=>w.createElement(w.Fragment,null,w.createElement("path",{d:"M232 416a23.88 23.88 0 01-14.2-4.68 8.27 8.27 0 01-.66-.51L125.76 336H56a24 24 0 01-24-24V200a24 24 0 0124-24h69.75l91.37-74.81a8.27 8.27 0 01.66-.51A24 24 0 01256 120v272a24 24 0 01-24 24zm-106.18-80zm-.27-159.86zM320 336a16 16 0 01-14.29-23.19c9.49-18.87 14.3-38 14.3-56.81 0-19.38-4.66-37.94-14.25-56.73a16 16 0 0128.5-14.54C346.19 208.12 352 231.44 352 256c0 23.86-6 47.81-17.7 71.19A16 16 0 01320 336z"}),w.createElement("path",{d:"M368 384a16 16 0 01-13.86-24C373.05 327.09 384 299.51 384 256c0-44.17-10.93-71.56-29.82-103.94a16 16 0 0127.64-16.12C402.92 172.11 416 204.81 416 256c0 50.43-13.06 83.29-34.13 120a16 16 0 01-13.87 8z"}),w.createElement("path",{d:"M416 432a16 16 0 01-13.39-24.74C429.85 365.47 448 323.76 448 256c0-66.5-18.18-108.62-45.49-151.39a16 16 0 1127-17.22C459.81 134.89 480 181.74 480 256c0 64.75-14.66 113.63-50.6 168.74A16 16 0 01416 432z"})),j.Close=()=>w.createElement("path",{d:"M289.94 256l95-95A24 24 0 00351 127l-95 95-95-95a24 24 0 00-34 34l95 95-95 95a24 24 0 1034 34l95-95 95 95a24 24 0 0034-34z"}),j.Download=()=>w.createElement(w.Fragment,null,w.createElement("path",{d:"M336 176h40a40 40 0 0140 40v208a40 40 0 01-40 40H136a40 40 0 01-40-40V216a40 40 0 0140-40h40",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32"}),w.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32",d:"M176 272l80 80 80-80M256 48v288"})),j.Image=()=>w.createElement("path",{d:"M416 64H96a64.07 64.07 0 00-64 64v256a64.07 64.07 0 0064 64h320a64.07 64.07 0 0064-64V128a64.07 64.07 0 00-64-64zm-80 64a48 48 0 11-48 48 48.05 48.05 0 0148-48zM96 416a32 32 0 01-32-32v-67.63l94.84-84.3a48.06 48.06 0 0165.8 1.9l64.95 64.81L172.37 416zm352-32a32 32 0 01-32 32H217.63l121.42-121.42a47.72 47.72 0 0161.64-.16L448 333.84z"}),j.Video=()=>w.createElement("path",{d:"M464 384.39a32 32 0 01-13-2.77 15.77 15.77 0 01-2.71-1.54l-82.71-58.22A32 32 0 01352 295.7v-79.4a32 32 0 0113.58-26.16l82.71-58.22a15.77 15.77 0 012.71-1.54 32 32 0 0145 29.24v192.76a32 32 0 01-32 32zM268 400H84a68.07 68.07 0 01-68-68V180a68.07 68.07 0 0168-68h184.48A67.6 67.6 0 01336 179.52V332a68.07 68.07 0 01-68 68z"});let tW=e7({"0%":{opacity:0,transform:"translateY(1rem)"},"100%":{opacity:1,transform:"translateY(0)"}}),tH=e7({"0%":{opacity:0,transform:"translateY(1rem)"},"100%":{opacity:1,transform:"translateY(0)"}}),tV=e6(N.Eh,{fill:"$secondaryAlt"}),tN=e6(N.x8,{position:"absolute",right:"0",top:"0",padding:"0.5rem",margin:"0",cursor:"pointer",border:"none",background:"none",fill:"inherit","&:hover":{opacity:"0.75"}}),tq=e6(N.VY,{border:"none",backgroundColor:"white",fill:"inhrerit",padding:"1rem 2rem 1rem 1rem",width:"auto",minWidth:"200px",maxWidth:"350px",borderRadius:"3px",boxShadow:"5px 5px 13px #0002",animationDuration:"0.3s",animationTimingFunction:"cubic-bezier(0.16, 1, 0.3, 1)",'&[data-side="top"]':{animationName:tH},'&[data-side="bottom"]':{animationName:tW},'&[data-align="end"]':{[`& ${tV}`]:{margin:"0 0.7rem"}}}),tU=e6(N.xz,{display:"inline-flex",padding:"0.5rem 0",margin:"0 0.5rem 0 0",cursor:"pointer",border:"none",background:"none","> button, > span":{margin:"0"}}),tQ=e6(N.fC,{boxSizing:"content-box"}),be=({children:a})=>w.createElement(tQ,null,a);be.Trigger=a=>w.createElement(tU,{...a},a.children),be.Content=a=>w.createElement(tq,{...a,sideOffset:5,collisionPadding:21},w.createElement(tV,null),w.createElement(tN,null,w.createElement(j,{isSmall:!0},w.createElement(j.Close,null))),a.children);let tG=e6("div",{boxSizing:"border-box",display:"inline-flex",alignItems:"center",borderRadius:"2px",padding:"$1",marginBottom:"$2",marginRight:"$2",backgroundColor:"$lightGrey",color:"$richBlack50",textTransform:"uppercase",fontSize:"$2",objectFit:"contain",lineHeight:"1em !important","&:last-child":{marginRight:"0"},[`${tD}`]:{position:"absolute",left:"$1",height:"$3",width:"$3"},variants:{isIcon:{true:{position:"relative",paddingLeft:"$5"}}}}),tZ=e6("span",{background:"transparent",opacity:"0",border:"3px solid transparent",position:"absolute",width:"100%",height:"100%",zIndex:"0",left:"0",top:"0",transition:"$all"}),tJ=e6("span",{display:"flex"}),tX=e6("span",{display:"flex",width:"1.2111rem",height:"0.7222rem"}),tY=e6("span",{display:"inline-flex",marginLeft:"5px",marginBottom:"-1px"}),tK=e6("div",{position:"relative",display:"flex",backgroundColor:"$secondaryAlt",width:"inherit",height:"100px",overflow:"hidden",borderRadius:"3px",".media-thumbnail-lazyload":{width:"100%",height:"100%",borderRadius:"3px"},img:{width:"100%",height:"100%",objectFit:"cover",objectPosition:"top center",filter:"blur(0)",transform:"scale3d(1, 1, 1)",borderRadius:"3px",transition:"$all",color:"transparent"},[`& ${tJ}`]:{position:"absolute",right:"0",bottom:"0",[`& ${tG}`]:{display:"none",margin:"0",paddingLeft:"0",fontSize:"0.7222rem",backgroundColor:"#000d",color:"$secondary",fill:"$secondary",borderBottomLeftRadius:"0",borderTopRightRadius:"0"}}}),t0=e6(F.ck,{display:"flex",flexShrink:"0",padding:"0",cursor:"pointer",background:"none",border:"none",fontFamily:"inherit",lineHeight:"1.25em",fontSize:"1rem",textAlign:"left",figure:{margin:"0",width:"161.8px",figcaption:{marginTop:"0.5rem",fontWeight:"400",fontSize:"0.8333rem",display:"-webkit-box",overflow:"hidden",MozBoxOrient:"vertical",WebkitBoxOrient:"vertical",WebkitLineClamp:"5","@sm":{fontSize:"0.8333rem"}}}}),t1=e6(F.fC,{display:"flex",flexDirection:"row",flexGrow:"1",overflowX:"scroll",position:"relative",zIndex:"0",gap:"1rem",padding:"1.618rem 0"}),t2=e6("div",{display:"flex",flexDirection:"row","&[data-active='true']":{[`& ${t0}`]:{figcaption:{fontWeight:"700"},[`& ${tG}`]:{backgroundColor:"$accent"},[`& ${tZ}`]:{background:"#0003",opacity:"1",borderBottom:"3px solid $accent"},"&:first-of-type":{[`& ${tZ}`]:{borderRight:"unset"}},"&:last-of-type":{[`& ${tZ}`]:{borderLeft:"unset"}}}},[`& ${t0}`]:{[`& ${tK}`]:{borderRadius:"unset"},"&:first-of-type":{[`& ${tK}`]:{borderTopLeftRadius:"3px",borderBottomLeftRadius:"3px"}},"&:last-of-type":{[`& ${tK}`]:{borderTopRightRadius:"3px",borderBottomRightRadius:"3px"},[`& ${tG}`]:{display:"flex"}}}}),t3=e6("div",{position:"absolute",right:"1rem",top:"1rem",display:"flex",justifyContent:"flex-end",zIndex:"1"}),t4=e6("input",{flexGrow:"1",border:"none",backgroundColor:"$secondaryMuted",color:"$primary",marginRight:"1rem",height:"2rem",padding:"0 1rem",borderRadius:"2rem",fontFamily:"inherit",fontSize:"1rem",lineHeight:"1rem",boxShadow:"inset 1px 1px 2px #0001","&::placeholder":{color:"$primaryMuted"}}),t5=e6("button",{display:"flex",background:"none",border:"none",width:"2rem !important",height:"2rem !important",padding:"0",margin:"0",fontWeight:"700",borderRadius:"2rem",backgroundColor:"$accent",color:"$secondary",cursor:"pointer",boxSizing:"content-box !important",transition:"$all",svg:{height:"60%",width:"60%",padding:"20%",fill:"$secondary",stroke:"$secondary",opacity:"1",filter:"drop-shadow(5px 5px 5px #000D)",boxSizing:"inherit",transition:"$all"},"&:disabled":{backgroundColor:"transparent",boxShadow:"none",svg:{opacity:"0.25"}}}),t6=e6("div",{display:"flex",marginRight:"0.618rem",backgroundColor:"$accentAlt",borderRadius:"2rem",boxShadow:"5px 5px 5px #0003",color:"$secondary",alignItems:"center","> span":{display:"flex",margin:"0 0.5rem",fontSize:"0.7222rem",fontWeight:"bold",gap:"0.25rem",em:{opacity:"0.25"}}}),t8=e6("div",{display:"flex",position:"relative",zIndex:"1",width:"100%",padding:"0",transition:"$all",variants:{isToggle:{true:{paddingTop:"2.618rem",[`& ${t3}`]:{width:"calc(100% - 2rem)","@sm":{width:"calc(100% - 2rem)"}}}}}}),Es=(a,l)=>{(0,w.useEffect)(()=>{function r(o){o.key===a&&l()}return window.addEventListener("keyup",r),()=>window.removeEventListener("keyup",r)},[])},Ss=({title:a})=>w.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},w.createElement("title",null,a),w.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M244 400L100 256l144-144M120 256h292"})),Cs=({title:a})=>w.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},w.createElement("title",null,a),w.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M268 112l144 144-144 144M392 256H100"})),Is=({title:a})=>w.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},w.createElement("title",null,a),w.createElement("path",{d:"M289.94 256l95-95A24 24 0 00351 127l-95 95-95-95a24 24 0 00-34 34l95 95-95 95a24 24 0 1034 34l95-95 95 95a24 24 0 0034-34z"})),As=({title:a})=>w.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},w.createElement("title",null,a),w.createElement("path",{d:"M456.69 421.39L362.6 327.3a173.81 173.81 0 0034.84-104.58C397.44 126.38 319.06 48 222.72 48S48 126.38 48 222.72s78.38 174.72 174.72 174.72A173.81 173.81 0 00327.3 362.6l94.09 94.09a25 25 0 0035.3-35.3zM97.92 222.72a124.8 124.8 0 11124.8 124.8 124.95 124.95 0 01-124.8-124.8z"})),Rs=({handleCanvasToggle:a,handleFilter:l,activeIndex:o,canvasLength:s})=>{let[u,m]=(0,w.useState)(!1),[h,g]=(0,w.useState)(!1),[v,x]=(0,w.useState)(!1),{t:E}=(0,b.$G)();return(0,w.useEffect)(()=>{x(0===o),o===s-1?g(!0):g(!1)},[o,s]),Es("Escape",()=>{m(!1),l("")}),w.createElement(t8,{isToggle:u},w.createElement(t3,null,u&&w.createElement(t4,{autoFocus:!0,onChange:a=>l(a.target.value),placeholder:E("commonSearchPlaceholder")}),!u&&w.createElement(t6,null,w.createElement(t5,{onClick:()=>a(-1),disabled:v,type:"button"},w.createElement(Ss,{title:E("commonPrevious")})),w.createElement("span",null,o+1," ",w.createElement("em",null,"/")," ",s),w.createElement(t5,{onClick:()=>a(1),disabled:h,type:"button"},w.createElement(Cs,{title:E("commonNext")}))),w.createElement(t5,{onClick:()=>{m(a=>!a),l("")},type:"button",className:"clover-viewer-media-search"},u?w.createElement(Is,{title:E("commonClose")}):w.createElement(As,{title:E("commonSearch")}))))},Ts=({children:a,rootMargin:l="100px",attributes:o={},isVisibleCallback:s=()=>{}})=>{let u=(0,w.useRef)(null),[m,h]=(0,w.useState)(!1);return(0,w.useEffect)(()=>{let a=u.current;if(!a)return;let o=new IntersectionObserver(([a])=>{a.isIntersecting&&(s(!0),h(!0),o.disconnect())},{rootMargin:l});return o.observe(a),()=>o.disconnect()},[u]),w.createElement("div",{ref:u,...o},m?a:null)};var t7={},t9={get:a=>a,setMetaValue([a,l,o],s){let u=t9.getResourceMeta(a,l),m=u?u[o]:void 0,h="function"==typeof s?s(m):s;t7[a]={...t7[a]||{},[l]:{...(t7[a]||{})[l]||{},[o]:h}}},getResourceMeta:(a,l)=>{let o=t7[a];if(o)return l?o[l]:o},async load(a){let l="string"==typeof a?a:a.id;return fetch(l).then(a=>a.json())},requestStatus(a){}},ie=Object.defineProperty,$s=(a,l,o)=>l in a?ie(a,l,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[l]=o,Oe=(a,l,o)=>($s(a,"symbol"!=typeof l?l+"":l,o),o);function ve(a){return a.endsWith("info.json")?a:a.endsWith("/")?`${a}info.json`:`${a}/info.json`}var it="http://library.stanford.edu/iiif/image-api/compliance.html#level1",ii="http://library.stanford.edu/iiif/image-api/compliance.html#level2",ir="http://library.stanford.edu/iiif/image-api/conformance.html#level1",il="http://library.stanford.edu/iiif/image-api/conformance.html#level2",is="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1",id="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2",iu="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level1",im="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level2",ip="http://iiif.io/api/image/1/level1.json",ih="http://iiif.io/api/image/1/profiles/level1.json",ig="http://iiif.io/api/image/1/level2.json",iv="http://iiif.io/api/image/1/profiles/level2.json",iy="http://iiif.io/api/image/2/level1.json",ib="http://iiif.io/api/image/2/profiles/level1.json",iw="http://iiif.io/api/image/2/level2.json",ix="http://iiif.io/api/image/2/profiles/level2.json",iE="level1",iS="level2",iC="http://iiif.io/api/image/2/level1",ik="http://iiif.io/api/image/2/level2",iR="https://iiif.io/api/image/1.1/compliance/#level1",iA="https://iiif.io/api/image/1.1/compliance/#level2",iI=[ik,ii,il,id,im,ig,iv,iw,ix,iS,iA],i$=[...iI,iC,it,ir,is,iu,ip,ih,iy,ib,iE,iR],iT=["http://iiif.io/api/image/2/level0",iC,ik,"http://library.stanford.edu/iiif/image-api/compliance.html#level0",it,ii,"http://library.stanford.edu/iiif/image-api/conformance.html#level0",ir,il,"http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0",is,id,"http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level0",iu,im,"http://iiif.io/api/image/1/level0.json","http://iiif.io/api/image/1/profiles/level0.json",ip,ih,ig,iv,"http://iiif.io/api/image/2/level0.json","http://iiif.io/api/image/2/profiles/level0.json",iy,ib,iw,ix,"level0",iE,iS,"https://iiif.io/api/image/1.1/compliance/#level0",iR,iA],iO={extraFormats:["jpg"],extraQualities:["default"],extraFeatures:["sizeByWhListed"]},iM={extraFormats:["jpg"],extraQualities:["default"],extraFeatures:["baseUriRedirect","cors","jsonldMediaType","regionByPx","regionSquare","sizeByWhListed","sizeByH","sizeByW","sizeByWh"]},iP={extraFormats:["jpg","png"],extraQualities:["default"],extraFeatures:["baseUriRedirect","cors","jsonldMediaType","regionByPct","regionByPx","regionSquare","rotationBy90s","sizeByWhListed","sizeByConfinedWh","sizeByH","sizeByPct","sizeByW","sizeByWh"]};function B(a){return a["@id"]?a["@id"]:a.id?a.id:void 0}function je(a){if(!a||!a.profile||!B(a))return!1;for(let l of Array.isArray(a.profile)?a.profile:[a.profile])if("string"==typeof l&&-1!==iT.indexOf(l))return!0;return!1}function _e(a,l){if(l&&l.profile){let o=l.profile;if(o){let l=Array.isArray(o)?o:[o];return l.includes(`level${a}`)||l.includes(`http://iiif.io/api/image/2/level${a}.json`)||l.includes(`http://iiif.io/api/image/1/level${a}.json`)||l.includes(`http://iiif.io/api/image/1/profiles/level${a}.json`)}}return!1}function mt(a){return je(a)?_e(0,a)?0:_e(1,a)?1:_e(2,a)?2:null:null}function bn(a){return -1!==(a["@context"]?Array.isArray(a["@context"])?a["@context"]:[a["@context"]]:[]).indexOf("http://iiif.io/api/image/3/context.json")}function zt(a){let l=a.match(/^.*\/(full)\/(((\d+),(\d+)?)|max)\/(\d+)\/default\.(jpg|png|jpeg)$/);if(l&&l[4]&&l[5]){let o=l[1],s=parseInt(l[4],10),u=parseInt(l[5],10),m=l[7];if(("max"===o||"full"===o)&&s&&u&&m)return{type:"fixed",id:a,height:u,width:s}}return{type:"unknown",id:a}}function ft(a){if("string"==typeof a)return zt(a);let l=a["@type"]?a["@type"]:a.type?a.type:void 0;if("Image"!==l&&"sc:Image"!==l)return null;let o=B(a);return o?o&&a.width&&a.height?{id:o,type:"fixed",width:a.width,height:a.height,unsafe:!0}:zt(o):null}function Lt(a){let l=[],o=a.length;for(let s=0;s<o;s++){let o=a[s];if(!o)continue;let u=function(a){return je(a)?(a&&a.sizes?a.sizes:[]).map(l=>({id:B(a),type:"fixed-service",height:l.height,width:l.width,level:mt(a),version:bn(a)?3:2})):[]}(o);u.length&&l.push(...u);let m=function(a){if(!function(a){if(!je(a))return!1;for(let l of Array.isArray(a.profile)?a.profile:[a.profile])if("string"==typeof l){if(-1!==i$.indexOf(l))return!0}else{let a=[...l.supports||[],...l.extraFeatures||[]];if(-1!==a.indexOf("regionByPx")&&(-1!==a.indexOf("sizeByW")||-1!==a.indexOf("sizeByWh")))return!0}return!1}(a))return[];let l=[],o=Array.isArray(a.profile)?a.profile:[a.profile],s=o.length;for(let l=0;l<s;l++){let s=o[l];if(s&&"string"!=typeof s&&(s.maxHeight||s.maxWidth))return[{id:B(a),type:"variable",minWidth:0,minHeight:0,maxHeight:s.maxHeight||s.maxWidth,maxWidth:s.maxWidth||s.maxHeight,level:mt(a),version:"http://iiif.io/api/image/3/context.json"===a["@context"]?3:2}]}if(a.tiles){let o=a.tiles.length;for(let s=0;s<o;s++){let o=a.tiles[s];o&&(o.height||o.width)&&l.push({id:B(a),type:"variable",minHeight:0,minWidth:0,maxHeight:o.height||o.width,maxWidth:o.width,level:mt(a),version:bn(a)?3:2})}}return l}(o);m.length&&l.push(...m)}return l}function wn(a){let l=a.service?Array.isArray(a.service)?a.service:[a.service]:[],o=l.length,s=[];for(let a=0;a<o;a++)je(l[a])&&s.push(l[a]);return s}function et(a,l,o){let s=function(a){let l=function(a,l=""){let{path:o,scheme:s,server:u,prefix:m}=function(a,l=""){let o=a.match(/^(([a-zA-Z]+):\/\/([^/]+))?((.*)+)/);if(!o)throw Error(`Invalid or unknown input ${a}`);let s=o[2],u=o[3],m=o[4];if("/"===m[0]&&(m=m.substring(1)),l.length>0){if("/"===l[0]&&(l=l.substring(1)),l!==m.substring(0,l.length))throw Error(`Path does not start with prefix (path: ${m}, prefix: ${l})`);m=m.substring(l.length)}return{scheme:s,server:u,path:m,prefix:l}}(a,l),h=(o||"").split("/").reverse(),[g,v,b,w,...x]=h,E=x.reverse().filter(Boolean).join("/");if(1===h.length||""===g)return{type:"base",scheme:s,server:u,prefix:m,identifier:E};if("info.json"===g){let[,...a]=h;return{type:"info",scheme:s,server:u,prefix:m,identifier:a.reverse().filter(Boolean).join("/")}}let C=(g||"").split(".");if(typeof C[1]>"u"||typeof C[0]>"u"||typeof w>"u"||typeof b>"u"||typeof v>"u")throw Error("Invalid image request");return{type:"image",scheme:s,server:u,prefix:m,identifier:E,originalPath:o,region:function(a){try{if("full"===a)return{full:!0};if("square"===a)return{square:!0};let l=a.startsWith("pct:"),o=a.substr(l?4:0).split(",").map(a=>parseFloat(a));return{x:o[0],y:o[1],w:o[2],h:o[3],percent:l}}catch{throw Error("Expected 'full', 'square' or 'x,y,w,h'. Found "+a)}}(w),size:function(a){let l={upscaled:!1,max:!1,confined:!1};if("^"===a[0]&&(l.upscaled=!0,a=a.slice(1)),"max"===a||"full"===a)return l.max=!0,l.serialiseAsFull="full"===a,l;if("!"===a[0]&&(l.confined=!0,a=a.slice(1)),"p"===a[0])return l.percentScale=parseFloat(a.slice(4)),l;let o=a.split(",").map(a=>a.trim());return o.length&&"u">typeof o[0]&&(""!==o[0]&&(l.width=parseInt(o[0],10)),"u">typeof o[1]&&""!==o[1]?(l.height=parseInt(o[1],10),l.version=2):l.version=3),l}(b),rotation:function(a){let l={angle:0};if("!"===a[0]&&(l.mirror=!0,a=a.substr(1)),l.angle=parseFloat(a)%360,Number.isNaN(l.angle))throw Error(`Invalid rotation ${a}`);return l}(v),quality:C[0],format:C[1]}}(ve(a.id));if("info"!==l.type)throw Error("Invalid service URL");let o=function(a){let l=a?Array.isArray(a.profile)?a.profile:[a.profile]:[],o={extraQualities:[],extraFormats:[],extraFeatures:[]};for(let a of l){var s;if("string"==typeof a&&(s=a,a=-1!==iI.indexOf(s)?iP:-1!==i$.indexOf(s)?iM:iO),a){if(a.formats)for(let l of a.formats)-1===o.extraFormats.indexOf(l)&&o.extraFormats.push(l);if(a.qualities)for(let l of a.qualities)-1===o.extraQualities.indexOf(l)&&o.extraQualities.push(l);if(a.supports)for(let l of a.supports)-1===o.extraFeatures.indexOf(l)&&o.extraFeatures.push(l);if(a.maxHeight&&(o.maxHeight=a.maxHeight),a.maxWidth&&(o.maxWidth=a.maxWidth),a.maxArea&&(o.maxArea=a.maxArea),a.extraFormats)for(let l of a.extraFormats)-1===o.extraFormats.indexOf(l)&&o.extraFormats.push(l);if(a.extraQualities)for(let l of a.extraQualities)-1===o.extraQualities.indexOf(l)&&o.extraQualities.push(l);if(a.extraFeatures)for(let l of a.extraFeatures)-1===o.extraFeatures.indexOf(l)&&o.extraFeatures.push(l);a.maxHeight&&(o.maxHeight=a.maxHeight),a.maxWidth&&(o.maxWidth=a.maxWidth),a.maxArea&&(o.maxArea=a.maxArea)}}if(a.extraFormats)for(let l of a.extraFormats)-1===o.extraFormats.indexOf(l)&&o.extraFormats.push(l);if(a.extraFeatures)for(let l of a.extraFeatures)-1===o.extraFeatures.indexOf(l)&&o.extraFeatures.push(l);if(a.extraQualities)for(let l of a.extraQualities)-1===o.extraQualities.indexOf(l)&&o.extraQualities.push(l);return o}(a);return{identifier:l.identifier,originalPath:"",server:l.server,prefix:l.prefix,scheme:l.scheme,type:"image",quality:-1===o.extraQualities.indexOf("default")?o.extraQualities[0]:"default",region:{full:!0},size:{max:!0,upscaled:!1,confined:!1},format:"jpg",rotation:{angle:0}}}({"@context":3===a.version?"http://iiif.io/api/image/3/context.json":"http://iiif.io/api/image/2/context.json",id:ve(B(a)),profile:null===a.level||typeof a.level>"u"?"level0":`level${a.level}`,type:3===a.version?"ImageService3":"ImageService2"});if("image"!==s.type)throw Error("Invalid service");return s.size.max=!1,s.size.width=l,s.size.height=o,{id:function(a,l){let o=a.prefix.startsWith("/")?a.prefix.substr(1):a.prefix,s=`${a.scheme}://${a.server}/${o?`${o}/`:""}${a.identifier}`;if("base"===a.type)return s;if("info"===a.type)return`${s}/info.json`;let{size:u}=a,{region:m,rotation:h,format:g,quality:v}=a;return[s,function({x:a=0,y:l=0,w:o,h:s,full:u,square:m,percent:h}){if(u)return"full";if(m)return"square";if(typeof o>"u"||typeof s>"u")throw Error("RegionParameter: invalid region");let g=`${a},${l},${o},${s}`;return h?`pct:${g}`:g}(m),function({max:a,percentScale:l,upscaled:o,confined:s,width:u,height:m,serialiseAsFull:h,version:g}){let v=[];return o&&v.push("^"),a?v.push(h?"full":"max"):(s&&v.push("!"),l&&v.push(`pct:${l}`),u&&v.push(`${u}`),v.push(","),m&&3===g&&v.push(`${m}`)),v.join("")}(u),`${h.mirror?"!":""}${(h.angle||0)%360}`,`${v}.${g}`].filter(Boolean).join("/")}(s),type:"fixed",width:l,height:o||a.height/(a.width||1)*l,unsafe:a.width>l}}function xe(a){let l=a.replace(/(https?:\/\/)?(www.)?/i,"");return -1!==l.indexOf("/")?l.split("/")[0]:l}var iz=class{constructor(a={}){Oe(this,"config",{verificationsRequired:1,approximateServices:!1,enableFetching:!0,disableThrottling:!1}),Oe(this,"fetchingCount",0),Oe(this,"imageServices",{}),Oe(this,"knownImageServers",{}),this.config=Object.assign(this.config,a)}setConfig(a){Object.assign(this.config,a)}sample(a,l,o=!0){let s=xe(B(a)),u=ve(B(a)),m=this.knownImageServers[s];return this.imageServices[u]=Object.assign(a,{real:!0}),m||!a.tiles||_e(0,a)?this.verify(a):(this.knownImageServers[s]={verifications:0,malformed:!1,root:s,preLoaded:o,sampledId:B(a),verified:!1,server:null,result:{context:a["@context"]||[],sampledProfile:a.profile,resourceServiceRatio:l&&a.height?l.height/a.height:1,sampledSizes:a.sizes||[],sizeRatios:function(a,l,o){let s=o.length,u=[];for(let l=0;l<s;l++){let s=o[l];if(s){let l=s.width;u.push(a/l)}}return u}(a.width,a.height,a.sizes||[]),sampledTiles:a.tiles||[]}},!0)}preLoad(a,l=!0){this.knownImageServers[a.root]=a,l&&(this.knownImageServers[a.root].malformed=!1,this.knownImageServers[a.root].verifications=this.config.verificationsRequired)}predict(a,l=!1,o=!1){let s=null==a?void 0:a.source,u=xe(B(a)),m=this.knownImageServers[u],h=ve(B(a));return this.imageServices[h]?this.imageServices[h]||null:!(!this.config.approximateServices||!m||!m.result||!(null!=s&&s.height||a.height)||!(null!=s&&s.width||a.width)||!o&&(m.malformed||m.verifications<this.config.verificationsRequired)||_e(0,a.source))?(this.imageServices[h]||(this.imageServices[h]={"@context":m.result.context,"@id":B(a),id:B(a),protocol:"http://iiif.io/api/image",tiles:(null==s?void 0:s.tiles)||function(a,l,o){let s=a>l?a:l,u=o.length,m=[];for(let a=0;a<u;a++){let l=o[a];if(!l||0===l.scaleFactors.length)continue;let u=l.scaleFactors[0];if(!u)continue;let h=s/u,g=[u];for(;h>=l.width;)g.push(u*=2),h/=2;m.push({...l,scaleFactors:g})}return m}(a.width,a.height,m.result.sampledTiles),sizes:(null==s?void 0:s.sizes)||function(a,l,o){let s=o.length,u=[];for(let m=0;m<s;m++){let s=o[m];s&&u.push({width:Math.floor(a/s),height:Math.floor(l/s)})}return u}(Math.round(a.width/m.result.resourceServiceRatio),Math.round(a.height/m.result.resourceServiceRatio),m.result.sizeRatios),profile:(null==s?void 0:s.profile)||m.result.sampledProfile,height:(null==s?void 0:s.height)||a.height,width:(null==s?void 0:s.width)||a.width,real:!1}),this.imageServices[h]||null):null}async getThumbnailFromResource(a,l,o=!0,s=[]){let u=a?await this.getImageCandidates(a,o):[];return function(a,l){let o=[],s=Object.assign({unsafeImageService:!1,atAnyCost:!0,fallback:!0,minHeight:64,minWidth:64,maxHeight:1/0,maxWidth:1/0,returnAllOptions:!1,preferFixedSize:!1,allowUnsafe:!1,explain:!1,height:0,width:0},a),i=(a,l=0)=>s.explain?o.push(Array(l).fill(0).map(a=>"    ").join("")+a().trim()):void 0,u=[],m=[],h=null;i(()=>`Using configuration: ${JSON.stringify(s,null,2)}`);let c=(a,l)=>{let o;if(i(()=>"Swapping choice",3),o=s.width?s.width:s.maxWidth,a.height<=s.maxHeight&&a.width<=s.maxWidth&&a.height>=s.minHeight&&a.width>=s.minWidth&&(!l||Math.abs(a.width-o)<Math.abs(l.width-o))){if(s.preferFixedSize&&a.unsafe){i(()=>`We found an image that was marked as unsafe, but it was the best size. (${a.id})`,4),m.push(a);return}s.returnAllOptions&&l&&m.push(l),i(()=>`We found a new image that was the best size. (${a.id})`,4),h=a}else s.returnAllOptions&&m.push(a)};i(()=>`The input shows we have ${l.length} list(s) of candidates to choose from.`);let g=l.length;for(let a=0;a<g;a++){let o=l[a]();i(()=>`Candidate group ${a}: ${JSON.stringify(o,null,2)}`,1);let m=o.length;i(()=>`Checking candidate list number ${a} and found ${m} potential ways of creating image(s)`,1);for(let a=0;a<m;a++){let l=o[a];i(()=>`-> Checking candidate ${a}`,1),"unknown"===l.type&&s.atAnyCost&&(i(()=>'We\'ve found an unknown image type, adding this to the "last resort" list',2),u.push(l)),"fixed"===l.type&&(l.unsafe?(i(()=>'We\'ve found an unsafe fixed image type, adding this to the "last resort" list',2),u.push(l)):(i(()=>"We've found a fixed size image, checking if it matches the request",2),c(l,h))),"fixed-service"===l.type&&(s.unsafeImageService?(i(()=>"Checking for an image from the tile source, without calculating the right height and width (unsafeImageService)",2),c(et(l,s.width,s.height),h)):(i(()=>"Checking for an image from the tile source 3",2),c(et(l,l.width,l.height),h))),"variable"===l.type&&l.maxWidth&&c(et({id:l.id,type:"fixed-service",width:l.maxWidth,height:l.maxWidth,level:l.level,version:l.version},l.maxWidth),h)}if(h&&!s.returnAllOptions){if(h.unsafe||s.allowUnsafe)continue;i(()=>`We found a match in choice list number ${a}, no searching any more`);break}}return s.atAnyCost&&0===m.length?(i(()=>h?`We found an image! ${h.id} of type ${h.type}`:'We found no images, but "atAnyCost" is set, so returning that'),{best:h||u[0]||null,fallback:u.slice(1),log:o}):s.returnAllOptions?(i(()=>"Returning all options that we have found"),{best:(s.atAnyCost?h||m[0]||u[0]:h||m[0])||null,fallback:[...m,...u],log:o}):(i(()=>"Returning the best image that we found, and a fallback"),{best:h||m[0]||null,fallback:h?m:m.slice(1),log:o})}(l,[()=>s,()=>u])}async getImageCandidates(a,l=!0){if(l&&a&&a.height&&a.width)for(let l of wn(a)){let o={id:B(l),width:l.width?l.width:a.width,height:l.height?l.height:a.height,source:l};await this.loadService(o)}return function(a,l=!0,o){let s=[],u=ft(a);if(null===u)return s;if(s.push(u),l&&a&&a.width&&a.height){let l=[];for(let s of wn(a)){let u={id:B(s),width:a.width,height:a.height};if(o.canLoadSync(u)){let s=o.loadServiceSync(u);s&&(s.height||(s.height=a.height),s.width||(s.width=a.width),l.push(...Lt([s])))}}if(l.length)return s.push(...l),s}return a.service&&s.push(...Lt(a.service)),s}(a,l,this)}async verify(a){let l=this.predict(a,!1,!0),o=await this.fetchService(B(a));if(!l)return!1;let s=l.height===o.height&&l.width===o.width&&l["@context"]===o["@context"]&&function(a,l){if(a.length!==l.length)return!1;if(0===a.length&&0===l.length)return!0;let o=a.length,s=!0;for(let u=0;u<o;u++){let o=a[u],m=l[u];if(o.width!==m.width||o.height!==m.height){s=!1;break}}if(s)return!0;let u=0;for(let s=0;s<o;s++)for(let m=0;m<o;m++)if(a[s].width===l[m].width&&a[s].height===l[m].height){u++;break}return u===o}(l.sizes||[],o.sizes||[]);if(s){let l=xe(B(a)),o=this.knownImageServers[l];o&&(o.verifications+=1,o.verifications>=this.config.verificationsRequired&&(o.verified=!0))}return s}canLoadSync(a){let l="string"==typeof a?a:B(a),o=ve(l);if(this.imageServices[o])return!0;let s=this.knownImageServers[xe(l)];return!!(s&&!s.malformed&&s.verifications>=this.config.verificationsRequired)}async markAsMalformed(a){return this.knownImageServers[xe(B(a))].malformed=!0,this.loadService(a,!0)}async fetchService(a,l=!1){let o=ve(a),s=this.imageServices[o];if(s&&(!l||s.real))return s;if(!this.config.enableFetching)throw Error("Fetching is not enabled");let u=await this.fetch(o).then(a=>a.json());return!u.id&&u["@id"]&&(u.id=u["@id"]),u.id!==a&&(u.id=a,u["@id"]&&(u["@id"]=a)),this.imageServices[o]=Object.assign(u,{real:!0}),this.imageServices[o]}async fetch(a,l){return fetch(a,l)}async loadService(a,l=!1){if(!this.config.disableThrottling){let a=!0;for(;a;)if(this.fetchingCount>=this.config.verificationsRequired)await new Promise(a=>setTimeout(a,500));else{a=!1;break}}let o=this.knownImageServers[xe(B(a))];if(o&&!o.malformed&&!l){await o.result;let l=this.loadServiceSync(a);if(l)return l}this.fetchingCount++;let s=await this.fetchService(B(a),l);return this.fetchingCount--,s.real&&this.sample(s,a),s}loadServiceSync(a){let l=ve(B(a));return this.imageServices[l]?this.imageServices[l]:this.config.approximateServices?this.predict(a):null}};new iz;var iF=new iz,iL=new Map;let yl=({type:a})=>{switch(a){case"Sound":return w.createElement(j.Audio,null);case"Image":default:return w.createElement(j.Image,null);case"Video":return w.createElement(j.Video,null)}},bl=({canvas:a,canvasIndex:l,isActive:o,type:s,handleChange:u})=>{let[m,h]=(0,w.useState)(!1),[g,v]=(0,w.useState)(),b=D(),{vault:x}=b,E=null!=a&&a.label?Z(null==a?void 0:a.label):String(l+1);return(0,w.useEffect)(()=>{m&&(async()=>{var l,o;try{if((null==(l=null==a?void 0:a.thumbnail)?void 0:l.length)!==0)v(null==(o=null==a?void 0:a.thumbnail[0])?void 0:o.id);else{let{best:l}=await function(a,{vault:l=t9,dereference:o=!1,...s}={}){let u=iL.get(l);return u||(u=function(a=t9,l={}){let o=l.imageServiceLoader||iF;async function n(l,s,u=!1,m=[],h){let d=()=>o.getThumbnailFromResource(void 0,s,u,m);if(!l)return await o.getThumbnailFromResource(void 0,s,u,m);if("string"==typeof l){let a=ft(l);return a&&m.push(a),await o.getThumbnailFromResource(void 0,s,u,m)}let g=a.get(l,{skipSelfReturn:!1});if("string"==typeof g)return{best:ft(g),fallback:[],log:[]};if(!g)return await d();switch(await (async l=>{if(l&&l.thumbnail&&l.thumbnail.length){let s=a.get(l.thumbnail[0]),h=await o.getImageCandidates(s,u);h&&h.length&&m.push(...h)}})(g),g.type){case"Annotation":{let l=Array.isArray(g.body)?g.body:[g.body],v=a.get(l[0]);return h&&!v.width&&(v.width=h.width,v.height=h.height),await o.getThumbnailFromResource(v,s,u,m)}case"Canvas":return n(g.items[0],s,u,m,{width:g.width,height:g.height});case"AnnotationPage":return n(g.items[0],s,u,m,h);case"Choice":return!g.items||g.items[0]?await d():n(g.items[0],s,u,m,h);case"Collection":{let a=g.items[0];return a?n(a,s,u,m,h):await d()}case"Manifest":{let a=g.items[0];return a?n(a,s,u,m,h):await d()}case"SpecificResource":case"Image":case"Dataset":case"Sound":case"Text":case"TextualBody":case"Video":return h&&!g.width&&(g.width=h.width,g.height=h.height),o.getThumbnailFromResource(g,s,u,m)}return await d()}return{getBestThumbnailAtSize:n}}(l),iL.set(l,u)),u.getBestThumbnailAtSize(a,s,o)}(a,{vault:x,dereference:!0,width:200,height:200});v(null==l?void 0:l.id)}}catch(a){console.error("Error fetching thumbnail",a)}})()},[a,m]),w.createElement(t0,{"aria-checked":o,"data-testid":"media-thumbnail","data-canvas":l,onClick:()=>u(a.id),value:a.id},w.createElement("figure",null,w.createElement(tK,null,w.createElement(Ts,{isVisibleCallback:a=>{h(a)},attributes:{className:"media-thumbnail-lazyload","data-lazyload":String(m),"data-testid":"media-thumbnail-lazyload"}},g&&w.createElement("img",{alt:E,"data-testid":"media-thumbnail-image",src:g})),w.createElement(tZ,null),w.createElement(tJ,null,w.createElement(tG,{isIcon:!0,"data-testid":"thumbnail-tag"},w.createElement(tX,null),w.createElement(j,{"aria-label":s},w.createElement(yl,{type:s})),["Video","Sound"].includes(s)&&w.createElement(tY,null,Sr(a.duration))))),w.createElement("figcaption",{"data-testid":"fig-caption"},a.label?w.createElement(ce,{label:a.label}):(l+1).toString())))},wl=a=>a.body?a.body.type:"Image",xl=({items:a})=>{let{t:l}=(0,b.$G)(),o=X(),s=D(),{activeCanvas:u,vault:m,sequence:h}=s,[g,v]=(0,w.useState)(""),[x,E]=(0,w.useState)([]),[C,k]=(0,w.useState)(0),A=w.useRef(null),f=a=>{u!==a&&o({type:"updateActiveCanvas",canvasId:a})};return(0,w.useEffect)(()=>{if(!x.length){let l=["Image","Sound","Video"],o=a.map(a=>Mr(m,a,"painting",l)).filter(a=>a.annotations.length>0);E(o)}},[a,x.length,m]),(0,w.useEffect)(()=>{x.forEach((a,l)=>{null!=a&&a.canvas&&a.canvas.id===u&&k(l)})},[u,x]),(0,w.useEffect)(()=>{let a=document.querySelector(`[data-canvas="${C}"]`);if(a instanceof HTMLElement&&A.current){let l=a.offsetLeft-A.current.offsetWidth/2+a.offsetWidth/2;A.current.scrollTo({left:l,behavior:"smooth"})}},[C]),w.createElement(w.Fragment,null,w.createElement(Rs,{handleFilter:a=>v(a),handleCanvasToggle:a=>{let l=h[1].findIndex(a=>a.includes(C)),o=l+a>=0?l+a:h[1].length-1;if(!h[1][o])return;let s=h[1][o][0],u=h[0][s].id;u&&f(u)},activeIndex:C,canvasLength:a.length}),w.createElement(t1,{"aria-label":l("media.selectItem"),"data-testid":"media","data-active-canvas":a[C].id,"data-canvas-length":a.length,"data-filter":g,ref:A},h[1].filter(a=>a.some(a=>{var l;let o=h[0][a].id,s=x.find(a=>{var l;return(null==(l=null==a?void 0:a.canvas)?void 0:l.id)===o});if(!s)return!1;let u=Z(null==(l=null==s?void 0:s.canvas)?void 0:l.label)||"";return!(g&&!u.toLowerCase().includes(g.toLowerCase()))})).map((a,l)=>{let o=a.map(a=>h[0][a].id).includes(u);return w.createElement(t2,{"data-active":o,key:l},a.map(a=>{var l,o;let s=h[0][a].id,m=x.find(a=>{var l;return(null==(l=null==a?void 0:a.canvas)?void 0:l.id)===s});return m?w.createElement(bl,{canvas:m.canvas,canvasIndex:x.findIndex(a=>a===m),handleChange:f,isActive:u===(null==(l=null==m?void 0:m.canvas)?void 0:l.id),key:null==(o=null==m?void 0:m.canvas)?void 0:o.id,type:wl(m.annotations[0])}):null}))})))},ij=e6("button",{position:"absolute",background:"none",border:"none",cursor:"zoom-in",margin:"0",padding:"0",width:"100%",height:"100%",transition:"$all",opacity:1,display:"flex",alignItems:"center",justifyContent:"center",img:{width:"100%",height:"100%",objectFit:"contain",color:"transparent",aspectRatio:"auto"},"&[data-paged=true]":{"img:first-child ":{objectPosition:"100% 50%"},"img:last-child":{objectPosition:"0 50%"}},"&[data-active=false]":{opacity:0,objectPosition:"50% 50%"},variants:{isMedia:{true:{cursor:"pointer"}}}}),i_=e6("button",{display:"flex",height:"2rem",width:"2rem",borderRadius:"2rem",padding:"0",margin:"0",fontFamily:"inherit",background:"none",backgroundColor:"$primary",border:"none",color:"white",cursor:"pointer",marginLeft:"0.618rem",filter:"drop-shadow(2px 2px 5px #0003)",transition:"$all",boxSizing:"content-box !important","&:first-child":{marginLeft:"0"},"@xs":{marginBottom:"0.618rem",marginLeft:"0","&:last-child":{marginBottom:"0"}},svg:{height:"60%",width:"60%",padding:"20%",fill:"$secondary",stroke:"$secondary",filter:"drop-shadow(2px 2px 5px #0003)",transition:"$all",boxSizing:"inherit"},"&:hover, &:focus":{backgroundColor:"$accent"},"&[data-button=rotate-right]":{"&:hover, &:focus":{svg:{rotate:"45deg"}}},"&[data-button=rotate-left]":{transform:"scaleX(-1)","&:hover, &:focus":{svg:{rotate:"45deg"}}},"&[data-button=reset]":{"&:hover, &:focus":{svg:{rotate:"-15deg"}}}}),iB=e6(i_,{position:"absolute",width:"2rem",top:"1rem",right:"1rem",zIndex:100,display:"flex",alignItems:"center",justifyContent:"center",textAlign:"center",transition:"$all",borderRadius:"50%",backgroundColor:"$accent",cursor:"pointer","&:hover, &:focus":{backgroundColor:"$accent !important"},variants:{isInteractive:{true:{"&:hover":{opacity:"1"}},false:{}},isMedia:{true:{cursor:"pointer !important"}}},compoundVariants:[{isInteractive:!1,isMedia:!0,css:{top:"50%",right:"50%",width:"4rem",height:"4rem",transform:"translate(50%,-50%)"}}]}),iD=e6("div",{position:"relative",display:"flex",flexDirection:"column",flexGrow:"1",flexShrink:"1",gap:"1rem",zIndex:"0",overflow:"hidden","&:hover":{[`${iB}`]:{backgroundColor:"$accent"},[`${ij}`]:{backgroundColor:"#6662"}}}),iW=e6("div",{width:"100%",height:"100%"}),iH=e6("svg",{height:"19px",color:"$accent",fill:"$accent",stroke:"$accent",display:"flex",margin:"0.25rem 0.85rem"}),iV=e6(q.xz,{fontSize:"1.25rem",fontWeight:"400",fontFamily:"inherit",alignSelf:"flex-start",flexGrow:"1",cursor:"pointer",transition:"$all",border:"1px solid #6663",boxShadow:"2px 2px 5px #0001",borderRadius:"3px",display:"flex",alignItems:"center",paddingLeft:"0.5rem",width:"100%","@sm":{fontSize:"1rem"}}),iN=e6(q.VY,{borderRadius:"3px",boxShadow:"3px 3px 8px #0003",backgroundColor:"$secondary",marginTop:"2.25rem",marginLeft:"6px",paddingBottom:"0.25rem",maxHeight:"calc(61.8vh - 2.5rem) !important",borderTopLeftRadius:"0",border:"1px solid $secondaryMuted",maxWidth:"90vw"}),iq=e6(q.ck,{display:"flex",alignItems:"center",fontFamily:"inherit",padding:"0.25rem 0.5rem",color:"$primary",fontWeight:"400",fontSize:"0.8333rem",cursor:"pointer",backgroundColor:"$secondary",width:"calc(100% - 1rem)","> span":{whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"},'&[data-state="checked"]':{fontWeight:"700",color:"$primary !important"},"&:hover":{color:"$accent"},img:{width:"31px",height:"31px",marginRight:"0.5rem",borderRadius:"3px"}}),iU=e6(q.__,{color:"$primaryMuted",fontFamily:"inherit",fontSize:"0.85rem",padding:"0.5rem 1rem 0.5rem 0.5rem",display:"flex",alignItems:"center",marginBottom:"0.25rem",borderRadius:"3px",borderTopLeftRadius:"0",borderBottomLeftRadius:"0",borderBottomRightRadius:"0",backgroundColor:"$secondaryMuted"}),iQ=e6(q.fC,{position:"relative",zIndex:"5",width:"100%"}),tt=({direction:a,title:l})=>w.createElement(iH,{xmlns:"http://www.w3.org/2000/svg",focusable:"false",viewBox:"0 0 512 512",role:"img"},w.createElement("title",null,l),"up"===a&&w.createElement(()=>w.createElement("path",{d:"M414 321.94L274.22 158.82a24 24 0 00-36.44 0L98 321.94c-13.34 15.57-2.28 39.62 18.22 39.62h279.6c20.5 0 31.56-24.05 18.18-39.62z"}),null),"down"===a&&w.createElement(()=>w.createElement("path",{d:"M98 190.06l139.78 163.12a24 24 0 0036.44 0L414 190.06c13.34-15.57 2.28-39.62-18.22-39.62h-279.6c-20.5 0-31.56 24.05-18.18 39.62z"}),null)),An=({children:a,label:l,maxHeight:o,onValueChange:s,value:u})=>w.createElement(iQ,{onValueChange:s,value:u},w.createElement(iV,{"data-testid":"select-button"},w.createElement(q.ki,{"data-testid":"select-button-value"}),w.createElement(q.GV,null,w.createElement(tt,{direction:"down",title:"select"}))),w.createElement(q.ue,null,w.createElement(iN,{css:{maxHeight:`${o} !important`},"data-testid":"select-content"},w.createElement(q.Pn,null,w.createElement(tt,{direction:"up",title:"scroll up for more"})),w.createElement(q.Q_,null,w.createElement(q.DI,null,l&&w.createElement(iU,null,w.createElement(ce,{"data-testid":"select-label",label:l})),a)),w.createElement(q.Jk,null,w.createElement(tt,{direction:"down",title:"scroll down for more"}))))),Rn=a=>w.createElement(iq,{...a},a.thumbnail&&w.createElement(Wr,{thumbnail:a.thumbnail}),w.createElement(q.S_,null,w.createElement(ce,{label:a.label})),w.createElement(q.o6,null)),iG=window.OpenSeadragon;if(!iG&&!(iG=U))throw Error("OpenSeadragon is missing.");let iZ="http://www.w3.org/2000/svg";iG.Viewer&&(iG.Viewer.prototype.svgOverlay=function(){return this._svgOverlayInfo||(this._svgOverlayInfo=new Tn(this)),this._svgOverlayInfo});let Tn=function(a){let l=this;this._viewer=a,this._containerWidth=0,this._containerHeight=0,this._svg=document.createElementNS(iZ,"svg"),this._svg.style.position="absolute",this._svg.style.left=0,this._svg.style.top=0,this._svg.style.width="100%",this._svg.style.height="100%",this._viewer.canvas.appendChild(this._svg),this._node=document.createElementNS(iZ,"g"),this._svg.appendChild(this._node),this._viewer.addHandler("animation",function(){l.resize()}),this._viewer.addHandler("open",function(){l.resize()}),this._viewer.addHandler("rotate",function(){l.resize()}),this._viewer.addHandler("flip",function(){l.resize()}),this._viewer.addHandler("resize",function(){l.resize()}),this.resize()};Tn.prototype={node:function(){return this._node},resize:function(){this._containerWidth!==this._viewer.container.clientWidth&&(this._containerWidth=this._viewer.container.clientWidth,this._svg.setAttribute("width",this._containerWidth)),this._containerHeight!==this._viewer.container.clientHeight&&(this._containerHeight=this._viewer.container.clientHeight,this._svg.setAttribute("height",this._containerHeight));let a=this._viewer.viewport.pixelFromPoint(new iG.Point(0,0),!0),l=this._viewer.viewport.getZoom(!0),o=this._viewer.viewport.getRotation(),s=this._viewer.viewport.getFlip(),u=this._viewer.viewport._containerInnerSize.x,m=u*l,h=m;s&&(m=-m,a.x=-a.x+u),this._node.setAttribute("transform","translate("+a.x+","+a.y+") scale("+m+","+h+") rotate("+o+")")},onClick:function(a,l){new iG.MouseTracker({element:a,clickHandler:l}).setTracking(!0)}};let kl=a=>fetch(`${a.replace(/\/$/,"")}/info.json`).then(a=>a.json()).then(a=>a).catch(l=>{console.error(`The IIIF tilesource ${a.replace(/\/$/,"")}/info.json failed to load: ${l}`)}),$l=a=>{let l,o;return Array.isArray(a)&&(l=a[0])&&(o="@id"in l?l["@id"]:l.id),o},kn=a=>{var l,o,s,u,m,h,g,v,b,w,x,E,C,k,A;let I,O={};switch(null==a?void 0:a.type){case"SpecificResource":O={manifest:I=null==(s=null==(o=null==(l=null==a?void 0:a.target)?void 0:l.partOf)?void 0:o[0])?void 0:s.id,canvas:null==(u=null==a?void 0:a.target)?void 0:u.id},null!=a&&a.selector&&(O.selector=a.selector);break;case"Range":case"Annotation":let M=(null==(m=null==a?void 0:a.target)?void 0:m.source)||(null==a?void 0:a.target),P=null==(h=null==a?void 0:a.target)?void 0:h.selector;O={manifest:null==(v=null==(g=null==M?void 0:M.partOf)?void 0:g[0])?void 0:v.id,canvas:null==M?void 0:M.id},((null==(b=null==a?void 0:a.target)?void 0:b.type)==="SpecificResource"||null!=(w=null==a?void 0:a.target)&&w.selector)&&(O.selector=P);break;case"Canvas":if(O={manifest:I=null==(E=null==(x=null==a?void 0:a.partOf)?void 0:x[0])?void 0:E.id,canvas:null==a?void 0:a.id},null!=(C=null==a?void 0:a.id)&&C.includes("#xywh=")){let[l,o]=a.id.split("#xywh=");O.canvas=l,O.selector={type:"FragmentSelector",value:`xywh=${o}`}}break;case"Manifest":I=null==a?void 0:a.id,O={collection:null==(A=null==(k=null==a?void 0:a.partOf)?void 0:k[0])?void 0:A.id,manifest:null==a?void 0:a.id};break;case"Collection":O={collection:I=null==a?void 0:a.id}}return{resourceId:I,active:O}},Ml=a=>{if(_l(a))return{resourceId:a};{let l=JSON.parse((0,k.o0)(a)),{active:o}=kn(l);return{active:o,resourceId:null==l?void 0:l.resourceId,resourceObject:l}}},Ol=a=>{let{resourceId:l,resourceObject:o}=Ml(a);return o||l},Pl=a=>a.items.map(a=>a.id)[0],Fl=a=>{let l=a.items.filter(a=>"Manifest"===a.type).map(a=>a.id);return 0==l.length?null:l[0]},_l=a=>{try{new URL(a)}catch{return!1}return!0};var iJ=((s=iJ||{}).TiledImage="tiledImage",s.SimpleImage="simpleImage",s);let zl=a=>{let l=Array.isArray(null==a?void 0:a.service)&&(null==a?void 0:a.service.length)>0,o=l?$l(null==a?void 0:a.service):null==a?void 0:a.id,s=l?iJ.TiledImage:iJ.SimpleImage;return{uri:o,imageType:s}},Ll=(a,l)=>{let o=l?iJ.TiledImage:iJ.SimpleImage;return{uri:a,imageType:o}},iX=e6("div",{position:"absolute !important",zIndex:"1",top:"1rem",left:"1rem",width:"161.8px",height:"100px",backgroundColor:"#000D",boxShadow:"5px 5px 5px #0002",borderRadius:"3px",".displayregion":{border:" 3px solid $accent !important",boxShadow:"0 0 3px #0006"},"@sm":{width:"123px",height:"76px"},"@xs":{width:"100px",height:"61.8px"}}),iY=e6("div",{position:"relative",width:"100%",height:"100%",zIndex:"0",".clover-iiif-image-openseadragon-annotation":{position:"relative",backgroundColor:"transparent",border:"2px solid #0003",boxSizing:"content-box",borderRadius:"3px",boxShadow:"0 0 38vw 38vw transparent",transition:"box-shadow 100ms ease-in-out",zIndex:"0",label:{opacity:0,position:"absolute",lineHeight:"1.47rem",pointerEvents:"none",textAlign:"center",minWidth:"300px",maxWidth:"20vw",padding:"0.5rem",borderRadius:"3px",top:"calc(100% + 0.5rem)",left:"50%",transform:"translate(-50%, 0)",backgroundColor:"$primary",color:"$secondary",transition:"opacity 100ms ease-in-out"},"&[data-active=true]":{border:"2px solid $accent !important",boxShadow:"0 0 38vw 38vw #0003",zIndex:"99999999",label:{opacity:1}}}}),iK=e6("div",{width:"100%",height:"100%",maxHeight:"100vh",background:"transparent",backgroundSize:"contain",color:"white",position:"relative",zIndex:"0",overflow:"hidden",variants:{hasNavigator:{true:{[`${iX}`]:{display:"block"}},false:{[`${iX}`]:{display:"none"}}}}}),Ee=({className:a,id:l,label:o,children:s})=>{let u=o.toLowerCase().replace(/\s/g,"-");return w.createElement(i_,{id:l,className:a,"data-testid":"openseadragon-button","data-button":u},w.createElement("svg",{xmlns:"http://www.w3.org/2000/svg","aria-labelledby":`${l}-svg-title`,"data-testid":"openseadragon-button-svg",focusable:"false",viewBox:"0 0 512 512",role:"img"},w.createElement("title",{id:`${l}-svg-title`},o),s))},i0=e6("div",{position:"absolute",zIndex:"1",top:"1rem",right:"1rem",display:"flex","@xs":{flexDirection:"column",zIndex:"2"},variants:{hasPlaceholder:{true:{right:"3.618rem","@xs":{top:"3.618rem",right:"1rem"}},false:{right:"1rem","@xs":{top:"1rem",right:"1rem"}}}}}),Vl=()=>w.createElement("path",{strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M256 112v288M400 256H112"}),Nl=()=>w.createElement("path",{strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M400 256H112"}),Wl=()=>w.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32",d:"M432 320v112H320M421.8 421.77L304 304M80 192V80h112M90.2 90.23L208 208M320 80h112v112M421.77 90.2L304 208M192 432H80V320M90.23 421.8L208 304"}),Ul=()=>w.createElement("path",{d:"M448 440a16 16 0 01-12.61-6.15c-22.86-29.27-44.07-51.86-73.32-67C335 352.88 301 345.59 256 344.23V424a16 16 0 01-27 11.57l-176-168a16 16 0 010-23.14l176-168A16 16 0 01256 88v80.36c74.14 3.41 129.38 30.91 164.35 81.87C449.32 292.44 464 350.9 464 424a16 16 0 01-16 16z"}),Vt=()=>w.createElement(w.Fragment,null,w.createElement("path",{fill:"none",strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M400 148l-21.12-24.57A191.43 191.43 0 00240 64C134 64 48 150 48 256s86 192 192 192a192.09 192.09 0 00181.07-128"}),w.createElement("path",{d:"M464 97.42V208a16 16 0 01-16 16H337.42c-14.26 0-21.4-17.23-11.32-27.31L436.69 86.1C446.77 76 464 83.16 464 97.42z"})),ql=({_cloverViewerHasPlaceholder:a,config:l})=>{let o=D(),{activeCanvas:s,plugins:u,vault:m,openSeadragonViewer:h}=o,g=m.get({id:s,type:"Canvas"});return(0,w.useEffect)(()=>{if(!h)return;let a=h.viewport.getRotation();h.addHandler("home",()=>{h.viewport.setRotation(a)})},[h]),w.createElement(i0,{"data-testid":"clover-iiif-image-openseadragon-controls",hasPlaceholder:a},l.showZoomControl&&w.createElement(w.Fragment,null,w.createElement(Ee,{id:l.zoomInButton,label:"zoom in"},w.createElement(Vl,null)),w.createElement(Ee,{id:l.zoomOutButton,label:"zoom out"},w.createElement(Nl,null))),l.showFullPageControl&&w.createElement(Ee,{id:l.fullPageButton,label:"full page"},w.createElement(Wl,null)),l.showRotationControl&&w.createElement(w.Fragment,null,w.createElement(Ee,{id:l.rotateRightButton,label:"rotate right"},w.createElement(Vt,null)),w.createElement(Ee,{id:l.rotateLeftButton,label:"rotate left"},w.createElement(Vt,null))),l.showHomeControl&&w.createElement(Ee,{id:l.homeButton,label:"reset"},w.createElement(Ul,null)),u.filter(a=>{var l;return null==(l=a.imageViewer)?void 0:l.controls}).map((a,l)=>{var o,s,u,m;let h=null==(s=null==(o=a.imageViewer)?void 0:o.controls)?void 0:s.component;return w.createElement(h,{key:l,...null==(m=null==(u=null==a?void 0:a.imageViewer)?void 0:u.controls)?void 0:m.componentProps,canvas:g,useViewerDispatch:X,useViewerState:D})}))};async function $n(a,l=3,o=500){try{return await a()}catch(s){if(l<=0)throw s;return await new Promise(a=>setTimeout(a,o)),$n(a,l-1,o)}}let jl=a=>new Promise(l=>setTimeout(l,a)),Nt=async(a,l,o=3,s=300)=>{for(let u=0;u<o;u++){let o=l?l-1:0,u=a.getItemAt(o);if(u)return u;await jl(s)}throw Error("No base item found at index 0 after retries")},Gl=({annotations:a,ariaLabel:l,config:o,uri:s,_cloverViewerHasPlaceholder:u,imageType:m,openSeadragonCallback:h})=>{let[g,v]=(0,w.useState)([]),[b,x]=(0,w.useState)([]),[E,C]=(0,w.useState)(),[k,A]=(0,w.useState)([]),I=X(),O=(0,w.useRef)(!1);function y(){E&&(null==h||h(E))}return(0,w.useEffect)(()=>(O.current||(O.current=!0,E||C(U(o))),()=>null==E?void 0:E.destroy()),[]),(0,w.useEffect)(()=>{y()},[E,h]),(0,w.useEffect)(()=>{E&&JSON.stringify(s)!==JSON.stringify(b)&&(E.forceRedraw(),x(s))},[E,b,s]),(0,w.useEffect)(()=>{b.length&&E&&(E.close(),(async()=>{switch(m){case"simpleImage":let l=1,o=0;for(let s=0;s<b.length;s++){let u=b[s];if(a){let a=new Image;a.src=u,await a.decode(),A(l=>[...l,{width:null==a?void 0:a.width,height:null==a?void 0:a.height}])}try{if(0!==s){let a=(await Nt(E.world,s)).getBounds();o=a.x+a.width,l=a.height}E.addSimpleImage({url:u,x:o,y:0,height:l,success:()=>{v(a=>[...a,u]),"function"==typeof I&&I({type:"updateOSDImageLoaded",OSDImageLoaded:!0})}})}catch(a){console.error(`Failed to load image at ${u}:`,a)}}break;case"tiledImage":{let a=1,l=0;for(let o=0;o<b.length;o++){let s=b[o];try{let u=await $n(()=>kl(s),3,1e3);if(!u)throw Error(`No tile source for ${s}`);if(0!==o){let s=(await Nt(E.world,o)).getBounds();l=s.x+s.width,a=s.height}E.addTiledImage({tileSource:u,x:l,y:0,height:a,success:()=>{v(a=>[...a,s]),"function"==typeof I&&I({type:"updateOSDImageLoaded",OSDImageLoaded:!0})}})}catch(a){console.error(`Failed to load tile at ${s}:`,a)}}break}default:console.warn(`Unsupported imageType: "${m}"`)}})().catch(a=>console.error("Error drawing tiles",a)))},[b,m,E]),(0,w.useEffect)(()=>{if(g){let a=0,S=()=>{if(a<3){let l=null==E?void 0:E.world.getHomeBounds();l&&(null==E||E.viewport.fitBounds(l,!0)),a++,setTimeout(S,50)}};S(),null==E||E.addHandler("canvas-click",a=>{let l=null==E?void 0:E.getOverlayById(a.originalTarget.id);if(l){let o=null==l?void 0:l.getBounds(E.viewport);return o.x-=.1,o.y-=.1,o.width+=.2,o.height+=.2,null==E||E.viewport.fitBounds(o,!1),a.preventDefaultAction=!0}})}},[g]),(0,w.useEffect)(()=>{a&&(null==E||E.clearOverlays(),a.forEach(a=>{var l,o,s,u;let{annotation:m,targetIndex:h}=a,g=(null==(o=null==(l=null==E?void 0:E.viewport)?void 0:l.getBounds())?void 0:o.width)||1,v=null==E?void 0:E.world.getItemAt(h),b=v?(null==v?void 0:v.getBounds().width)/(null==v?void 0:v.getContentSize().x):(null==(s=k[h])?void 0:s.width)/g,w=oo(null==m?void 0:m.target),x=null!=m&&m.body?null==(u=null==m?void 0:m.body[0])?void 0:u.value:void 0;if(null!=w&&w.rect){let{x:a,y:l,w:o,h:s}=null==w?void 0:w.rect,u=function(a,l,o){let s=a*o;if(0===l)return s;for(;l>0;){let a=null==E?void 0:E.world.getItemAt(l-1);if(a){let o=a.getBounds().width;s+=o,l--}else break}return s}(a,h,b),g=new U.Rect(u,l*b,o*b,s*b),v=document.createElement("button");if(v.classList.add("clover-iiif-image-openseadragon-annotation"),v.id=m.id,v.setAttribute("tabindex","0"),v.setAttribute("role","button"),v.setAttribute("data-active","true"),v.setAttribute("tabindex","0"),v.setAttribute("role","button"),v.setAttribute("data-active","false"),x){v.setAttribute("aria-label",x);let a=document.createElement("label");a.innerHTML=x,v.appendChild(a)}v.addEventListener("mousedown",a=>{a.stopPropagation(),a.preventDefault()}),v.addEventListener("touchstart",a=>{a.stopPropagation(),a.preventDefault()}),v.addEventListener("click",a=>{a.stopPropagation(),a.preventDefault()}),v.addEventListener("keydown",a=>{if("Enter"===a.key){a.stopPropagation(),a.preventDefault();let l=new U.Rect(g.x-.1,g.y-.1,g.width+.2,g.height+.2);null==E||E.viewport.fitBounds(l,!1)}}),v.addEventListener("focus",()=>{v.setAttribute("data-active","true")}),v.addEventListener("mouseover",()=>{v.setAttribute("data-active","true")}),v.addEventListener("mouseout",()=>{v.removeAttribute("data-active")}),v.addEventListener("blur",()=>{v.removeAttribute("data-active")}),null==E||E.addOverlay(v,g,U.Placement.CENTER)}}),y())},[g,a]),w.createElement(iK,{className:"clover-iiif-image-openseadragon","data-testid":"clover-iiif-image-openseadragon","data-openseadragon-instance":o.id,hasNavigator:o.showNavigator},w.createElement(ql,{_cloverViewerHasPlaceholder:u,config:o}),o.showNavigator&&w.createElement(iX,{id:o.navigatorId,"data-testid":"clover-iiif-image-openseadragon-navigator"}),w.createElement(iY,{id:o.id,"data-testid":"clover-iiif-image-openseadragon-viewport",role:"img",...l&&{"aria-label":l}}))},Jl=({_cloverViewerHasPlaceholder:a=!1,annotations:l,body:o,instanceId:s,isTiledImage:u=!1,label:m,src:h="",openSeadragonCallback:g,openSeadragonConfig:v={}})=>{let b=s??(0,C.Z)(),x="string"==typeof m?m:Z(m),E={id:`openseadragon-${b}`,navigatorId:`openseadragon-navigator-${b}`,loadTilesWithAjax:!0,fullPageButton:`fullPage-${b}`,homeButton:`reset-${b}`,rotateLeftButton:`rotateLeft-${b}`,rotateRightButton:`rotateRight-${b}`,zoomInButton:`zoomIn-${b}`,zoomOutButton:`zoomOut-${b}`,showNavigator:!0,showFullPageControl:!0,showHomeControl:!0,showRotationControl:!0,showZoomControl:!0,navigatorBorderColor:"transparent",gestureSettingsMouse:{clickToZoom:!0,dblClickToZoom:!0,pinchToZoom:!0,scrollToZoom:!1},...v},k=Array.isArray(o)?o:o?[o]:[],A=Array.isArray(h)?h:h?[h]:[],I=[],M=iJ.SimpleImage;if(k.length){let a=k.map(zl);I=a.map(a=>a.uri).filter(Boolean),M=a.some(a=>a.imageType===iJ.TiledImage)?iJ.TiledImage:iJ.SimpleImage}else if(A.length){let a=A.map(a=>Ll(a,u));I=a.map(a=>a.uri).filter(Boolean),M=a.some(a=>a.imageType===iJ.TiledImage)?iJ.TiledImage:iJ.SimpleImage}return I.length?w.createElement(O.ErrorBoundary,{FallbackComponent:yt},w.createElement(Gl,{_cloverViewerHasPlaceholder:a,annotations:l,ariaLabel:x,config:E,imageType:M,key:b,uri:I,openSeadragonCallback:a=>{null==g||g(a)}})):null},Yl=({isActive:a,isMedia:l,items:o,setIsInteractive:s})=>{let{vault:u}=D(),[m,h]=(0,w.useState)([]),g=m.length>1;if((0,w.useEffect)(()=>{h([]);let a=o.map(a=>{let l=me(u,a.id);if(!l)return null;let{id:o,width:s,height:m}=l[0];return o?{src:o,width:s||640,height:m||640,alt:a.label?vt(a.label):"placeholder image"}:null}).filter(a=>null!==a);a.length&&h(a)},[o,g]),!a||!m.length)return null;let v=m.map(a=>a.width/a.height*1),b=v.reduce((a,l)=>a+l,0);return w.createElement(ij,{onClick:()=>s(!0),isMedia:l,className:"clover-viewer-placeholder","data-active":a,"data-paged":g},m.map((a,l)=>{let o=v[l]/b*100;return w.createElement("img",{...a,key:l,alt:a.alt,style:{width:`${o}%`}})}))},i1=e6("canvas",{position:"absolute",width:"100%",height:"100%",zIndex:"0"}),i2=w.forwardRef((a,l)=>{let o=w.useRef(null),s=(0,w.useCallback)(()=>{var a,s;if(null!=(a=l.current)&&a.currentTime&&(null==(s=l.current)?void 0:s.currentTime)>0)return;let u=l.current;if(!u)return;let m=new AudioContext,h=m.createMediaElementSource(u),g=m.createAnalyser(),v=o.current;if(!v)return;v.width=u.offsetWidth,v.height=u.offsetHeight;let b=v.getContext("2d");h.connect(g),g.connect(m.destination),g.fftSize=256;let w=g.frequencyBinCount,x=new Uint8Array(w);setInterval(function(){!function(a,l,o,s,u,m){let h=u/o*2.6,g,v=0;a.getByteFrequencyData(s),l.fillStyle="#000000",l.fillRect(0,0,u,m);for(let a=0;a<o;a++)g=2*s[a],l.fillStyle="rgba(78, 42, 132, 1)",l.fillRect(v,m-g,h,g),v+=h+6}(g,b,w,x,v.width,v.height)},20)},[l]);return w.useEffect(()=>{l&&l.current&&(l.current.onplay=s)},[s,l]),w.createElement(i1,{ref:o,role:"presentation"})}),i3=e6("div",{position:"relative",backgroundColor:"$primaryAlt",display:"flex",flexGrow:"0",flexShrink:"1",height:"100%",zIndex:"1",video:{backgroundColor:"transparent",objectFit:"contain",width:"100%",height:"100%",position:"relative",zIndex:"1"}}),ec=({resource:a,ignoreCaptionLabels:l})=>{let o=vt(a.label,"en");return Array.isArray(o)&&o.some(a=>l.includes(a))?null:w.createElement("track",{key:a.id,src:a.id,label:Array.isArray(o)?o[0]:o,srcLang:"en","data-testid":"player-track"})},i4=["application/vnd.apple.mpegurl","vnd.apple.mpegurl","audio/mpegurl","audio/x-mpegurl","application/x-mpegurl","video/x-mpegurl","video/mpegurl","application/mpegurl"],rc=({allSources:a,annotationResources:l,painting:o})=>{let[s,u]=w.useState(0),[m,h]=w.useState(),g=w.useRef(null),v=(null==o?void 0:o.type)==="Sound",b=X(),x=D(),{activeCanvas:E,configOptions:C,contentStateAnnotation:k,vault:A}=x;return(0,w.useEffect)(()=>{if(!o.id||!g.current)return;if(null!=g&&g.current){let a=g.current;a.src=o.id,a.load()}if("m3u8"!==o.id.split(".").pop()&&o.format&&!i4.includes(o.format))return;let a=new H.ZP({xhrSetup:function(a,l){a.withCredentials=!!C.withCredentials}});return a.attachMedia(g.current),a.on(H.ZP.Events.MEDIA_ATTACHED,function(){a.loadSource(o.id)}),a.on(H.ZP.Events.ERROR,function(l,o){if(o.fatal)switch(o.type){case H.ZP.ErrorTypes.NETWORK_ERROR:console.error(`fatal ${l} network error encountered, try to recover`),a.startLoad();break;case H.ZP.ErrorTypes.MEDIA_ERROR:console.error(`fatal ${l} media error encountered, try to recover`),a.recoverMediaError();break;default:a.destroy()}}),()=>{if(a&&g.current){let l=g.current;a.detachMedia(),a.destroy(),l.currentTime=0}}},[C.withCredentials,o.id]),(0,w.useEffect)(()=>{var a,l,o,u;let m=A.get(E),g=null!=(a=m.accompanyingCanvas)&&a.id?me(A,null==(l=m.accompanyingCanvas)?void 0:l.id):null,v=null!=(o=m.placeholderCanvas)&&o.id?me(A,null==(u=m.placeholderCanvas)?void 0:u.id):null;g&&v?h(0===s?v[0].id:g[0].id):(g&&h(g[0].id),v&&h(v[0].id))},[E,s,A]),(0,w.useEffect)(()=>{let a=null==g?void 0:g.current;if(!a)return;let l=null,o=!1,y=()=>{o||(o=!0,l=setInterval(()=>{!a||a.paused||a.ended||(u(a.currentTime),b({type:"updateActiveSelector",selector:{type:"PointSelector",t:Math.round(a.currentTime)}}))},500)),a&&a.paused&&(u(a.currentTime),b({type:"updateActiveSelector",selector:{type:"PointSelector",t:Math.round(a.currentTime)}}))};return a.addEventListener("timeupdate",y),()=>{null==a||a.removeEventListener("timeupdate",y),l&&clearInterval(l)}},[o.id,E]),(0,w.useEffect)(()=>{var a,l;if(k){let o=null==g?void 0:g.current;if(!o)return;let s=null==(a=null==k?void 0:k.target)?void 0:a.selector,{type:m,t:h,value:v}=s||{};if(((null==(l=null==k?void 0:k.target)?void 0:l.source)||(null==k?void 0:k.target)).id!==E)return;if(h&&"PointSelector"===m&&(u(h),o.currentTime=h),"FragmentSelector"===m&&v){let a=v.split("=")[1];if(!a)return;let l=a.split(",")[0];u(l),o.currentTime=l}}},[g,k]),w.createElement(i3,{css:{backgroundColor:C.canvasBackgroundColor,maxHeight:C.canvasHeight,position:"relative"},"data-testid":"player-wrapper",className:"clover-viewer-player-wrapper"},w.createElement("video",{id:"clover-iiif-video",key:o.id,ref:g,"data-src":o.id,controls:!0,height:o.height,width:o.width,crossOrigin:C.crossOrigin,poster:m,style:{maxHeight:C.canvasHeight,position:"relative",zIndex:"1"}},a.map(a=>w.createElement("source",{src:a.id,type:a.format,key:a.id})),(null==l?void 0:l.length)>0&&l.map(a=>{let l=[];return a.items.forEach(a=>{A.get(a.id).body.forEach(a=>{let o=A.get(a.id);l.push(o)})}),l.map(a=>w.createElement(ec,{resource:a,ignoreCaptionLabels:C.ignoreCaptionLabels||[],key:a.id}))}),"Sorry, your browser doesn't support embedded videos."),v&&w.createElement(i2,{ref:g}))},nc=()=>w.createElement("svg",{xmlns:"http://www.w3.org/2000/svg","aria-labelledby":"close-svg-title",focusable:"false",viewBox:"0 0 512 512",role:"img"},w.createElement("title",{id:"close-svg-title"},"close"),w.createElement("path",{d:"M289.94 256l95-95A24 24 0 00351 127l-95 95-95-95a24 24 0 00-34 34l95 95-95 95a24 24 0 1034 34l95-95 95 95a24 24 0 0034-34z"})),ic=({isMedia:a})=>w.createElement("svg",{xmlns:"http://www.w3.org/2000/svg","aria-labelledby":"open-svg-title",focusable:"false",viewBox:"0 0 512 512",role:"img"},w.createElement("title",{id:"open-svg-title"},"open"),a?w.createElement("path",{d:"M133 440a35.37 35.37 0 01-17.5-4.67c-12-6.8-19.46-20-19.46-34.33V111c0-14.37 7.46-27.53 19.46-34.33a35.13 35.13 0 0135.77.45l247.85 148.36a36 36 0 010 61l-247.89 148.4A35.5 35.5 0 01133 440z"}):w.createElement(w.Fragment,null,w.createElement("path",{d:"m456.69,421.39l-94.09-94.09c22.65-30.16,34.88-66.86,34.84-104.58,0-96.34-78.38-174.72-174.72-174.72S48,126.38,48,222.72s78.38,174.72,174.72,174.72c37.72.04,74.42-12.19,104.58-34.84l94.09,94.09c10.29,9.2,26.1,8.32,35.3-1.98,8.48-9.49,8.48-23.83,0-33.32Zm-233.97-73.87c-68.89-.08-124.72-55.91-124.8-124.8h0c0-68.93,55.87-124.8,124.8-124.8s124.8,55.87,124.8,124.8-55.87,124.8-124.8,124.8Z"}),w.createElement("path",{d:"m279.5,197.76h-3.35s-28.47,0-28.47,0v-31.82c-.77-13.79-12.57-24.33-26.36-23.56-12.71.71-22.85,10.86-23.56,23.56v3.35h0v28.47h-31.82c-13.79.77-24.33,12.57-23.56,26.36.71,12.71,10.86,22.85,23.56,23.56h3.35s28.47,0,28.47,0v31.82c.77,13.79,12.57,24.33,26.36,23.56,12.71-.71,22.85-10.86,23.56-23.56v-3.35h0v-28.47h31.82c13.79-.77,24.33-12.57,23.56-26.36-.71-12.71-10.86-22.85-23.56-23.56Z"}))),ac=({handleToggle:a,isInteractive:l,isMedia:o})=>w.createElement(iB,{onClick:a,isInteractive:l,isMedia:o,"data-testid":"placeholder-toggle"},l?w.createElement(nc,null):w.createElement(ic,{isMedia:o})),oc=({activeCanvas:a,annotationResources:l,contentSearchResource:o,isMedia:s,painting:u})=>{var m,h,g,v;let[b,x]=w.useState(0),[E,C]=w.useState(!1),[k,A]=w.useState([]),[I,O]=w.useState([]),[M,P]=w.useState(0),{configOptions:z,customDisplays:F,contentStateAnnotation:L,informationPanelResource:_,openSeadragonViewer:H,vault:V,viewerId:N,visibleCanvases:q}=D(),[U,G]=w.useState([]),Y=!!L&&a===(null==(h=null==(m=null==L?void 0:L.target)?void 0:m.source)?void 0:h.id),K=X(),ee=V.get(a),ei=I.length&&!E&&!s,en=(null==u?void 0:u.length)>1,er=`${N}-${Ir(a+b+JSON.stringify(q)+M)}`,J=()=>{C(!E),P(a=>a+1)},el=F.find(l=>{var o;let s=!1,{canvasId:m,paintingFormat:h}=l.target;if(Array.isArray(m)&&m.length>0&&(s=m.includes(a)),Array.isArray(h)&&h.length>0){let a=(null==(o=u[b])?void 0:o.format)||"";s=!!(a&&h.includes(a))}return s});(0,w.useEffect)(()=>{Y&&ei&&0===M&&J()},[Y,ei]),(0,w.useEffect)(()=>{ei&&(K({type:"updateOpenSeadragonViewer",openSeadragonViewer:void 0}),K({type:"updateActiveSelector",selector:void 0}))},[ei]),(0,w.useEffect)(()=>{var a,s,u;let m=[];if("manifest-annotations"===_&&(null==l||l.forEach((a,l)=>{var o;null==(o=null==a?void 0:a.items)||o.forEach(a=>{let o=V.get(a.id);o&&m.push({annotation:{...o,body:o.body.map(a=>{let l=V.get(a.id);return l||a})},targetIndex:l})})}),L)){let l=(null==(a=null==L?void 0:L.target)?void 0:a.source)||(null==L?void 0:L.target);m.push({annotation:{...L,body:null==(s=null==L?void 0:L.body)?void 0:s.map(a=>{let l=V.get(a.id);return l||a})},targetIndex:q.findIndex(a=>a.id===l.id)})}"manifest-content-search"===_&&(null==(u=null==o?void 0:o.items)||u.forEach(a=>{let l=V.get(a.id);if(l){let a=q.findIndex(a=>a.id===l.target.source.id);"number"==typeof a&&m.push({annotation:{...l,body:l.body.map(a=>{let l=V.get(a.id);return l||a})},targetIndex:a})}})),G(m)},[l,o,L,_,q]),(0,w.useEffect)(()=>{if(!s){let a=q.map(a=>{let l=a.id,o=me(V,l);return o?o[b]:void 0}).filter(Boolean),l=q.map(a=>{var l;let o=a.id,s=V.get(o),u=null==(l=null==s?void 0:s.placeholderCanvas)?void 0:l.id;return u&&u?{id:u,label:null==s?void 0:s.label}:null}).filter(a=>null!==a);A(a),O(l)}},[b,a,q,s,ee]),(0,w.useEffect)(()=>{x(0)},[q]);let eo=null==(g=null==el?void 0:el.display)?void 0:g.component;return w.createElement(iD,{className:"clover-viewer-painting"},w.createElement(iW,{style:{backgroundColor:z.canvasBackgroundColor,height:"auto"===z.canvasHeight?"100%":z.canvasHeight}},!!I.length&&!s&&w.createElement(ac,{handleToggle:J,isInteractive:E,isMedia:s}),!!(null!=I&&I.length)&&!s&&w.createElement(Yl,{isActive:!!ei,isMedia:s,items:I,setIsInteractive:C}),!ei&&!el&&(s?w.createElement(rc,{allSources:u,painting:u[b],annotationResources:l}):u&&w.createElement(Jl,{_cloverViewerHasPlaceholder:!!(null!=I&&I.length),annotations:U,body:k,instanceId:er,key:er,openSeadragonCallback:a=>{a&&!ei&&(null==H?void 0:H.id)!==`openseadragon-${er}`&&K({type:"updateOpenSeadragonViewer",openSeadragonViewer:a})},openSeadragonConfig:z.openSeadragon})),!ei&&eo&&w.createElement(eo,{id:a,annotationBody:u[b],...null==el?void 0:el.display.componentProps})),en&&w.createElement(An,{value:null==(v=u[b])?void 0:v.id,onValueChange:a=>{let l=u.findIndex(l=>l.id===a);x(l)},maxHeight:"200px"},null==u?void 0:u.map(a=>w.createElement(Rn,{value:null==a?void 0:a.id,key:null==a?void 0:a.id,label:null==a?void 0:a.label}))))},sc=({activeCanvas:a,annotationResources:l,searchServiceUrl:o,setContentSearchResource:s,contentSearchResource:u,isAudioVideo:m,items:h,painting:g})=>{var v,b;let{contentStateAnnotation:x,isInformationOpen:E,configOptions:C,sequence:k,visibleCanvases:A}=D(),{informationPanel:I}=C,O=A.map(a=>a.id),M=(l.length>0||O.includes(null==(b=null==(v=null==x?void 0:x.target)?void 0:v.source)?void 0:b.id))&&(null==I?void 0:I.renderAnnotation)&&!I.open,P=(null==I?void 0:I.renderAbout)&&E||M,z=null==I?void 0:I.renderToggle;return w.createElement(tr,{className:"clover-viewer-content","data-testid":"clover-viewer-content"},w.createElement(tl,{"data-aside-active":P,"data-aside-toggle":z},w.createElement(oc,{activeCanvas:a,annotationResources:l,contentSearchResource:u,isMedia:m,painting:g}),k[1].length>1&&w.createElement(ta,{className:"clover-viewer-media-wrapper"},w.createElement(xl,{items:h,activeItem:0}))),P&&w.createElement(ts,{"data-aside-active":P,"data-aside-toggle":z},w.createElement(Ko,{activeCanvas:a,annotationResources:l,searchServiceUrl:o,setContentSearchResource:s,contentSearchResource:u})))},i5=e6(be.Trigger,{width:"30px",padding:"5px"}),i6=e6(be.Content,{display:"flex",flexDirection:"column",fontSize:"0.8333rem",border:"none",boxShadow:"2px 2px 5px #0003",zIndex:"2",button:{display:"flex",textDecoration:"none",marginBottom:"0.5em",color:"$accentAlt",cursor:"pointer",background:"$secondary",border:"none","&:last-child":{marginBottom:"0"}}}),i8=e6("span",{fontSize:"1.33rem",alignSelf:"flex-start",flexGrow:"0",flexShrink:"1",padding:"1rem","@sm":{fontSize:"1rem"},"&.visually-hidden":{position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",border:"0"}}),i7=e6("header",{display:"flex",backgroundColor:"transparent !important",justifyContent:"space-between",alignItems:"flex-start",width:"100%",[`> ${iQ}`]:{flexGrow:"1",flexShrink:"0"},form:{flexGrow:"0",flexShrink:"1"}}),i9=e6("div",{display:"flex",alignItems:"flex-end",justifyContent:"flex-end",padding:"1rem",flexShrink:"0",flexGrow:"1"}),mc=()=>{var a;let l=X(),o=D(),{activeManifest:s,collection:u,configOptions:m,vault:h}=o,g=null==m?void 0:m.canvasHeight;return w.createElement("div",{style:{margin:"0.75rem"}},w.createElement(An,{label:u.label,maxHeight:g,value:s,onValueChange:a=>{l({type:"updateActiveCanvas",canvasId:void 0}),l({type:"updateActiveManifest",manifestId:a}),l({type:"updateViewerId",viewerId:(0,C.Z)()})}},null==(a=null==u?void 0:u.items)?void 0:a.map(a=>w.createElement(Rn,{value:a.id,key:a.id,thumbnail:null!=a&&a.thumbnail?h.get(null==a?void 0:a.thumbnail):void 0,label:a.label}))))},fc=(a,l=2500)=>{let{t:o}=(0,b.$G)(),[s,u]=(0,w.useState)(""),m=(0,w.useCallback)(()=>{navigator.clipboard.writeText(a).then(()=>u(o("copySuccess")),()=>u(o("copyFailure")))},[a]);return(0,w.useEffect)(()=>{if(!s)return;let a=setTimeout(()=>u(""),l);return()=>clearTimeout(a)},[s]),[s,m]},ne=e6("span",{display:"flex",alignContent:"center",alignItems:"center",padding:"0.125rem 0.25rem 0",marginTop:"-0.125rem",marginLeft:"0.5rem",backgroundColor:"$accent",color:"$secondary",borderRadius:"3px",lineHeight:"1em"}),pc=({status:a})=>a?w.createElement(ne,{"data-copy-status":a},a):null,Wt=({textPrompt:a,textToCopy:l})=>{let[o,s]=fc(l);return w.createElement("button",{onClick:s},a," ",w.createElement(pc,{status:o}))},gc=({title:a})=>{let l="#ed1d33",o="#2873ab";return w.createElement("svg",{viewBox:"0 0 493.35999 441.33334",id:"iiif-logo",version:"1.1"},w.createElement("title",null,a),w.createElement("g",{transform:"matrix(1.3333333,0,0,-1.3333333,0,441.33333)"},w.createElement("g",{transform:"scale(0.1)"},w.createElement("path",{style:{fill:o},d:"M 65.2422,2178.75 775.242,1915 773.992,15 65.2422,276.25 v 1902.5"}),w.createElement("path",{style:{fill:o},d:"m 804.145,2640.09 c 81.441,-240.91 -26.473,-436.2 -241.04,-436.2 -214.558,0 -454.511,195.29 -535.9527,436.2 -81.4335,240.89 26.4805,436.18 241.0387,436.18 214.567,0 454.512,-195.29 535.954,-436.18"}),w.createElement("path",{style:{fill:l},d:"M 1678.58,2178.75 968.578,1915 969.828,15 1678.58,276.25 v 1902.5"}),w.createElement("path",{style:{fill:l},d:"m 935.082,2640.09 c -81.437,-240.91 26.477,-436.2 241.038,-436.2 214.56,0 454.51,195.29 535.96,436.2 81.43,240.89 -26.48,436.18 -241.04,436.18 -214.57,0 -454.52,-195.29 -535.958,-436.18"}),w.createElement("path",{style:{fill:o},d:"m 1860.24,2178.75 710,-263.75 -1.25,-1900 -708.75,261.25 v 1902.5"}),w.createElement("path",{style:{fill:o},d:"m 2603.74,2640.09 c 81.45,-240.91 -26.47,-436.2 -241.03,-436.2 -214.58,0 -454.52,195.29 -535.96,436.2 -81.44,240.89 26.48,436.18 241.03,436.18 214.57,0 454.51,-195.29 535.96,-436.18"}),w.createElement("path",{style:{fill:l},d:"m 3700.24,3310 v -652.5 c 0,0 -230,90 -257.5,-142.5 -2.5,-247.5 0,-336.25 0,-336.25 l 257.5,83.75 V 1690 l -258.61,-92.5 V 262.5 L 2735.24,0 v 2360 c 0,0 -15,850 965,950"}))))},nt=e6(G.fC,{all:"unset",height:"2rem",width:"3.236rem",backgroundColor:"#6663",borderRadius:"9999px",position:"relative",WebkitTapHighlightColor:"transparent",cursor:"pointer","&:focus":{boxShadow:"0 0 0 2px $secondaryAlt"},'&[data-state="checked"]':{backgroundColor:"$accent",boxShadow:"inset 2px 2px 5px #0003"}}),ni=e6(G.bU,{display:"block",height:"calc(2rem - 12px)",width:"calc(2rem - 12px)",backgroundColor:"$secondary",borderRadius:"100%",boxShadow:"2px 2px 5px #0001",transition:"$all",transform:"translateX(6px)",willChange:"transform",span:{fontFamily:"monospace",fontSize:"0.8333rem",fontWeight:"700",display:"flex",height:"100%",width:"100%",alignItems:"center",justifyContent:"center",color:"$primary",opacity:"0.382",userSelect:"none",pointerEvents:"none"},'&[data-state="checked"]':{transform:"translateX(calc(1.236rem + 6px))",span:{opacity:"1",color:"$accent"}}});e6("label",{fontSize:"0.8333rem",fontWeight:"400",lineHeight:"1em",userSelect:"none",cursor:"pointer",paddingRight:"0.618rem"});let nn=e6("form",{display:"flex",flexShrink:"0",flexGrow:"1",alignItems:"center",marginLeft:"1.618rem"}),na=w.memo(()=>{let{isInformationOpen:a}=D(),l=X(),{t:o}=(0,b.$G)();return w.createElement(nn,null,w.createElement(nt,{checked:a,onCheckedChange:a=>{l({type:"updateInformationOpen",isInformationOpen:a})},id:"information-toggle","aria-label":o("informationPanelToggle"),name:"toggled?"},w.createElement(ni,null,w.createElement("span",null,"i"))))}),nr=e6(be.Trigger,{width:"30px",padding:"5px",marginBottom:"auto"}),nl=e6(i6,{h3:{color:"$primaryAlt",fontSize:"$2",fontWeight:"700",margin:"$2 0"},button:{},"& ul li":{marginBottom:"$1"}});function Ut(a,l){let o=[];if(!a)return o;for(let s of a)if(s.id){let a=l.get(s.id);a&&o.push(a)}return o}function qt(a,l){return a.map(({format:a,id:o,label:s})=>{let u=function(a){let{vault:l}=D();try{let o=a&&l.get(a);if(!o)throw Error(`Vault entity ${a} not found.`);return(null==o?void 0:o["@id"])||(null==o?void 0:o.id)}catch(l){return console.error(l),a}}(o);return{format:a,id:u,label:Z(s)||l}})}let Rc=()=>{let{allPages:a,individualPages:l}=function(){let a=function(){let{activeCanvas:a,activeManifest:l,vault:o}=D(),[s,u]=(0,w.useState)({root:[],canvas:[]});return(0,w.useEffect)(()=>{let s=o.get(l),m=o.get(a),h=null==s?void 0:s.rendering,g=null==m?void 0:m.rendering,v=Ut(h,o),b=Ut(g,o);u({root:v,canvas:b})},[a,l,o]),{...s}}(),l=qt((null==a?void 0:a.root)||[],"Root Rendering Label"),o=qt((null==a?void 0:a.canvas)||[],"Canvas Rendering Label");return{allPages:l,individualPages:o}}(),o=a.length>0||l.length>0,n=a=>{window.open(a,"_blank")};return o?w.createElement(be,null,w.createElement(nr,{"data-testid":"download-button"},w.createElement(j,null,w.createElement(j.Download,null))),w.createElement(nl,{"data-testid":"download-content"},l.length>0&&w.createElement(w.Fragment,null,w.createElement("h3",null,"Individual Pages"),w.createElement("ul",null,l.map(({format:a,id:l,label:o})=>w.createElement("li",{key:o},w.createElement("button",{onClick:()=>n(l)},o," (",a,")"))))),a.length>0&&w.createElement(w.Fragment,null,w.createElement("h3",null,"All Pages"),w.createElement("ul",null,a.map(({format:a,id:l,label:o})=>w.createElement("li",{key:o},w.createElement("button",{onClick:()=>n(l)},o," (",a,")"))))))):null},Tc=({manifestId:a,manifestLabel:l})=>{let o=D(),{collection:s,configOptions:u}=o,{informationPanel:m,showDownload:h,showIIIFBadge:g,showTitle:v}=u,x=h||g||(null==m?void 0:m.renderToggle),{t:E}=(0,b.$G)();return w.createElement(i7,{className:"clover-viewer-header"},null!=s&&s.items?w.createElement(mc,null):w.createElement(i8,{className:v?"":"visually-hidden"},v&&w.createElement(ce,{label:l,className:"label"})),x&&w.createElement(i9,null,h&&w.createElement(Rc,null),g&&w.createElement(be,null,w.createElement(i5,null,w.createElement(gc,{title:E("commonShare")})),w.createElement(i6,null,(null==s?void 0:s.items)&&w.createElement("button",{onClick:a=>{a.preventDefault(),window.open(s.id,"_blank")}},E("shareCollectionJson")),w.createElement("button",{onClick:l=>{l.preventDefault(),window.open(a,"_blank")}},E("shareManifestJson"))," ",(null==s?void 0:s.items)&&w.createElement(Wt,{textPrompt:E("shareCollectionCopy"),textToCopy:s.id}),w.createElement(Wt,{textPrompt:E("shareManifestCopy"),textToCopy:a}))),(null==m?void 0:m.renderToggle)&&w.createElement(na,null)))},kc=a=>{let t=()=>!!window.matchMedia&&window.matchMedia(a).matches,[l,o]=(0,w.useState)(t);return(0,w.useEffect)(()=>{let i=()=>o(t);return window.addEventListener("resize",i),()=>window.removeEventListener("resize",i)}),l},$c=({manifest:a,theme:l,iiifContentSearchQuery:o})=>{var s;let u=D(),m=X(),{activeCanvas:h,isInformationOpen:g,vault:v,configOptions:b,visibleCanvases:x}=u,E=(null==b?void 0:b.canvasHeight)&&["100%","auto"].includes(null==b?void 0:b.canvasHeight),[C,k]=(0,w.useState)(!1),[M,P]=(0,w.useState)([]),[z,F]=(0,w.useState)([]),[L,_]=(0,w.useState)(),H=kc(e5.sm),[V,N]=(0,w.useState)(),q=(0,w.useCallback)(a=>{m({type:"updateInformationOpen",isInformationOpen:a})},[m]);(0,w.useEffect)(()=>{var a;null!=(a=null==b?void 0:b.informationPanel)&&a.open&&q(!H)},[H,null==(s=null==b?void 0:b.informationPanel)?void 0:s.open]),(0,w.useEffect)(()=>{},[H]),(0,w.useEffect)(()=>{let l=me(v,h);l&&(k(["Sound","Video"].indexOf(l[0].type)>-1),P(l));let o=(0,A.sA)(v,a,h);m({type:"updateVisibleCanvases",visibleCanvases:o})},[h,H,a,v,m]),(0,w.useEffect)(()=>{(async()=>{let a=await Promise.all(x.map(a=>za(v,a.id)));F(a.flat())})()},[x]);let U=a.service.some(a=>["SearchService1","SearchService2"].includes(a.type||a["@type"]));return(0,w.useEffect)(()=>{if(U){let l=a.service.find(a=>["SearchService1","SearchService2"].includes(a.type||a["@type"]));l&&N(l.id||l["@id"])}},[a,U]),(0,w.useEffect)(()=>{var a;V&&(null==(a=b.informationPanel)?void 0:a.renderContentSearch)!==!1&&$r(v,V,o).then(a=>_(a))},[V]),w.createElement(O.ErrorBoundary,{FallbackComponent:yt},w.createElement(tc,{className:`${l} clover-viewer`,css:{background:null==b?void 0:b.background},"data-absolute-position":E,"data-information-panel-open":g},w.createElement(I.fC,{open:g,onOpenChange:q},w.createElement(Tc,{manifestLabel:a.label,manifestId:a.id}),w.createElement(sc,{activeCanvas:h,painting:M,annotationResources:z,searchServiceUrl:V,setContentSearchResource:_,contentSearchResource:L,items:a.items,isAudioVideo:C}))))},no={ignoreCache:!1,headers:{Accept:"application/json, text/javascript, text/plain"},timeout:5e3,withCredentials:!1};function Gt(a,l=null){return{ok:!1,status:a.status,statusText:a.statusText,headers:a.getAllResponseHeaders(),data:l||a.statusText,json:()=>JSON.parse(l||a.statusText)}}let ns={"@context":"http://iiif.io/api/presentation/3/context.json",id:"https://example.org/iiif/content-state/specific-resource",type:"Annotation",motivation:["contentState"],target:{type:"SpecificResource",source:{id:"https://example.org/iiif/manifest/canvas/0",type:"Canvas",partOf:[{id:"https://example.org/iiif/manifest",type:"Manifest"}]}},body:[]},Xc=({canvasIdCallback:a,contentStateCallback:l,customDisplays:o=[],plugins:s=[],customTheme:u,iiifContent:m,id:h,manifestId:g,options:v,iiifContentSearchQuery:b})=>{var x,E,C;let k=m;h&&(k=h),g&&(k=g);let A=Rr(null==(E=null==(x=null==v?void 0:v.informationPanel)?void 0:x.vtt)?void 0:E.autoScroll);return w.createElement(_a,{initialState:{...e2,customDisplays:o,plugins:s,isAutoScrollEnabled:A.enabled,isInformationOpen:!!(null!=(C=null==v?void 0:v.informationPanel)&&C.open),vault:new eK({customFetcher:a=>(function(a,l=no){let o=l.headers||no.headers;return new Promise((s,u)=>{let m=new XMLHttpRequest;m.open("get",a),m.withCredentials=l.withCredentials,o&&Object.keys(o).forEach(a=>m.setRequestHeader(a,o[a])),m.onload=()=>{s({ok:m.status>=200&&m.status<300,status:m.status,statusText:m.statusText,headers:m.getAllResponseHeaders(),data:m.responseText,json:()=>JSON.parse(m.responseText)})},m.onerror=()=>{u(Gt(m,"Failed to make request."))},m.ontimeout=()=>{u(Gt(m,"Request took longer than expected."))},m.send()})})(a,{withCredentials:null==v?void 0:v.withCredentials,headers:null==v?void 0:v.requestHeaders}).then(a=>JSON.parse(a.data))})}},w.createElement(Pc,{iiifContent:k,canvasIdCallback:a,contentStateCallback:l,customTheme:u,options:v,iiifContentSearchQuery:b}))},Pc=({canvasIdCallback:a,contentStateCallback:l,customTheme:o,iiifContent:s,options:u,iiifContentSearchQuery:m})=>{let h=X(),g=D(),{activeCanvas:v,activeManifest:b,activeSelector:x,isLoaded:E,vault:C,visibleCanvases:I}=g,[O,P]=(0,w.useState)(),[z,F]=(0,w.useState)(),L={};if(o&&(L=(0,M.jG)("custom",o)),(0,w.useEffect)(()=>{h({type:"updateActiveSelector",selector:void 0})},[v,b]),(0,w.useEffect)(()=>{var o;if(a&&a(v),l&&b&&v){let a=(null==(o=I[0])?void 0:o.id)||v,s=`${b}/state/${Ir(a+JSON.stringify(x))}`,u={...ns,id:s,target:{type:"SpecificResource",source:{id:a,type:"Canvas",partOf:[{id:b,type:"Manifest"}]},selector:x}};l({json:u,encoded:(0,k.ML)(JSON.stringify(u))})}},[v,b,x,a,l,I]),(0,w.useEffect)(()=>{b&&C.load(b).then(a=>{if(!a)return;F(a);let l=(0,A.rw)(C,a),o=v||Pl(a);h({type:"updateActiveCanvas",canvasId:o}),h({type:"updateManifestSequence",sequence:l})}).catch(a=>{console.error(`Manifest failed to load: ${a}`)}).finally(()=>{h({type:"updateIsLoaded",isLoaded:!0})})},[s,b,h,C]),(0,w.useEffect)(()=>{h({type:"updateConfigOptions",configOptions:u}),(async()=>{var a;if(!s)return;let l=Ol(s);try{let a=await C.load(l);P(a)}catch(o){if(l&&l.id||console.error(`Failed to load resource: ${o}`),null!=l&&l.id&&(null==l?void 0:l.type)==="Annotation"&&null!=(a=null==l?void 0:l.motivation)&&a.includes("contentState")){let a=await C.loadSync(l.id,l);a&&P(a)}else null!=l&&l.id&&["Canvas","Manifest"].includes(null==l?void 0:l.type)&&await C.loadSync(l.id,l)&&P({...ns,target:l})}})()},[h,s,u,C]),(0,w.useEffect)(()=>{if(O)switch(O.type){case"Annotation":if(null!=O&&O.motivation&&(Array.isArray(null==O?void 0:O.motivation)?null!=O&&O.motivation.includes("contentState"):(null==O?void 0:O.motivation)==="content-state")){let{active:a}=kn(O);h({type:"updateActiveManifest",manifestId:a.manifest}),h({type:"updateActiveCanvas",canvasId:a.canvas}),h({type:"updateContentStateAnnotation",contentStateAnnotation:O})}break;case"Collection":let a=Fl(O);h({type:"updateCollection",collection:O}),a&&h({type:"updateActiveManifest",manifestId:a});break;case"Manifest":h({type:"updateActiveManifest",manifestId:O.id})}},[h,s,O]),!E){if(null==u||!u.customLoadingComponent)return w.createElement(w.Fragment,null,"Loading");{let a=u.customLoadingComponent;return w.createElement(a,null)}}return z&&z.items?0===z.items.length?(console.log(`The IIIF manifest ${s} does not contain canvases.`),w.createElement(w.Fragment,null)):w.createElement($c,{manifest:z,theme:L,key:z.id,iiifContentSearchQuery:m}):(console.log(`The IIIF manifest ${s} failed to load.`),w.createElement(w.Fragment,null))}}}]);