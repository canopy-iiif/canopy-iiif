(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[645],{7255:function(e,t,r){"use strict";r.d(t,{F:function(){return n},e:function(){return a}});var i=r(7294);function n(...e){return t=>e.forEach(e=>{var r;"function"==typeof(r=e)?r(t):null!=r&&(r.current=t)})}function a(...e){return(0,i.useCallback)(n(...e),e)}},192:function(e,t,r){"use strict";r.d(t,{WV:function(){return s},jH:function(){return l}});var i=r(7462),n=r(7294),a=r(3935),o=r(8820);let s=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"].reduce((e,t)=>{let r=(0,n.forwardRef)((e,r)=>{let{asChild:a,...s}=e,l=a?o.g7:t;return(0,n.useEffect)(()=>{window[Symbol.for("radix-ui")]=!0},[]),(0,n.createElement)(l,(0,i.Z)({},s,{ref:r}))});return r.displayName=`Primitive.${t}`,{...e,[t]:r}},{});function l(e,t){e&&(0,a.flushSync)(()=>e.dispatchEvent(t))}},8820:function(e,t,r){"use strict";r.d(t,{g7:function(){return o}});var i=r(7462),n=r(7294),a=r(7255);let o=(0,n.forwardRef)((e,t)=>{let{children:r,...a}=e,o=n.Children.toArray(r),l=o.find(c);if(l){let e=l.props.children,r=o.map(t=>t!==l?t:n.Children.count(e)>1?n.Children.only(null):(0,n.isValidElement)(e)?e.props.children:null);return(0,n.createElement)(s,(0,i.Z)({},a,{ref:t}),(0,n.isValidElement)(e)?(0,n.cloneElement)(e,void 0,r):null)}return(0,n.createElement)(s,(0,i.Z)({},a,{ref:t}),r)});o.displayName="Slot";let s=(0,n.forwardRef)((e,t)=>{let{children:r,...i}=e;return(0,n.isValidElement)(r)?(0,n.cloneElement)(r,{...function(e,t){let r={...t};for(let i in t){let n=e[i],a=t[i],o=/^on[A-Z]/.test(i);o?n&&a?r[i]=(...e)=>{a(...e),n(...e)}:n&&(r[i]=n):"style"===i?r[i]={...n,...a}:"className"===i&&(r[i]=[n,a].filter(Boolean).join(" "))}return{...e,...r}}(i,r.props),ref:(0,a.F)(t,r.ref)}):n.Children.count(r)>1?n.Children.only(null):null});s.displayName="SlotClone";let l=({children:e})=>(0,n.createElement)(n.Fragment,null,e);function c(e){return(0,n.isValidElement)(e)&&e.type===l}},5800:function(e,t,r){!function(e,t){"use strict";var r=function(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach(function(r){if("default"!==r){var i=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:function(){return e[r]}})}}),t.default=e,Object.freeze(t)}(t);function i(e,t){return(i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var n={error:null},a=function(e){function t(){for(var t,r=arguments.length,i=Array(r),a=0;a<r;a++)i[a]=arguments[a];return(t=e.call.apply(e,[this].concat(i))||this).state=n,t.resetErrorBoundary=function(){for(var e,r=arguments.length,i=Array(r),n=0;n<r;n++)i[n]=arguments[n];null==t.props.onReset||(e=t.props).onReset.apply(e,i),t.reset()},t}(a=t).prototype=Object.create(e.prototype),a.prototype.constructor=a,i(a,e),t.getDerivedStateFromError=function(e){return{error:e}};var a,o=t.prototype;return o.reset=function(){this.setState(n)},o.componentDidCatch=function(e,t){var r,i;null==(r=(i=this.props).onError)||r.call(i,e,t)},o.componentDidUpdate=function(e,t){var r,i,n,a,o=this.state.error,s=this.props.resetKeys;null!==o&&null!==t.error&&(void 0===(r=e.resetKeys)&&(r=[]),void 0===(i=s)&&(i=[]),r.length!==i.length||r.some(function(e,t){return!Object.is(e,i[t])}))&&(null==(n=(a=this.props).onResetKeysChange)||n.call(a,e.resetKeys,s),this.reset())},o.render=function(){var e=this.state.error,t=this.props,i=t.fallbackRender,n=t.FallbackComponent,a=t.fallback;if(null!==e){var o={error:e,resetErrorBoundary:this.resetErrorBoundary};if(r.isValidElement(a))return a;if("function"==typeof i)return i(o);if(n)return r.createElement(n,o);throw Error("react-error-boundary requires either a fallback, fallbackRender, or FallbackComponent prop")}return this.props.children},t}(r.Component);e.ErrorBoundary=a,e.useErrorHandler=function(e){var t=r.useState(null),i=t[0],n=t[1];if(null!=e)throw e;if(null!=i)throw i;return n},e.withErrorBoundary=function(e,t){var i=function(i){return r.createElement(a,t,r.createElement(e,i))},n=e.displayName||e.name||"Unknown";return i.displayName="withErrorBoundary("+n+")",i},Object.defineProperty(e,"__esModule",{value:!0})}(t,r(7294))},1757:function(e,t){!function(e){"use strict";function t(e){return null==e}function r(e){throw Error("Argument "+e+" is empty.")}function i(e){return"function"==typeof e&&"getType"in e}function n(e){throw Error("Argument "+e+' is invalid, it should be an action-creator instance from "typesafe-actions"')}function a(e,t){if(null==e)throw Error("Argument contains array with empty element at index "+t);if(null==e.getType)throw Error("Argument contains array with invalid element at index "+t+', it should be an action-creator instance from "typesafe-actions"')}function o(e){return"string"==typeof e||"symbol"==typeof e}function s(e){throw Error("Argument "+e+" is invalid, it should be an action type of type: string | symbol")}function l(e,t){if(null==e)throw Error("Argument contains array with empty element at index "+t);if("string"!=typeof e&&"symbol"!=typeof e)throw Error("Argument contains array with invalid element at index "+t+", it should be of type: string | symbol")}function c(e,i,a,s){return t(e)&&r(1),o(e)||n(1),{type:e,payload:i,meta:a,error:s}}function u(e,i){return t(e)&&r(1),o(e)||s(1),Object.assign(function(){var t=null!=i?i.apply(void 0,arguments):void 0;return Object.assign({type:e},t)},{getType:function(){return e},toString:function(){return e}})}function p(e,i,n){return t(e)&&r(1),o(e)||s(1),function(){return u(e,function(){var e=arguments.length<=0?void 0:arguments[0],t=arguments.length<=1?void 0:arguments[1];return null==i&&null==n||(e=null!=i?i.apply(void 0,arguments):void 0,t=null!=n?n.apply(void 0,arguments):void 0),Object.assign({},void 0!==e&&{payload:e},{},void 0!==t&&{meta:t})})}}function f(e){return t(e)&&r(1),i(e)||n(1),e.getType()}function h(e,i){return t(e)&&r(1),o(e)||s(1),Object.assign(null!=i?i(e):function(){return{type:e}},{getType:function(){return e},toString:function(){return e}})}e.action=c,e.createAction=p,e.createAsyncAction=function(e,t,r,i){return function(){var n=[e,t,r,i].map(function(e,t){return Array.isArray(e)?p(e[0],e[1],e[2])():"string"==typeof e||"symbol"==typeof e?p(e)():void(t<3&&function(e){throw Error("Argument "+e+' is invalid, it should be an action type of "string | symbol" or a tuple of "[string | symbol, Function, Function?]"')}(t))});return{request:n[0],success:n[1],failure:n[2],cancel:n[3]}}},e.createCustomAction=u,e.createReducer=function e(t,r){void 0===r&&(r={});var n=Object.assign({},r),a=function(r,a){var s=Array.isArray(r)?r:[r],l={};return s.map(function(e,t){return i(e)?f(e):o(e)?e:function(e){throw Error("Argument "+e+' is invalid, it should be an action-creator instance from "typesafe-actions" or action type of type: string | symbol')}(t+1)}).forEach(function(e){return l[e]=a}),e(t,Object.assign({},n,{},l))};return Object.assign(function(e,r){if(void 0===e&&(e=t),n.hasOwnProperty(r.type)){var i=n[r.type];if("function"!=typeof i)throw Error('Reducer under "'+r.type+'" key is not a valid reducer');return i(e,r)}return e},{handlers:Object.assign({},n),handleAction:a,handleType:a})},e.deprecated={createAction:function(e,t){return Object.assign(null==t?function(){return c(e)}:t(c.bind(null,e)),{getType:function(){return e},toString:function(){return e}})},createCustomAction:h,createStandardAction:function(e){return t(e)&&r(1),o(e)||s(1),Object.assign(function(){return h(e,function(e){return function(t,r){return{type:e,payload:t,meta:r}}})},{map:function(t){return h(e,function(e){return function(r,i){return Object.assign(t(r,i),{type:e})}})}})}},e.getType=f,e.isActionOf=function(e,i){t(e)&&r(1);var n=Array.isArray(e)?e:[e];n.forEach(a);var o=function(e){return n.some(function(t){return e.type===t.getType()})};return void 0===i?o:o(i)},e.isOfType=function(e,i){t(e)&&r(1);var n=Array.isArray(e)?e:[e];n.forEach(l);var a=function(e){return n.includes(e.type)};return void 0===i?a:a(i)}}(t)},7462:function(e,t,r){"use strict";function i(){return(i=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}r.d(t,{Z:function(){return i}})},3654:function(e,t,r){"use strict";r.d(t,{j:function(){return tg}});var i=Object.defineProperty,n=(e,t,r)=>t in e?i(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,a=(e,t,r)=>(n(e,"symbol"!=typeof t?t+"":t,r),r);let o=[];Object.freeze(o);let s={id:"https://iiif-parser/annotation-page",type:"AnnotationPage",behavior:o,motivation:null,label:null,thumbnail:o,summary:null,requiredStatement:null,metadata:o,rights:null,provider:o,items:o,seeAlso:o,homepage:o,logo:o,rendering:o,service:o},l={id:"https://iiif-parser/empty-canvas",type:"Canvas",label:null,behavior:o,motivation:null,thumbnail:o,posterCanvas:null,accompanyingCanvas:null,placeholderCanvas:null,summary:null,requiredStatement:null,metadata:o,rights:null,navDate:null,provider:o,items:o,annotations:o,seeAlso:o,homepage:o,logo:o,partOf:o,rendering:o,service:o,duration:0,height:0,width:0},c={id:"https://iiif-parser/empty-collection",type:"Collection",label:null,viewingDirection:"left-to-right",behavior:o,motivation:null,thumbnail:o,posterCanvas:null,accompanyingCanvas:null,placeholderCanvas:null,summary:null,requiredStatement:null,metadata:o,rights:null,navDate:null,provider:o,items:o,annotations:o,seeAlso:o,homepage:o,logo:o,partOf:o,rendering:o,service:o,services:o},u={id:"https://iiif-parser/empty-manifest",type:"Manifest",annotations:o,behavior:o,homepage:o,items:o,label:null,logo:o,metadata:o,motivation:null,navDate:null,provider:o,partOf:o,posterCanvas:null,accompanyingCanvas:null,placeholderCanvas:null,rendering:o,requiredStatement:null,rights:null,seeAlso:o,service:o,services:o,start:null,structures:o,summary:null,thumbnail:o,viewingDirection:"left-to-right"},p={id:"https://iiif-parser/empty-canvas",type:"Range",label:null,behavior:o,motivation:null,thumbnail:o,posterCanvas:null,accompanyingCanvas:null,placeholderCanvas:null,summary:null,requiredStatement:null,metadata:o,rights:null,navDate:null,provider:o,items:o,annotations:o,seeAlso:o,homepage:o,logo:o,partOf:o,rendering:o,service:o,start:null,supplementary:null,viewingDirection:"left-to-right"},f={id:"https://iiif-parser/empty-agent",type:"Agent",label:{},logo:o,seeAlso:o,homepage:o};function h(e){return Array.isArray(e)?e:[e]}let v=["Collection","Manifest","Canvas","AnnotationPage","AnnotationCollection","Annotation","ContentResource","Range","Service","Selector","Agent"];class d{constructor(e,t={}){a(this,"traversals"),a(this,"options"),this.traversals={collection:[],manifest:[],canvas:[],annotationCollection:[],annotationPage:[],annotation:[],contentResource:[],choice:[],range:[],service:[],agent:[],...e},this.options={allowUndefinedReturn:!1,...t}}static all(e){return new d({collection:[e],manifest:[e],canvas:[e],annotationCollection:[e],annotationPage:[e],annotation:[e],contentResource:[e],choice:[e],range:[e],service:[e]})}traverseDescriptive(e){return e.thumbnail&&(e.thumbnail=e.thumbnail.map(e=>this.traverseType(e,this.traversals.contentResource))),e.provider&&(e.provider=e.provider.map(e=>this.traverseAgent(e))),e}traverseLinking(e){return e.seeAlso&&(e.seeAlso=e.seeAlso.map(e=>this.traverseType(e,this.traversals.contentResource))),e.service&&(e.service=h(e.service).map(e=>this.traverseType(e,this.traversals.service))),e.services&&(e.services=e.services.map(e=>this.traverseType(e,this.traversals.service))),e.logo&&(e.logo=e.logo.map(e=>this.traverseType(e,this.traversals.contentResource))),e.homepage&&(e.homepage=e.homepage.map(e=>this.traverseType(e,this.traversals.contentResource))),e.partOf&&(e.partOf=e.partOf.map(e=>"string"!=typeof e&&e.type?"Canvas"===e.type?this.traverseType(e,this.traversals.canvas):"AnnotationCollection"===e.type?this.traverseType(e,this.traversals.annotationCollection):"Collection"===e.type?this.traverseType(e,this.traversals.collection):this.traverseType(e,this.traversals.contentResource):this.traverseType(e,this.traversals.contentResource))),e.start&&(e.start=e.start?this.traverseType(e.start,this.traversals.canvas):null),e.rendering&&(e.rendering=e.rendering.map(e=>this.traverseType(e,this.traversals.contentResource))),e.supplementary&&(e.supplementary=e.supplementary.map(e=>this.traverseType(e,this.traversals.contentResource))),e}traverseCollectionItems(e){return e.items&&e.items.map(e=>"Collection"===e.type?this.traverseCollection(e):this.traverseManifest(e)),e}traverseCollection(e){return this.traverseType(this.traverseDescriptive(this.traverseInlineAnnotationPages(this.traverseLinking(this.traversePosterCanvas(this.traverseCollectionItems(e))))),this.traversals.collection)}traverseManifestItems(e){return e.items&&(e.items=e.items.map(e=>this.traverseCanvas(e))),e}traverseManifestStructures(e){return e.structures&&(e.structures=e.structures.map(e=>this.traverseRange(e))),e}traverseManifest(e){return this.traverseType(this.traverseInlineAnnotationPages(this.traverseManifestStructures(this.traversePosterCanvas(this.traverseDescriptive(this.traverseLinking(this.traverseManifestItems(e)))))),this.traversals.manifest)}traverseCanvasItems(e){return e.items=(e.items||[]).map(e=>this.traverseAnnotationPage(e)),e}traverseInlineAnnotationPages(e){return"string"!=typeof e&&e&&e.annotations&&(e.annotations=e.annotations.map(e=>this.traverseAnnotationPage(e))),e}traverseCanvas(e){return this.traverseType(this.traverseInlineAnnotationPages(this.traversePosterCanvas(this.traverseDescriptive(this.traverseLinking(this.traverseCanvasItems(e))))),this.traversals.canvas)}traverseAnnotationPageItems(e){return e.items&&(e.items=e.items.map(e=>this.traverseAnnotation(e))),e}traverseAnnotationPage(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseAnnotationPageItems(e))),this.traversals.annotationPage)}traverseAnnotationBody(e){return Array.isArray(e.body)?e.body=e.body.map(e=>this.traverseContentResource(e)):e.body&&(e.body=this.traverseContentResource(e.body)),e}traversePosterCanvas(e){return e.posterCanvas&&(e.posterCanvas=this.traverseCanvas(e.posterCanvas)),e.placeholderCanvas&&(e.placeholderCanvas=this.traverseCanvas(e.placeholderCanvas)),e.accompanyingCanvas&&(e.accompanyingCanvas=this.traverseCanvas(e.accompanyingCanvas)),e}traverseAnnotation(e){return this.traverseType(this.traverseLinking(this.traverseAnnotationBody(e)),this.traversals.annotation)}traverseContentResourceLinking(e){return"string"!=typeof e&&e&&e&&e.service&&(e.service=h(e.service||[]).map(e=>this.traverseType(e,this.traversals.service))),e}traverseContentResource(e){return"Choice"===e.type&&(e.items=e.items.map(e=>this.traverseContentResource(e))),this.traverseType(this.traverseInlineAnnotationPages(this.traverseContentResourceLinking(e)),this.traversals.contentResource)}traverseRangeRanges(e){return e.items&&(e.items=e.items.map(e=>"string"==typeof e?this.traverseCanvas({id:e,type:"Canvas"}):"Manifest"===e.type?this.traverseManifest(e):this.traverseRange(e))),e}traverseRange(e){return this.traverseType(this.traversePosterCanvas(this.traverseDescriptive(this.traverseLinking(this.traverseRangeRanges(e)))),this.traversals.range)}traverseAgent(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(e)),this.traversals.agent)}traverseType(e,t){return t.reduce((e,t)=>{let r=t(e);return void 0!==r||this.options.allowUndefinedReturn?r:e},e)}traverseService(e){return this.traverseType(e,this.traversals.service)}traverseUnknown(e){let t=function(e){if(null==e)throw Error("Null or undefined is not a valid entity.");if(Array.isArray(e))throw Error("Array is not a valid entity");if("object"!=typeof e)throw Error(`${typeof e} is not a valid entity`);if("string"==typeof e.type){let t=v.indexOf(e.type);if(-1!==t)return v[t]}if(e.profile)return"Service";throw Error("Resource type is not known")}(e);switch(t){case"Collection":return this.traverseCollection(e);case"Manifest":return this.traverseManifest(e);case"Canvas":return this.traverseCanvas(e);case"AnnotationPage":return this.traverseAnnotationPage(e);case"Annotation":return this.traverseAnnotation(e);case"ContentResource":return this.traverseContentResource(e);case"Range":return this.traverseRange(e);case"Service":return this.traverseService(e);case"Agent":return this.traverseAgent(e);default:throw Error(`Unknown or unsupported resource type of ${t}`)}}}let y=["sc:Collection","sc:Manifest","sc:Canvas","sc:AnnotationList","oa:Annotation","sc:Range","sc:Layer","sc:Sequence","oa:Choice","Service","ContentResource"];class m{constructor(e,t={}){a(this,"traversals"),a(this,"options"),this.traversals={collection:[],manifest:[],canvas:[],annotationList:[],sequence:[],annotation:[],contentResource:[],choice:[],range:[],service:[],layer:[],...e},this.options={convertPropsToArray:!0,mergeMemberProperties:!0,allowUndefinedReturn:!1,...t}}static all(e){return new m({collection:[e],manifest:[e],canvas:[e],annotationList:[e],sequence:[e],annotation:[e],contentResource:[e],choice:[e],range:[e],service:[e],layer:[e]})}traverseCollection(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseCollectionItems(e))),this.traversals.collection)}traverseCollectionItems(e){if(this.options.mergeMemberProperties){let t=[...(e.manifests||[]).map(e=>"string"==typeof e?{"@id":e,"@type":"sc:Manifest"}:e),...(e.collections||[]).map(e=>"string"==typeof e?{"@id":e,"@type":"sc:Collection"}:e),...e.members||[]];delete e.collections,delete e.manifests,e.members=t}return e.manifests&&(e.manifests=e.manifests.map(e=>this.traverseManifest("string"==typeof e?{"@id":e,"@type":"sc:Manifest"}:e))),e.collections&&(e.collections=e.collections.map(e=>this.traverseCollection("string"==typeof e?{"@id":e,"@type":"sc:Collection"}:e))),e.members&&(e.members=e.members.map(e=>"string"==typeof e?e:this.traverseUnknown(e))),e}traverseManifest(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseManifestItems(e))),this.traversals.manifest)}traverseManifestItems(e){return e.sequences&&(e.sequences=e.sequences.map(e=>this.traverseSequence(e))),e.structures&&(e.structures=e.structures.map(e=>this.traverseRange(e))),e}traverseSequence(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseSequenceItems(e))),this.traversals.sequence)}traverseSequenceItems(e){return e.canvases&&(e.canvases=e.canvases.map(e=>this.traverseCanvas(e))),e}traverseCanvas(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseCanvasItems(e))),this.traversals.canvas)}traverseCanvasItems(e){return e.images&&(e.images=e.images.map(e=>this.traverseAnnotation(e))),e.otherContent&&(e.otherContent=e.otherContent.map(e=>this.traverseAnnotationList(e))),e}traverseRange(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseRangeItems(e))),this.traversals.range)}traverseRangeItems(e){if(this.options.mergeMemberProperties){let t=[...(e.ranges||[]).map(e=>"string"==typeof e?{"@id":e,"@type":"sc:Range"}:e),...(e.canvases||[]).map(e=>"string"==typeof e?{"@id":e,"@type":"sc:Canvas"}:e),...e.members||[]];delete e.ranges,delete e.canvases,e.members=t.length?t.map(e=>this.traverseUnknown(e)):void 0}return e}traverseAnnotationList(e){return this.traverseType(this.traverseDescriptive(this.traverseAnnotationListItems("string"==typeof e?{"@id":e,"@type":"sc:AnnotationList"}:e)),this.traversals.annotationList)}traverseAnnotationListItems(e){return e.resources&&(e.resources=e.resources.map(e=>this.traverseAnnotation(e))),e}traverseAnnotation(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseAnnotationItems(e))),this.traversals.annotation)}traverseAnnotationItems(e){return e.resource&&(Array.isArray(e.resource)?e.resource=e.resource.map(e=>this.traverseContentResource(e)):e.resource=this.traverseContentResource(e.resource)),e.on,e}traverseLayer(e){return this.traverseType(this.traverseLinking(this.traverseLayerItems(e)),this.traversals.layer)}traverseLayerItems(e){return e.otherContent&&(e.otherContent=e.otherContent.map(e=>this.traverseAnnotationList(e))),e}traverseChoice(e){return this.traverseType(this.traverseChoiceItems(e),this.traversals.choice)}traverseChoiceItems(e){return e.default&&"rdf:nil"!==e.default&&(e.default=this.traverseContentResource(e.default)),e.item&&"rdf:nil"!==e.item&&(e.item=e.item.map(e=>this.traverseContentResource(e))),e}traverseService(e){return this.traverseType(this.traverseLinking(e),this.traversals.service)}traverseContentResource(e){return"oa:Choice"===e["@type"]?this.traverseChoice(e):this.traverseType(this.traverseDescriptive(this.traverseLinking(e)),this.traversals.contentResource)}traverseUnknown(e){if(!e["@type"]||"string"==typeof e)return e;switch(function(e){if(null==e)throw Error("Null or undefined is not a valid entity.");if(Array.isArray(e))throw Error("Array is not a valid entity");if("object"!=typeof e)throw Error(`${typeof e} is not a valid entity`);if("string"==typeof e["@type"]){let t=y.indexOf(e["@type"]);if(-1!==t)return y[t]}if(e.profile)return"Service";if(e.format||e["@type"])return"ContentResource";throw Error("Resource type is not known")}(e)){case"sc:Collection":return this.traverseCollection(e);case"sc:Manifest":return this.traverseManifest(e);case"sc:Canvas":return this.traverseCanvas(e);case"sc:Sequence":return this.traverseSequence(e);case"sc:Range":return this.traverseRange(e);case"oa:Annotation":return this.traverseAnnotation(e);case"sc:AnnotationList":return this.traverseAnnotationList(e);case"sc:Layer":return this.traverseLayer(e);case"Service":return this.traverseService(e);case"oa:Choice":return this.traverseChoice(e);case"ContentResource":return this.traverseContentResource(e)}return e.profile?this.traverseService(e):e}traverseImageResource(e){let t=Array.isArray(e),r=Array.isArray(e)?e:[e],i=[];for(let e of r)"string"==typeof e?i.push(this.traverseContentResource({"@id":e,"@type":"dctypes:Image"})):i.push(this.traverseContentResource(e));return t||this.options.convertPropsToArray?i:i[0]}traverseDescriptive(e){return e.thumbnail&&(e.thumbnail=this.traverseImageResource(e.thumbnail)),e.logo&&(e.logo=this.traverseImageResource(e.logo)),e}traverseOneOrMoreServices(e){let t=Array.isArray(e),r=Array.isArray(e)?e:[e],i=[];for(let e of r)i.push(this.traverseService(e));return t||this.options.convertPropsToArray?i:i[0]}traverseLinking(e){return e.related&&(e.related=this.traverseOneOrManyType(e.related,this.traversals.contentResource)),e.rendering&&(e.rendering=this.traverseOneOrManyType(e.rendering,this.traversals.contentResource)),e.service&&(e.service=this.traverseOneOrMoreServices(e.service)),e.seeAlso&&(e.seeAlso=this.traverseOneOrManyType(e.seeAlso,this.traversals.contentResource)),e.within&&("string"==typeof e.within||(e.within=this.traverseOneOrManyType(e.within,this.traversals.contentResource))),e.startCanvas&&("string"==typeof e.startCanvas?e.startCanvas=this.traverseType({"@id":e.startCanvas,"@type":"sc:Canvas"},this.traversals.canvas):e.startCanvas&&this.traverseType(e.startCanvas,this.traversals.canvas)),e.contentLayer&&("string"==typeof e.contentLayer?e.contentLayer=this.traverseLayer({"@id":e.contentLayer,"@type":"sc:Layer"}):e.contentLayer=this.traverseLayer(e.contentLayer)),e}traverseOneOrManyType(e,t){if(!Array.isArray(e)){if(!this.options.convertPropsToArray)return this.traverseType(e,t);e=[e]}return e.map(e=>this.traverseType(e,t))}traverseType(e,t){return t.reduce((e,t)=>{let r=t(e);return void 0!==r||this.options.allowUndefinedReturn?r:e},e)}}let g="http://library.stanford.edu/iiif/image-api/compliance.html#level1",A="http://library.stanford.edu/iiif/image-api/compliance.html#level2",b="http://library.stanford.edu/iiif/image-api/conformance.html#level1",C="http://library.stanford.edu/iiif/image-api/conformance.html#level2",w="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1",E="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2",R="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level1",S="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level2",O="http://iiif.io/api/image/1/level1.json",j="http://iiif.io/api/image/1/profiles/level1.json",T="http://iiif.io/api/image/1/level2.json",I="http://iiif.io/api/image/1/profiles/level2.json",x="http://iiif.io/api/image/2/level1.json",P="http://iiif.io/api/image/2/profiles/level1.json",k="http://iiif.io/api/image/2/level2.json",L="http://iiif.io/api/image/2/profiles/level2.json",M="level1",D="level2",_="http://iiif.io/api/image/2/level1",U="http://iiif.io/api/image/2/level2",q=[_,U,g,A,b,C,w,E,R,S,O,j,T,I,x,P,k,L,M,D],N=["http://iiif.io/api/image/2/level0",_,U,"http://library.stanford.edu/iiif/image-api/compliance.html#level0",g,A,"http://library.stanford.edu/iiif/image-api/conformance.html#level0",b,C,"http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0",w,E,"http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level0",R,S,"http://iiif.io/api/image/1/level0.json","http://iiif.io/api/image/1/profiles/level0.json",O,j,T,I,"http://iiif.io/api/image/2/level0.json","http://iiif.io/api/image/2/profiles/level0.json",x,P,k,L,"level0",M,D],F={attributionLabel:"Attribution",lang:"none",providerId:"http://example.org/provider",providerName:"Unknown"};function $(e,t="none"){if(!e)return{};let r=Array.isArray(e)?e:[e],i={};for(let e of r){if("string"==typeof e){i[t]=i[t]?i[t]:[],i[t].push(e||"");continue}if(!e["@language"]){i[t]=i[t]?i[t]:[],i[t].push(e["@value"]||"");continue}let r=e["@language"];i[r]=i[r]?i[r]:[],i[r].push(e["@value"]||"")}return i}function B(e){for(let t of["sc","oa","dcterms","dctypes","iiif"])if(e.startsWith(`${t}:`))return e.slice(t.length+1);return e}let W=["Collection","Manifest","Annotation","AnnotationPage","Range","Service"];function V(e){let t=e["@id"]||e.id,r=e["@type"]||e.type,i=e.profile||void 0,n=e["@context"]||void 0;if(i){let e=function(e){switch(e){case"http://iiif.io/api/image/2/level0.json":case"http://iiif.io/api/image/2/level1.json":case"http://iiif.io/api/image/2/level2.json":return"ImageService2";case"http://iiif.io/api/auth/1/kiosk":case"http://iiif.io/api/auth/1/login":case"http://iiif.io/api/auth/1/clickthrough":case"http://iiif.io/api/auth/1/external":case"http://iiif.io/api/auth/0/kiosk":case"http://iiif.io/api/auth/0/login":case"http://iiif.io/api/auth/0/clickthrough":case"http://iiif.io/api/auth/0/external":return"AuthCookieService1";case"http://iiif.io/api/auth/1/token":case"http://iiif.io/api/auth/0/token":return"AuthTokenService1";case"http://iiif.io/api/auth/1/logout":case"http://iiif.io/api/auth/0/logout":return"AuthLogoutService1";case"http://iiif.io/api/search/1/search":case"http://iiif.io/api/search/0/search":return"SearchService1";case"http://iiif.io/api/search/1/autocomplete":case"http://iiif.io/api/search/0/autocomplete":return"AutoCompleteService1"}}(i);if(e)return e}if(n){let e=function(e){let t=Array.isArray(e)?e:[e];for(let e of t)switch(e){case"http://iiif.io/api/image/2/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2":return"ImageService2";case"http://iiif.io/api/image/1/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/context.json":return"ImageService1";case"http://iiif.io/api/annex/openannotation/context.json":return"ImageApiSelector"}}(n);if(e)return e}if(r){if(Array.isArray(r)){if(-1!==r.indexOf("oa:CssStylesheet"))return"CssStylesheet";if(-1!==r.indexOf("cnt:ContentAsText"))return"TextualBody";r=r[0]}for(let e of["sc","oa","dcterms","dctypes","iiif"])if(r.startsWith(`${e}:`)){r=r.slice(e.length+1);break}switch(r){case"Layer":return"AnnotationCollection";case"AnnotationList":return"AnnotationPage";case"cnt:ContentAsText":return"TextualBody"}}if(r&&-1!==W.indexOf(r))return r;if(e.format){if(e.format.startsWith("image/"))return"Image";if(e.format.startsWith("text/")||"application/pdf"===e.format)return"Text";if(e.format.startsWith("application/"))return"Dataset"}return t&&(t.endsWith(".jpg")||t.endsWith(".png")||t.endsWith(".jpeg"))?"Image":r||"unknown"}let Q=/http(s)?:\/\/(creativecommons.org|rightsstatements.org)[^"'\\<\n]+/gm,H=["http://iiif.io/api/presentation/2/context.json","http://iiif.io/api/image/2/context.json","http://iiif.io/api/image/1/context.json","http://library.stanford.edu/iiif/image-api/1.1/context.json","http://iiif.io/api/search/1/context.json","http://iiif.io/api/search/0/context.json","http://iiif.io/api/auth/1/context.json","http://iiif.io/api/auth/0/context.json","http://iiif.io/api/annex/openannotation/context.json"];function K(e){for(let t in e)(void 0===e[t]||null===e[t])&&delete e[t];return e}let z=0;function Y(e,t){let r=encodeURI(e.id||e["@id"]||"").trim();return r&&t?`${r}/${t}`:r||`http://example.org/${e["@type"]}${t?`/${t}`:""}/${++z}`}function Z(e){let t;let r=[...e.behavior||[]];return e.viewingHint&&r.push(e.viewingHint),Array.isArray(e.motivation)?t=e.motivation.map(B):e.motivation&&(t=B(e.motivation)),{"@context":e["@context"]?function(e){if(e){let t=Array.isArray(e)?e:[e],r=[];for(let e of t)"http://iiif.io/api/presentation/2/context.json"===e&&r.push("http://iiif.io/api/presentation/3/context.json"),-1===H.indexOf(e)&&r.push(e);if(t.length)return 1===r.length?r[0]:r}}(e["@context"]):void 0,id:(e["@id"]||Y(e)).trim(),type:V(e),behavior:r.length?r:void 0,height:e.height?e.height:void 0,width:e.width?e.width:void 0,motivation:t,viewingDirection:e.viewingDirection,profile:e.profile,format:e.format?e.format:void 0,duration:void 0,timeMode:void 0}}function G(e){var t;let[r,i]=function(e,t="Rights/License",r="none"){let i=null,n=[],a=Array.isArray(e)?e:[e];for(let e of a){let a=e?function(e){let t=e.match(Q);return t?t[0]:e}(e):void 0;if(a&&(-1!==a.indexOf("creativecommons.org")||-1!==a.indexOf("rightsstatements.org"))){i=a.startsWith("https://")?`http://${a.slice(8)}`:a;continue}a&&n.push({label:{[r]:[t]},value:{[r]:[a]}})}return[i,n]}(e.license),n=[...e.metadata&&(t=e.metadata)?t.map(e=>({label:$(e.label),value:$(e.value)})):[],...i];return{rights:r,metadata:n.length?n:void 0,label:e.label?$(e.label):void 0,requiredStatement:e.attribution?{label:$(F.attributionLabel),value:$(e.attribution)}:void 0,navDate:e.navDate,summary:e.description?$(e.description):void 0,thumbnail:e.thumbnail}}function X(e){let t=e.related?Array.isArray(e.related)?e.related:[e.related]:[],r=e.contentLayer;return{provider:e.logo||t.length?[{id:F.providerId,type:"Agent",homepage:t.length?[t[0]]:void 0,logo:e.logo?Array.isArray(e.logo)?e.logo:[e.logo]:void 0,label:$(F.providerName)}]:void 0,partOf:function(e){if(!e.within)return;let t=Array.isArray(e.within)?e.within:[e.within],r=[];for(let i of t)"string"==typeof i?i&&"sc:Manifest"===e["@type"]&&r.push({id:i,type:"Collection"}):i["@id"]&&r.push({id:i["@id"],type:V(i)});return r.length?r:void 0}(e),rendering:e.rendering,seeAlso:e.seeAlso,start:e.startCanvas,service:e.service?h(e.service):void 0,supplementary:r?[r]:void 0}}function J(e){return K({...Z(e),...G(e),...X(e),chars:e.chars,format:e.format?e.format:void 0,language:e.language})}let ee=new m({collection:[function(e){return K({...Z(e),...G(e),...X(e),items:e.members})}],manifest:[function(e){let t=[],r=[];for(let i of e.sequences||[])i.canvases.length&&t.push(...i.canvases),i.behavior&&r.push(...i.behavior);let i=Z(e);return r.length&&(i.behavior?i.behavior.push(...r):i.behavior=r),K({...i,...G(e),...X(e),items:t,structures:e.structures})}],canvas:[function(e){return K({...Z(e),...G(e),...X(e),annotations:e.otherContent&&e.otherContent.length?e.otherContent:void 0,items:e.images&&e.images.length?[{id:Y(e,"annotation-page"),type:"AnnotationPage",items:e.images}]:void 0})}],annotationList:[function(e){return K({...Z(e),...G(e),...X(e),items:e.resources&&e.resources.length?e.resources:void 0})}],sequence:[function(e){return e.canvases&&0!==e.canvases.length?{canvases:e.canvases,behavior:e.viewingHint?[e.viewingHint]:[]}:{canvases:[],behavior:[]}}],annotation:[function(e){return K({...Z(e),...G(e),...X(e),target:function e(t){if(Array.isArray(t)){if(t.length>1)return{type:"List",items:t.map(e)};t=t[0]}if("string"==typeof t)return encodeURI(t).trim();if(!("@type"in t))return encodeURI(t["@id"]).trim();{let e;if("string"==typeof t.full)e=t.full;else if("dctypes:Image"===t.full["@type"])e={id:t.full["@id"],type:"Image"};else if("sc:Canvas"===t.full["@type"])e={id:t.full["@id"],type:"Canvas"};else throw Error(`Unsupported source type on annotation: ${t.full["@type"]}`);return{type:"SpecificResource",source:e,selector:function e(t){let r=(Array.isArray(t["@type"])&&t["@type"].includes("oa:SvgSelector")||"oa:SvgSelector"==t["@type"])&&("chars"in t||"value"in t);if(r)return{type:"SvgSelector",value:"chars"in t?t.chars:t.value};if("oa:FragmentSelector"===t["@type"])return{type:"FragmentSelector",value:t.value};if("oa:Choice"===t["@type"])return[e(t.default),...(Array.isArray(t.item)?t.item:[t.item]).map(e)];if("iiif:ImageApiSelector"==t["@type"])return{type:"ImageApiSelector",region:"region"in t?t.region:void 0,rotation:"rotation"in t?t.rotation:void 0};throw Error(`Unsupported selector type: ${t["@type"]}`)}(t.selector)}}}(e.on),body:Array.isArray(e.resource)?e.resource.map(J):J(e.resource)})}],contentResource:[J],choice:[function(e){let t=[];return e.default&&"rdf:nil"!==e.default&&t.push(e.default),e.item&&"rdf:nil"!==e.item&&t.push(...e.item),{...Z(e),...G(e),items:t}}],range:[function(e){return K({...Z(e),...G(e),...X(e),items:e.members})}],service:[function(e){let{"@id":t,"@type":r,"@context":i,profile:n,...a}=e,o={};return t&&(o["@id"]=t),o["@type"]=V(e),"unknown"===o["@type"]&&(i&&i.length&&(o["@context"]=i),o["@type"]="Service"),n&&(o.profile=function e(t){return Array.isArray(t)?e(t.find(e=>"string"==typeof e)):-1!==N.indexOf(t)?"level2":-1!==q.indexOf(t)?"level1":"string"==typeof t?t:void 0}(n)),K({...o,...a})}],layer:[function(e){return K({...Z(e),...G(e),...X(e)})}]});function et(e,t){if("string"==typeof e)return{id:e,type:t};if(!e.id)throw Error(`Invalid resource does not have an ID (${t})`);return e}function er(e){return t=>"string"==typeof t?{id:t,type:e}:t.id?t.type?t:{type:e,...t}:{id:`vault://${function(e){let t=JSON.stringify(e),r=5381,i=t.length;for(;i;)r=33*r^t.charCodeAt(--i);let n=r>>>0,a=n.toString(16);return a.length%2?"0"+a:a}(t)}`,type:e,...t}}function ei(e){return t=>({...e,...t})}function en(e){return Array.isArray(e)?e:[e]}function ea(e){return e.body&&(e.body=en(e.body)),e.seeAlso&&(e.seeAlso=en(e.seeAlso)),e.body&&(e.body=en(e.body)),e.audience&&(e.audience=en(e.audience)),e.accessibility&&(e.accessibility=en(e.accessibility)),e.motivation&&(e.motivation=en(e.motivation)),e}let eo="__$UNSET$__",es="__$UNWRAP$__";function el(e){if(!e)return;let t=Object.keys(e);if(0!==t.length){if(1===t.length){let r=t[0];if(!r)return"";let i=(e[r]||[]).join("");return"@none"===r||"none"===r||"en"===r?i:{"@language":r,"@value":i}}return t.map(t=>({"@language":t,"@value":(e[t]||[]).join("")}))}}function ec(e,t=!1){return e?e.length>1&&!t?e:e[0]||void 0:void 0}function eu(e){if(e){if("string"==typeof e)return{"@id":e};if("@id"in e){let t={...e};return delete t["@type"],t}return{"@context":"http://iiif.io/api/image/2/context.json","@id":e.id,profile:`http://iiif.io/api/image/2/profiles/${e.profile}.json`}}}function ep(e,t){return[["@id",e.id],["@type",t],["format",e.format],["height",e.height],["width",e.width],["viewingDirection","left-to-right"!==e.viewingDirection?e.viewingDirection:void 0]]}function*ef(e){let t=e.provider?yield e.provider[0]:void 0;return[["label",el(e.label)],["metadata",e.metadata&&e.metadata.length?e.metadata.map(e=>({label:el(e.label)||"",value:el(e.value)||""})):void 0],["description",el(e.summary)],["thumbnail",ec((yield e.thumbnail))],["navDate",e.navDate],["logo",t?ec(t.logo):void 0],["homepage",t?t.homepage:void 0],["attribution",e.requiredStatement?el(e.requiredStatement.value):void 0]]}function*eh(e){return[["seeAlso",ec((yield e.seeAlso))],["service",ec((e.service||[]).map(eu))],["rendering",ec((yield e.rendering))],["startCanvas",e.start?e.start.id:void 0]]}let ev={Manifest:function*(e){return[...ep(e,"sc:Manifest"),...yield*ef(e),...yield*eh(e),["sequences",[{"@id":`${e.id}/sequence0`,"@type":"sc:Sequence",canvases:yield e.items}]],["structures",(yield e.structures)]]},Canvas:function*(e){let t=yield e.items,r=t[0];return[...ep(e,"sc:Canvas"),...yield*ef(e),...yield*eh(e),["images",r?[r.resources]:void 0],["annotations",e.annotations&&e.annotations.length?ec((yield e.annotations)):void 0]]},AnnotationPage:function*(e){return[...ep(e,"sc:AnnotationList"),...yield*ef(e),["resources",e.items&&e.items.length?ec((yield e.items)):void 0]]},Annotation:function*(e){return[["@id",e.id],["@type","oa:Annotation"],["motivation","sc:painting"],["on",function e(t){return Array.isArray(t)?t.map(t=>e(t)):"string"==typeof t?t:t.type&&"Canvas"===t.type?t.id:t}(e.target)],["resource",ec((yield e.body),!0)]]},ContentResource:function*(e){return"Image"===e.type?[...ep(e,"dctypes:Image"),...yield*ef(e),...yield*eh(e)]:[...ep(e,void 0),...yield*ef(e)]},AnnotationCollection:function*(e){return[["@id",e.id],["@type","sc:Layer"],["label",el(e.label)]]},Collection:function*(e){return[...ep(e,"sc:Collection"),...yield*ef(e),...yield*eh(e),["members",(yield*e.items)]]},Range:function*(e){let t=[],r=[];if(e.items)for(let i of e.items){let n=yield i;t.push({"@id":i.id,"@type":i.type,label:n?n.label:void 0,within:e.id}),"Canvas"===i.type&&r.push(i.id)}return[...ep(e,"sc:Range"),...yield*ef(e),...yield*eh(e),["canvases",r.length===t.length?r:void 0],["members",r.length!==t.length?t:void 0]]}};function ed(e){var t;return[["id",(null==(t=e.id)?void 0:t.startsWith("vault://"))?void 0:e.id],["type",e.type],["format",e.format],["profile",e.profile],["height",e.height],["width",e.width],["duration",e.duration||void 0],["viewingDirection","left-to-right"!==e.viewingDirection?e.viewingDirection:void 0],["behavior",e.behavior&&e.behavior.length?e.behavior:void 0],["timeMode",e.timeMode],["motivation",Array.isArray(e.motivation)?e.motivation[0]:e.motivation]]}function ey(e){if(e&&0!==e.length)return e}function em(e){if(e&&e.type&&"ImageService2"===e.type){let{id:t,type:r,profile:i,...n}=e,a="string"==typeof i?i:Array.isArray(i)?i.find(e=>"string"==typeof e):"";return{"@id":t,"@type":r,profile:a?a.startsWith("http")?a:`http://iiif.io/api/image/2/${a}.json`:"http://iiif.io/api/image/2/level0.json",...n}}return e}function eg(e){if(e&&0!==e.length)return e.map(em)}function*eA(e){return[["label",e.label],["metadata",ey(e.metadata)],["summary",e.summary],["requiredStatement",e.requiredStatement],["rights",e.rights],["navDate",e.navDate],["language",e.language],["thumbnail",ey((yield e.thumbnail))],["placeholderCanvas",(yield e.placeholderCanvas)],["accompanyingCanvas",(yield e.accompanyingCanvas)],["provider",ey((yield e.provider))]]}function*eb(e){return[["seeAlso",ey((yield e.seeAlso))],["service",eg(e.service)],["services",eg(e.services)],["rendering",ey((yield e.rendering))],["supplementary",ey((yield e.supplementary))],["homepage",ey((yield e.homepage))],["logo",ey((yield e.logo))],["partOf",ey((yield e.partOf))],["start",e.start]]}let eC={Manifest:function*(e,t,{isTopLevel:r}){return r?[["@context","http://iiif.io/api/presentation/3/context.json"],...ed(e),...yield*eA(e),...yield*eb(e),["items",(yield e.items)],["structures",ey((yield e.structures))],["annotations",ey((yield e.annotations))]]:[...ed(e),...yield*eA(e)]},Canvas:function*(e){return[...ed(e),...yield*eA(e),...yield*eb(e),["items",(yield e.items)],["annotations",ey((yield e.annotations))]]},Agent:function*(e){return[["id",e.id],["type","Agent"],["label",e.label],...yield*eb(e)]},AnnotationPage:function*(e){let t=Object.entries(e).map(([e,t])=>[e,Array.isArray(t)?ey(t):t]).filter(([e,t])=>"items"!==e);return[...t,...yield*eb(e),["items",(yield e.items)]]},Service:function*(e){return[[es,em(e)]]},Annotation:function*(e){let t=Object.entries(e).map(([e,t])=>"motivation"===e?[e,Array.isArray(t)?t[0]:t]:[e,Array.isArray(t)?ey(t):t]).filter(([e])=>"body"!==e),r=yield e.body;return[...t,["body",1===r.length?r[0]:r]]},ContentResource:function*(e){return[...ed(e),...yield*eA(e),...yield*eb(e),["annotations",ey((yield e.annotations))],["items",ey((yield e.items))]]},AnnotationCollection:function*(e){return[["id",e.id],["type","AnnotationCollection"],["label",e.label]]},Collection:function*(e,t,{isTopLevel:r}){return r?[["@context","http://iiif.io/api/presentation/3/context.json"],...ed(e),...yield*eA(e),...yield*eb(e),["items",ey((yield e.items))]]:[...ed(e),...yield*eA(e)]},Range:function*(e){let t=[];for(let r of e.items)"Range"===r.type?t.push((yield r)):t.push(r);return[...ed(e),...yield*eA(e),...yield*eb(e),["items",t],["annotations",ey((yield e.annotations))]]}};var ew=r(1757);function eE(e){return(eE="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function eR(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function eS(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?eR(Object(r),!0).forEach(function(t){!function(e,t,r){var i;i=function(e,t){if("object"!==eE(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!==eE(i))return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"),(t="symbol"===eE(i)?i:String(i))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):eR(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function eO(e){return"Minified Redux error #"+e+"; visit https://redux.js.org/Errors?code="+e+" for the full message or use the non-minified dev environment for full errors. "}var ej="function"==typeof Symbol&&Symbol.observable||"@@observable",eT=function(){return Math.random().toString(36).substring(7).split("").join(".")},eI={INIT:"@@redux/INIT"+eT(),REPLACE:"@@redux/REPLACE"+eT(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+eT()}};function ex(e){for(var t,r=Object.keys(e),i={},n=0;n<r.length;n++){var a=r[n];"function"==typeof e[a]&&(i[a]=e[a])}var o=Object.keys(i);try{!function(e){Object.keys(e).forEach(function(t){var r=e[t];if(void 0===r(void 0,{type:eI.INIT}))throw Error(eO(12));if(void 0===r(void 0,{type:eI.PROBE_UNKNOWN_ACTION()}))throw Error(eO(13))})}(i)}catch(e){t=e}return function(e,r){if(void 0===e&&(e={}),t)throw t;for(var n=!1,a={},s=0;s<o.length;s++){var l=o[s],c=i[l],u=e[l],p=c(u,r);if(void 0===p)throw r&&r.type,Error(eO(14));a[l]=p,n=n||p!==u}return(n=n||o.length!==Object.keys(e).length)?a:e}}function eP(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return 0===t.length?function(e){return e}:1===t.length?t[0]:t.reduce(function(e,t){return function(){return e(t.apply(void 0,arguments))}})}function ek(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return function(e){return function(){var r=e.apply(void 0,arguments),i=function(){throw Error(eO(15))},n={getState:r.getState,dispatch:function(){return i.apply(void 0,arguments)}},a=t.map(function(e){return e(n)});return i=eP.apply(void 0,a)(r.dispatch),eS(eS({},r),{},{dispatch:i})}}}let eL="@iiif/IMPORT_ENTITIES",eM="@iiif/MODIFY_ENTITY_FIELD",eD="@iiif/REORDER_ENTITY_FIELD",e_="@iiif/ADD_REFERENCE",eU="@iiif/REMOVE_REFERENCE",eq=(0,ew.createAction)(eL)(),eN=(0,ew.createAction)(eM)(),eF=(0,ew.createAction)(eD)(),e$=(0,ew.createAction)(e_)(),eB=(0,ew.createAction)(eU)(),eW={importEntities:eq,modifyEntityField:eN,reorderEntityField:eF,addReference:e$,removeReference:eB},eV="@iiif/ADD_MAPPING",eQ="@iiif/ADD_MAPPINGS",eH=(0,ew.createAction)(eV)(),eK=(0,ew.createAction)(eQ)(),ez="@iiif/SET_META_VALUE",eY="@iiif/SET_META_VALUE_DYNAMIC",eZ="@iiif/UNSET_META_VALUE",eG=(0,ew.createAction)(ez)(),eX=(0,ew.createAction)(eY)(),eJ=(0,ew.createAction)(eZ)(),e0={setMetaValue:eG,setMetaValueDynamic:eX,unsetMetaValue:eJ},e1="RESOURCE_ERROR",e2="RESOURCE_LOADING",e3="RESOURCE_READY",e7="@iiif/REQUEST_RESOURCE",e5="@iiif/REQUEST_ERROR",e4="@iiif/REQUEST_MISMATCH",e6="@iiif/REQUEST_COMPLETE",e8="@iiif/REQUEST_OFFLINE_RESOURCE",e9=(0,ew.createAction)(e7)(),te=(0,ew.createAction)(e5)(),tt=(0,ew.createAction)(e4)(),tr=(0,ew.createAction)(e6)();(0,ew.createAction)(e8)();let ti="@iiif/BATCH",tn="@iiif/BATCH_IMPORT",ta=(0,ew.createAction)(ti)();(0,ew.createAction)(tn)();let to=(e,t)=>{let{entities:r,resource:i,mapping:n}=function(e){var t;let r=e&&e["@context"]&&("http://iiif.io/api/presentation/2/context.json"===e["@context"]||-1!==e["@context"].indexOf("http://iiif.io/api/presentation/2/context.json")||"http://www.shared-canvas.org/ns/context.json"===e["@context"])||"http://iiif.io/api/image/2/context.json"===e["@context"]?ee.traverseUnknown(e):e,i={Collection:{},Manifest:{},Canvas:{},AnnotationPage:{},AnnotationCollection:{},Annotation:{},ContentResource:{},Range:{},Service:{},Selector:{},Agent:{}},n={},a=(e,t)=>{let r=i[e]?i[e]:{};return i=>{let n=et(i,t||e);return n&&n.id&&e?(r[n.id]=r[n.id]?function(e,t){if("string"==typeof e)return e;if(t.id!==e.id||t.type!==e.type)throw Error("Can only merge entities with identical identifiers and type!");return function e(t,r){if(!r)return t;if(Array.isArray(t)){if(!Array.isArray(r))throw Error("Cannot merge array with non-array");let i=[...t];for(let n of r)if(null!=n){if(Array.isArray(n))i.push(n);else if("object"==typeof n&&n.id&&n.type){let t=i.findIndex(e=>e.id===n.id&&e.type===n.type);t>=0&&(i[t]=e(i[t],n))}else -1===t.indexOf(n)&&i.push(n)}return i}if("object"==typeof t){if(Array.isArray(r)||"object"!=typeof r)throw Error("Cannot merge object with non-object");let i={...t};for(let[t,n]of Object.entries(r)){let r=i[t];r!==o&&r?i[t]=e(r,n):i[t]=n}return i}return t||r}({...e},t)}(r[n.id],n):Object.assign({},n),{id:n.id,type:"ContentResource"===e?e:n.type}):n}},h=(t=n,(e,r)=>i=>{let{id:n,type:a}=et(i,r||e);if(void 0===n)throw Error("Found invalid entity without an ID.");return"ContentResource"===e?t[n]=e:t[n]=a,i}),v=new d({collection:[ei(c),h("Collection"),a("Collection")],manifest:[ei(u),h("Manifest"),a("Manifest")],canvas:[ei(l),h("Canvas"),a("Canvas")],annotationPage:[er("AnnotationPage"),ei(s),h("AnnotationPage"),a("AnnotationPage")],annotation:[er("Annotation"),ea,h("Annotation"),a("Annotation")],contentResource:[er("ContentResource"),h("ContentResource"),a("ContentResource")],range:[ei(p),h("Range","Canvas"),a("Range","Canvas")],agent:[ei(f),h("Agent"),a("Agent")]}),y=v.traverseUnknown(r);return{entities:i,resource:y,mapping:n}}(t);if(void 0===i.id)return[te({id:e,message:"ID is not defined in resource."})];let a=[eq({entities:r}),eK({mapping:n})];return i.id!==e&&(a.push(eH({id:e,type:i.type})),a.push(tt({requestId:e,actualId:i.id}))),a.push(tr({id:e})),a},ts=Number.isNaN||function(e){return"number"==typeof e&&e!=e};function tl(e,t){if(!Array.isArray(e)||!Array.isArray(t))return e===t;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++){var r,i;if(!((r=e[n])===(i=t[n])||ts(r)&&ts(i)))return!1}return!0}function tc(e,t){let r=e.iiif.requests[t],i=e.iiif.mapping[t];if(i&&e.iiif.entities[i][r.resourceUri])return e.iiif.entities[i][r.resourceUri]}function tu(e,t,{waitTimeout:r=30}={}){return async(i,n)=>{let a=e.getState(),o=a.iiif.requests[i];if(o)switch(o.loadingState){case e1:break;case e2:{let t;let n=!1;try{let a=await Promise.race([new Promise((r,a)=>{n||(t=e.subscribe(()=>{let t=e.getState();if(t.iiif.requests[i].loadingState===e1){a();return}if(t.iiif.requests[i].loadingState===e3){let e=tc(t,i);e?r(e):a()}}))}),new Promise((e,t)=>setTimeout(()=>{n=!0,t()},60*r))]);if(t&&t(),a)return a}catch(e){t&&t()}break}case e3:{let e=tc(a,i);if(e)return e}}e.dispatch(e9({id:i}));try{let r=await t(i,n);r.id||r["@id"]||(r["@type"]&&(r["@id"]=i),r.id=i);let a=to(i,r);return e.dispatch(ta({actions:a})),tc(e.getState(),i)}catch(t){throw e.dispatch(te({id:i,message:t.toString()})),t}}}let tp=(e={},t)=>{switch(t.type){case eV:return{...e,[t.payload.id]:t.payload.type};case eQ:return{...e,...t.payload.mapping};default:return e}};function tf(e,t,r,i){return!(!e[r]||!e[r][t]||!e[r][t][i]||!Array.isArray(e[r][t][i]))}let th=(e={Collection:{},Manifest:{},Canvas:{},AnnotationPage:{},AnnotationCollection:{},Annotation:{},ContentResource:{},Range:{},Service:{},Selector:{},Agent:{}},t)=>{switch(t.type){case eM:{if(!e[t.payload.type]||!e[t.payload.type][t.payload.id])return e;let r=e[t.payload.type][t.payload.id];if("string"==typeof r)return e;return{...e,[t.payload.type]:{...e[t.payload.type],[t.payload.id]:{...r,[t.payload.key]:t.payload.value}}}}case eD:{if(!tf(e,t.payload.id,t.payload.type,t.payload.key))return e;let r=e[t.payload.type][t.payload.id];if("string"==typeof r)return e;let i=Array.from(r[t.payload.key]),[n]=i.splice(t.payload.startIndex,1);return i.splice(t.payload.endIndex,0,n),{...e,[t.payload.type]:{...e[t.payload.type],[t.payload.id]:{...r,[t.payload.key]:i}}}}case eL:{let r=Object.keys(t.payload.entities),i={...e};for(let n of r){let r=t.payload.entities[n],a={...e[n]||{}},o=!1,s=Object.keys(r||{})||[];if(r&&s){for(let t of s)o=!0,a[t]=e[n][t]?function(e,t){let r={},i=[];for(let[n,a]of Object.entries(e||{})){i.push(n);let e=(t||{})[n];if(!e||0===e.length){r[n]=a;continue}r[n]=e}for(let[e,n]of Object.entries(t||{}))-1===i.indexOf(e)&&(r[e]=n);return r}(e[n][t],r[t]):r[t];o&&(i[n]=a)}}return i}case e_:{if(!tf(e,t.payload.id,t.payload.type,t.payload.key))return e;let r=e[t.payload.type][t.payload.id],i=Array.from(r[t.payload.key]);return i.splice(t.payload.index||i.length+1,0,t.payload.reference),{...e,[t.payload.type]:{...e[t.payload.type],[t.payload.id]:{...r,[t.payload.key]:i}}}}case eU:{if(!tf(e,t.payload.id,t.payload.type,t.payload.key))return e;let r=e[t.payload.type][t.payload.id],i=Array.from(r[t.payload.key]),n=t.payload.index||i.findIndex(e=>e&&e.id===t.payload.reference.id);if(-1===n||i[n]?.id!==t.payload.reference.id)return e;return i.splice(n,1),{...e,[t.payload.type]:{...e[t.payload.type],[t.payload.id]:{...r,[t.payload.key]:i}}}}default:return e}},tv=(e={},t)=>{switch(t.type){case e7:case e8:return{...e,[t.payload.id]:{requestUri:t.payload.id,loadingState:e2,uriMismatch:!1,resourceUri:t.payload.id}};case e4:return{...e,[t.payload.requestId]:{...e[t.payload.requestId]||{},uriMismatch:!0,resourceUri:t.payload.actualId},[t.payload.actualId]:{requestUri:t.payload.requestId,loadingState:e[t.payload.requestId].loadingState,uriMismatch:!0,resourceUri:t.payload.actualId}};case e5:return{...e,[t.payload.id]:{...e[t.payload.id]||{},loadingState:e1,error:t.payload.message}};case e6:return{...e,[t.payload.id]:{...e[t.payload.id]||{},loadingState:e3,error:void 0}}}return e},td=(e={},t)=>{let{id:r,updateValue:i,value:n,meta:a,key:o}=t&&t.payload||{};switch(t.type){case ez:return{...e,[r]:{...e[r]||{},[a]:{...e[r]&&e[r][a]||{},[o]:n}}};case eY:return{...e,[r]:{...e[r]||{},[a]:{...e[r]&&e[r][a]||{},[o]:i(e[r]&&e[r][a]?e[r][a][o]:void 0)}}};case eZ:if(e[r]&&e[r][a]&&e[r][a][o])return{...e,[r]:{...e[r]||{},[a]:{...e[r]&&e[r][a]||{},[o]:void 0}}};return e;default:return e}},ty=ex({mapping:tp,entities:th,requests:tv,meta:td}),tm="undefined"!=typeof window&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||eP;class tg{options;store;emitter;isBatching=!1;batchQueue=[];remoteFetcher;staticFetcher;constructor(e,t){var r;this.options=Object.assign({reducers:{},middleware:[],defaultState:{},customFetcher:this.defaultFetcher,enableDevtools:!0},e||{}),this.store=t||function(e={}){let{enableDevtools:t=!0,iiifStoreName:r="iiif",defaultState:i={},extraMiddleware:n=[],customReducers:a={}}=e,o=ex({[r]:ty,...a}),s=function e(t,r,i){if("function"==typeof r&&"function"==typeof i||"function"==typeof i&&"function"==typeof arguments[3])throw Error(eO(0));if("function"==typeof r&&void 0===i&&(i=r,r=void 0),void 0!==i){if("function"!=typeof i)throw Error(eO(1));return i(e)(t,r)}if("function"!=typeof t)throw Error(eO(2));var n,a=t,o=r,s=[],l=s,c=!1;function u(){l===s&&(l=s.slice())}function p(){if(c)throw Error(eO(3));return o}function f(e){if("function"!=typeof e)throw Error(eO(4));if(c)throw Error(eO(5));var t=!0;return u(),l.push(e),function(){if(t){if(c)throw Error(eO(6));t=!1,u();var r=l.indexOf(e);l.splice(r,1),s=null}}}function h(e){if(!function(e){if("object"!=typeof e||null===e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}(e))throw Error(eO(7));if(void 0===e.type)throw Error(eO(8));if(c)throw Error(eO(9));try{c=!0,o=a(o,e)}finally{c=!1}for(var t=s=l,r=0;r<t.length;r++)(0,t[r])();return e}return h({type:eI.INIT}),(n={dispatch:h,subscribe:f,getState:p,replaceReducer:function(e){if("function"!=typeof e)throw Error(eO(10));a=e,h({type:eI.REPLACE})}})[ej]=function(){var e;return(e={subscribe:function(e){if("object"!=typeof e||null===e)throw Error(eO(11));function t(){e.next&&e.next(p())}return t(),{unsubscribe:f(t)}}})[ej]=function(){return this},e},n}((e,t)=>t&&t.type===ti?t.payload.actions.reduce(o,e):t&&t.type===tn?t.payload.state:o(e,t),i,t?tm(ek(...n)):eP(ek(...n)));return s}({customReducers:this.options.reducers,extraMiddleware:[...this.options.middleware,this.middleware],defaultState:this.options.defaultState,enableDevtools:this.options.enableDevtools}),this.emitter={all:r=r||new Map,on:function(e,t){var i=r.get(e);i?i.push(t):r.set(e,[t])},off:function(e,t){var i=r.get(e);i&&(t?i.splice(i.indexOf(t)>>>0,1):r.set(e,[]))},emit:function(e,t){var i=r.get(e);i&&i.slice().map(function(e){e(t)}),(i=r.get("*"))&&i.slice().map(function(r){r(e,t)})}},this.remoteFetcher=tu(this.store,this.options.customFetcher),this.staticFetcher=tu(this.store,(e,t)=>t)}defaultFetcher=e=>fetch(e).then(e=>e.json());batch(e){this.isBatching=!0;try{e(this),this.store.dispatch(ta({actions:this.batchQueue}))}catch(e){throw this.batchQueue=[],this.isBatching=!1,e}this.batchQueue=[],this.isBatching=!1}async asyncBatch(e){this.isBatching=!0;try{await e(this),this.store.dispatch(ta({actions:this.batchQueue}))}catch(e){throw this.batchQueue=[],this.isBatching=!1,e}this.batchQueue=[],this.isBatching=!1}modifyEntityField(e,t,r){this.dispatch(eW.modifyEntityField({id:e.id,type:e.type,key:t,value:r}))}dispatch(e){this.isBatching?this.batchQueue.push(e):this.store.dispatch(e)}middleware=e=>t=>r=>{if(r.type===ti){for(let t of r.payload.actions)this.emitter.emit(t.type,{realAction:t,state:e.getState()});let i=t(r);for(let e of r.payload.actions)this.emitter.emit(`after:${r.type}`,{action:r,state:i});return i}this.emitter.emit(r.type,{action:r,state:e.getState()});let i=t(r);return this.emitter.emit(`after:${r.type}`,{action:r,state:i}),i};serialize(e,t){return function(e,t,r){if(!t.type||!t.id)throw Error("Unknown entity");if(!r[t.type])throw Error(`Serializer not found for ${t.type}`);return function i(n){let a=r[n.type];if(!a)return eo;let o=function(e,t){let r=e.requests[t],i=e.mapping[t];if(i&&(!r||!r.resourceUri||e.entities[i][r.resourceUri]))return e.entities[i][r?r.resourceUri:t]}(e,n.id)||(n.id&&n.type?n:null);if(!o)return eo;let s=a(o,e,{isTopLevel:t.id===n.id}),l=s.next();for(;!l.done;){let e=l.value,t=eo;if(e){if(Array.isArray(e)){let r=[];for(let t of e)r.push(i(t));t=r}else t=i(e)}l=s.next(t)}return l.value===eo?eo:function(e){let t={};for(let[r,i]of e){if(r===es&&i!==eo)return i;i!==eo&&null!=i&&(t[r]=i)}return t}(l.value)}(t)}(this.getState().iiif,e,t)}toPresentation2(e){return this.serialize(e,ev)}toPresentation3(e){return this.serialize(e,eC)}hydrate(e,t){return this.get(e,t,{skipSelfReturn:!1})}get(e,t,r={}){"string"!=typeof t&&(r=t||{},t=void 0);let{skipSelfReturn:i=!0}=r||{};if(Array.isArray(e))return e.map(e=>this.get(e,r));let n=this.getState();if("string"==typeof e){let r=t||n.iiif.mapping[e];if(!r)return i?null:{id:e,type:"unknown"};e={id:e,type:r}}let a=t||e.type,o=e.id,s=n.iiif.entities[a];if(!s){let t=n.iiif.requests[o];return t&&t.resourceUri!==o?this.get(t.resourceUri,r):i?null:e}return s[e.id]||(i?null:e)}select(e){return e(this.getState())}getStore(){return this.store}getState(){return this.store.getState()}loadManifest(e,t){let r="string"==typeof e?e:e.id;return this.load(r,t)}loadCollection(e,t){let r="string"==typeof e?e:e.id;return this.load(r,t)}load(e,t){let r="string"==typeof e?e:e.id;return t?this.staticFetcher(r,t):this.remoteFetcher(r)}areInputsEqual(e,t){return tl(e,t)}subscribe(e,t,r){void 0===r&&(void 0===t||!1===t||!0===t)&&(r=t,t=e,e=e=>e);let i=r?null:e(this.store.getState());return r||t(i,this),this.store.subscribe(()=>{let r=this.store.getState(),n=e(r);i===n||tl(i,n)||t(n,this),i=n})}async ensureLoaded(e){let t="string"==typeof e?e:e.id;this.requestStatus(t)||await this.load(t)}requestStatus(e){return this.select(t=>t.iiif.requests[e])}getResourceMeta(e,t){let r=this.getState().iiif.meta[e];return r?t?r[t]:r:void 0}setMetaValue([e,t,r],i){this.dispatch("function"==typeof i?e0.setMetaValueDynamic({id:e,meta:t,key:r,updateValue:i}):e0.setMetaValue({id:e,meta:t,key:r,value:i}))}}}}]);